/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/webpack/buildin/amd-options.js":
/*!****************************************!*\
  !*** (webpack)/buildin/amd-options.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */\r\nmodule.exports = __webpack_amd_options__;\r\n\n/* WEBPACK VAR INJECTION */}.call(this, {}))\n\n//# sourceURL=webpack:///(webpack)/buildin/amd-options.js?");

/***/ }),

/***/ "./node_modules/webpack/buildin/harmony-module.js":
/*!*******************************************!*\
  !*** (webpack)/buildin/harmony-module.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = function(originalModule) {\n\tif (!originalModule.webpackPolyfill) {\n\t\tvar module = Object.create(originalModule);\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"exports\", {\n\t\t\tenumerable: true\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n\n\n//# sourceURL=webpack:///(webpack)/buildin/harmony-module.js?");

/***/ }),

/***/ "./src/js/cropBox.js":
/*!***************************!*\
  !*** ./src/js/cropBox.js ***!
  \***************************/
/*! exports provided: CropBox */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CropBox\", function() { return CropBox; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/js/util.js\");\n\nclass CropBox {\n    constructor(options) {\n        const defaults = {\n            ele: ''\n        };\n        options = Object.assign({}, defaults, options);\n        this.ele = options.ele;\n\n        this.init();\n    }\n    init() {\n        this.$ele = typeof this.ele === 'string' ? document.querySelector(this.ele) : this.ele;\n\n        var src = this.$ele.getAttribute('src');\n\n        this.html = `<div class=\"dragbox-wrapper J-dragbox-wrapper\">\n                        <img class=\"J-source\" src=\"${src}\" id=\"img1\">\n                        <img class=\"J-source\" src=\"${src}\" id=\"img2\">\n                        <div id=\"main\">\n                            <div class=\"Divmin up-left\" id=\"up-left\"></div>\n                            <div class=\"Divmin up\" id=\"up\"></div>\n                            <div class=\"Divmin up-right\" id=\"up-right\"></div>\n                            <div class=\"Divmin right\" id=\"right\"></div>\n                            <div class=\"Divmin right-down\" id=\"right-down\"></div>\n                            <div class=\"Divmin down\" id=\"down\"></div>\n                            <div class=\"Divmin left-down\" id=\"left-down\"></div>\n                            <div class=\"Divmin left\" id=\"left\"></div>\n                        </div>\n                    </div>`;\n\n        this.$ele.parentNode.innerHTML = this.html;\n\n        this.$mainDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#main');\n        this.$rightDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#right');\n        this.$leftDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#left');\n        this.$upDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#up');\n        this.$downDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#down');\n        this.$upleftDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#up-left');\n        this.$uprightDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#up-right');\n        this.$rightdownDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#right-down');\n        this.$leftdownDiv = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"_$\"])('#left-down');\n       \n        this._bind();\n        \n        \n        Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"drag\"])(this.$mainDiv, this.$mainDiv, () => {\n            this.setChoice();\n        })\n    }\n    _bind() {\n        let isDraging = false;\n        let contact = \"\"; //表示被按下的触点\n        //鼠标按下时\n        \n        this.$rightDiv.onmousedown = function (e) {\n            e.stopPropagation();\n            isDraging = true;\n            contact = \"right\";\n        }\n        this.$leftDiv.onmousedown = function (e) {\n            e.stopPropagation();\n            isDraging = true;\n            contact = \"left\";\n        }\n        this.$upDiv.onmousedown = function (e) {\n            e.stopPropagation();\n            isDraging = true;\n            contact = \"up\";\n        }\n        this.$downDiv.onmousedown = function (e) {\n            e.stopPropagation();\n            isDraging = true;\n            contact = \"down\";\n        }\n        this.$rightdownDiv.onmousedown = function (e) {\n            e.stopPropagation();\n            isDraging = true;\n            contact = \"right-down\";\n        }\n        this.$leftdownDiv.onmousedown = function (e) {\n            e.stopPropagation();\n            isDraging = true;\n            contact = \"left-down\";\n        }\n        this.$upleftDiv.onmousedown = function (e) {\n            e.stopPropagation();\n            isDraging = true;\n            contact = \"up-left\";\n        }\n        this.$uprightDiv.onmousedown = function (e) {\n            e.stopPropagation();\n            isDraging = true;\n            contact = \"up-right\";\n        }\n        //鼠标松开时\n        window.onmouseup = () => {\n            isDraging = false;\n            this.boxData = {\n                left: this.$mainDiv.offsetLeft,\n                top: this.$mainDiv.offsetTop,\n                width: this.$mainDiv.offsetWidth,\n                height: this.$mainDiv.offsetHeight\n            };\n        }\n        \n        window.onmousemove = (e) => {\n            var e = e || window.event;\n            if (isDraging == true) {\n                switch (contact) {\n                    case \"up\":\n                    this.upMove(e);\n                        break;\n                    case \"right\":\n                    this.rightMove(e);\n                        break;\n                    case \"down\":\n                    this.downMove(e);\n                        break;\n                    case \"left\":\n                    this.leftMove(e);\n                        break;\n                    case \"up-right\":\n                    this.upMove(e);\n                    this.rightMove(e);\n                        break;\n                    case \"right-down\":\n                    this.downMove(e);\n                    this.rightMove(e);\n                        break;\n                    case \"left-down\":\n                    this.downMove(e);\n                    this.leftMove(e);\n                        break;\n                    case \"up-left\":\n                    this.upMove(e);\n                    this.leftMove(e);\n                        break;\n                }\n            }\n        }\n    }\n\n    //获取元素相对于屏幕左边及上边的距离，利用offsetLeft\n    getPosition(el) {\n        var left = el.offsetLeft;\n        var top = el.offsetTop;\n        var parent = el.offsetParent;\n        while (parent != null) {\n            left += parent.offsetLeft;\n            top += parent.offsetTop;\n            parent = parent.offsetParent;\n        }\n        return {\n            \"left\": left,\n            \"top\": top\n        };\n    }\n    //up移动\n    upMove(e) {\n        var y = e.clientY; //鼠标位置的纵坐标\n        var heightBefore = this.$mainDiv.offsetHeight; //选取框变化前的高度\n        var addHeight = this.getPosition(this.$mainDiv).top - y; //增加的高度\n        this.$mainDiv.style.height = heightBefore + addHeight + 'px'; //选取框变化后的宽度\n        this.$mainDiv.style.top = this.$mainDiv.offsetTop - addHeight + 'px'; //相当于变化后左上角的纵坐标，鼠标向上移纵坐标减小，下移增大\n        this.setChoice();\n    }\n    //right移动\n    rightMove(e) {\n        var x = e.clientX; //鼠标位置的横坐标\n        var widthBefore = this.$mainDiv.offsetWidth; //选取框变化前的宽度\n        //var widthBefore = mainDiv.clientWidth;\n        var addWidth = x - this.getPosition(this.$mainDiv).left - widthBefore; //鼠标移动后选取框增加的宽度\n        this.$mainDiv.style.width = widthBefore + addWidth + 'px'; //选取框变化后的宽度\n        this.setChoice();\n    }\n    //down移动\n    downMove(e) {\n        var heightBefore = this.$mainDiv.offsetHeight;\n        var addHeight = e.clientY - this.getPosition(this.$mainDiv).top - this.$mainDiv.offsetHeight;\n        this.$mainDiv.style.height = heightBefore + addHeight + 'px';\n        this.setChoice();\n    }\n    //left移动\n    leftMove(e) {\n        var widthBefore = this.$mainDiv.offsetWidth;\n        var addWidth = this.getPosition(this.$mainDiv).left - e.clientX; //增加的宽度等于距离屏幕左边的距离减去鼠标位置横坐标\n        this.$mainDiv.style.width = widthBefore + addWidth + 'px';\n        this.$mainDiv.style.left = this.$mainDiv.offsetLeft - addWidth + 'px'; //左边的距离（相当于左边位置横坐标）等于选取框距父级元素的距离减去增加的宽度\n        this.setChoice();\n    }\n    \n    \n    \n    //设置选取框图片区域明亮显示\n    setChoice() {\n        var top = this.$mainDiv.offsetTop;\n        var right = this.$mainDiv.offsetLeft + this.$mainDiv.offsetWidth;\n        var bottom = this.$mainDiv.offsetTop + this.$mainDiv.offsetHeight;\n        var left = this.$mainDiv.offsetLeft;\n        img2.style.clip = \"rect(\" + top + \"px,\" + right + \"px,\" + bottom + \"px,\" + left + \"px)\";\n    }\n}\n\n\n\n\n//# sourceURL=webpack:///./src/js/cropBox.js?");

/***/ }),

/***/ "./src/js/dragBox.js":
/*!***************************!*\
  !*** ./src/js/dragBox.js ***!
  \***************************/
/*! exports provided: DragBox */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DragBox\", function() { return DragBox; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/js/util.js\");\n\nclass DragBox {\n    constructor(options) {\n        // 默认配置参数\n        const defaults = {\n            // 待编辑图片元素\n            ele: '',\n            width: '100%',\n            height: '100%',\n            markText: 'producttest.en.made-in-china.com',\n            // 是否有明暗效果，主要是裁剪图片效果\n            hasLight: false,\n            fixRatio: false,\n            // 拖动触点回调函数\n            onDragPoint: (boxData) => {},\n            onDragComplete: () => {}\n        };\n\n        options = Object.assign({}, defaults, options);\n        this.ele = options.ele;\n        this.width = options.width;\n        this.height = options.height;\n        this.markText = options.markText;\n        this.hasLight = options.hasLight;\n        this.fixRatio = options.fixRatio;\n        this.onDragPoint = options.onDragPoint;\n        this.onDragComplete = options.onDragComplete;\n\n        this.init();\n    }\n    init() {\n        this.$ele = $(this.ele);\n        let src = this.$ele.attr('src');\n        let $parent = this.$ele.parent();\n\n        let dragBoxHtml = `<div class=\"dragbox-wrapper J-dragbox-wrapper\">\n                                <img class=\"J-source\" src=\"${src}\">\n                                <div class=\"drag-box J-drag-box\">\n                                    <div class=\"drag-point up-left J-drag-point\"></div>\n                                    <div class=\"drag-point up J-drag-point\"></div>\n                                    <div class=\"drag-point up-right J-drag-point\"></div>\n                                    <div class=\"drag-point right J-drag-point\"></div>\n                                    <div class=\"drag-point right-down J-drag-point\"></div>\n                                    <div class=\"drag-point down J-drag-point\"></div>\n                                    <div class=\"drag-point left-down J-drag-point\"></div>\n                                    <div class=\"drag-point left J-drag-point\"></div>\n                                    <div class=\"mark-txt J-mark-txt\">${this.markText}</div>\n                                </div>\n                            </div>`;\n        if (this.hasLight) {\n            dragBoxHtml = `<div class=\"dragbox-wrapper J-dragbox-wrapper\">\n                                <img class=\"J-source\" src=\"${src}\" id=\"img1\">\n                                <img class=\"J-source\" src=\"${src}\" id=\"img2\">\n                                <div class=\"drag-box J-drag-box\">\n                                    <div class=\"drag-point up-left J-drag-point\"></div>\n                                    <div class=\"drag-point up J-drag-point\"></div>\n                                    <div class=\"drag-point up-right J-drag-point\"></div>\n                                    <div class=\"drag-point right J-drag-point\"></div>\n                                    <div class=\"drag-point right-down J-drag-point\"></div>\n                                    <div class=\"drag-point down J-drag-point\"></div>\n                                    <div class=\"drag-point left-down J-drag-point\"></div>\n                                    <div class=\"drag-point left J-drag-point\"></div>\n                                </div>\n                            </div>`;\n        }\n\n        $parent.html(dragBoxHtml);\n        this.$dragBox = $parent.find('.J-drag-box');\n        this.$dragBox.css({\n            width: this.width,\n            height: this.height\n        });\n        this.$dragPoint = this.$dragBox.find('.J-drag-point');\n\n\n        this.boxEl = this.$dragBox.get(0);\n        this.containerEl = this.boxEl.parentNode;\n\n        this.boxData = {\n            left: this.boxEl.offsetLeft,\n            top: this.boxEl.offsetTop,\n            width: this.boxEl.offsetWidth,\n            height: this.boxEl.offsetHeight,\n            ratio: this.boxEl.offsetWidth / this.boxEl.offsetHeight\n        };\n\n        this._bind();\n\n\n        Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"drag\"])(this.boxEl, this.boxEl, this.boxEl.parentNode, (left, top) => {\n            this._light();\n            this.onDragComplete(left, top);\n        });\n\n\n    }\n    _bind() {\n        let isDraging = false;\n        let contact = \"\"; //表示被按下的触点\n        const DRAGPOINT = ['up-left', 'up', 'up-right', 'right', 'right-down', 'down', 'left-down', 'left'];\n        let dragBoxRatio = this.boxData.width / this.boxData.height;\n        //鼠标按下时\n        this.$dragPoint.on('mousedown', (e) => {\n            e.stopPropagation();\n            isDraging = true;\n            let index = $(e.target).index();\n            contact = DRAGPOINT[index];\n            dragBoxRatio = this.boxData.width / this.boxData.height;\n        })\n\n        $(document).on('mouseup', (e) => {\n            isDraging = false;\n            this.boxData = {\n                left: this.boxEl.offsetLeft,\n                top: this.boxEl.offsetTop,\n                width: this.boxEl.offsetWidth,\n                height: this.boxEl.offsetHeight,\n                ratio: this.boxEl.offsetWidth / this.boxEl.offsetHeight\n            };\n        })\n        $(document).on('mousemove', (e) => {\n            if (isDraging == true) {\n                this._move(e, contact, dragBoxRatio);\n                this._light();\n\n                this.boxData = {\n                    left: this.boxEl.offsetLeft,\n                    top: this.boxEl.offsetTop,\n                    width: this.boxEl.offsetWidth,\n                    height: this.boxEl.offsetHeight,\n                    ratio: this.boxEl.offsetWidth / this.boxEl.offsetHeight\n                };\n\n                this.onDragPoint(this.boxData);\n            }\n        })\n\n    }\n\n    //获取元素相对于屏幕左边及上边的距离，利用offsetLeft\n    _getPosition() {\n        let el = this.boxEl;\n        let left = el.offsetLeft;\n        let top = el.offsetTop;\n        let parent = el.offsetParent;\n        while (parent != null) {\n            left += parent.offsetLeft;\n            top += parent.offsetTop;\n            parent = parent.offsetParent;\n        }\n        return {\n            \"left\": left,\n            \"top\": top\n        };\n    }\n\n    _move(e, contact, dragBoxRatio) {\n\n        let x = e.clientX,\n            y = e.clientY;\n        let oldWidth = this.boxEl.offsetWidth; //选取框变化前的宽度\n        let oldHeight = this.boxEl.offsetHeight; //选取框变化前的高度\n        let position = this._getPosition();\n        let top = position.top;\n        let left = position.left;\n\n\n        let newWidth;\n        let newHeight;\n        let newLeft;\n        let newTop;\n\n        // 约束比例：根据宽度计算高度\n        if (contact.indexOf('left') != -1) {\n            let addWidth = left - x;\n            if (addWidth >= 0 && this.boxEl.offsetLeft <= 0) {\n                return false;\n            }\n\n            newWidth = oldWidth + addWidth;\n            newLeft = this.boxEl.offsetLeft - addWidth;\n        }\n        if (contact.indexOf('right') != -1) {\n            let addWidth = x - left - oldWidth;\n            if (addWidth >= 0 && (this.containerEl.clientWidth - (this.boxEl.offsetLeft + oldWidth + addWidth)) <= 0) {\n                return false;\n            }\n\n            newWidth = oldWidth + addWidth;\n            newLeft = this.boxEl.offsetLeft;\n        }\n        if (contact.indexOf('up') != -1) {\n            let addHeight;\n            if (this.fixRatio) {\n                newHeight = newWidth / dragBoxRatio;\n                addHeight = newHeight - oldHeight;\n            } else {\n                addHeight = top - y;\n                newHeight = oldHeight + addHeight;\n            }\n            newTop = this.boxEl.offsetTop - addHeight;\n\n            if (addHeight >= 0 && this.boxEl.offsetTop <= 0) {\n                return false;\n            }\n        }\n        if (contact.indexOf('down') != -1) {\n            let addHeight;\n            if (this.fixRatio) {\n                newHeight = newWidth / dragBoxRatio;\n                addHeight = newHeight - oldHeight;\n                newTop = this.boxEl.offsetTop;\n            } else {\n                addHeight = y - top - oldHeight;\n                newHeight = oldHeight + addHeight;\n            }\n\n            if (addHeight >= 0 && (this.containerEl.clientHeight - (this.boxEl.offsetTop + oldHeight + addHeight)) <= 0) {\n                return false;\n            }\n\n        }\n\n\n        this.boxEl.style.width = newWidth + 'px';\n        this.boxEl.style.height = newHeight + 'px';\n        this.boxEl.style.left = newLeft + 'px';\n        this.boxEl.style.top = newTop + 'px';\n    }\n    _limitedField() {\n\n    }\n    _light() {\n        if (this.hasLight) {\n            this._setChoice();\n        }\n    }\n    //设置选取框图片区域明亮显示\n    _setChoice() {\n        var top = this.boxEl.offsetTop;\n        var right = this.boxEl.offsetLeft + this.boxEl.offsetWidth;\n        var bottom = this.boxEl.offsetTop + this.boxEl.offsetHeight;\n        var left = this.boxEl.offsetLeft;\n        img2.style.clip = \"rect(\" + top + \"px,\" + right + \"px,\" + bottom + \"px,\" + left + \"px)\";\n    }\n\n    update(width, height) {\n        width && (this.width = width);\n        height && (this.height = height);\n        this.$dragBox.css({\n            width: this.width,\n            height: this.height\n        });\n    }\n}\n\n\n\n\n//# sourceURL=webpack:///./src/js/dragBox.js?");

/***/ }),

/***/ "./src/js/imgHandler.js":
/*!******************************!*\
  !*** ./src/js/imgHandler.js ***!
  \******************************/
/*! exports provided: ImgHandler */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ImgHandler\", function() { return ImgHandler; });\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/js/util.js\");\n\n\nclass ImgHandler {\n\n    constructor(options) {\n\n        // 默认配置参数\n        let defaults = {\n            // 源图片\n            sourceImg: '',\n\n            rotateNum: 0,\n\n            // 裁剪后图片最大值KB\n            maxSize: 500,\n            cropW: '',\n            cropH: '',\n\n            // 裁剪后的图片类型\n            mime: 'image/jpeg',\n\n            // 水印相关参数，若watermarkImg存在则用图片水印，否则用文字水印。\n            // 是否添加水印\n            hasMark: true,\n            textAlign: 'left',\n            // 水印字体，值同css的font\n            markFont: '16px microsoft yahei',\n            // 水印字样式，可选值：color,gradient,pattern\n            markStyle: '#fff',\n            // 水印字文本\n            markText: 'UED',\n            // 水印字x轴位置\n            markX: 0,\n            // 水印字y轴位置\n            markY: 0\n\n        };\n\n\n        options = Object.assign({}, defaults, options);\n\n        this.sourceImg = options.sourceImg;\n        this.rotateNum = options.rotateNum;\n        this.maxSize = options.maxSize;\n        this.cropW = options.cropW;\n        this.cropH = options.cropH;\n\n        this.mime = options.mime;\n\n        this.hasMark = options.hasMark;\n        this.textAlign = options.textAlign;\n        this.markFont = options.markFont;\n        this.markStyle = options.markStyle;\n        this.markText = options.markText;\n        this.markX = options.markX;\n        this.markY = options.markY;\n\n\n        // 全局变量\n        this.sx = 0;\n        this.sy = 0;\n\n        this.scaleRatio = 0.5;\n        this.quality = 0.2;\n\n        this.results = [];\n\n        this.init();\n\n    }\n\n\n\n\n    init() {\n        this.results.push(this.sourceImg);\n\n        let targetImgData = this._getTargetImg();\n        let canvas = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"getCanvas\"])(targetImgData.sourceW0, targetImgData.sourceH0);\n        let ctx = canvas.getContext('2d');\n        ctx.drawImage(this.sourceImg, 0, 0);\n        this.result = canvas;\n    }\n    _getTargetImg() {\n        let targetImg = this.results[this.results.length - 1];\n        let sourceW0 = targetImg.width;\n        let sourceH0 = targetImg.height;\n        if (targetImg.nodeName.toLowerCase() === 'img') {\n            sourceW0 = targetImg.naturalWidth;\n            sourceH0 = targetImg.naturalHeight;\n        }\n        return {\n            targetImg: targetImg,\n            sourceW0: sourceW0,\n            sourceH0: sourceH0\n        }\n    }\n    // 重置\n    reset() {\n        this.results = this.results.slice(0, 1);\n    }\n    // 回退\n    rollback() {\n        this.results.pop();\n    }\n    // 旋转\n    rotate() {\n        let targetImgObj = this._getTargetImg();\n        let targetImg = targetImgObj.targetImg;\n        let sourceW0 = targetImgObj.sourceW0;\n        let sourceH0 = targetImgObj.sourceH0;\n\n\n        let rotateDeg = this.rotateNum * 90;\n\n        let max = Math.max(sourceW0, sourceH0);\n        let tempCvs = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"getCanvas\"])(max, max),\n            tempCtx = tempCvs.getContext('2d');\n\n        tempCtx.translate(max / 2, max / 2);\n        tempCtx.rotate(rotateDeg * Math.PI / 180);\n        tempCtx.translate(-max / 2, -max / 2);\n        tempCtx.drawImage(targetImg, 0, 0);\n\n\n        let w = sourceW0,\n            h = sourceH0,\n            sx = 0,\n            sy = 0;\n        if (this.rotateNum === 1) {\n            w = sourceH0;\n            h = sourceW0;\n            sx = max - w;\n            sy = 0;\n\n        } else if (this.rotateNum === 2) {\n            w = sourceW0;\n            h = sourceH0;\n            sx = max - w;\n            sy = max - h;\n        } else if (this.rotateNum === 3) {\n            w = sourceH0;\n            h = sourceW0;\n            sx = 0;\n            sy = max - h;\n        } else {\n            w = sourceW0;\n            h = sourceH0;\n            sx = 0;\n            sy = 0;\n        }\n\n        let canvas = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"getCanvas\"])(w, h),\n            context = canvas.getContext('2d');\n\n        context.drawImage(tempCvs, sx, sy, w, h, 0, 0, w, h);\n\n        this.base64Data = canvas.toDataURL(this.mime);\n        this.result = canvas;\n        this.results.push(canvas);\n        return this;\n    }\n\n    // 水印\n    mark() {\n        let targetImgObj = this._getTargetImg();\n        let targetImg = targetImgObj.targetImg;\n        let sourceW0 = targetImgObj.sourceW0;\n        let sourceH0 = targetImgObj.sourceH0;\n\n        let canvas = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"getCanvas\"])(sourceW0, sourceH0);\n        let dContext = canvas.getContext('2d');\n        dContext.drawImage(targetImg, 0, 0);\n        if (this.hasMark) {\n            dContext.textBaseline = \"top\";\n            dContext.textAlign = this.textAlign;\n            dContext.font = this.markFont;\n            dContext.fillStyle = this.markStyle;\n            dContext.fillText(this.markText, this.markX, this.markY);\n\n        }\n\n        this.base64Data = canvas.toDataURL(this.mime);\n        this.result = canvas;\n        this.results.push(canvas);\n        return this;\n    }\n\n    // 裁剪\n    crop() {\n        let targetImgObj = this._getTargetImg();\n        let targetImg = targetImgObj.targetImg;\n        let sourceW0 = targetImgObj.sourceW0;\n        let sourceH0 = targetImgObj.sourceH0;\n\n        let canvas = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"getCanvas\"])(this.cropW, this.cropH);\n        let context = canvas.getContext('2d');\n        context.drawImage(targetImg, this.sx, this.sy, this.cropW, this.cropH, 0, 0, this.cropW, this.cropH);\n\n        this.base64Data = canvas.toDataURL(this.mime);\n        this.result = canvas;\n        this.results.push(canvas);\n        return this;\n    }\n    // 缩放\n    scale() {\n        let targetImgObj = this._getTargetImg();\n        let targetImg = targetImgObj.targetImg;\n        let sourceW0 = targetImgObj.sourceW0;\n        let sourceH0 = targetImgObj.sourceH0;\n\n        let resultW = this.scaleRatio * sourceW0;\n        let resultH = this.scaleRatio * sourceH0;\n\n        let canvas = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"getCanvas\"])(resultW, resultH);\n        let context = canvas.getContext('2d');\n        context.drawImage(targetImg, 0, 0, sourceW0, sourceH0, 0, 0, resultW, resultH);\n\n        this.base64Data = canvas.toDataURL(this.mime);\n        this.result = canvas;\n        this.results.push(canvas);\n        return this;\n    }\n    // 压缩\n    compress() {\n        let targetImgObj = this._getTargetImg();\n        let targetImg = targetImgObj.targetImg;\n        let sourceW0 = targetImgObj.sourceW0;\n        let sourceH0 = targetImgObj.sourceH0;\n\n        let canvas = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"getCanvas\"])(sourceW0, sourceH0);\n        let ctx = canvas.getContext(\"2d\");\n\n        if (this.cropW && this.cropH) {\n            ctx.drawImage(targetImg, 0, 0, this.cropW, this.cropH);\n        } else {\n            ctx.drawImage(targetImg, 0, 0);\n        }\n        this.base64Data = canvas.toDataURL(this.mime, this.quality);\n\n        return this.base64Data;\n    }\n\n}\n\n\n\n\n\n//# sourceURL=webpack:///./src/js/imgHandler.js?");

/***/ }),

/***/ "./src/js/pipeImg.js":
/*!***************************!*\
  !*** ./src/js/pipeImg.js ***!
  \***************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* WEBPACK VAR INJECTION */(function(module) {/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \"./src/js/util.js\");\n/* harmony import */ var _imgHandler__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./imgHandler */ \"./src/js/imgHandler.js\");\n/* harmony import */ var _cropBox__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./cropBox */ \"./src/js/cropBox.js\");\n/* harmony import */ var _dragBox__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./dragBox */ \"./src/js/dragBox.js\");\n\n\n\n\n\nclass PipeImg {\n\n    constructor(options) {\n\n        // 默认配置参数\n        let defaults = {\n            ele: '.J-pipeImg-wrapper',\n            source: ['./assets/Jellyfish.jpg'],\n            mime: 'image/jpeg',\n            maxSize: 500\n        };\n\n\n        options = Object.assign({}, defaults, options);\n        this.source = options.source;\n        this.ele = options.ele;\n        this.mime = options.mime;\n        this.maxSize = options.maxSize;\n\n\n\n        this._init();\n\n    }\n\n    _init() {\n        this.$ele = $(this.ele);\n        // 全局变量\n        this.rotateNum = 0;\n        this.scaleRatio = 1;\n\n        this.resultList = [];\n\n        this.imgList = [];\n\n        this.imgBoxHeight = $('.J-img-box').height();\n        this.imgBoxWidth = $('.J-img-box').width();\n        this.imgBoxRatio = this.imgBoxWidth / this.imgBoxHeight;\n\n\n        Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"loadImages\"])(this.source, (images) => {\n            this._loadImagesSuccess(images);\n\n        })\n\n    }\n    _loadImagesSuccess(images) {\n        // 初始化底部缩略图\n        let imgsHtml = '';\n        // 为了显示顺序与配置一致\n        this.imgList = images.reverse();\n        $(this.imgList).each((index, element) => {\n            let thumbnailHtml = '<a class=\"img-thumbnail ' + (index === 0 ? 'active' : '') + ' J-img-thumbnail\" href=\"javascript:void(0)\">' +\n                '<img src=\"' + element.src + '\">' +\n                '</a>';\n            imgsHtml += thumbnailHtml;\n\n        });\n        this.$ele.find('.J-imgs-thumbnail').html(imgsHtml);\n\n        // 待编辑图片\n        this.imgHandler = new _imgHandler__WEBPACK_IMPORTED_MODULE_1__[\"ImgHandler\"]({\n            sourceImg: images[0]\n        });\n\n        this.resultList.push(this.imgHandler.result);\n        this._updateSourceData();\n\n        this._refresh();\n\n        // 初始化裁剪框\n        this.cropBox = new _dragBox__WEBPACK_IMPORTED_MODULE_3__[\"DragBox\"]({\n            ele: '.J-crop-box .J-source',\n            hasLight: true,\n            onDragPoint: (data) => {\n                this._showSize(data.width * this.sourceData.ratio, data.height * this.sourceData.ratio);\n            }\n        });\n        // 初始化水印框\n        this.markBox = new _dragBox__WEBPACK_IMPORTED_MODULE_3__[\"DragBox\"]({\n            ele: '.J-mark-box .J-source',\n            width: 340,\n            height: 35,\n            markText: 'producttest.en.made-in-china.com',\n            onDragComplete: (left, top) => {\n                this.markX = left * this.sourceData.ratio;\n                this.markY = top * this.sourceData.ratio;\n            }\n        });\n        // 初始化批量水印框\n        this.markAllBox = new _dragBox__WEBPACK_IMPORTED_MODULE_3__[\"DragBox\"]({\n            ele: '.J-mark-box-all .J-source',\n            width: 340,\n            height: 35,\n            markText: 'producttest.en.made-in-china.com',\n            onDragComplete: (left, top) => {\n                this.markXAll = left * this.sourceData.ratio;\n                this.markYAll = top * this.sourceData.ratio;\n            }\n        });\n        // 事件绑定\n        this._bind();\n    }\n\n    _bind() {\n        let self = this;\n        // 切换编辑图片\n        this.$ele.find('.J-imgs-thumbnail').on('click', '.J-img-thumbnail', (e) => {\n\n            let $this = $(e.target).parent();\n            $this.addClass('active').siblings().removeClass('active');\n\n            $('.J-source').attr('src', $this.find('img').attr('src'));\n            let targetImg = $('.J-source:first').get(0);\n\n\n            this.imgHandler = new _imgHandler__WEBPACK_IMPORTED_MODULE_1__[\"ImgHandler\"]({\n                sourceImg: targetImg\n            })\n\n            this.resultList = [this.imgHandler.result];\n            this._updateSourceData();\n\n            this._refresh();\n            this._initPanel();\n        })\n\n        // 菜单切换\n        this.$ele.find('.J-menu-item').on('click', function () {\n            let $this = $(this);\n            let index = $this.index();\n            let oldActiveIndex = $this.parent().find('.active:first').index();\n            $this.addClass('active').siblings().removeClass('active');\n            $('.J-panel').eq(index).addClass('active').siblings().removeClass('active');\n\n            // 离开旋转，裁剪，缩放面板进行保存\n            switch (oldActiveIndex) {\n                case 0:\n                    self._saveRotate();\n                    break;\n                case 1:\n                    self._saveCrop();\n                    break;\n                case 2:\n                    self._saveScale();\n                    break;\n                default:\n                    break;\n            }\n\n            // 进入裁剪\n            if (index === 1) {\n                self._initCrop();\n            }\n            // 进入缩放\n            if (index === 2) {\n                self._initScale();\n            }\n            // 进入水印\n            if (index === 3) {\n                self._initMark();\n            }\n            \n            // 进入批量水印\n            if (index === 4) {\n                self._initMarkAll();\n            }\n\n        })\n\n\n        // 旋转++++++++++++++++\n        // 逆时针旋转\n        this.$ele.find('.J-btn-rotate-left').on('click', () => {\n            this._getRotateNum(-1);\n            this._updateRotate();\n        })\n        // 顺时针旋转\n        this.$ele.find('.J-btn-rotate-right').on('click', () => {\n            this._getRotateNum(1);\n            this._updateRotate();\n        })\n        // 裁剪++++++++++++\n        let $cropPanel = this.$ele.find('.J-crop-panel');\n        $cropPanel.find('.J-num-width').on('input', (e) => {\n            this.cropBox.width = $(e.target).val() / this.sourceData.ratio;\n            if (this.cropBox.fixRatio) {\n                this.cropBox.height = this.cropBox.width / this.cropBox.boxData.ratio;\n            }\n            this._updateCrop();\n        })\n        $cropPanel.find('.J-num-height').on('input', (e) => {\n            this.cropBox.height = $(e.target).val() / this.sourceData.ratio;\n            if (this.cropBox.fixRatio) {\n                this.cropBox.width = this.cropBox.height * this.cropBox.boxData.ratio;\n            }\n            this._updateCrop();\n        })\n        $cropPanel.find('.J-fix-ratio').on('change', (e) => {\n            this.cropBox.fixRatio = !this.cropBox.fixRatio;\n        })\n\n        // 缩放++++++++++++++\n        let $scalePanel = this.$ele.find('.J-scale-panel');\n        $scalePanel.find('.J-scale-range').on('input', (e) => {\n            let $this = $(e.target);\n            let max = parseInt($this.attr('max'));\n            this.scaleRatio = parseInt($this.val()) / max;\n            this._updateScale();\n        })\n        $scalePanel.find('.J-num-width').on('input', (e) => {\n            let $this = $(e.target);\n            this.scaleRatio = parseInt($this.val()) / this.sourceData.w0;\n            this._updateScale();\n        })\n        $scalePanel.find('.J-num-height').on('input', (e) => {\n            let $this = $(e.target);\n            this.scaleRatio = parseInt($this.val()) / this.sourceData.h0;\n            this._updateScale();\n        })\n\n        // 水印++++++++++++++\n        let $markPanel = this.$ele.find('.J-mark-panel');\n        $markPanel.find('[name=color],[name=opacity]').on('input', () => {\n            this._updateMark();\n        })\n        $markPanel.find('[name=markTxt]').on('change', () => {\n            this._updateMark();\n        })\n        $markPanel.find('[name=position]').on('change', () => {\n            this._updateMark();\n        })\n        // 水印确定\n        $markPanel.find('.J-button-confirm').on('click', () => {\n            this._saveMark();\n        })\n        // 水印取消\n        this.$ele.find('.J-button-cancel').on('click', () => {\n            this._goHome();\n        })\n        // 批量水印++++++++++++++\n        let $markAllPanel = this.$ele.find('.J-mark-all-panel');\n        $markAllPanel.find('[name=colorAll],[name=opacityAll]').on('input', () => {\n            this._updateMarkAll();\n        })\n        $markAllPanel.find('[name=markTxtAll]').on('change', () => {\n            this._updateMarkAll();\n        })\n        $markAllPanel.find('[name=positionAll]').on('change', () => {\n            this._updateMarkAll();\n        })\n        // 批量水印确定\n        $markAllPanel.find('.J-button-confirm-all').on('click', () => {\n\n            let xPercent = this.markXAll / this.resultList[this.resultList.length - 1].width;\n            let yPercent = this.markYAll / this.resultList[this.resultList.length - 1].height;\n            $(this.imgList).each((index, element) => {\n                let imgHandler = new _imgHandler__WEBPACK_IMPORTED_MODULE_1__[\"ImgHandler\"]({\n                    sourceImg: element\n                });\n                imgHandler.markX = element.width * xPercent;\n                imgHandler.markY = element.height * yPercent;\n\n\n                imgHandler.markText = this.markTextAll;\n                imgHandler.markFont = this.markFontAll;\n                imgHandler.markStyle = this.markStyleAll;\n\n                imgHandler.mark();\n\n                this.save(imgHandler.result);\n                // 模拟关闭编辑窗口\n                this.$ele.hide();\n            })\n\n        })\n\n        // 重置\n        this.$ele.find('.J-button-reset').on('click', () => {\n            this._reset();\n        })\n        // 保存\n        this.$ele.find('.J-button-save').on('click', (e) => {\n            let panelIndex = $(e.target).parents('.J-panel').index();\n            switch (panelIndex) {\n                case 0:\n                    this._saveRotate();\n                    break;\n                case 1:\n                    this._saveCrop();\n                    break;\n                case 2:\n                    this._saveScale();\n                default:\n                    break;\n            }\n\n            let activeImg = this.resultList[this.resultList.length - 1];\n            let base64Data = activeImg.toDataURL(this.mime);\n            let $activeThumbnail = this.$ele.find('.J-img-thumbnail.active');\n            // 更新底部缩略图显示\n            $activeThumbnail.find('img').attr('src', base64Data);\n            // 更新全局数据\n            this.resultList = [activeImg];\n            this.imgList[$activeThumbnail.index()] = activeImg;\n\n            this.save(activeImg);\n        })\n        this.$ele.find('.J-button-close').on('click', () => {\n            this.$ele.hide();\n        })\n\n    }\n    _initPanel() {\n        this._initCrop();\n        this._initScale();\n        this._initMark();\n        this._initMarkAll();\n    }\n    _goHome() {\n        this.$ele.find('.J-menu-item:first').click();\n    }\n    _updateSourceData() {\n\n        let targetImg = this.resultList[this.resultList.length - 1];\n        let w0 = targetImg.width;\n        let h0 = targetImg.height;\n        if (targetImg.nodeName.toLowerCase() === 'img') {\n            w0 = targetImg.naturalWidth;\n            h0 = targetImg.naturalHeight;\n        }\n\n        let targetImgRatio = w0 / h0;\n        let h1;\n        let w1;\n        let ratio;\n        // console.log('targetImgRatio:' + targetImgRatio);\n        if (targetImgRatio < this.imgBoxRatio) {\n            h1 = this.imgBoxHeight;\n            // w1 = h1 * targetImgRatio;\n            w1 = 'auto';\n            ratio = h0 / h1;\n        } else {\n            w1 = this.imgBoxWidth;\n            // h1 = w0 / targetImgRatio;\n            h1 = 'auto';\n            ratio = w0 / w1;\n        }\n\n        this.sourceData = {\n            w0: w0,\n            h0: h0,\n            w1: w1,\n            h1: h1,\n            ratio: ratio,\n            targetImgRatio: targetImgRatio\n        }\n    }\n    _initRotate() {\n        this.rotateNum = 0;\n    }\n    _updateRotate() {\n        let sourceData = this.sourceData;\n\n        $('.J-source').css({\n            'transform': `rotate(${this.rotateNum * 90}deg)`\n        });\n\n        if (this.rotateNum === 1 || this.rotateNum === 3) {\n            // 旋转类90度后\n            if (1 / sourceData.targetImgRatio < this.imgBoxRatio) {\n                $('.J-source').css({\n                    'width': this.imgBoxHeight,\n                    'height': 'auto'\n                });\n            } else {\n                $('.J-source').css({\n                    'width': 'auto',\n                    'height': this.imgBoxWidth\n                });\n            }\n\n        } else {\n\n            if (sourceData.targetImgRatio < this.imgBoxRatio) {\n                $('.J-source').css({\n                    'width': 'auto',\n                    'height': this.imgBoxHeight\n                });\n            } else {\n                $('.J-source').css({\n                    'width': this.imgBoxWidth,\n                    'height': 'auto'\n                });\n            }\n        }\n\n    }\n    _saveRotate() {\n        this.imgHandler.rotateNum = this.rotateNum;\n        this.imgHandler.rotate();\n\n        this.resultList.push(this.imgHandler.result);\n        this._updateSourceData();\n        this._refresh();\n\n    }\n    _initCrop() {\n        let $cropPanel = this.$ele.find('.J-crop-panel');\n\n        this.cropBox.isFixed = $cropPanel.find('.J-fix-ratio').prop('checked');\n        this.cropBox.width = $cropPanel.find('.J-num-width').val() / this.sourceData.ratio;\n        this.cropBox.height = $cropPanel.find('.J-num-height').val() / this.sourceData.ratio;\n    }\n    _updateCrop() {\n        this.cropBox.update();\n    }\n    _saveCrop() {\n        this.sx = this.cropBox.boxData.left * this.sourceData.ratio;\n        this.sy = this.cropBox.boxData.top * this.sourceData.ratio;\n        this.cropW = this.cropBox.boxData.width * this.sourceData.ratio;\n        this.cropH = this.cropBox.boxData.height * this.sourceData.ratio;\n\n        this.imgHandler.cropW = this.cropW;\n        this.imgHandler.cropH = this.cropH;\n        this.imgHandler.sx = this.sx;\n        this.imgHandler.sy = this.sy;\n        this.imgHandler.crop();\n\n        this.resultList.push(this.imgHandler.result);\n        this._updateSourceData();\n        this._refresh();\n    }\n    _initScale() {\n        let $scalePanel = this.$ele.find('.J-scale-panel');\n        let $scaleImgBox = $scalePanel.find('.J-img-box');\n        let $scaleRange = $scalePanel.find('.J-scale-range');\n\n        // 去除预览图的缩放显示\n        $scaleImgBox.find('.J-source').css({\n            width: 'auto',\n            height: 'auto'\n        })\n        // 初始化滑块值\n        $scaleRange.val($scaleRange.attr('max'));\n\n        this.scaleRatio = 1;\n    }\n    _updateScale() {\n        let sourceData = this.sourceData;\n        let scaleRatio = this.scaleRatio;\n\n        let $scalePanel = this.$ele.find('.J-scale-panel');\n        let $scaleRange = $scalePanel.find('.J-scale-range');\n        let $scaleNumWidth = $scalePanel.find('.J-num-width');\n        let $scaleNumHeight = $scalePanel.find('.J-num-height');\n        let max = parseInt($scaleRange.attr('max'));\n\n        if ($scaleNumWidth.val() != sourceData.w0 * scaleRatio) {\n            $scaleNumWidth.val(sourceData.w0 * scaleRatio);\n        }\n        if ($scaleNumHeight.val() != sourceData.h0 * scaleRatio) {\n            $scaleNumHeight.val(sourceData.h0 * scaleRatio);\n        }\n        if ($scaleRange.val() != max * scaleRatio) {\n            $scaleRange.val(max * scaleRatio);\n        }\n\n\n        $('.J-source').css({\n            'transform': `scale(${this.scaleRatio})`\n        });\n    }\n    _saveScale() {\n        this.imgHandler.scaleRatio = this.scaleRatio;\n        this.imgHandler.scale();\n\n        this.resultList.push(this.imgHandler.result);\n        this._updateSourceData();\n        this._refresh();\n\n    }\n    _initMark() {\n        let $markPanel = this.$ele.find('.J-mark-panel');\n        $markPanel.find('.J-color').eq(1).prop('checked', true);\n        $markPanel.find('.J-position').eq(0).prop('checked', true);\n        $markPanel.find('.J-opacity').val(0.8);\n        $markPanel.find('.J-markTxt option:first').prop('selected', true);\n\n        this._updateMark();\n    }\n    _updateMark() {\n        const MARKTXT = ['producttest.en.made-in-china.com', 'Focus Service Co - Product Sourcing'];\n        const POSITION = ['center', 'upLeft', 'upRight', 'downLeft', 'downRight'];\n\n        let $markPanel = this.$ele.find('.J-mark-panel');\n        let colorVal = $markPanel.find('[name=color]:checked').val();\n        let positionVal = $markPanel.find('[name=position]:checked').val();\n        let opacityVal = $markPanel.find('[name=opacity]').val();\n        let markTxtVal = $markPanel.find('[name=markTxt]').val();\n\n        let markStyle = `rgba(255, 255, 255, ${opacityVal})`;\n        if (colorVal === '1') {\n            markStyle = `rgba(0, 0, 0, ${opacityVal})`;\n        }\n\n        this.markFont = 20 * this.sourceData.ratio + 'px microsoft yahei';\n        this.markStyle = markStyle;\n        this.markText = MARKTXT[markTxtVal];\n\n        let $dragBoxWrapper = this.markBox.$dragBox.parent();\n        let dragBoxWrapperWidth = $dragBoxWrapper.width();\n        let dragBoxWrapperHeight = $dragBoxWrapper.height();\n        let dragBoxWidth = this.markBox.$dragBox.width() < dragBoxWrapperWidth ? this.markBox.$dragBox.width() : dragBoxWrapperWidth;\n        let dragBoxHeight = this.markBox.$dragBox.height() < dragBoxWrapperHeight ? this.markBox.$dragBox.height() : dragBoxWrapperHeight;\n\n        switch (POSITION[positionVal]) {\n            case 'center':\n                this.markX = (dragBoxWrapperWidth - dragBoxWidth) / 2 * this.sourceData.ratio;\n                this.markY = (dragBoxWrapperHeight - dragBoxHeight) / 2 * this.sourceData.ratio;\n                break;\n            case 'upLeft':\n                this.markX = 0;\n                this.markY = 0;\n                break;\n            case 'upRight':\n                this.markX = (dragBoxWrapperWidth - dragBoxWidth) * this.sourceData.ratio;\n                this.markY = 0;\n                break;\n            case 'downLeft':\n                this.markX = 0;\n                this.markY = (dragBoxWrapperHeight - dragBoxHeight) * this.sourceData.ratio;\n                break;\n            case 'downRight':\n                this.markX = (dragBoxWrapperWidth - dragBoxWidth) * this.sourceData.ratio;\n                this.markY = (dragBoxWrapperHeight - dragBoxHeight) * this.sourceData.ratio;\n                break;\n            default:\n                break;\n        }\n\n        $markPanel.find('.J-mark-txt').text(this.markText).css({\n            color: this.markStyle\n        });\n        this.markBox.$dragBox.css({\n            left: this.markX / this.sourceData.ratio,\n            top: this.markY / this.sourceData.ratio,\n            width: dragBoxWidth,\n            height: dragBoxHeight\n        })\n    }\n    _saveMark() {\n        this.imgHandler.markX = this.markX;\n        this.imgHandler.markY = this.markY;\n        this.imgHandler.markText = this.markText;\n        this.imgHandler.markFont = this.markFont;\n        this.imgHandler.markStyle = this.markStyle;\n        this.imgHandler.mark();\n\n        this.resultList.push(this.imgHandler.result);\n        this._updateSourceData();\n        this._refresh();\n\n        this._goHome();\n    }\n    _initMarkAll() {\n        let $markPanel = this.$ele.find('.J-mark-all-panel');\n        $markPanel.find('.J-color').eq(1).prop('checked', true);\n        $markPanel.find('.J-position').eq(0).prop('checked', true);\n        $markPanel.find('.J-opacity').val(0.8);\n        $markPanel.find('.J-markTxt option:first').prop('selected', true);\n        this._updateMarkAll();\n    }\n    _updateMarkAll() {\n        const MARKTXT = ['producttest.en.made-in-china.com', 'Focus Service Co - Product Sourcing'];\n        const POSITION = ['center', 'upLeft', 'upRight', 'downLeft', 'downRight'];\n\n        let $markPanel = this.$ele.find('.J-mark-all-panel');\n        let colorVal = $markPanel.find('[name=colorAll]:checked').val();\n        let positionVal = $markPanel.find('[name=positionAll]:checked').val();\n        let opacityVal = $markPanel.find('[name=opacityAll]').val();\n        let markTxtVal = $markPanel.find('[name=markTxtAll]').val();\n\n        let markStyle = `rgba(255, 255, 255, ${opacityVal})`;\n        if (colorVal === '1') {\n            markStyle = `rgba(0, 0, 0, ${opacityVal})`;\n        }\n\n        this.markFontAll = 20 * this.sourceData.ratio + 'px microsoft yahei';\n        this.markStyleAll = markStyle;\n        this.markTextAll = MARKTXT[markTxtVal];\n\n        let $dragBoxWrapper = this.markAllBox.$dragBox.parent();\n        let dragBoxWrapperWidth = $dragBoxWrapper.width();\n        let dragBoxWrapperHeight = $dragBoxWrapper.height();\n        let dragBoxWidth = this.markAllBox.$dragBox.width();\n        let dragBoxHeight = this.markAllBox.$dragBox.height();\n\n        switch (POSITION[positionVal]) {\n            case 'center':\n                this.markXAll = (dragBoxWrapperWidth - dragBoxWidth) / 2 * this.sourceData.ratio;\n                this.markYAll = (dragBoxWrapperHeight - dragBoxHeight) / 2 * this.sourceData.ratio;\n                break;\n            case 'upLeft':\n                this.markXAll = 0;\n                this.markYAll = 0;\n                break;\n            case 'upRight':\n                this.markXAll = (dragBoxWrapperWidth - dragBoxWidth) * this.sourceData.ratio;\n                this.markYAll = 0;\n                break;\n            case 'downLeft':\n                this.markXAll = 0;\n                this.markYAll = (dragBoxWrapperHeight - dragBoxHeight) * this.sourceData.ratio;\n                break;\n            case 'downRight':\n                this.markXAll = (dragBoxWrapperWidth - dragBoxWidth) * this.sourceData.ratio;\n                this.markYAll = (dragBoxWrapperHeight - dragBoxHeight) * this.sourceData.ratio;\n                break;\n            default:\n                break;\n        }\n\n        $markPanel.find('.J-mark-txt').text(this.markTextAll).css({\n            color: this.markStyleAll\n        });\n        this.markAllBox.$dragBox.css({\n            left: this.markXAll / this.sourceData.ratio,\n            top: this.markYAll / this.sourceData.ratio\n        })\n    }\n    _showSize(w0, h0) {\n        // 显示活动图片原始宽高\n        $('.J-num-width').each((index, element) => {\n            if ($(element).get(0).nodeName.toLowerCase() === 'input') {\n                $('.J-num-width').val(w0);\n            } else {\n                $('.J-num-width').html(w0);\n            }\n        })\n        $('.J-num-height').each((index, element) => {\n            if ($(element).get(0).nodeName.toLowerCase() === 'input') {\n                $('.J-num-height').val(h0);\n            } else {\n                $('.J-num-height').html(h0);\n            }\n        })\n    }\n    _refresh() {\n        let base64Data = this.resultList[this.resultList.length - 1].toDataURL(this.mime);\n\n        if ($('.J-img-box').find('.J-source').length > 0) {\n            $('.J-img-box').find('.J-source').attr('src', base64Data);\n        } else {\n            $('.J-img-box').append(`<img class=\"J-source\" src=\"${base64Data}\">`);\n        }\n\n        $('.J-source').removeAttr('style');\n        this.cropBox && (this.cropBox.boxEl.style = '');\n\n        $('.J-img-box').find('.J-source').css({\n            width: this.sourceData.w1,\n            height: this.sourceData.h1\n        })\n\n        this._showSize(this.sourceData.w0, this.sourceData.h0);\n\n    }\n\n    _getRotateNum(direction) {\n        this.rotateNum += direction;\n        if (this.rotateNum > 3) {\n            this.rotateNum = 0;\n        }\n        if (this.rotateNum < 0) {\n            this.rotateNum = 3;\n        }\n    }\n\n    _reset() {\n        this.rotateNum = 0;\n        this.scaleRatio = 1;\n\n        this.resultList = this.resultList.slice(0, 1);\n        this.imgHandler = new _imgHandler__WEBPACK_IMPORTED_MODULE_1__[\"ImgHandler\"]({\n            sourceImg: this.resultList[0]\n        })\n        this._updateSourceData();\n        this._refresh();\n    }\n    save(cvs) {\n        this._getFormData(cvs);\n    }\n    _getFormData(cvs) {\n        if (cvs.nodeName.toLowerCase() !== 'canvas') {\n            return false;\n        }\n        let data = cvs.toDataURL(this.mime);\n        let size0 = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"getBase64Size\"])(data);\n        // console.log('start compress: ' + Math.ceil(size0 / 1024));\n        if (size0 > 1024 * this.maxSize) {\n            let quality = Math.floor(1024 * this.maxSize / size0 * 10) / 10;\n            data = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"compress\"])(resultCvs, quality);\n        }\n        // 模拟处理后图片展示\n        $('#J-preview-container').append($('<img>').attr('src', data));\n\n        let blob = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"base64Data2Blob\"])(data, this.mime);\n        // console.log('end compress: ' + Math.ceil(blob.size / 1024));\n        let formData = Object(_util__WEBPACK_IMPORTED_MODULE_0__[\"blob2FormData\"])(blob);\n\n        $.ajax({\n            url: \"/saveFile\",\n            type: \"POST\",\n            data: formData,\n            processData: false, // 不处理数据\n            contentType: false // 不设置内容类型\n        });\n    }\n\n\n}\n\n\nif (typeof module !== \"undefined\" && module.exports) {\n    module.exports = PipeImg;\n} else if (typeof define === \"function\" && __webpack_require__(/*! !webpack amd options */ \"./node_modules/webpack/buildin/amd-options.js\")) {\n    define(function () {\n        return PipeImg;\n    });\n} else {\n    window.PipeImg = PipeImg;\n}\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../node_modules/webpack/buildin/harmony-module.js */ \"./node_modules/webpack/buildin/harmony-module.js\")(module)))\n\n//# sourceURL=webpack:///./src/js/pipeImg.js?");

/***/ }),

/***/ "./src/js/util.js":
/*!************************!*\
  !*** ./src/js/util.js ***!
  \************************/
/*! exports provided: drag, loadImage, loadImages, getCanvas, getBase64Size, compress, base64Data2Blob, blob2FormData, chooseFile, uploadFile, getImgPromise, _$ */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"drag\", function() { return drag; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"loadImage\", function() { return loadImage; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"loadImages\", function() { return loadImages; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getCanvas\", function() { return getCanvas; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getBase64Size\", function() { return getBase64Size; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"compress\", function() { return compress; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"base64Data2Blob\", function() { return base64Data2Blob; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"blob2FormData\", function() { return blob2FormData; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"chooseFile\", function() { return chooseFile; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"uploadFile\", function() { return uploadFile; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getImgPromise\", function() { return getImgPromise; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"_$\", function() { return _$; });\n//拖拽\nfunction drag(moveElement, dragBar = document, container, cb) {\n    if (!moveElement) return;\n\n    var draging = false,\n        x0, y0, mLeft0, mTop0, mLeft1, mTop1;\n\n    var mousedownHandler = (e) => {\n        e = e || window.event;\n        x0 = e.clientX;\n        y0 = e.clientY;\n        mLeft0 = moveElement.offsetLeft;\n        mTop0 = moveElement.offsetTop;\n\n        draging = true;\n\n    };\n    var mousemoveHandler = (e) => {\n        e = e || window.event;\n        if (draging) {\n            var x1 = e.clientX,\n                y1 = e.clientY;\n            mLeft1 = x1 - x0 + mLeft0;\n            mTop1 = y1 - y0 + mTop0;\n\n\n            if (container) {\n                // 计算可移动位置的大小， 保证元素不会超过可移动范围\n                // 此处就是父元素的宽度减去子元素宽度\n                var width = container.clientWidth - moveElement.offsetWidth;\n                var height = container.clientHeight - moveElement.offsetHeight;\n                // min方法保证不会超过右边界，max保证不会超过左边界\n                mLeft1 = Math.min(Math.max(0, mLeft1), width);\n                mTop1 = Math.min(Math.max(0, mTop1), height);\n            }\n\n\n            moveElement.style.left = mLeft1;\n            moveElement.style.top = mTop1;\n\n            typeof cb === 'function' && cb(mLeft1, mTop1);\n        }\n    };\n    var mouseupHandler = (e) => {\n        draging = false;\n    }\n\n    if (window.addEventListener) {\n        dragBar.addEventListener('mousedown', mousedownHandler, false);\n        document.addEventListener('mousemove', mousemoveHandler, false);\n        document.addEventListener('mouseup', mouseupHandler, false);\n    }\n}\n// 选择器\n// function $(el) {\n//   return (typeof el === \"string\" ? document.querySelector(el) : el);\n// }\nfunction getImgPromise(src) {\n    return new Promise((resolve, reject) => {\n        let image = new Image();\n        // 跨域报错处理（Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.）\n        image.setAttribute('crossorigin', 'anonymous');\n        image.src = src;\n        image.onload = () => {\n            resolve(image);\n        };\n        image.onerror = () => {\n            reject('Error: image error!');\n        };\n    });\n}\n// 加载图片\nfunction loadImage(src, success, failure) {\n    let image = new Image();\n    // 跨域报错处理（Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.）\n    image.setAttribute('crossorigin', 'anonymous');\n    image.src = src;\n    image.onload = function () {\n        typeof success === 'function' && success(image);\n    };\n    image.onerror = function () {\n        typeof failure === 'function' && failure();\n    };\n}\n\nfunction loadImages(srcList, success, failure) {\n    let images = [];\n    let index = srcList.length;\n    let _loadImage = () => {\n        if (index === 0) {\n            return false;\n        }\n        let image = new Image();\n        // 跨域报错处理（Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.）\n        image.setAttribute('crossorigin', 'anonymous');\n        image.src = srcList[--index];\n        image.onload = function () {\n            images.push(image);\n            if (images.length === srcList.length) {\n                typeof success === 'function' && success(images);\n                return false;\n            }\n            _loadImage();\n        };\n        image.onerror = function () {\n            typeof failure === 'function' && failure();\n        };\n    };\n    _loadImage();\n\n}\n// 创建cavas\nfunction getCanvas(width, height) {\n    let canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n}\n\n//获取base64图片大小\nfunction getBase64Size(base64Data) {\n    // 'data:image/jpeg;base64,xxxxxx...xxx='\n    let str = base64Data.replace(/^data:image\\/[\\w]*;base64,$/, '');\n    let equalIndex = str.indexOf('=');\n    if (equalIndex > 0) {\n        str = str.substring(0, equalIndex);\n    }\n    let strLength = str.length;\n    return parseInt(strLength - (strLength / 8) * 2);\n}\n// 压缩只支持image/jpeg和image/webp\nfunction compress(img, quality = 0.6, width, height, mime = 'images/jpeg') { //  Image 对象，或者是 Canvas 元素\n    let canvas = getCanvas(width, height),\n        ctx = canvas.getContext(\"2d\");\n    if (width && height) {\n        ctx.drawImage(img, 0, 0, width, height);\n    } else {\n        ctx.drawImage(img, 0, 0);\n    }\n\n    let base64 = canvas.toDataURL(mime, quality);\n\n    return base64; // 压缩后的base64串\n}\n\n\nfunction base64Data2Blob(base64Data, mime) {\n    let binStr = atob(base64Data.split(',')[1]),\n        len = binStr.length,\n        arr = new Uint8Array(len);\n    if (!mime) {\n        // mime = base64Data.split(',')[0].split(':')[1].split(';')[0];\n        mime = base64Data.substring(base64Data.indexOf('data:') + 5, base64Data.indexOf(';base64'));\n    }\n\n    for (var i = 0; i < len; i++) {\n        arr[i] = binStr.charCodeAt(i);\n    }\n\n    return new Blob([arr], {\n        type: mime\n    });\n\n}\n\nfunction blob2FormData(blob, fileName) {\n    let formData = new FormData();\n    formData.append('file', blob);\n    if (!fileName) {\n        fileName = new Date().getTime();\n    }\n    formData.append(\"fileName\", fileName);\n\n    return formData;\n}\n\n// canvas转成blob对象，type值为image/jpeg或者image/webp时，可使用encoderOptions（0-1）设置图片展示质量。\nfunction canvas2Blob(canvas, callback, type, quality) {\n    // Polyfill\n    if (!HTMLCanvasElement.prototype.toBlob) {\n        Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n            value: function (callback, type, quality) {\n\n                var binStr = atob(this.toDataURL('image/jpeg', quality).split(',')[1]),\n                    len = binStr.length,\n                    arr = new Uint8Array(len);\n\n                for (var i = 0; i < len; i++) {\n                    arr[i] = binStr.charCodeAt(i);\n                }\n\n                callback(new Blob([arr], {\n                    type: type || 'image/png'\n                }));\n            }\n        });\n    }\n\n    canvas.toBlob(callback, type, quality);\n}\n\nfunction uploadFile(formData, url) {\n\n    var xmlHttp = new XMLHttpRequest();\n    xmlHttp.open('POST', url); //注意跨域问题\n    xmlHttp.send(formData);\n    xmlHttp.onreadystatechange = function () {\n        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {\n            console.log(xmlHttp.responseText);\n        } else {\n            console.log(xmlHttp.statusText);\n        }\n    };\n}\n// 选择文件\nfunction chooseFile(btn, cb, validFileCallback) {\n    let $btn = typeof btn === \"string\" ? document.querySelector(btn) : btn;\n    let $file = $btn.querySelector('input[type=file]');\n    if (!$file) {\n        let fileNode = document.createElement('input');\n        fileNode.setAttribute('type', 'file');\n\n        fileNode.style.cssText = 'display: none;';\n        $btn.appendChild(fileNode);\n        $file = $btn.querySelector('input[type=file]');\n    }\n\n    $file.addEventListener('change', function (e) {\n        if (this.files.length > 0) {\n\n            let oFile = this.files[0];\n\n            let validFile = true;\n            if (typeof validFileCallback === 'function' && validFileCallback(oFile) === false) {\n                validFile = false;\n            }\n\n            if (validFile) {\n                let reader = new FileReader();\n                reader.readAsDataURL(oFile);\n\n                reader.onload = function () {\n                    typeof cb === 'function' && cb(this.result);\n                }\n            } else {\n                console.log('onValidateFile function return false')\n            }\n\n        }\n    }, false);\n\n    // 阻止冒泡导致两次触发selectBtn\n    $file.addEventListener('click', (e) => {\n        e.stopPropagation();\n    })\n\n    $file.click();\n\n}\nfunction _$(ele) {\n    return typeof ele === 'string' ? document.querySelector(ele) : ele;\n}\n\n\n\n\n//# sourceURL=webpack:///./src/js/util.js?");

/***/ }),

/***/ 0:
/*!*********************************!*\
  !*** multi ./src/js/pipeImg.js ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("module.exports = __webpack_require__(/*! H:\\workspace\\03pipeImg\\src\\js\\pipeImg.js */\"./src/js/pipeImg.js\");\n\n\n//# sourceURL=webpack:///multi_./src/js/pipeImg.js?");

/***/ })

/******/ });