"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};!function(O,X){void 0!==O&&(O.pipeImg=function(e){var t={selectBtn:X.querySelector("#J-select-btn"),upBtn:X.querySelector("#J-up-btn"),downBtn:X.querySelector("#J-down-btn"),cropBtn:X.querySelector("#J-crop-btn"),downloadBtn:X.querySelector("#J-download-btn"),workingContainer:X.querySelector("#J-working-container"),previewContainer:X.querySelector("#J-preview-container"),scaleStep:10,containerSize:500,cropSize:300,cropImgType:"image/png",borderColor:"rgba(0, 0, 0, 0.8)",hasWatermark:!0,watermarkImg:null,watermarkFont:"16px microsoft yahei",watermarkFillStyle:"#fff",watermarkFillText:"UED",watermarkX:0,watermarkY:0,onValidateFile:function(e){return!0},onCropped:function(e){}},n=_extends({},t,e),r=n.selectBtn,i=n.upBtn,o=n.downBtn,a=n.cropBtn,c=n.downloadBtn,l=n.workingContainer,s=n.previewContainer,d=n.scaleStep,u=n.containerSize,p=n.cropSize<=u?n.cropSize:u,f=n.cropImgType,w=(n.containerSize-n.cropSize)/2,v=n.borderColor,m=n.hasWatermark,y=n.watermarkImg,h=n.watermarkFont,g=n.watermarkFillStyle,k=n.watermarkFillText,S=n.watermarkX?n.watermarkX:p-10,x=n.watermarkY?n.watermarkY:p-10,b=n.onValidateFile,E=n.onCropped,L=void 0,I=0,q=0,C=0,T=0,B=0;function F(){q=L.naturalWidth,C=L.naturalHeight;var e=0,t=0;1<=(I=q/C)?(e=w,t=(u-(T=(B=p)*I))/2):(t=w,e=(u-(B=(T=p)/I))/2),L.style.cssText="position: absolute;width: "+T+"px;height: "+B+"px;top: "+e+"px;left: "+t+"px;"}function z(e){T=(B+=d*e)*I,L.style.width=T+"px",L.style.height=B+"px"}function J(){if(L.src){var e,t,n=(w-L.offsetTop)/B*C,r=(w-L.offsetLeft)/T*q;e=t=p/B*C;var i=X.createElement("canvas"),o=i.getContext("2d");if(i.width=i.height=p,o.drawImage(L,r,n,e,t,0,0,p,p),m)if(y){var a=new Image;a.setAttribute("crossorigin","anonymous"),a.onload=function(){S=p-a.naturalWidth,x=p-a.naturalHeight,o.drawImage(a,S,x),l()},a.src=y}else o.textAlign="end",o.font=h,o.fillStyle=g,o.fillText(k,S,x),l();else l()}function l(){var e=i.toDataURL(f);s.innerHTML='<img src="'+e+'">',"download"in X.createElement("a")&&(c.download=(new Date).valueOf()+"_dest."+f.substr(f.indexOf("image/")+6),c.href=e),E(e)}}!function(){if(E&&"function"!=typeof E)throw new Error("onCropped必须为函数");if(b&&"function"!=typeof b)throw new Error("onValidateFile必须为函数");l.innerHTML='<div class="working-area"><img><div class="mask"></div></div><input type="file" hidden>',l.querySelector(".working-area").style.cssText="position: relative;overflow: hidden;width: "+u+"px;height: "+u+"px;",(L=l.querySelector("img")).style.position="absolute",l.querySelector(".mask").style.cssText="position: absolute;width: "+p+"px;height: "+p+"px;border: "+w+"px solid "+v+";",function(e,o,a){if(e&&o){var l,c,t=function(e,t){return e.currentStyle?e.currentStyle[t]:getComputedStyle(e,null)[t]},s=t(o,"left"),d=t(o,"top"),u=!1;O.addEventListener&&(e.addEventListener("mousedown",function(e){var e=e||O.event;l=e.clientX,c=e.clientY,u=!0},!1),X.addEventListener("mousemove",function(e){var e=e||O.event;if(u){var t=e.clientX,n=e.clientY,r=t-l,i=n-c;return o.style.left=parseInt(s)+r+"px",o.style.top=parseInt(d)+i+"px","function"==typeof a&&a((parseInt(s)||0)+r,(parseInt(d)||0)+i),!1}},!1),X.addEventListener("mouseup",function(e){u=!1,s=t(o,"left"),d=t(o,"top")},!1))}}(l,L),L.addEventListener("load",F,!1),r.addEventListener("click",function(){var e=l.querySelector("input[type=file]");e.addEventListener("change",function(){if(0<this.files.length){var e=this.files[0];if(0!=b(e)){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){L.src=this.result,L.style.width="auto",L.style.height="auto"}}}},!1),e.click()},!1),o.addEventListener("click",function(){z(-1)},!1),i.addEventListener("click",function(){z(1)},!1),a.addEventListener("click",J,!1)}()})}(window,document);