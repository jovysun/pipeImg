"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};!function(O,e){function t(e){var t={selectBtn:document.querySelector("#J-select-btn"),upBtn:document.querySelector("#J-up-btn"),downBtn:document.querySelector("#J-down-btn"),cropBtn:document.querySelector("#J-crop-btn"),downloadBtn:document.querySelector("#J-download-btn"),workingContainer:document.querySelector("#J-working-container"),previewContainer:document.querySelector("#J-preview-container"),scaleStep:10,containerSize:500,cropSize:300,cropImgType:"image/png",borderColor:"rgba(0, 0, 0, 0.8)",hasWatermark:!0,watermarkImg:null,watermarkFont:"16px microsoft yahei",watermarkFillStyle:"#fff",watermarkFillText:"UED",watermarkX:0,watermarkY:0,onValidateFile:function(e){return!0},onCropped:function(e){}},n=_extends({},t,e),r=n.selectBtn,o=n.upBtn,i=n.downBtn,a=n.cropBtn,c=n.downloadBtn,l=n.workingContainer,d=n.previewContainer,s=n.scaleStep,u=n.containerSize,p=n.cropSize<=u?n.cropSize:u,f=n.cropImgType,m=(n.containerSize-n.cropSize)/2,w=n.borderColor,v=n.hasWatermark,y=n.watermarkImg,g=n.watermarkFont,h=n.watermarkFillStyle,k=n.watermarkFillText,x=n.watermarkX?n.watermarkX:p-10,S=n.watermarkY?n.watermarkY:p-10,b=n.onValidateFile,E=n.onCropped,L=void 0,I=0,q=0,C=0,T=0,B=0;function F(){q=L.naturalWidth,C=L.naturalHeight;var e=0,t=0;1<=(I=q/C)?(e=m,t=(u-(T=(B=p)*I))/2):(t=m,e=(u-(B=(T=p)/I))/2),L.style.cssText="position: absolute;width: "+T+"px;height: "+B+"px;top: "+e+"px;left: "+t+"px;"}function z(e){T=(B+=s*e)*I,L.style.width=T+"px",L.style.height=B+"px"}function J(){if(L.src){var e,t,n=(m-L.offsetTop)/B*C,r=(m-L.offsetLeft)/T*q;e=t=p/B*C;var o=document.createElement("canvas"),i=o.getContext("2d");if(o.width=o.height=p,i.drawImage(L,r,n,e,t,0,0,p,p),v)if(y){var a=new Image;a.setAttribute("crossorigin","anonymous"),a.onload=function(){x=p-a.naturalWidth,S=p-a.naturalHeight,i.drawImage(a,x,S),l()},a.src=y}else i.textAlign="end",i.font=g,i.fillStyle=h,i.fillText(k,x,S),l();else l()}function l(){var e=o.toDataURL(f);d.innerHTML='<img src="'+e+'">',"download"in document.createElement("a")&&(c.download=(new Date).valueOf()+"_dest."+f.substr(f.indexOf("image/")+6),c.href=e),E(e)}}!function(){if(E&&"function"!=typeof E)throw new Error("onCropped必须为函数");if(b&&"function"!=typeof b)throw new Error("onValidateFile必须为函数");l.innerHTML='<div class="working-area"><img><div class="mask"></div></div><input type="file" hidden>',l.querySelector(".working-area").style.cssText="position: relative;overflow: hidden;width: "+u+"px;height: "+u+"px;",(L=l.querySelector("img")).style.position="absolute",l.querySelector(".mask").style.cssText="position: absolute;width: "+p+"px;height: "+p+"px;border: "+m+"px solid "+w+";",function(e,i,a){if(e&&i){var l,c,t=function(e,t){return e.currentStyle?e.currentStyle[t]:getComputedStyle(e,null)[t]},d=t(i,"left"),s=t(i,"top"),u=!1;O.addEventListener&&(e.addEventListener("mousedown",function(e){var e=e||O.event;l=e.clientX,c=e.clientY,u=!0},!1),document.addEventListener("mousemove",function(e){var e=e||O.event;if(u){var t=e.clientX,n=e.clientY,r=t-l,o=n-c;return i.style.left=parseInt(d)+r+"px",i.style.top=parseInt(s)+o+"px","function"==typeof a&&a((parseInt(d)||0)+r,(parseInt(s)||0)+o),!1}},!1),document.addEventListener("mouseup",function(e){u=!1,d=t(i,"left"),s=t(i,"top")},!1))}}(l,L),L.addEventListener("load",F,!1),r.addEventListener("click",function(){var e=l.querySelector("input[type=file]");e.addEventListener("change",function(){if(0<this.files.length){var e=this.files[0];if(0!=b(e)){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){L.src=this.result,L.style.width="auto",L.style.height="auto"}}}},!1),e.click()},!1),i.addEventListener("click",function(){z(-1)},!1),o.addEventListener("click",function(){z(1)},!1),a.addEventListener("click",J,!1)}()}void 0!==O&&(O.pipeImg=t),"undefined"!=typeof exports&&(exports.pipeImg=t)}(window,document);