"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};!function(J,O){function e(e){var t={selectBtn:O.getElementById("J-select-btn"),upBtn:O.getElementById("J-up-btn"),downBtn:O.getElementById("J-down-btn"),cropBtn:O.getElementById("J-crop-btn"),downloadBtn:O.getElementById("J-download-btn"),workingContainer:O.getElementById("J-working-container"),previewContainer:O.getElementById("J-preview-container"),scaleStep:10,containerSize:500,cropSize:300,cropImgType:"image/png",borderColor:"rgba(0, 0, 0, 0.4)",hasWatermark:!0,watermarkImg:null,watermarkFont:"16px microsoft yahei",watermarkFillStyle:"#fff",watermarkFillText:"UED",watermarkX:0,watermarkY:0},n=_extends({},t,e),r=n.selectBtn,i=n.upBtn,a=n.downBtn,o=n.cropBtn,s=n.downloadBtn,l=n.workingContainer,d=n.previewContainer,c=n.scaleStep,p=n.containerSize,u=n.cropSize<=p?n.cropSize:p,f=n.cropImgType,m=(n.containerSize-n.cropSize)/2,w=n.borderColor,g=n.hasWatermark,v=n.watermarkImg,y=n.watermarkFont,h=n.watermarkFillStyle,k=n.watermarkFillText,x=n.watermarkX?n.watermarkX:u-10,E=n.watermarkY?n.watermarkY:u-10,I=void 0,S=0,B=0,b=0,L=0,T=0;function C(){B=I.naturalWidth,b=I.naturalHeight;var e=0,t=0;1<=(S=B/b)?(e=m,t=(p-(L=(T=u)*S))/2):(t=m,e=(p-(T=(L=u)/S))/2),I.style.cssText="position: absolute;width: "+L+"px;height: "+T+"px;top: "+e+"px;left: "+t+"px;"}function z(e){L=(T+=c*e)*S,I.style.width=L+"px",I.style.height=T+"px"}function F(){if(I.src){var e,t,n=(m-I.offsetTop)/T*b,r=(m-I.offsetLeft)/L*B;e=t=u/T*b;var i=O.createElement("canvas"),a=i.getContext("2d");if(i.width=i.height=u,a.drawImage(I,r,n,e,t,0,0,u,u),g)if(v){var o=new Image;o.setAttribute("crossorigin","anonymous"),o.onload=function(){x=u-o.naturalWidth,E=u-o.naturalHeight,a.drawImage(o,x,E),l()},o.src=v}else a.textAlign="end",a.font=y,a.fillStyle=h,a.fillText(k,x,E),l();else l()}function l(){var e=i.toDataURL(f);d.innerHTML='<img src="'+e+'">',"download"in O.createElement("a")&&(s.download=(new Date).valueOf()+"_dest."+f.substr(f.indexOf("image/")+6),s.href=e)}}l.innerHTML='<div class="working-area"><img><div class="mask"></div></div><input type="file" hidden>',l.querySelector(".working-area").style.cssText="position: relative;overflow: hidden;width: "+p+"px;height: "+p+"px;",(I=l.querySelector("img")).style.position="absolute",l.querySelector(".mask").style.cssText="position: absolute;width: "+u+"px;height: "+u+"px;border: "+m+"px solid "+w+";",function(e,a,o){if(e&&a){var l,s,t=function(e,t){return e.currentStyle?e.currentStyle[t]:getComputedStyle(e,null)[t]},d=t(a,"left"),c=t(a,"top"),p=!1;J.addEventListener&&(e.addEventListener("mousedown",function(e){var e=e||J.event;l=e.clientX,s=e.clientY,p=!0},!1),O.addEventListener("mousemove",function(e){var e=e||J.event;if(p){var t=e.clientX,n=e.clientY,r=t-l,i=n-s;return a.style.left=parseInt(d)+r+"px",a.style.top=parseInt(c)+i+"px","function"==typeof o&&o((parseInt(d)||0)+r,(parseInt(c)||0)+i),!1}},!1),O.addEventListener("mouseup",function(e){p=!1,d=t(a,"left"),c=t(a,"top")},!1))}}(l,I),I.addEventListener("load",C,!1),r.addEventListener("click",function(){var e=l.querySelector("input[type=file]");e.addEventListener("change",function(){if(0<this.files.length){var e=this.files[0],t=new FileReader;t.readAsDataURL(e),t.onload=function(){I.src=this.result,I.style.width="auto",I.style.height="auto"}}},!1),e.click()},!1),a.addEventListener("click",function(){z(-1)},!1),i.addEventListener("click",function(){z(1)},!1),o.addEventListener("click",F,!1)}void 0!==J&&(J.pipeImg=e),"undefined"!=typeof exports&&(exports.pipeImg=e)}(window,document);