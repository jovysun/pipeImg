"use strict";var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};!function(X,e){function t(e){var t={selectBtn:document.getElementById("J-select-btn"),upBtn:document.getElementById("J-up-btn"),downBtn:document.getElementById("J-down-btn"),cropBtn:document.getElementById("J-crop-btn"),downloadBtn:document.getElementById("J-download-btn"),workingContainer:document.getElementById("J-working-container"),previewContainer:document.getElementById("J-preview-container"),scaleStep:10,containerSize:500,cropSize:300,cropImgType:"image/png",borderColor:"rgba(0, 0, 0, 0.4)",hasWatermark:!0,watermarkImg:null,watermarkFont:"16px microsoft yahei",watermarkFillStyle:"#fff",watermarkFillText:"UED",watermarkX:0,watermarkY:0,onValidateFile:function(e){return!0},onCropped:function(e){}},n=_extends({},t,e),r=n.selectBtn,o=n.upBtn,i=n.downBtn,a=n.cropBtn,d=n.downloadBtn,l=n.workingContainer,c=n.previewContainer,s=n.scaleStep,u=n.containerSize,p=n.cropSize<=u?n.cropSize:u,f=n.cropImgType,m=(n.containerSize-n.cropSize)/2,w=n.borderColor,g=n.hasWatermark,v=n.watermarkImg,y=n.watermarkFont,h=n.watermarkFillStyle,k=n.watermarkFillText,x=n.watermarkX?n.watermarkX:p-10,E=n.watermarkY?n.watermarkY:p-10,I=n.onValidateFile,S=n.onCropped,B=void 0,b=0,L=0,C=0,T=0,F=0;function z(){L=B.naturalWidth,C=B.naturalHeight;var e=0,t=0;1<=(b=L/C)?(e=m,t=(u-(T=(F=p)*b))/2):(t=m,e=(u-(F=(T=p)/b))/2),B.style.cssText="position: absolute;width: "+T+"px;height: "+F+"px;top: "+e+"px;left: "+t+"px;"}function J(e){T=(F+=s*e)*b,B.style.width=T+"px",B.style.height=F+"px"}function O(){if(B.src){var e,t,n=(m-B.offsetTop)/F*C,r=(m-B.offsetLeft)/T*L;e=t=p/F*C;var o=document.createElement("canvas"),i=o.getContext("2d");if(o.width=o.height=p,i.drawImage(B,r,n,e,t,0,0,p,p),g)if(v){var a=new Image;a.setAttribute("crossorigin","anonymous"),a.onload=function(){x=p-a.naturalWidth,E=p-a.naturalHeight,i.drawImage(a,x,E),l()},a.src=v}else i.textAlign="end",i.font=y,i.fillStyle=h,i.fillText(k,x,E),l();else l()}function l(){var e=o.toDataURL(f);c.innerHTML='<img src="'+e+'">',"download"in document.createElement("a")&&(d.download=(new Date).valueOf()+"_dest."+f.substr(f.indexOf("image/")+6),d.href=e),S(e)}}!function(){if(S&&"function"!=typeof S)throw new Error("onCropped必须为函数");if(I&&"function"!=typeof I)throw new Error("onValidateFile必须为函数");l.innerHTML='<div class="working-area"><img><div class="mask"></div></div><input type="file" hidden>',l.querySelector(".working-area").style.cssText="position: relative;overflow: hidden;width: "+u+"px;height: "+u+"px;",(B=l.querySelector("img")).style.position="absolute",l.querySelector(".mask").style.cssText="position: absolute;width: "+p+"px;height: "+p+"px;border: "+m+"px solid "+w+";",function(e,i,a){if(e&&i){var l,d,t=function(e,t){return e.currentStyle?e.currentStyle[t]:getComputedStyle(e,null)[t]},c=t(i,"left"),s=t(i,"top"),u=!1;X.addEventListener&&(e.addEventListener("mousedown",function(e){var e=e||X.event;l=e.clientX,d=e.clientY,u=!0},!1),document.addEventListener("mousemove",function(e){var e=e||X.event;if(u){var t=e.clientX,n=e.clientY,r=t-l,o=n-d;return i.style.left=parseInt(c)+r+"px",i.style.top=parseInt(s)+o+"px","function"==typeof a&&a((parseInt(c)||0)+r,(parseInt(s)||0)+o),!1}},!1),document.addEventListener("mouseup",function(e){u=!1,c=t(i,"left"),s=t(i,"top")},!1))}}(l,B),B.addEventListener("load",z,!1),r.addEventListener("click",function(){var e=l.querySelector("input[type=file]");e.addEventListener("change",function(){if(0<this.files.length){var e=this.files[0];if(0!=I(e)){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){B.src=this.result,B.style.width="auto",B.style.height="auto"}}}},!1),e.click()},!1),i.addEventListener("click",function(){J(-1)},!1),o.addEventListener("click",function(){J(1)},!1),a.addEventListener("click",O,!1)}()}void 0!==X&&(X.pipeImg=t),"undefined"!=typeof exports&&(exports.pipeImg=t)}(window,document);