{"version":3,"file":"pipeImg.js","sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./src/css/pipeImg.scss","webpack:///./src/js/dialog.js","webpack:///./src/js/dialog.tpl","webpack:///./src/js/dragBox.js","webpack:///./src/js/imgHandler.js","webpack:///./src/js/pipeImg.js","webpack:///./src/js/thinSelect.js","webpack:///./src/js/thinSelect.tpl","webpack:///./src/js/thumbnail.tpl","webpack:///./src/js/util.js","webpack:///external {\"commonjs\":\"jQuery\",\"commonjs2\":\"jQuery\",\"amd\":\"jQuery\",\"root\":\"jQuery\"}","webpack:///external {\"commonjs\":\"template\",\"commonjs2\":\"template\",\"amd\":\"template\",\"root\":\"template\"}"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jQuery\"), require(\"template\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"jQuery\", \"template\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"jQuery\"), require(\"template\")) : factory(root[\"jQuery\"], root[\"template\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE_jquery__, __WEBPACK_EXTERNAL_MODULE_template__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/pipeImg.js\");\n","// removed by extract-text-webpack-plugin","import $ from 'jquery';\r\nimport template from 'template';\r\n\r\nimport {\r\n    drag,\r\n    isRealNum\r\n} from './util';\r\nimport {\r\n    DragBox\r\n} from './dragBox';\r\nimport tpl from './dialog.tpl';\r\nimport thumbnailTpl from './thumbnail.tpl';\r\nimport ThinSelect from './thinSelect';\r\n\r\nclass Dialog {\r\n\r\n    constructor(options) {\r\n\r\n        // 默认配置参数\r\n        let defaults = {\r\n            debug: false,\r\n            imgList: ['data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'],\r\n            activeIndex: 0,\r\n            type: '0',\r\n            template: tpl,\r\n            thumbnailTpl: thumbnailTpl,\r\n            mime: 'image/jpeg',\r\n            markXPositionMargin: 15,\r\n            markYPositionMargin: 20,\r\n            markTextList: ['producttest.en.made-in-china.com', 'Focus Service Co - Product Sourcing'],\r\n\r\n            closeBtnTxt: '关闭',\r\n            saveBtnTxt: '保存',\r\n            resetBtnTxt: '重置',\r\n            confirmBtnTxt: '确定',\r\n            cancelBtnTxt: '取消',\r\n            rotateMenuTxt: '旋转',\r\n            turnLeftTxt: '逆时针旋转',\r\n            turnRightTxt: '顺时针旋转',\r\n            cropMenuTxt: '裁剪',\r\n            scaleMenuTxt: '缩放',\r\n            markMenuTxt: '添加水印',\r\n            colorTxt: '颜色',\r\n            positionTxt: '位置',\r\n            opacityTxt: '透明度',\r\n            showRoomTxt: '展示厅',\r\n            companyNameTxt: '公司名称',\r\n            markAllMenuTxt: '批量添加水印',\r\n            tipTitleTxt: '提示',\r\n            tipContentTxt: '尚未保存，是否确定离开？',\r\n            tipConfirmBtnTxt: '确定',\r\n            constrainTxt: '约束比例',\r\n\r\n            onSaveRotate: (args, cb) => {},\r\n            onSaveCrop: (args, cb) => {},\r\n            onSaveScale: (args, cb) => {},\r\n            onSaveMark: (args, cb) => {},\r\n            onReset: (cb) => {},\r\n            onSave: (cb) => {},\r\n            onChangeActive: (options, cb) => {},\r\n            onSaveMarkAll: (cb) => {},\r\n            onComplete: (result) => {}\r\n\r\n        };\r\n\r\n\r\n        options = Object.assign({}, defaults, options);\r\n\r\n        this.debug = options.debug;\r\n        this.imgList = options.imgList;\r\n        this.activeIndex = options.activeIndex;\r\n        this.type = options.type;\r\n        this.template = options.template;\r\n        this.thumbnailTpl = options.thumbnailTpl;\r\n        this.mime = options.mime;\r\n        this.markXPositionMargin = options.markXPositionMargin;\r\n        this.markYPositionMargin = options.markYPositionMargin;\r\n        this.markTextList = options.markTextList;\r\n        this.closeBtnTxt = options.closeBtnTxt;\r\n        this.saveBtnTxt = options.saveBtnTxt;\r\n        this.resetBtnTxt = options.resetBtnTxt;\r\n        this.confirmBtnTxt = options.confirmBtnTxt;\r\n        this.cancelBtnTxt = options.cancelBtnTxt;\r\n        this.rotateMenuTxt = options.rotateMenuTxt;\r\n        this.turnLeftTxt = options.turnLeftTxt;\r\n        this.turnRightTxt = options.turnRightTxt;\r\n        this.cropMenuTxt = options.cropMenuTxt;\r\n        this.scaleMenuTxt = options.scaleMenuTxt;\r\n        this.markMenuTxt = options.markMenuTxt;\r\n        this.colorTxt = options.colorTxt;\r\n        this.positionTxt = options.positionTxt;\r\n        this.opacityTxt = options.opacityTxt;\r\n        this.showRoomTxt = options.showRoomTxt;\r\n        this.companyNameTxt = options.companyNameTxt;\r\n        this.markAllMenuTxt = options.markAllMenuTxt;\r\n        this.tipTitleTxt = options.tipTitleTxt;\r\n        this.tipContentTxt = options.tipContentTxt;\r\n        this.tipConfirmBtnTxt = options.tipConfirmBtnTxt;\r\n        this.constrainTxt = options.constrainTxt;\r\n\r\n        this.onSaveRotate = options.onSaveRotate;\r\n        this.onSaveCrop = options.onSaveCrop;\r\n        this.onSaveScale = options.onSaveScale;\r\n        this.onSaveMark = options.onSaveMark;\r\n        this.onReset = options.onReset;\r\n        this.onSave = options.onSave;\r\n        this.onChangeActive = options.onChangeActive;\r\n        this.onSaveMarkAll = options.onSaveMarkAll;\r\n        this.onComplete = options.onComplete;\r\n\r\n        this._init();\r\n\r\n    }\r\n\r\n    _init() {\r\n        let templateHtml = template(this.template, {\r\n            imgList: this.imgList,\r\n            activeIndex: this.activeIndex,\r\n            type: this.type,\r\n            closeBtnTxt: this.closeBtnTxt,\r\n            saveBtnTxt: this.saveBtnTxt,\r\n            resetBtnTxt: this.resetBtnTxt,\r\n            confirmBtnTxt: this.confirmBtnTxt,\r\n            cancelBtnTxt: this.cancelBtnTxt,\r\n            rotateMenuTxt: this.rotateMenuTxt,\r\n            turnLeftTxt: this.turnLeftTxt,\r\n            turnRightTxt: this.turnRightTxt,\r\n            cropMenuTxt: this.cropMenuTxt,\r\n            scaleMenuTxt: this.scaleMenuTxt,\r\n            markMenuTxt: this.markMenuTxt,\r\n            colorTxt: this.colorTxt,\r\n            positionTxt: this.positionTxt,\r\n            opacityTxt: this.opacityTxt,\r\n            showRoomTxt: this.showRoomTxt,\r\n            companyNameTxt: this.companyNameTxt,\r\n            markAllMenuTxt: this.markAllMenuTxt,\r\n            tipTitleTxt: this.tipTitleTxt,\r\n            tipContentTxt: this.tipContentTxt,\r\n            tipConfirmBtnTxt: this.tipConfirmBtnTxt,\r\n            constrainTxt: this.constrainTxt\r\n        });\r\n\r\n        let html = '<div class=\"pipeImg-dialog J-pipe-dialog\" onselectstart=\"return false\" ondragstart=\"return false\"><div class=\"pipe-mask J-pipe-mask\"></div>' + templateHtml + '</div>';\r\n        $('body').append(html);\r\n\r\n        this.$el = $('.J-pipe-dialog');\r\n        this.$pipeWrapper = this.$el.find('.J-pipe-wrapper');\r\n\r\n\r\n        // 通用按钮\r\n        this.$btnClose = this.$el.find('.J-button-close');\r\n        this.$btnSave = this.$el.find('.J-button-save');\r\n        this.$btnReset = this.$el.find('.J-button-reset');\r\n        this.$btnConfirm = this.$el.find('.J-button-confirm');\r\n        this.$btnCancel = this.$el.find('.J-button-cancel');\r\n        this.$btnSaveAll = this.$el.find('.J-button-confirm-all');\r\n        this.$btnCancelAll = this.$el.find('.J-button-cancel-all');\r\n\r\n        // 模块按钮\r\n        // 旋转\r\n        this.$rotatePanel = this.$el.find('.J-rotate-panel');\r\n        this.$txtRotateWidth = this.$rotatePanel.find('.J-num-width');\r\n        this.$txtRotateHeight = this.$rotatePanel.find('.J-num-height');\r\n        this.$btnRotateLeft = this.$el.find('.J-btn-rotate-left');\r\n        this.$btnRotateRight = this.$el.find('.J-btn-rotate-right');\r\n        // 裁剪\r\n        this.$cropPanel = this.$el.find('.J-crop-panel');\r\n        this.$inputCropWidth = this.$cropPanel.find('.J-num-width');\r\n        this.$inputCropHeight = this.$cropPanel.find('.J-num-height');\r\n        this.$radioCropFix = this.$cropPanel.find('.J-fix-ratio');\r\n        // 缩放\r\n        this.$scalePanel = this.$el.find('.J-scale-panel');\r\n        this.$inputScaleWidth = this.$scalePanel.find('.J-num-width');\r\n        this.$inputScaleHeight = this.$scalePanel.find('.J-num-height');\r\n        this.$rangeScaleRatio = this.$scalePanel.find('.J-scale-range');\r\n        // 添加水印\r\n        this.$markPanel = this.$el.find('.J-mark-panel');\r\n        this.$radioMarkColor = this.$markPanel.find('.J-color');\r\n        this.$radioMarkPosition = this.$markPanel.find('.J-position');\r\n        this.$rangeMarkOpacity = this.$markPanel.find('.J-opacity');\r\n        this.$selectMarkTxt = this.$markPanel.find('.J-select-mark');\r\n        // 批量添加水印\r\n        this.$markAllPanel = this.$el.find('.J-mark-all-panel');\r\n        this.$radioMarkAllColor = this.$markAllPanel.find('.J-color');\r\n        this.$radioMarkAllPosition = this.$markAllPanel.find('.J-position');\r\n        this.$rangeMarkAllOpacity = this.$markAllPanel.find('.J-opacity');\r\n        this.$selectMarkAllTxt = this.$markAllPanel.find('.J-select-mark');\r\n\r\n        this.$buttons = this.$el.find('.J-button-save, .J-button-reset, .J-button-confirm, .J-button-cancel, .J-button-confirm-all, .J-button-cancel-all');\r\n\r\n        // 全局变量\r\n        this.loaded = false;\r\n        this.MARKTYPE = {'SINGLE': '0', 'MULTIPLE': '1'};\r\n        this.isChange = false;\r\n        this.rotateNum = 0;\r\n        this.scaleRatio = 1;\r\n\r\n        this.imgBoxHeight = this.$el.find('.J-img-box').height();\r\n        this.imgBoxWidth = this.$el.find('.J-img-box').width();\r\n        this.imgBoxRatio = this.imgBoxWidth / this.imgBoxHeight;\r\n\r\n        this._bind();\r\n\r\n        this.$el.find('.J-img-box').addClass('loading');\r\n    }\r\n    renderImgList(imgList, activeIndex) {\r\n        this.$el.find('.J-img-box').removeClass('loading');\r\n\r\n        this.imgList = imgList;\r\n        this.activeIndex = activeIndex;\r\n        this.activeImg = this.imgList[this.activeIndex];\r\n        this._updateActiveData();\r\n        \r\n\r\n        \r\n        \r\n        \r\n        // 初始化自定义select\r\n        this.markSelects = ThinSelect.use(this.$el.find('.J-select-mark'));\r\n\r\n        // 初始化缩略图\r\n        this.$el.find('.J-pipe-footer').find('.J-imgs-thumbnail').html(template(this.thumbnailTpl, {\r\n            imgList: this.imgList,\r\n            activeIndex: this.activeIndex,\r\n            markType: '0'\r\n        }))\r\n        this.$markAllPanel.find('.J-imgs-thumbnail').html(template(this.thumbnailTpl, {\r\n            imgList: this.imgList,\r\n            activeIndex: this.activeIndex,\r\n            markType: '1'\r\n        }));\r\n\r\n        // 初始化裁剪框\r\n        this.cropBox = new DragBox({\r\n            el: this.$cropPanel.find('.J-source'),\r\n            isCrop: true,\r\n            onDragPoint: (data) => {\r\n                this._showSize(data.width * this.activeData.ratio, data.height * this.activeData.ratio);\r\n                this._updateIsChange(true);\r\n            }\r\n        });\r\n\r\n        // 初始化缩放\r\n        let $scaleImgWrapper = this.$scalePanel.find('.J-scale-img-wrapper');\r\n        let imgEl = this.$scalePanel.find('.J-source').get(0);\r\n        drag(imgEl, imgEl, $scaleImgWrapper.get(0));\r\n\r\n\r\n\r\n        // 初始化水印框\r\n        this.markBox = new DragBox({\r\n            el: this.$markPanel.find('.J-source'),\r\n            fixRatio: true,\r\n            markText: this.markTextList[0],\r\n            onDragComplete: (left, top) => {\r\n                this.$markPanel.find('.J-position').prop('checked', false);\r\n\r\n                // this._updateIsChange(true);\r\n            },\r\n            onDragPoint: (boxData) => {\r\n                this.$markPanel.find('.J-mark-txt').css({\r\n                    'font-size': Math.floor(parseInt(this.markBox.$dragBox.css('height')) / this.markLineHeight0 * this.markFontSize0)\r\n                });\r\n                // this.markBox.$dragBox.find('.J-mark-txt').css({\r\n                //     'display': 'block'\r\n                // });\r\n\r\n            },\r\n            onDragPointComplete: (boxData) => {\r\n                this.markBox.$dragBox.css({\r\n                    'width': this.markBox.$dragBox.find('.J-mark-txt').css('width'),\r\n                    'height': this.markBox.$dragBox.find('.J-mark-txt').css('height')\r\n                });\r\n                // this.markFontSize0 = parseInt(this.markBox.$dragBox.find('.J-mark-txt').css('font-size')) * this.activeData.ratio;\r\n                // this.markLineHeight0 = parseInt(this.markBox.$dragBox.find('.J-mark-txt').css('line-height')) * this.activeData.ratio;        \r\n\r\n            }\r\n\r\n        });\r\n        \r\n\r\n\r\n\r\n        // 初始化批量水印框\r\n        this.markAllBox = new DragBox({\r\n            el: this.$markAllPanel.find('.J-source'),\r\n            fixRatio: true,\r\n            markText: this.markTextList[0],\r\n            onDragComplete: (left, top) => {\r\n                this.$markAllPanel.find('.J-position').prop('checked', false);\r\n                // this._updateIsChange(true);\r\n            },\r\n            onDragPoint: (boxData) => {\r\n                this.$markAllPanel.find('.J-mark-txt').css({\r\n                    'font-size': Math.round(parseInt(this.markAllBox.$dragBox.css('height')) / this.markLineHeight0 * this.markFontSize0)\r\n                });\r\n                // this.markAllBox.$dragBox.find('.J-mark-txt').css({\r\n                //     'display': 'block'\r\n                // });\r\n                // this.markAllBox.$dragBox.css('width', this.markAllBox.$dragBox.find('.J-mark-txt').css('width'));\r\n            },\r\n            onDragPointComplete: (boxData) => {\r\n                let $markTxt = this.markAllBox.$dragBox.find('.J-mark-txt');\r\n                this.markAllBox.$dragBox.css({\r\n                    'width': $markTxt.css('width'),\r\n                    'height': $markTxt.css('height')\r\n                });\r\n                this.markAllFontSize1 = parseInt($markTxt.css('font-size')) * this.activeData.ratio;\r\n                this.markAllLineHeight1 = parseInt($markTxt.css('line-height')) * this.activeData.ratio;    \r\n\r\n            }\r\n        });\r\n\r\n        // 初始值\r\n        this.markFontSize1 = this.markFontSize0 = parseInt(this.markBox.$dragBox.find('.J-mark-txt').css('font-size'));\r\n        this.markLineHeight1 = this.markLineHeight0 = parseInt(this.markBox.$dragBox.find('.J-mark-txt').css('line-height'));\r\n        this.markAllFontSize1 = this.markAllFontSize0 = parseInt(this.markAllBox.$dragBox.find('.J-mark-txt').css('font-size'));\r\n        this.markAllLineHeight1 = this.markAllLineHeight0 = parseInt(this.markAllBox.$dragBox.find('.J-mark-txt').css('line-height'));\r\n\r\n\r\n        this.type === this.MARKTYPE.MULTIPLE && this.showModel(this.type);\r\n        this._refresh();\r\n\r\n        this._updateMarkTxt();\r\n        this._updateMarkTxt(this.MARKTYPE.MULTIPLE);\r\n        this._setMarkPosition();\r\n        this._setMarkPosition(this.MARKTYPE.MULTIPLE);\r\n\r\n\r\n\r\n\r\n        // 图片加载完成，激活首屏按钮\r\n        this.loaded = true;\r\n        this.$el.find('.J-menu-btn,.J-btn-rotate-left,.J-btn-rotate-right,.J-menu-btn-mark-all,.J-menu-btn-mark').addClass('loaded');\r\n    }\r\n    _bind() {\r\n        // 切换编辑图片\r\n        this.$el.find('.J-pipe-footer').on('click', '.J-img-thumbnail', (e) => {\r\n            let run = () => {\r\n                let $thumbnail = $(e.currentTarget);\r\n                $thumbnail.addClass('active').siblings().removeClass('active');\r\n\r\n                let $thumbnailImg = $thumbnail.find('img');\r\n                this.$el.find('.J-panel').not('.J-mark-all-panel').find('.J-source').attr('src', $thumbnailImg.attr('src'));\r\n\r\n                this._updateActiveImg($thumbnail.index());\r\n                this._goHome();\r\n                this._initData();\r\n            };\r\n            if (this.isChange) {\r\n                this._confirm(() => {\r\n                    run();\r\n                    this._updateIsChange(false);\r\n                })                \r\n            } else {\r\n                run();\r\n            }\r\n\r\n        })\r\n        // 批量水印切换编辑图片\r\n        this.$markAllPanel.on('click', '.J-img-thumbnail', (e) => {\r\n            let $thumbnail = $(e.currentTarget);\r\n            $thumbnail.addClass('active').siblings().removeClass('active');\r\n\r\n            let $thumbnailImg = $thumbnail.find('img');\r\n            this.$markAllPanel.find('.J-source').attr('src', $thumbnailImg.attr('src'));\r\n\r\n            this._updateActiveImg($thumbnail.index());\r\n            this._updateMarkTxt(this.MARKTYPE.MULTIPLE);\r\n            this._setMarkPosition(this.MARKTYPE.MULTIPLE);\r\n            this._initData();\r\n\r\n        })\r\n\r\n        // 菜单切换\r\n        this.$el.find('.J-menu-btn').on('click', (e) => {\r\n            if (!this.loaded) {\r\n                return;\r\n            }\r\n            let run = () => { \r\n                let $item = $(e.currentTarget).parent();\r\n                let index = $item.index();\r\n                let oldActiveIndex = $item.parent().find('.active:first').index();\r\n\r\n                this.showModel(this.MARKTYPE.SINGLE);\r\n                this.showMenu(index);\r\n\r\n                // 若有编辑操作，离开旋转，裁剪，缩放面板进行保存\r\n                if (this.isChange) {\r\n                    switch (oldActiveIndex) {\r\n                        case 0:\r\n                        this._saveRotate();\r\n                            break;\r\n                        case 1:\r\n                        this._saveCrop();\r\n                            break;\r\n                        case 2:\r\n                        this._saveScale();\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                }\r\n\r\n                // 进入裁剪\r\n                if (index === 1) {\r\n                    this._initCrop();\r\n                }\r\n                // 进入缩放\r\n                if (index === 2) {\r\n                    this._initScale();\r\n                }\r\n                // 进入水印\r\n                if (index === 3) {\r\n                    // this._updateMarkTxt();\r\n                    this._initMark();\r\n                    \r\n                }\r\n             \r\n            };\r\n\r\n\r\n            // 离开批量水印模式提示\r\n            if (this.$markAllPanel.hasClass('active')) {\r\n                this._confirm(() => {\r\n                    // 切换到单图编辑模式重置活动图片\r\n                    let $thumbnail = this.$el.find('.J-pipe-footer').find('.J-img-thumbnail.active');\r\n                    this._updateActiveImg($thumbnail.index());\r\n\r\n                    run();\r\n                    this._updateIsChange(false);\r\n                })                \r\n            }else{\r\n                run();\r\n            }\r\n            \r\n\r\n        })\r\n        // 切换水印\r\n        this.$el.find('.J-item-mark').on('click', '.J-menu-btn-mark', (e) => {\r\n            let run = () => {\r\n                let $thumbnail = this.$el.find('.J-pipe-footer').find('.J-img-thumbnail.active');\r\n\r\n                this._updateActiveImg($thumbnail.index());\r\n                this.showModel(this.MARKTYPE.SINGLE);\r\n                this.showMenu(3);\r\n                this._initMark();\r\n                this._updateIsChange(false);\r\n            };\r\n            this._confirm(run);\r\n\r\n        })\r\n        // 切换批量水印\r\n        this.$el.find('.J-item-mark').on('click', '.J-menu-btn-mark-all', (e) => {\r\n            if (!this.loaded) {\r\n                return;\r\n            }\r\n            let run = () => {\r\n                let $thumbnail = this.$markAllPanel.find('.J-img-thumbnail.active');\r\n\r\n                this._updateActiveImg($thumbnail.index());\r\n                this.showModel(this.MARKTYPE.MULTIPLE);             \r\n                this._initMark(this.MARKTYPE.MULTIPLE);\r\n                this._updateIsChange(false);\r\n                this._initData();\r\n            };\r\n            if (this.isChange) {\r\n                this._confirm(run);             \r\n            } else {\r\n                run();\r\n            }\r\n\r\n        })\r\n\r\n\r\n        // 旋转++++++++++++++++\r\n        // 逆时针旋转\r\n        this.$btnRotateLeft.on('click', () => {\r\n            if (!this.loaded) {\r\n                return;\r\n            }\r\n            this._getRotateNum(-1);\r\n            this._updateRotate();\r\n        })\r\n        // 顺时针旋转\r\n        this.$btnRotateRight.on('click', () => {\r\n            if (!this.loaded) {\r\n                return;\r\n            }\r\n            this._getRotateNum(1);\r\n            this._updateRotate();\r\n        })\r\n\r\n        // 裁剪++++++++++++\r\n        this.$inputCropWidth.on('input', (e) => {\r\n            let $input = $(e.currentTarget);\r\n\r\n\r\n            let value = $input.val();\r\n            $input.val($input.val().replace(/[^\\d]/g,''));\r\n            \r\n            if (value === '') {\r\n                return;\r\n            } else {\r\n                value = parseInt($input.val())\r\n            }\r\n\r\n\r\n            // let value = $input.val() != '' ? parseInt($input.val()) : 0;\r\n            if (value > this.activeData.w0) {\r\n                // 此刻slice比substr与substring好用\r\n                $input.val($input.val().slice(0, -1));\r\n                return\r\n            }\r\n            if (value < 50) {\r\n                if (value <= this.activeData.w0) {\r\n                    value = this.activeData.w0;\r\n                } else {\r\n                    value = 50;\r\n                }\r\n            }\r\n            \r\n            this.cropW = value;\r\n            if (this.fixRatio) {\r\n                this.cropH = Math.floor(value / this.activeData.imgRatio);\r\n                this.$inputCropHeight.val(this.cropH);\r\n            }\r\n\r\n            this._updateCrop();\r\n        }).on('blur', (e) => {\r\n            let $input = $(e.currentTarget);\r\n            let value = $input.val() != '' ? parseInt($input.val()) : 0;\r\n\r\n            if (value < 50) {\r\n                if (value <= this.activeData.w0) {\r\n                    value = this.activeData.w0;\r\n                } else {\r\n                    value = 50;\r\n                }\r\n\r\n                $input.val(value);\r\n                if (this.fixRatio) {\r\n                    this.$inputCropHeight.val(Math.floor(value / this.activeData.imgRatio));\r\n                }\r\n                this.cropW = value;\r\n                this.cropH = this.$inputCropHeight.val();\r\n                this._updateCrop();\r\n            }\r\n\r\n        });\r\n        this.$inputCropHeight.on('input', (e) => {\r\n            let $input = $(e.currentTarget);\r\n\r\n            let value = $input.val();\r\n            $input.val($input.val().replace(/[^\\d]/g,''));\r\n            \r\n            if (value === '') {\r\n                return;\r\n            } else {\r\n                value = parseInt($input.val())\r\n            }\r\n\r\n            // let value =  $input.val() != '' ? parseInt( $input.val()) : 0;\r\n            if (value > this.activeData.h0) {\r\n                $input.val($input.val().slice(0, -1));\r\n                return\r\n            }\r\n\r\n            if (value < 50) {\r\n                if (value <= this.activeData.h0) {\r\n                    value = this.activeData.h0;\r\n                } else {\r\n                    value = 50;\r\n                }\r\n            }\r\n\r\n            this.cropH = value;\r\n            if (this.fixRatio) {\r\n                this.cropW = Math.floor(value * this.activeData.imgRatio);\r\n                this.$inputCropWidth.val(this.cropW);\r\n            }\r\n\r\n            this._updateCrop();\r\n        }).on('blur', (e) => {\r\n            let $input = $(e.currentTarget);\r\n            let value = $input.val() != '' ? parseInt($input.val()) : 0;\r\n\r\n            if (value < 50) {\r\n                if (value <= this.activeData.h0) {\r\n                    value = this.activeData.h0;\r\n                } else {\r\n                    value = 50;\r\n                }\r\n                \r\n\r\n                $input.val(value);\r\n                if (this.fixRatio) {\r\n                    this.$inputCropWidth.val(Math.floor(value * this.activeData.imgRatio));\r\n                }\r\n\r\n                this.cropW = this.$inputCropWidth.val();\r\n                this.cropH = value;\r\n                this._updateCrop();\r\n            }\r\n\r\n        });\r\n        this.$radioCropFix.on('change', (e) => {\r\n            this.fixRatio = !this.fixRatio;\r\n            this.cropBox.fixRatio = this.fixRatio;\r\n        });\r\n\r\n        // 缩放++++++++++++++\r\n        this.$inputScaleWidth.on('input', (e) => {\r\n            let $input = $(e.currentTarget);\r\n            let value = $input.val();\r\n            $input.val($input.val().replace(/[^\\d]/g,''));\r\n            \r\n            if (value === '') {\r\n                return;\r\n            } else {\r\n                value = parseInt($input.val())\r\n            }\r\n\r\n            if (value > this.activeData.w0) {\r\n                $input.val($input.val().slice(0, -1));\r\n                return\r\n            }\r\n\r\n            if (value > 50) {\r\n                this.scaleRatio = value / this.activeData.w0;\r\n                this._updateScale();\r\n            }\r\n\r\n        }).on('blur', (e) => {\r\n            let $input = $(e.currentTarget);\r\n            let value = $input.val();\r\n            if (value === '' || parseInt(value) < 50) {\r\n                value = Math.floor(parseInt(this.$inputScaleHeight.val()) * this.activeData.imgRatio);\r\n                $input.val(value);\r\n            }\r\n        });\r\n        this.$inputScaleHeight.on('input', (e) => {\r\n            let $input = $(e.currentTarget);\r\n            let value = $input.val();\r\n            $input.val($input.val().replace(/[^\\d]/g,''));\r\n            \r\n            if (value === '') {\r\n                return;\r\n            } else {\r\n                value = parseInt($input.val())\r\n            }\r\n\r\n            if (value > this.activeData.h0) {\r\n                $input.val($input.val().slice(0, -1));\r\n                return\r\n            }\r\n\r\n            if (value > 50) {\r\n                this.scaleRatio = value / this.activeData.h0;\r\n                this._updateScale();\r\n            }\r\n\r\n        }).on('blur', (e) => {\r\n            let $input = $(e.currentTarget);\r\n            let value = $input.val();\r\n            if (value === '' || parseInt(value) < 50) {\r\n                value = Math.floor(parseInt(this.$inputScaleWidth.val()) / this.activeData.imgRatio);\r\n                $input.val(value);\r\n            }\r\n        });\r\n        // IE11下change事件连续触发\r\n        this.$rangeScaleRatio.on('change', (e) => {\r\n            let $this = $(e.target);\r\n            let max = parseInt($this.attr('max'));\r\n            let value = parseInt($this.val());\r\n            this.scaleRatio = value / max;\r\n            this._updateScale();\r\n        });\r\n        // chrome下input事件连续触发，change只有停止拖动时触发\r\n        this.$rangeScaleRatio.on('input', (e) => {\r\n            let $this = $(e.target);\r\n            let max = parseInt($this.attr('max'));\r\n            let value = parseInt($this.val());\r\n            this.scaleRatio = value / max;\r\n            this._updateScale();\r\n        });\r\n        // 水印++++++++++++++\r\n        this.$radioMarkColor.on('change', () => {\r\n            this._updateMark();\r\n        })\r\n        this.$rangeMarkOpacity.on('input', () => {\r\n            this._updateMark();\r\n        })\r\n        this.$rangeMarkOpacity.on('change', () => {\r\n            this._updateMark();\r\n        })\r\n        this.$selectMarkTxt.on('change', () => {\r\n            // this.markBox.$dragBox.find('.J-mark-txt').css({\r\n            //     'display': 'inline-block',\r\n            //     'font-size': this.markFontSize0\r\n            // });\r\n\r\n            this._updateMark();\r\n        })\r\n        this.$radioMarkPosition.on('change', () => {\r\n            this._updateMark();\r\n        })\r\n\r\n        // 批量水印++++++++++++++\r\n        this.$radioMarkAllColor.on('change', () => {\r\n            this._updateMark(this.MARKTYPE.MULTIPLE);\r\n        })\r\n        this.$rangeMarkAllOpacity.on('input', () => {\r\n            this._updateMark(this.MARKTYPE.MULTIPLE);\r\n        })\r\n        this.$rangeMarkAllOpacity.on('change', () => {\r\n            this._updateMark(this.MARKTYPE.MULTIPLE);\r\n        })\r\n        this.$selectMarkAllTxt.on('change', () => {\r\n            // this.markAllBox.$dragBox.find('.J-mark-txt').css({\r\n            //     'display': 'inline-block',\r\n            //     'font-size': this.markFontSize0\r\n            // });\r\n            this._updateMark(this.MARKTYPE.MULTIPLE);\r\n        })\r\n        this.$radioMarkAllPosition.on('change', () => {\r\n            this._updateMark(this.MARKTYPE.MULTIPLE);\r\n        })\r\n\r\n\r\n        // 水印确定\r\n        this.$btnConfirm.on('click', () => {\r\n            this._saveMark();\r\n        })\r\n        // 水印取消\r\n        this.$btnCancel.on('click', () => {\r\n            this._cancelMark();\r\n        })\r\n        // 批量水印确定\r\n        this.$btnSaveAll.on('click', () => {\r\n            this._showProgress();\r\n            this._saveMarkAll();\r\n        })\r\n        // 批量水印取消\r\n        this.$btnCancelAll.on('click', () => {\r\n            if (this.isChange) {\r\n                this._confirm(() => {\r\n                    this.destory();\r\n                })\r\n            } else {\r\n                this.destory();\r\n            }\r\n            \r\n        })\r\n        // 重置\r\n        this.$btnReset.on('click', () => {\r\n            if (this.isChange) {\r\n                this._reset();\r\n            }\r\n        })\r\n        // 保存\r\n        this.$btnSave.on('click', (e) => {\r\n            if (this.isChange) {\r\n                this._showProgress();\r\n                let panelIndex = this.$el.find('.J-panel.active').index();\r\n                switch (panelIndex) {\r\n                    case 0:\r\n                        this._saveRotate();\r\n                        break;\r\n                    case 1:\r\n                        this._saveCrop();\r\n                        break;\r\n                    case 2:\r\n                        this._saveScale();\r\n                    default:\r\n                        break;\r\n                }\r\n                this._save();\r\n            }\r\n\r\n        })\r\n        // 关闭\r\n        this.$btnClose.on('click', (e) => {\r\n            if (this.isChange) {\r\n                this._confirm(() => {\r\n                    this.destory();\r\n                })                \r\n            } else {\r\n                this.destory();\r\n            }\r\n\r\n        })\r\n        // 禁用鼠标右击菜单\r\n        this.$el.on('contextmenu', (e) => {\r\n            return this.debug;\r\n        })\r\n\r\n    }\r\n\r\n    _goHome() {\r\n        this.$el.find('.J-menu-btn').parent(':first').addClass('active').siblings().removeClass('active');\r\n        this.$el.find('.J-panel:first').addClass('active').siblings().removeClass('active');\r\n\r\n        this.$el.find('.J-item-mark').find('.J-menu-btn').show();\r\n        this.$el.find('.J-item-mark').find('.J-menu-txt').hide();\r\n    }\r\n\r\n    _initRotate() {\r\n        this.rotateNum = 0;\r\n    }\r\n    _updateRotate() {\r\n        this.$el.find('.J-source').css({\r\n            'transform': `rotate(${this.rotateNum * 90}deg)`\r\n        });\r\n\r\n        let width, height;\r\n        if (this.rotateNum === 1 || this.rotateNum === 3) {\r\n            // 旋转类90度后\r\n            if (1 / this.activeData.imgRatio < this.imgBoxRatio) {\r\n                width = Math.min(this.imgBoxHeight, this.activeData.w0);\r\n                height = 'auto';\r\n            } else {\r\n                width = 'auto';\r\n                height = Math.min(this.imgBoxWidth, this.activeData.h0);\r\n            }\r\n\r\n            this.$txtRotateWidth.text(this.activeData.h0);\r\n            this.$txtRotateHeight.text(this.activeData.w0);           \r\n\r\n        } else {\r\n            if (this.activeData.imgRatio < this.imgBoxRatio) {\r\n                width = 'auto';\r\n                height = Math.min(this.imgBoxHeight, this.activeData.h0);\r\n            } else {\r\n                width = Math.min(this.imgBoxWidth, this.activeData.w0);\r\n                height = 'auto';\r\n            }\r\n\r\n            this.$txtRotateWidth.text(this.activeData.w0);\r\n            this.$txtRotateHeight.text(this.activeData.h0);     \r\n        }\r\n\r\n        this.$el.find('.J-source').css({\r\n            'width': width,\r\n            'height': height\r\n        });\r\n\r\n        this._updateIsChange(true);\r\n    }\r\n    _saveRotate() {\r\n        if (this.rotateNum === 0) {\r\n            return false;\r\n        }\r\n        let options = {\r\n            rotateNum: this.rotateNum\r\n        };\r\n        this.onSaveRotate(options, (img) => {\r\n            this.rotateNum = 0;\r\n            this.activeImg = img;\r\n            this._updateActiveData();\r\n            this._refresh();\r\n        });   \r\n    }\r\n    _initCrop() {\r\n        this.$radioCropFix.prop('checked', false);\r\n\r\n        this.fixRatio = this.$radioCropFix.prop('checked');\r\n        this.cropW = this.$inputCropWidth.val();\r\n        this.cropH = this.$inputCropHeight.val();\r\n\r\n        this.cropBox.width = this.cropW / this.activeData.ratio;\r\n        this.cropBox.height = this.cropH / this.activeData.ratio;\r\n        this.cropBox.fixRatio = this.fixRatio;\r\n    }\r\n    _updateCrop() {\r\n        this.cropBox.width = this.cropW / this.activeData.ratio;\r\n        this.cropBox.height = this.cropH / this.activeData.ratio;\r\n        this.cropBox.fixRatio = this.fixRatio;\r\n\r\n        this.cropBox.update();\r\n        this._updateIsChange(true);\r\n    }\r\n    _saveCrop() {\r\n        if (this.cropBox.boxData.left === 0 && this.cropBox.boxData.top === 0 && Math.floor(this.cropBox.boxData.width) === Math.floor(this.activeData.w1) && Math.floor(this.cropBox.boxData.height) === Math.floor(this.activeData.h1)) {\r\n            return false;\r\n        }\r\n        let options = {\r\n            sx: Math.max(this.cropBox.boxData.left * this.activeData.ratio, 0),\r\n            sy: Math.max(this.cropBox.boxData.top * this.activeData.ratio, 0),\r\n            cropW: Math.min(this.cropBox.boxData.width * this.activeData.ratio, this.activeData.w0),\r\n            cropH: Math.min(this.cropBox.boxData.height * this.activeData.ratio, this.activeData.h0)\r\n        };\r\n        this.onSaveCrop(options, (img) => {\r\n            this.activeImg = img;\r\n            this._updateActiveData();\r\n            this._refresh();\r\n        })\r\n    }\r\n\r\n    _initScale() {\r\n        let $scaleImgBox = this.$scalePanel.find('.J-img-box');\r\n        let $scaleRange = this.$scalePanel.find('.J-scale-range');\r\n        let $scaleImgWrapper = this.$scalePanel.find('.J-scale-img-wrapper');\r\n\r\n        let $img = $scaleImgBox.find('.J-source');\r\n\r\n        let width, height;\r\n        if (this.activeData.w0 < this.imgBoxWidth) {\r\n            width = this.imgBoxWidth;\r\n        } else {\r\n            width = this.activeData.w0 + (this.activeData.w0 - this.imgBoxWidth);\r\n        }\r\n        if (this.activeData.h0 < this.imgBoxHeight) {\r\n            height = this.imgBoxHeight;\r\n        } else {\r\n            height = this.activeData.h0 + (this.activeData.h0 - this.imgBoxHeight);\r\n        }\r\n        $scaleImgWrapper.css({\r\n            'width': width,\r\n            'height': height,\r\n            'margin-left': -width / 2,\r\n            'margin-top': -height / 2\r\n        });\r\n        // 去除预览图的缩放显示\r\n        $img.css({\r\n            'position': 'absolute',\r\n            'left': (width - this.activeData.w0) / 2,\r\n            'top': (height - this.activeData.h0) / 2,\r\n            'width': this.activeData.w0,\r\n            'height': this.activeData.h0,\r\n            'max-width': 'none',\r\n            'max-height': 'none',\r\n            'cursor': 'move'\r\n        })\r\n        // 初始化滑块值\r\n        $scaleRange.attr('max', this.activeData.w0);\r\n        $scaleRange.val(this.activeData.w0);\r\n\r\n        this.scaleRatio = 1;\r\n    }\r\n    _updateScale() {\r\n        let max = parseInt(this.$rangeScaleRatio.attr('max'));\r\n\r\n        let newWidth = Math.floor(this.activeData.w0 * this.scaleRatio);\r\n        let newHeight = Math.floor(this.activeData.h0 * this.scaleRatio);\r\n        let newRange = Math.floor(max * this.scaleRatio);\r\n        if (this.$inputScaleWidth.val() != newWidth) {\r\n            this.$inputScaleWidth.val(newWidth);\r\n        }\r\n        if (this.$inputScaleHeight.val() != newHeight) {\r\n            this.$inputScaleHeight.val(newHeight);\r\n        }\r\n        if (this.$rangeScaleRatio.val() != newRange) {\r\n            this.$rangeScaleRatio.val(newRange);\r\n        }\r\n\r\n        this.$scalePanel.find('.J-source').css({\r\n            'transform': `scale(${this.scaleRatio})`\r\n        });\r\n\r\n        this._updateIsChange(true);\r\n    }\r\n    _saveScale() {\r\n        if (this.scaleRatio === 1) {\r\n            return false;\r\n        }\r\n        let options = {\r\n            scaleRatio: this.scaleRatio,\r\n        };\r\n        this.onSaveScale(options, (img) => {\r\n            this.scaleRatio = 1;\r\n            this.activeImg = img;\r\n            this._updateActiveData();\r\n            this._refresh();\r\n            this._initScale();\r\n        })\r\n\r\n    }\r\n\r\n    // 水印相关操作start++++++++++++++++++++++++++++++++++++++++\r\n    _setMarkPosition(type) {\r\n        const POSITION = ['center', 'upLeft', 'upRight', 'downLeft', 'downRight'];\r\n\r\n        let $panel = type === this.MARKTYPE.MULTIPLE ? this.$markAllPanel : this.$markPanel;\r\n        let $dragBox = type === this.MARKTYPE.MULTIPLE ? this.markAllBox.$dragBox : this.markBox.$dragBox;\r\n        let $markTxt = $dragBox.find('.J-mark-txt');\r\n        let $markSvg = $dragBox.find('.J-mark-svg');\r\n\r\n        let markX = parseInt($dragBox.css('left'));\r\n        let markY = parseInt($dragBox.css('top'));\r\n\r\n        let positionVal = $panel.find('.J-position:checked').val();\r\n\r\n        let dragBoxWrapperWidth = this.activeData.w1;\r\n        let dragBoxWrapperHeight = this.activeData.h1;\r\n        // let dragBoxWidth = $markTxt.outerWidth();\r\n        // let dragBoxHeight = $markTxt.outerHeight();\r\n        let dragBoxWidth = $markSvg.outerWidth();\r\n        let dragBoxHeight = $markSvg.outerHeight();\r\n\r\n        switch (POSITION[positionVal]) {\r\n            case 'center':\r\n                markX = (dragBoxWrapperWidth - dragBoxWidth) / 2;\r\n                markY = (dragBoxWrapperHeight - dragBoxHeight) / 2;\r\n                break;\r\n            case 'upLeft':\r\n                markX = this.markXPositionMargin;\r\n                markY = this.markYPositionMargin;\r\n                break;\r\n            case 'upRight':\r\n                markX = dragBoxWrapperWidth - dragBoxWidth - this.markXPositionMargin;\r\n                markY = this.markYPositionMargin;\r\n                break;\r\n            case 'downLeft':\r\n                markX = this.markXPositionMargin;\r\n                markY = dragBoxWrapperHeight - dragBoxHeight - this.markYPositionMargin;\r\n                break;\r\n            case 'downRight':\r\n                markX = dragBoxWrapperWidth - dragBoxWidth - this.markXPositionMargin;\r\n                markY = dragBoxWrapperHeight - dragBoxHeight - this.markYPositionMargin;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        $dragBox.css({\r\n            'left': markX,\r\n            'top': markY,\r\n            'width': dragBoxWidth,\r\n            'height': dragBoxHeight\r\n        })\r\n    }\r\n    _setMarkStyle(type) {\r\n        let $panel = type === this.MARKTYPE.MULTIPLE ? this.$markAllPanel : this.$markPanel;\r\n        let markBox = type === this.MARKTYPE.MULTIPLE ? this.markAllBox : this.markBox;\r\n\r\n        let $markTxt = $panel.find('.J-mark-txt');\r\n        let colorVal = $panel.find('.J-color:checked').val();\r\n        let opacityVal = parseInt($panel.find('.J-opacity').val()) / parseInt($panel.find('.J-opacity').attr('max'));\r\n        let txtVal = $panel.find('.J-select-mark').val();\r\n\r\n        let color = `rgba(255, 255, 255, ${opacityVal})`;\r\n        if (colorVal === '1') {\r\n            color = `rgba(0, 0, 0, ${opacityVal})`;\r\n        }\r\n        let text = this.markTextList[txtVal];\r\n\r\n        // $markTxt.text(text).css({\r\n        //     'color': color\r\n        // });\r\n        // if (type) {\r\n            \r\n        // } else {\r\n            \r\n        // }\r\n        // this.markBox = new DragBox({\r\n        //     el: this.$markPanel.find('.J-source'),\r\n        //     fixRatio: true,\r\n        //     markText: text,\r\n        //     onDragComplete: (left, top) => {\r\n        //         this.$markPanel.find('.J-position').prop('checked', false);\r\n        //     }\r\n\r\n        // });\r\n\r\n        markBox.updateTxt({\r\n            text: text,\r\n            color: color\r\n        });\r\n       \r\n\r\n    }\r\n    _updateMarkTxt(type) {\r\n        let $panel = type === this.MARKTYPE.MULTIPLE ? this.$markAllPanel : this.$markPanel;\r\n\r\n        if (type === this.MARKTYPE.MULTIPLE && this.markAllFontSize0 !== this.markAllFontSize1) {\r\n            $panel.find('.J-mark-txt').css({\r\n                'font-size': Math.round(this.markAllFontSize1 / this.activeData.ratio) + 'px'\r\n            });\r\n            // this.markAllBox.$dragBox.find('.J-mark-txt').css({\r\n            //     'display': 'inline-block'\r\n            // });\r\n\r\n        } else {\r\n            if (this.markFontSize0 !== this.markFontSize1) {\r\n                \r\n            }\r\n            $panel.find('.J-mark-txt').css({\r\n                'font-size': Math.round(this.markFontSize1 / this.activeData.ratio) + 'px'\r\n            });\r\n            // this.markBox.$dragBox.find('.J-mark-txt').css({\r\n            //     'display': 'inline-block'\r\n            // });\r\n        }\r\n\r\n    }\r\n    _initMark(type) {\r\n        let $panel = type === this.MARKTYPE.MULTIPLE ? this.$markAllPanel : this.$markPanel;\r\n        $panel.find('.J-color:last').prop('checked', true);\r\n        $panel.find('.J-position:first').prop('checked', true);\r\n        $panel.find('.J-opacity:first').val($panel.find('.J-opacity:first').attr('defaultValue'));\r\n        $panel.find('.J-select-mark option:first').prop('selected', true);\r\n\r\n        if (type === this.MARKTYPE.MULTIPLE) {\r\n            $panel.find('.J-mark-txt').css({\r\n                'font-size': Math.round(this.markAllFontSize0 / this.activeData.ratio) + 'px'\r\n            });\r\n            // this.markAllBox.$dragBox.find('.J-mark-txt').css({\r\n            //     'display': 'inline-block'\r\n            // });\r\n\r\n        } else {\r\n            $panel.find('.J-mark-txt').css({\r\n                'font-size': Math.round(this.markFontSize0 / this.activeData.ratio) + 'px'\r\n            });\r\n            // this.markBox.$dragBox.find('.J-mark-txt').css({\r\n            //     'display': 'inline-block'\r\n            // });\r\n            \r\n            let markSvg = $panel.find('.J-mark-svg').get(0);\r\n            let w = Math.round(parseInt(markSvg.getAttribute('viewBox').split(' ')[2]) / this.activeData.ratio);\r\n            let h = Math.round(parseInt(markSvg.getAttribute('viewBox').split(' ')[3]) / this.activeData.ratio);\r\n            $panel.find('.J-mark-svg').css({\r\n                width: w,\r\n                height: h\r\n            })\r\n        }\r\n\r\n        if (type === this.MARKTYPE.MULTIPLE) {\r\n            this.markSelects[1].select(0);\r\n\r\n        } else {\r\n            this.markSelects[0].select(0);\r\n        }\r\n\r\n        this._setMarkStyle(type);\r\n        this._setMarkPosition(type);\r\n    }\r\n    _updateMark(type) {\r\n        // if (type === this.MARKTYPE.MULTIPLE) {\r\n        //     this._updateMarkTxt(type);\r\n        // }\r\n        \r\n        this._setMarkStyle(type);\r\n        this._setMarkPosition(type);\r\n\r\n        this._updateIsChange(true);\r\n    }\r\n    _saveMark() {\r\n        let options = this._getMarkParams();\r\n\r\n        this.onSaveMark(options, (img) => {\r\n            this.activeImg = img;\r\n            this._updateActiveData();\r\n            this._refresh();\r\n            this._goHome();\r\n\r\n            this._updateIsChange(true);\r\n        })\r\n    }\r\n    _cancelMark() {\r\n        this._goHome();\r\n    }\r\n    _getMarkParams(type) {\r\n\r\n        let $panel = type === this.MARKTYPE.MULTIPLE ? this.$markAllPanel : this.$markPanel;\r\n        let $dragBox = type === this.MARKTYPE.MULTIPLE ? this.markAllBox.$dragBox : this.markBox.$dragBox;\r\n        let $markTxt = $panel.find('.J-mark-txt');\r\n\r\n        // let fontSize = Math.round(parseInt($markTxt.css('font-size')) * this.activeData.ratio);\r\n        // let lineHeight = Math.round(parseInt($markTxt.css('line-height')) * this.activeData.ratio);\r\n        // let markFont = fontSize + 'px / ' + lineHeight + 'px ' + $markTxt.css('font-family');\r\n\r\n        let $markSvg = $panel.find('.J-mark-svg');\r\n        let svgHeight = parseInt($markSvg.css('height'));\r\n        let fontSize0 = parseInt($markSvg.find('text').css('font-size'));\r\n        // '0 0 183 22'\r\n        let lineHeight0 = parseInt($markSvg.get(0).getAttribute('viewBox').split(' ').pop());\r\n        let svgTextRatio = svgHeight / lineHeight0;\r\n\r\n        let fontSize = Math.round(fontSize0 * svgTextRatio * this.activeData.ratio);\r\n        let lineHeight = Math.round(svgHeight * this.activeData.ratio);\r\n        let markFont = fontSize + 'px / ' + lineHeight + 'px ' + $markSvg.parent().css('font-family');\r\n        let markFont0 = fontSize0 + 'px / ' + svgHeight + 'px ' + $markSvg.parent().css('font-family');\r\n\r\n\r\n        let $opacity = $panel.find('.J-opacity');\r\n        let opacityVal = parseInt($opacity.val()) / parseInt($opacity.attr('max'));\r\n        let colorVal = $panel.find('.J-color:checked').val();\r\n\r\n        let color = `rgba(255, 255, 255, ${opacityVal})`;\r\n        if (colorVal === '1') {\r\n            color = `rgba(0, 0, 0, ${opacityVal})`;\r\n        }\r\n\r\n        let txtVal = $panel.find('.J-select-mark').val();\r\n        let text = this.markTextList[txtVal];\r\n\r\n\r\n        let markX = parseInt($dragBox.css('left'));\r\n        let markY = parseInt($dragBox.css('top'));\r\n\r\n\r\n        const POSITION = ['center', 'upLeft', 'upRight', 'downLeft', 'downRight'];\r\n\r\n        let positionVal = $panel.find('.J-position:checked').val();\r\n\r\n        let dragBoxWrapperWidth = this.activeData.w1;\r\n        let dragBoxWrapperHeight = this.activeData.h1;\r\n        // let dragBoxWidth = $markTxt.outerWidth();\r\n        // let dragBoxHeight = $markTxt.outerHeight();        \r\n        let dragBoxWidth = $markSvg.outerWidth();\r\n        let dragBoxHeight = $markSvg.outerHeight();\r\n\r\n        switch (POSITION[positionVal]) {\r\n            case 'center':\r\n                markX = (dragBoxWrapperWidth - dragBoxWidth) / 2;\r\n                markY = (dragBoxWrapperHeight - dragBoxHeight) / 2;\r\n                break;\r\n            case 'upLeft':\r\n                markX = this.markXPositionMargin;\r\n                markY = this.markYPositionMargin;\r\n                break;\r\n            case 'upRight':\r\n                markX = dragBoxWrapperWidth - dragBoxWidth - this.markXPositionMargin;\r\n                markY = this.markYPositionMargin;\r\n                break;\r\n            case 'downLeft':\r\n                markX = this.markXPositionMargin;\r\n                markY = dragBoxWrapperHeight - dragBoxHeight - this.markYPositionMargin;\r\n                break;\r\n            case 'downRight':\r\n                markX = dragBoxWrapperWidth - dragBoxWidth - this.markXPositionMargin;\r\n                markY = dragBoxWrapperHeight - dragBoxHeight - this.markYPositionMargin;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        markX = Math.round(markX * this.activeData.ratio);\r\n        markY = Math.round(markY * this.activeData.ratio  + (lineHeight - fontSize) / 2);\r\n\r\n        let markTxtCvs = {\r\n            width: dragBoxWidth,\r\n            height: dragBoxHeight,\r\n            font0: markFont0,\r\n            font1: markFont,\r\n            color: color,\r\n            text: text,\r\n            x: markX,\r\n            y: markY\r\n        }; \r\n\r\n        return markTxtCvs      \r\n    }\r\n    _saveMarkAll() {\r\n        let num = 0;\r\n        this.imgList.forEach((element,index) => {\r\n\r\n            this.onChangeActive({\r\n                activeImg: element,\r\n                activeIndex: index\r\n            });\r\n            this.activeImg = element;\r\n            this._updateActiveData();\r\n            this._updateMarkTxt(this.MARKTYPE.MULTIPLE);\r\n            let options = this._getMarkParams(this.MARKTYPE.MULTIPLE);\r\n            this.onSaveMark(options, (img) => {});\r\n            this.onSave((data) => {\r\n                // console.log(num+1);\r\n                if (++num === this.imgList.length) {\r\n                    this._hideProgress();\r\n                    this.destory();\r\n                    this._updateIsChange(false);\r\n                    num = 0;\r\n                    this.onComplete(data);\r\n                }\r\n                \r\n            }, index);\r\n        });\r\n\r\n    }\r\n    // 水印相关操作end++++++++++++++++++++++++++++++++++++++++\r\n\r\n\r\n    _showSize(w0, h0) {\r\n        w0 = Math.floor(w0);\r\n        h0 = Math.floor(h0);\r\n        // 显示活动图片原始宽高\r\n        let $numWidth = this.$el.find('.J-num-width');\r\n        let $numHeight = this.$el.find('.J-num-height');\r\n        $numWidth.each((index, element) => {\r\n            if ($(element).get(0).nodeName.toLowerCase() === 'input') {\r\n                $numWidth.val(w0);\r\n            } else {\r\n                $numWidth.text(w0);\r\n            }\r\n        })\r\n        $numHeight.each((index, element) => {\r\n            if ($(element).get(0).nodeName.toLowerCase() === 'input') {\r\n                $numHeight.val(h0);\r\n            } else {\r\n                $numHeight.text(h0);\r\n            }\r\n        })\r\n    }\r\n    _refresh() {\r\n        let src = '';\r\n        if (this.activeData.img.nodeName.toLowerCase() === 'img') {\r\n            src = this.activeData.img.src;\r\n        } else {\r\n            src = this.activeData.img.toDataURL(this.mime, 1.0);\r\n        }\r\n\r\n        if (this.$el.find('.J-img-box').find('.J-source').length > 0) {\r\n            this.$el.find('.J-img-box').find('.J-source').attr('src', src);\r\n        } else {\r\n            this.$el.find('.J-img-box').append(`<img class=\"J-source\" src=\"${src}\">`);\r\n        }\r\n\r\n        this.$el.find('.J-source').removeAttr('style');\r\n        this.cropBox && this.cropBox.boxEl.removeAttribute('style');\r\n\r\n        this.$el.find('.J-img-box').find('.J-source').css({\r\n            width: this.activeData.w1,\r\n            height: this.activeData.h1\r\n        })\r\n\r\n        this._showSize(this.activeData.w0, this.activeData.h0);\r\n\r\n    }\r\n    // 更新正在编辑图片的数据\r\n    _updateActiveData() {\r\n        let targetImg = this.activeImg;\r\n        let w0 = targetImg.width;\r\n        let h0 = targetImg.height;\r\n        if (targetImg.nodeName.toLowerCase() === 'img') {\r\n            w0 = targetImg.naturalWidth;\r\n            h0 = targetImg.naturalHeight;\r\n        }\r\n\r\n        let imgRatio = w0 / h0;\r\n        let h1 = h0;\r\n        let w1 = w0;\r\n        let ratio = 1;\r\n        if (imgRatio < this.imgBoxRatio) {\r\n            if (h0 > this.imgBoxHeight) {\r\n                h1 = this.imgBoxHeight;\r\n                w1 = h1 * imgRatio;\r\n                ratio = h0 / h1;\r\n            }\r\n\r\n        } else {\r\n            if (w0 > this.imgBoxWidth) {\r\n                w1 = this.imgBoxWidth;\r\n                h1 = w1 / imgRatio;\r\n                ratio = w0 / w1;                \r\n            }\r\n\r\n        }\r\n\r\n        this.activeData = {\r\n            w0: w0,\r\n            h0: h0,\r\n            w1: w1,\r\n            h1: h1,\r\n            ratio: ratio,\r\n            imgRatio: imgRatio,\r\n            img: targetImg\r\n        }\r\n    }\r\n    _getRotateNum(direction) {\r\n        this.rotateNum += direction;\r\n        if (this.rotateNum > 3) {\r\n            this.rotateNum = 0;\r\n        }\r\n        if (this.rotateNum < 0) {\r\n            this.rotateNum = 3;\r\n        }\r\n    }\r\n    // TODO 独立出Tip组件\r\n    _confirm(yesCallback, noCallback) {\r\n        let $tip = this.$el.find('.J-pipeImg-tip');\r\n        let hideTip = () => {\r\n            this.$pipeWrapper.css('z-index', 2);\r\n            $tip.hide();\r\n            $tip.off('click');\r\n        };\r\n        let showTip = () => {\r\n            $tip.show();\r\n            this.$pipeWrapper.css('z-index', 0);\r\n        };\r\n\r\n        showTip();\r\n\r\n        $tip.on('click', '.J-tip-confirm', (e) => {\r\n            yesCallback();\r\n            hideTip();\r\n        })\r\n        $tip.on('click', '.J-tip-cancel', (e) => {\r\n            noCallback && noCallback();\r\n            hideTip();\r\n        })\r\n    }\r\n\r\n    _updateIsChange(isChange) {\r\n        this.isChange = isChange;\r\n        if (isChange) {\r\n            this.$buttons.addClass('active');\r\n        } else {\r\n            this.$buttons.removeClass('active');\r\n        }\r\n\r\n    }\r\n    _reset() {\r\n        this.onReset((img) => {\r\n            this.activeImg = img;\r\n            this._updateActiveData();\r\n            this._refresh();\r\n            this._goHome();\r\n\r\n            this._initData();\r\n            this._updateIsChange(false)\r\n        });\r\n    }\r\n    _save() {\r\n        let $activeThumb = this.$el.find('.J-pipe-footer').find('.J-img-thumbnail.active');\r\n        let index = $activeThumb.index();\r\n        this.onSave((data) => {  \r\n            // [{\"picHeight\":600,\"picWidth\":800,\"tempPhotoId\":\"573761\",\"url\":\"image?tid=40&amp;id=gCfpAUFcYRlB&amp;cache=0&amp;lan_code=0\"}];\r\n\r\n            if (!(data && data[index] && data[index].url)) {\r\n                window.console && console.log('save: data error!');\r\n                return false;\r\n            }\r\n            let newSrc = data[index].url.replace(\"&amp;\", \"&\");\r\n            // 更新单图和批量模式缩略图\r\n            $activeThumb.addClass('new').find('img').attr('src', newSrc);            \r\n            this.$markAllPanel.find('.J-img-thumbnail').eq(index).find('img').attr('src', newSrc).attr('title', data[index].picWidth + 'px * ' + data[index].picHeight + 'px');\r\n            // 更新imgList\r\n            this.imgList[index] = $activeThumb.find('img').get(0);\r\n\r\n            this._hideProgress();\r\n            this._goHome();\r\n            this.onComplete(data);\r\n            this._updateIsChange(false);\r\n        }, index);\r\n    }\r\n    _showProgress() {\r\n        this.$pipeWrapper.css('z-index', 0);\r\n        this.$el.find('.J-pipeImg-progress').addClass('active');\r\n    }\r\n    _hideProgress() {\r\n        this.$pipeWrapper.css('z-index', 2);\r\n        this.$el.find('.J-pipeImg-progress').removeClass('active');\r\n    }\r\n    _initData() {\r\n        this.rotateNum = 0;\r\n        this.scaleRatio = 1;\r\n    }\r\n    _updateActiveImg(index) {\r\n        this.activeImg = this.imgList[index];\r\n        this._updateActiveData();\r\n        this._refresh();\r\n        let options = {\r\n            activeImg: this.activeImg,\r\n            activeIndex: index\r\n        };\r\n        this.onChangeActive(options, (img) => {});\r\n    }\r\n    showMenu(index) {\r\n        this.$el.find('.J-item').eq(index).addClass('active').siblings().removeClass('active');\r\n        this.$el.find('.J-panel').eq(index).addClass('active').siblings().removeClass('active');\r\n        // 若是水印，设置鼠标指针状态\r\n        if (index === 3) {\r\n            // 切换水印按钮状态\r\n            let $itemMark = this.$el.find('.J-item-mark');\r\n            $itemMark.find('.J-menu-btn').hide();\r\n            $itemMark.find('.J-menu-txt').show();\r\n        }\r\n    }\r\n\r\n    showModel(type) {\r\n        // 编辑界面类型\r\n        if (type === this.MARKTYPE.MULTIPLE) {\r\n\r\n            this.imgBoxHeight = this.$markAllPanel.find('.J-img-box').height();\r\n            this.imgBoxWidth = this.$markAllPanel.find('.J-img-box').width();\r\n            this.imgBoxRatio = this.imgBoxWidth / this.imgBoxHeight;\r\n            this._updateActiveData();\r\n            this._refresh();\r\n            \r\n\r\n            let $itemMark = this.$el.find('.J-item-mark');\r\n            // 切换菜单及面板状态\r\n            $itemMark.addClass('active').siblings().removeClass('active');\r\n            this.$markAllPanel.addClass('active').siblings().removeClass('active');\r\n            // 切换水印按钮状态\r\n            $itemMark.find('.J-menu-btn').hide();\r\n            $itemMark.find('.J-menu-txt').show();\r\n\r\n            let txt = $itemMark.find('.J-menu-btn-mark-all').html();\r\n            $itemMark.find('.J-menu-txt').html(txt);\r\n            $itemMark.find('.J-menu-btn-mark-all').hide();\r\n            $itemMark.find('.J-menu-btn-mark').show();\r\n            // 切换页脚状态\r\n            this.$el.find('.J-pipe-footer').addClass('mark-all');           \r\n\r\n        } else {\r\n\r\n            this.imgBoxHeight = this.$markPanel.find('.J-img-box').height();\r\n            this.imgBoxWidth = this.$markPanel.find('.J-img-box').width();\r\n            this.imgBoxRatio = this.imgBoxWidth / this.imgBoxHeight;\r\n            this._updateActiveData();\r\n            this._refresh();\r\n\r\n            let $itemMark = this.$el.find('.J-item-mark');\r\n            // 切换菜单及面板状态\r\n            this.$el.find('.J-item:first').addClass('active').siblings().removeClass('active');\r\n            this.$el.find('.J-panel:first').addClass('active').siblings().removeClass('active');\r\n            // 切换水印按钮状态\r\n            $itemMark.find('.J-menu-btn').show();\r\n            $itemMark.find('.J-menu-txt').hide();\r\n\r\n            let txt = $itemMark.find('.J-menu-btn-mark').html();\r\n            $itemMark.find('.J-menu-txt').html(txt);\r\n            $itemMark.find('.J-menu-btn-mark-all').show();\r\n            $itemMark.find('.J-menu-btn-mark').hide();\r\n\r\n            // 切换页脚状态\r\n            this.$el.find('.J-pipe-footer').removeClass('mark-all');\r\n            \r\n        }\r\n    }\r\n    destory() {\r\n        this.$el.remove();\r\n    }\r\n    showDialog() {\r\n        this.$pipeWrapper.fadeIn(100);\r\n    }\r\n    hideDialog() {\r\n        this.$pipeWrapper.fadeOut(100);\r\n    }\r\n\r\n}\r\n\r\nexport default Dialog\r\n","module.exports = \"<div class=\\\"pipeImg-wrapper J-pipe-wrapper\\\">\\r\\n    <div class=\\\"pipeImg-header\\\">\\r\\n        <ul class=\\\"pipeImg-menu\\\">\\r\\n            <li class=\\\"pipeImg-item J-item active\\\"><a class=\\\"pipeImg-btn J-menu-btn\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"ob-icon icon-refresh\\\"></i>{{=rotateMenuTxt}}</a></li>\\r\\n            <li class=\\\"pipeImg-item J-item\\\"><a class=\\\"pipeImg-btn J-menu-btn\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"ob-icon icon-crop\\\"></i>{{=cropMenuTxt}}</a></li>\\r\\n            <li class=\\\"pipeImg-item J-item\\\"><a class=\\\"pipeImg-btn J-menu-btn\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"ob-icon icon-scaling\\\"></i>{{=scaleMenuTxt}}</a></li>\\r\\n            <li class=\\\"pipeImg-item J-item J-item-mark\\\">\\r\\n                <a class=\\\"pipeImg-btn J-menu-btn\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"ob-icon icon-add-l\\\"></i>{{=markMenuTxt}}</a>\\r\\n                <div class=\\\"pipeImg-btn J-menu-txt\\\" style=\\\"display:none;\\\"><i class=\\\"ob-icon icon-add-l\\\"></i>{{=markMenuTxt}}</div>\\r\\n                <div class=\\\"pipeImg-item item-sub\\\">\\r\\n                    <a class=\\\"pipeImg-btn J-menu-btn-mark-all\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"ob-icon icon-batch\\\"></i>{{=markAllMenuTxt}}</a>\\r\\n                    <a class=\\\"pipeImg-btn J-menu-btn-mark\\\" href=\\\"javascript:void(0)\\\" style=\\\"display:none;\\\"><i class=\\\"ob-icon icon-add-l\\\"></i>{{=markMenuTxt}}</a>\\r\\n                </div>\\r\\n            </li>\\r\\n        </ul>\\r\\n        <a class=\\\"pipeImg-btn btn-close active J-button-close\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"ob-icon icon-delete\\\"></i>{{=closeBtnTxt}}</a>\\r\\n    </div>\\r\\n    <div class=\\\"pipeImg-content\\\">\\r\\n        <!-- 旋转面板 -->\\r\\n        <div class=\\\"pipeImg-panel rotate-panel active J-panel J-rotate-panel\\\">\\r\\n            <div class=\\\"img-box J-img-box\\\">\\r\\n                <img class=\\\"J-source\\\" src=\\\"{{-imgList[activeIndex].src}}\\\">\\r\\n            </div>\\r\\n            <div class=\\\"content-footer\\\">\\r\\n                <div class=\\\"size\\\">\\r\\n                    <span class=\\\"J-num-width\\\">0</span>*<span class=\\\"J-num-height\\\">0</span>px\\r\\n                </div>\\r\\n                <a class=\\\"pipeImg-btn btn-rotate J-btn-rotate-left\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"ob-icon icon-rotate-l\\\"></i>{{=turnLeftTxt}}</a>\\r\\n                <a class=\\\"pipeImg-btn btn-rotate J-btn-rotate-right\\\" href=\\\"javascript:void(0)\\\"><i class=\\\"ob-icon icon-rotate-r\\\"></i>{{=turnRightTxt}}</a>\\r\\n\\r\\n                <div class=\\\"pipeImg-buttons\\\">\\r\\n                    <a class=\\\"pipeImg-button button-main J-button-save\\\" href=\\\"javascript:void(0)\\\">{{=saveBtnTxt}}</a>\\r\\n                    <a class=\\\"pipeImg-button button-reset J-button-reset\\\" href=\\\"javascript:void(0)\\\">{{=resetBtnTxt}}</a>\\r\\n                </div>\\r\\n            </div>\\r\\n        </div>\\r\\n        <!-- 裁剪面板 -->\\r\\n        <div class=\\\"pipeImg-panel J-panel J-crop-panel\\\">\\r\\n            <div class=\\\"img-box J-img-box\\\">\\r\\n                <img class=\\\"J-source\\\" src=\\\"{{-imgList[activeIndex].src}}\\\">\\r\\n            </div>\\r\\n            <div class=\\\"content-footer\\\">\\r\\n                <input class=\\\"num-width J-num-width\\\" type=\\\"text\\\">\\r\\n                <input class=\\\"J-fix-ratio\\\" id=\\\"fixRatio\\\" type=\\\"checkbox\\\" name=\\\"fixRatio\\\" hidden>\\r\\n                <label class=\\\"fix\\\" for=\\\"fixRatio\\\" title=\\\"{{=constrainTxt}}\\\"><i class=\\\"ob-icon icon-lock\\\"></i></label>\\r\\n                <input class=\\\"num-height J-num-height\\\" type=\\\"text\\\">\\r\\n                <span class=\\\"txt\\\">px</span>\\r\\n\\r\\n                <div class=\\\"pipeImg-buttons\\\">\\r\\n                    <a class=\\\"pipeImg-button button-main J-button-save\\\" href=\\\"javascript:void(0)\\\">{{=saveBtnTxt}}</a>\\r\\n                    <a class=\\\"pipeImg-button button-reset J-button-reset\\\" href=\\\"javascript:void(0)\\\">{{=resetBtnTxt}}</a>\\r\\n                </div>\\r\\n            </div>\\r\\n\\r\\n        </div>\\r\\n        <!-- 缩放面板 -->\\r\\n        <div class=\\\"pipeImg-panel scale-panel J-panel J-scale-panel\\\">\\r\\n            <div class=\\\"img-box J-img-box\\\">\\r\\n                <div class=\\\"scale-img-wrapper J-scale-img-wrapper\\\">\\r\\n                    <img class=\\\"J-source\\\" src=\\\"{{-imgList[activeIndex].src}}\\\">\\r\\n                </div>\\r\\n            </div>\\r\\n            <div class=\\\"content-footer\\\">\\r\\n                <input class=\\\"num-width J-num-width\\\" type=\\\"text\\\">\\r\\n                <span class=\\\"txt\\\">X</span>\\r\\n                <input class=\\\"num-height J-num-height\\\" type=\\\"text\\\">\\r\\n                <span class=\\\"txt\\\">px</span>\\r\\n                <input class=\\\"scale-range J-scale-range\\\" type=\\\"range\\\" name=\\\"scaleRatio\\\" min=\\\"50\\\" max=\\\"100\\\" step=\\\"1\\\" value=\\\"100\\\">\\r\\n\\r\\n                <div class=\\\"pipeImg-buttons\\\">\\r\\n                    <a class=\\\"pipeImg-button button-main J-button-save\\\" href=\\\"javascript:void(0)\\\">{{=saveBtnTxt}}</a>\\r\\n                    <a class=\\\"pipeImg-button button-reset J-button-reset\\\" href=\\\"javascript:void(0)\\\">{{=resetBtnTxt}}</a>\\r\\n                </div>\\r\\n            </div>\\r\\n\\r\\n        </div>\\r\\n        <!-- 添加水印面板 -->\\r\\n        <div class=\\\"pipeImg-panel J-panel J-mark-panel\\\">\\r\\n            <div class=\\\"img-box J-img-box\\\">\\r\\n                <img class=\\\"J-source\\\" src=\\\"{{-imgList[activeIndex].src}}\\\">\\r\\n            </div>\\r\\n            <div class=\\\"content-footer\\\">\\r\\n                <div class=\\\"pipeImg-item\\\">\\r\\n                    <div class=\\\"txt-label\\\">{{=colorTxt}}:</div> \\r\\n                    <input class=\\\"J-color\\\" id=\\\"colorWhite\\\" type=\\\"radio\\\" name=\\\"color\\\" value=\\\"0\\\" autocomplete=\\\"off\\\" hidden>        \\r\\n                    <label class=\\\"color\\\" for=\\\"colorWhite\\\"></label>\\r\\n                    <input class=\\\"J-color\\\" id=\\\"colorBlack\\\" type=\\\"radio\\\" name=\\\"color\\\" value=\\\"1\\\" checked autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"color color-black\\\" for=\\\"colorBlack\\\"></label>\\r\\n                </div>\\r\\n                <div class=\\\"pipeImg-item\\\">\\r\\n                    <div class=\\\"txt-label\\\">{{=positionTxt}}:</div>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionCenter\\\" type=\\\"radio\\\" name=\\\"position\\\" value=\\\"0\\\" autocomplete=\\\"off\\\" checked hidden>\\r\\n                    <label class=\\\"position center\\\" for=\\\"positionCenter\\\"><span class=\\\"line\\\"></span></label>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionLeftTop\\\" type=\\\"radio\\\" name=\\\"position\\\" value=\\\"1\\\" autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"position left-top\\\" for=\\\"positionLeftTop\\\"><span class=\\\"line\\\"></span></label>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionRightTop\\\" type=\\\"radio\\\" name=\\\"position\\\" value=\\\"2\\\" autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"position right-top\\\" for=\\\"positionRightTop\\\"><span class=\\\"line\\\"></span></label>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionLeftBottom\\\" type=\\\"radio\\\" name=\\\"position\\\" value=\\\"3\\\" autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"position left-bottom\\\" for=\\\"positionLeftBottom\\\"><span class=\\\"line\\\"></span></label>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionRightBottom\\\" type=\\\"radio\\\" name=\\\"position\\\" value=\\\"4\\\" autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"position right-bottom\\\" for=\\\"positionRightBottom\\\"><span class=\\\"line\\\"></span></label>\\r\\n                </div>\\r\\n                <div class=\\\"pipeImg-item\\\">\\r\\n                    <div class=\\\"txt-label\\\">{{=opacityTxt}}:</div>\\r\\n                    <input class=\\\"opacity-range J-opacity\\\" name=\\\"opacity\\\" type=\\\"range\\\" min=\\\"10\\\" max=\\\"100\\\" step=\\\"1\\\" defaultValue=\\\"80\\\" value=\\\"80\\\">\\r\\n                </div>\\r\\n\\r\\n                <select class=\\\"J-select-mark\\\" name=\\\"markTxt\\\">\\r\\n                    <option value=\\\"0\\\" selected=\\\"selected\\\">{{=showRoomTxt}}</option>\\r\\n                    <option value=\\\"1\\\">{{=companyNameTxt}}</option>\\r\\n                </select>\\r\\n\\r\\n                <div class=\\\"pipeImg-buttons\\\">\\r\\n                    <a class=\\\"pipeImg-button button-confirm J-button-confirm\\\" href=\\\"javascript:void(0)\\\">{{=confirmBtnTxt}}</a>\\r\\n                    <a class=\\\"pipeImg-button button-cancel J-button-cancel\\\" href=\\\"javascript:void(0)\\\">{{=cancelBtnTxt}}</a>\\r\\n                </div>\\r\\n            </div>\\r\\n\\r\\n        </div>\\r\\n        <!-- 批量添加水印 -->\\r\\n        <div class=\\\"pipeImg-panel panel-mark-all J-panel J-mark-all-panel\\\">\\r\\n            <div class=\\\"img-box J-img-box\\\">\\r\\n                <img class=\\\"J-source\\\" src=\\\"{{-imgList[activeIndex].src}}\\\">\\r\\n            </div>\\r\\n            <div class=\\\"imgs-thumbnail J-imgs-thumbnail\\\">\\r\\n                {{ for(var i=0;i<imgList.length;i++) { }} \\r\\n                <div class=\\\"img-thumbnail {{=i === activeIndex ? 'active' : ''}} J-img-thumbnail\\\">\\r\\n                    <a href=\\\"javascript:void(0)\\\">\\r\\n                        <img src=\\\"{{-imgList[i].src}}\\\">\\r\\n                        <span class=\\\"circle\\\"></span>\\r\\n                    </a>\\r\\n                </div>\\r\\n\\r\\n                {{ } }}\\r\\n            </div>\\r\\n            <div class=\\\"content-footer\\\">\\r\\n                <div class=\\\"pipeImg-item\\\">\\r\\n                    <div class=\\\"txt-label\\\">{{=colorTxt}}:</div> \\r\\n                    <input class=\\\"J-color\\\" id=\\\"colorWhiteAll\\\" type=\\\"radio\\\" name=\\\"colorAll\\\" value=\\\"0\\\" autocomplete=\\\"off\\\" hidden>        \\r\\n                    <label class=\\\"color\\\" for=\\\"colorWhiteAll\\\"></label>\\r\\n                    <input class=\\\"J-color\\\" id=\\\"colorBlackAll\\\" type=\\\"radio\\\" name=\\\"colorAll\\\" value=\\\"1\\\" checked autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"color color-black\\\" for=\\\"colorBlackAll\\\"></label>\\r\\n                </div>\\r\\n                <div class=\\\"pipeImg-item\\\">\\r\\n                    <div class=\\\"txt-label\\\">{{=positionTxt}}:</div>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionCenterAll\\\" type=\\\"radio\\\" name=\\\"positionAll\\\" value=\\\"0\\\" autocomplete=\\\"off\\\" checked hidden>\\r\\n                    <label class=\\\"position center\\\" for=\\\"positionCenterAll\\\"><span class=\\\"line\\\"></span></label>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionLeftTopAll\\\" type=\\\"radio\\\" name=\\\"positionAll\\\" value=\\\"1\\\" autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"position left-top\\\" for=\\\"positionLeftTopAll\\\"><span class=\\\"line\\\"></span></label>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionRightTopAll\\\" type=\\\"radio\\\" name=\\\"positionAll\\\" value=\\\"2\\\" autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"position right-top\\\" for=\\\"positionRightTopAll\\\"><span class=\\\"line\\\"></span></label>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionLeftBottomAll\\\" type=\\\"radio\\\" name=\\\"positionAll\\\" value=\\\"3\\\" autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"position left-bottom\\\" for=\\\"positionLeftBottomAll\\\"><span class=\\\"line\\\"></span></label>\\r\\n                    <input class=\\\"J-position\\\" id=\\\"positionRightBottomAll\\\" type=\\\"radio\\\" name=\\\"positionAll\\\" value=\\\"4\\\" autocomplete=\\\"off\\\" hidden>\\r\\n                    <label class=\\\"position right-bottom\\\" for=\\\"positionRightBottomAll\\\"><span class=\\\"line\\\"></span></label>\\r\\n                </div>\\r\\n                <div class=\\\"pipeImg-item\\\">\\r\\n                    <div class=\\\"txt-label\\\">{{=opacityTxt}}:</div>\\r\\n                    <input class=\\\"opacity-range J-opacity\\\" name=\\\"opacityAll\\\" type=\\\"range\\\" min=\\\"10\\\" max=\\\"100\\\" step=\\\"1\\\" defaultValue=\\\"80\\\" value=\\\"80\\\">\\r\\n                </div>\\r\\n\\r\\n                <select class=\\\"J-select-mark\\\" name=\\\"markTxtAll\\\">\\r\\n                    <option value=\\\"0\\\" selected=\\\"selected\\\">{{=showRoomTxt}}</option>\\r\\n                    <option value=\\\"1\\\">{{=companyNameTxt}}</option>\\r\\n                </select>\\r\\n                \\r\\n            </div>\\r\\n\\r\\n        </div>\\r\\n    </div>\\r\\n    <div class=\\\"pipeImg-footer J-pipe-footer\\\">\\r\\n        <div class=\\\"imgs-thumbnail J-imgs-thumbnail\\\">\\r\\n            {{ for(var i=0;i<imgList.length;i++) { }} \\r\\n            <div class=\\\"img-thumbnail {{=i === activeIndex ? 'active' : ''}} J-img-thumbnail\\\">\\r\\n                <div class=\\\"img-inner\\\">\\r\\n                    <a href=\\\"javascript:void(0)\\\">\\r\\n                    <img src=\\\"{{-imgList[i].src}}\\\">\\r\\n                    <span class=\\\"circle\\\"></span>\\r\\n                    </a>\\r\\n                </div>\\r\\n\\r\\n            </div>\\r\\n\\r\\n            {{ } }}\\r\\n        </div>  \\r\\n\\r\\n        <div class=\\\"pipeImg-buttons\\\">\\r\\n            <a class=\\\"pipeImg-button button-confirm J-button-confirm-all\\\" href=\\\"javascript:void(0)\\\">{{=saveBtnTxt}}</a>\\r\\n            <a class=\\\"pipeImg-button button-cancel J-button-cancel-all\\\" href=\\\"javascript:void(0)\\\">{{=cancelBtnTxt}}</a>\\r\\n        </div>            \\r\\n    </div>\\r\\n\\r\\n</div>\\r\\n\\r\\n<div class=\\\"pipeImg-tip J-pipeImg-tip\\\">\\r\\n    <div class=\\\"pipeImg-tip-header\\\">{{=tipTitleTxt}}</div>\\r\\n    <div class=\\\"pipeImg-tip-main\\\">\\r\\n        <div class=\\\"pipeImg-tip-content\\\">{{=tipContentTxt}}</div>\\r\\n        <a class=\\\"pipeImg-button button-confirm J-tip-confirm\\\" href=\\\"javascript:void(0)\\\">{{=tipConfirmBtnTxt}}</a>\\r\\n        <a class=\\\"pipeImg-button button-cancel J-tip-cancel\\\" href=\\\"javascript:void(0)\\\">{{=cancelBtnTxt}}</a>        \\r\\n    </div>\\r\\n</div>\\r\\n\\r\\n<div class=\\\"pipeImg-progress-bar J-pipeImg-progress\\\">\\r\\n    <div class=\\\"pipeImg-progress-val\\\"></div>\\r\\n</div>\"","import $ from 'jquery';\r\n\r\nimport {\r\n    drag\r\n} from './util';\r\n\r\nclass DragBox {\r\n    constructor(options) {\r\n        // 默认配置参数\r\n        const defaults = {\r\n            // 待编辑图片元素\r\n            el: '',\r\n            width: '100%',\r\n            height: '100%',\r\n            markText: 'producttest.en.made-in-china.com',\r\n            // 是否有明暗效果，主要是裁剪图片效果\r\n            isCrop: false,\r\n            fixRatio: false,\r\n            // 拖动触点回调函数\r\n            onDragPoint: (boxData) => {},\r\n            onDragPointComplete: (boxData) => {},\r\n            // 拖动框回调函数\r\n            onDragComplete: (left, top) => {}\r\n        };\r\n\r\n        options = Object.assign({}, defaults, options);\r\n        this.el = options.el;\r\n        this.width = options.width;\r\n        this.height = options.height;\r\n        this.markText = options.markText;\r\n        this.isCrop = options.isCrop;\r\n        this.fixRatio = options.fixRatio;\r\n        this.onDragPoint = options.onDragPoint;\r\n        this.onDragPointComplete = options.onDragPointComplete;\r\n        this.onDragComplete = options.onDragComplete;\r\n\r\n        this.init();\r\n    }\r\n    init() {\r\n        this.$el = $(this.el);\r\n        let src = this.$el.attr('src');\r\n        let $parent = this.$el.parent();\r\n\r\n        let dragBoxHtml = `<div class=\"dragbox-wrapper J-dragbox-wrapper\">\r\n                                <img class=\"J-source\" src=\"${src}\">\r\n                                <div class=\"drag-box J-drag-box\">\r\n                                    <div class=\"drag-point up-left J-drag-point\"></div>\r\n                                    <div class=\"drag-point up J-drag-point\"></div>\r\n                                    <div class=\"drag-point up-right J-drag-point\"></div>\r\n                                    <div class=\"drag-point right J-drag-point\"></div>\r\n                                    <div class=\"drag-point right-down J-drag-point\"></div>\r\n                                    <div class=\"drag-point down J-drag-point\"></div>\r\n                                    <div class=\"drag-point left-down J-drag-point\"></div>\r\n                                    <div class=\"drag-point left J-drag-point\"></div>\r\n \r\n                                    <svg class=\"J-mark-svg\">\r\n                                        <text x=\"0\" y=\"1em\">${this.markText}</text>\r\n                                    </svg>\r\n                                </div>\r\n                            </div>`;\r\n        if (this.isCrop) {\r\n            dragBoxHtml = `<div class=\"dragbox-wrapper J-dragbox-wrapper\">\r\n                                <img class=\"J-source img-dark\" src=\"${src}\">\r\n                                <img class=\"J-source img-light J-img-light\" src=\"${src}\">\r\n                                <div class=\"drag-box style-2 J-drag-box\">\r\n                                    <div class=\"drag-point up-left J-drag-point\"></div>\r\n                                    <div class=\"drag-point up J-drag-point\"></div>\r\n                                    <div class=\"drag-point up-right J-drag-point\"></div>\r\n                                    <div class=\"drag-point right J-drag-point\"></div>\r\n                                    <div class=\"drag-point right-down J-drag-point\"></div>\r\n                                    <div class=\"drag-point down J-drag-point\"></div>\r\n                                    <div class=\"drag-point left-down J-drag-point\"></div>\r\n                                    <div class=\"drag-point left J-drag-point\"></div>\r\n                                </div>\r\n                            </div>`;\r\n        }\r\n\r\n        $parent.html(dragBoxHtml);\r\n        this.$dragBox = $parent.find('.J-drag-box');\r\n        if (!this.isCrop) {\r\n            this.$markSvg = this.$dragBox.find('svg');\r\n            let bBox = this.$dragBox.find('svg text').get(0).getBBox();\r\n            let w = Math.round(bBox.width);\r\n            let h = Math.round(bBox.height);\r\n            this.$dragBox.find('svg').css({\r\n                height: h\r\n            })\r\n            this.$dragBox.find('svg').get(0).setAttribute('viewBox', '0 0 ' + w + ' ' + h);\r\n            this.$dragBox.css({\r\n                width: w,\r\n                height: h\r\n            });\r\n            \r\n        }\r\n\r\n        this.$dragPoint = this.$dragBox.find('.J-drag-point');\r\n\r\n\r\n        this.boxEl = this.$dragBox.get(0);\r\n        this.containerEl = this.boxEl.parentNode;\r\n        this.imgLight = $parent.find('.J-img-light:first').get(0);\r\n\r\n        this.boxData = {\r\n            left: this.boxEl.offsetLeft,\r\n            top: this.boxEl.offsetTop,\r\n            width: this.boxEl.offsetWidth,\r\n            height: this.boxEl.offsetHeight,\r\n            ratio: this.boxEl.offsetWidth / this.boxEl.offsetHeight\r\n        };\r\n\r\n        this._bind();\r\n\r\n        let container = this.isCrop ? this.boxEl.parentNode : null;\r\n        drag(this.boxEl, this.boxEl, container, (left, top) => {\r\n            this._light();\r\n            this.onDragComplete(left, top);\r\n        });\r\n\r\n\r\n    }\r\n    _bind() {\r\n        let isDraging = false;\r\n        let contact = \"\"; //表示被按下的触点\r\n        const DRAGPOINT = ['up-left', 'up', 'up-right', 'right', 'right-down', 'down', 'left-down', 'left'];\r\n        let dragBoxRatio = this.boxData.width / this.boxData.height;\r\n        //鼠标按下时\r\n        this.$dragPoint.on('mousedown', (e) => {\r\n            e.stopPropagation();\r\n            isDraging = true;\r\n            let index = $(e.target).index();\r\n            contact = DRAGPOINT[index];\r\n            dragBoxRatio = this.boxData.width / this.boxData.height;\r\n        })\r\n\r\n        $(document).on('mouseup', (e) => {\r\n            isDraging = false;\r\n            this.boxData = {\r\n                left: this.boxEl.offsetLeft,\r\n                top: this.boxEl.offsetTop,\r\n                width: this.boxEl.offsetWidth,\r\n                height: this.boxEl.offsetHeight,\r\n                ratio: this.boxEl.offsetWidth / this.boxEl.offsetHeight\r\n            };\r\n            \r\n            this.onDragPointComplete(this.boxData);\r\n        })\r\n        $(document).on('mousemove', (e) => {\r\n            if (isDraging == true) {\r\n                this._move(e, contact, dragBoxRatio);\r\n                this._light();\r\n\r\n                this.boxData = {\r\n                    left: this.boxEl.offsetLeft,\r\n                    top: this.boxEl.offsetTop,\r\n                    width: this.boxEl.offsetWidth,\r\n                    height: this.boxEl.offsetHeight,\r\n                    ratio: this.boxEl.offsetWidth / this.boxEl.offsetHeight\r\n                };\r\n\r\n                this._updateSvg();\r\n                this.onDragPoint(this.boxData);\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    //获取元素相对于屏幕左边及上边的距离，利用offsetLeft\r\n    _getPosition() {\r\n        let el = this.boxEl;\r\n        let left = el.offsetLeft;\r\n        let top = el.offsetTop;\r\n        let parent = el.offsetParent;\r\n        while (parent != null) {\r\n            left += parent.offsetLeft;\r\n            top += parent.offsetTop;\r\n            parent = parent.offsetParent;\r\n        }\r\n        return {\r\n            \"left\": left,\r\n            \"top\": top\r\n        };\r\n    }\r\n\r\n    _move(e, contact, dragBoxRatio) {\r\n\r\n        let x = e.clientX,\r\n            y = e.clientY;\r\n        let oldWidth = this.boxEl.offsetWidth; //选取框变化前的宽度\r\n        let oldHeight = this.boxEl.offsetHeight; //选取框变化前的高度\r\n        let position = this._getPosition();\r\n        let top = position.top;\r\n        let left = position.left;\r\n\r\n\r\n        let newWidth;\r\n        let newHeight;\r\n        let newLeft;\r\n        let newTop;\r\n\r\n        // 约束比例：根据宽度计算高度\r\n        if (contact.indexOf('left') != -1) {\r\n            let addWidth = left - x;\r\n            if (this.isCrop && addWidth >= 0 && this.boxEl.offsetLeft <= 0) {\r\n                return false;\r\n            }\r\n\r\n            newWidth = oldWidth + addWidth;\r\n            if (this.isCrop && newWidth <= 1) {\r\n                return false;\r\n            }\r\n            newLeft = this.boxEl.offsetLeft - addWidth;\r\n        }\r\n        if (contact.indexOf('right') != -1) {\r\n            let addWidth = x - left - oldWidth;\r\n            if (this.isCrop && addWidth >= 0 && (this.containerEl.clientWidth - (this.boxEl.offsetLeft + oldWidth + addWidth)) <= 0) {\r\n                return false;\r\n            }\r\n\r\n            newWidth = oldWidth + addWidth;\r\n            newLeft = this.boxEl.offsetLeft;\r\n        }\r\n        if (contact.indexOf('up') != -1) {\r\n            let addHeight;\r\n            if (this.fixRatio) {\r\n                newHeight = Math.floor(newWidth / dragBoxRatio);\r\n                addHeight = newHeight - oldHeight;\r\n            } else {\r\n                addHeight = top - y;\r\n                newHeight = oldHeight + addHeight;\r\n            }\r\n\r\n            if (this.isCrop && newHeight <= 1) {\r\n                return false;\r\n            }\r\n            if (this.isCrop && addHeight >= 0 && this.boxEl.offsetTop <= 0) {\r\n                return false;\r\n            }\r\n\r\n            newTop = this.boxEl.offsetTop - addHeight;\r\n\r\n        }\r\n        if (contact.indexOf('down') != -1) {\r\n            let addHeight;\r\n            if (this.fixRatio) {\r\n                newHeight = Math.floor(newWidth / dragBoxRatio);\r\n                addHeight = newHeight - oldHeight;\r\n                newTop = this.boxEl.offsetTop;\r\n            } else {\r\n                addHeight = y - top - oldHeight;\r\n                newHeight = oldHeight + addHeight;\r\n            }\r\n\r\n            if (this.isCrop && addHeight >= 0 && (this.containerEl.clientHeight - (this.boxEl.offsetTop + oldHeight + addHeight)) <= 0) {\r\n                return false;\r\n            }\r\n\r\n        }\r\n        if (this.isCrop) {\r\n            newWidth = Math.min(newWidth, this.containerEl.offsetWidth);\r\n            newHeight = Math.min(newHeight, this.containerEl.offsetHeight);\r\n            newLeft = Math.max(newLeft, 0);\r\n            newTop = Math.max(newTop, 0);      \r\n        }\r\n        \r\n        this.boxEl.style.width = newWidth + 'px';\r\n        this.boxEl.style.height = newHeight + 'px';\r\n        this.boxEl.style.left = newLeft + 'px';\r\n        this.boxEl.style.top = newTop + 'px';                 \r\n\r\n    }\r\n\r\n    _light() {\r\n        if (this.isCrop) {\r\n            this._setChoice();\r\n        }\r\n    }\r\n    //设置选取框图片区域明亮显示\r\n    _setChoice() {\r\n        var top = this.boxEl.offsetTop;\r\n        var right = this.boxEl.offsetLeft + this.boxEl.offsetWidth;\r\n        var bottom = this.boxEl.offsetTop + this.boxEl.offsetHeight;\r\n        var left = this.boxEl.offsetLeft;\r\n        this.imgLight.style.clip = \"rect(\" + top + \"px,\" + right + \"px,\" + bottom + \"px,\" + left + \"px)\";\r\n    }\r\n    _updateSvg() {\r\n        this.$dragBox.find('svg').css({\r\n            width: this.boxData.width,\r\n            height: this.boxData.height\r\n        })\r\n    }\r\n\r\n    updateTxt(options) {\r\n        let text = options.text;\r\n        let color = options.color;\r\n        text && this.$dragBox.find('svg text').text(text);\r\n        color && this.$dragBox.find('svg text').get(0).setAttribute('fill', color);\r\n        let bBox = this.$dragBox.find('svg text').get(0).getBBox();\r\n        \r\n        let w = Math.round(bBox.width);\r\n        let h = Math.round(bBox.height);\r\n        this.$dragBox.find('svg').css({\r\n            width: w,\r\n            height: h\r\n        })\r\n        this.$dragBox.find('svg').get(0).setAttribute('viewBox', '0 0 ' + w + ' ' + h);\r\n        this.$dragBox.css({\r\n            width: w,\r\n            height: h\r\n        });\r\n    }\r\n    update() {\r\n        this.$dragBox.css({\r\n            width: this.width,\r\n            height: this.height\r\n        });\r\n        if (this.isCrop) {\r\n            this._setChoice();\r\n        }\r\n    }\r\n}\r\n\r\nexport {\r\n    DragBox\r\n}\r\n","import {\r\n    getCanvas,\r\n    base64Data2Blob,\r\n    blob2FormData,\r\n    getBase64Size\r\n} from './util';\r\n\r\nclass ImgHandler {\r\n\r\n    constructor(options) {\r\n\r\n        // 默认配置参数\r\n        let defaults = {\r\n            // 源图片元素\r\n            sourceImg: null,\r\n\r\n            rotateNum: 0,\r\n          \r\n            cropW: '',\r\n            cropH: '',\r\n\r\n            // 裁剪后的图片类型\r\n            mime: 'image/jpeg',            \r\n\r\n            // 水印相关参数，若watermarkImg存在则用图片水印，否则用文字水印。\r\n            // 是否添加水印\r\n            hasMark: true,\r\n            textAlign: 'start',\r\n            // 水印字体，值同css的font\r\n            markFont: '16px microsoft yahei',\r\n            // 水印字样式，可选值：color,gradient,pattern\r\n            markStyle: '#fff',\r\n            // 水印字文本\r\n            markText: 'UED',\r\n            // 水印字x轴位置\r\n            markX: 0,\r\n            // 水印字y轴位置\r\n            markY: 0,\r\n\r\n            // 压缩图片最大值KB\r\n            maxSize: 500,\r\n            // 逐步压缩质量幅度，即每次已多大幅度递减压缩质量，直到符合最小体积值\r\n            qualityStep: 0.1\r\n\r\n        };\r\n\r\n\r\n        options = Object.assign({}, defaults, options);\r\n\r\n        this.sourceImg = options.sourceImg;\r\n        this.rotateNum = options.rotateNum;\r\n        this.maxSize = options.maxSize;\r\n        this.cropW = options.cropW;\r\n        this.cropH = options.cropH;\r\n\r\n        this.mime = options.mime;\r\n        this.qualityStep = options.qualityStep;\r\n\r\n        this.hasMark = options.hasMark;\r\n        this.textAlign = options.textAlign;\r\n        this.markFont = options.markFont;\r\n        this.markStyle = options.markStyle;\r\n        this.markText = options.markText;\r\n        this.markX = options.markX;\r\n        this.markY = options.markY;\r\n\r\n\r\n        // 全局变量\r\n        this.sx = 0;\r\n        this.sy = 0;\r\n\r\n        this.scaleRatio = 1;\r\n\r\n        this.results = [];\r\n\r\n        this.init();\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n    init() {\r\n        let targetImg = this.sourceImg;\r\n        let sourceW0 = targetImg.width;\r\n        let sourceH0 = targetImg.height;\r\n\r\n        if (targetImg.nodeName.toLowerCase() === 'img') {\r\n            sourceW0 = targetImg.naturalWidth;\r\n            sourceH0 = targetImg.naturalHeight;\r\n            // img to canvas\r\n            let canvas = getCanvas(sourceW0, sourceH0);\r\n            let ctx = canvas.getContext('2d');\r\n            ctx.drawImage(targetImg, 0, 0);\r\n            targetImg = canvas;\r\n        }\r\n\r\n        this.result = targetImg;\r\n        this.results.push(this.result);\r\n\r\n    }\r\n\r\n    // 重置\r\n    reset() {\r\n        this.rotateNum = 0;\r\n        this.scaleRatio = 1;\r\n        this.results = this.results.slice(0, 1);\r\n    }\r\n    // 回退\r\n    rollback() {\r\n        this.results.pop();\r\n    }\r\n    // 旋转\r\n    rotate() {\r\n        let targetImg = this.result;\r\n        let sourceW0 = targetImg.width;\r\n        let sourceH0 = targetImg.height;\r\n\r\n\r\n        let rotateDeg = this.rotateNum * 90;\r\n\r\n        let max = Math.max(sourceW0, sourceH0);\r\n        let tempCvs = getCanvas(max, max),\r\n            tempCtx = tempCvs.getContext('2d');\r\n\r\n        tempCtx.translate(max / 2, max / 2);\r\n        tempCtx.rotate(rotateDeg * Math.PI / 180);\r\n        tempCtx.translate(-max / 2, -max / 2);\r\n        tempCtx.drawImage(targetImg, 0, 0);\r\n\r\n\r\n        let w = sourceW0,\r\n            h = sourceH0,\r\n            sx = 0,\r\n            sy = 0;\r\n        if (this.rotateNum === 1) {\r\n            w = sourceH0;\r\n            h = sourceW0;\r\n            sx = max - w;\r\n            sy = 0;\r\n\r\n        } else if (this.rotateNum === 2) {\r\n            w = sourceW0;\r\n            h = sourceH0;\r\n            sx = max - w;\r\n            sy = max - h;\r\n        } else if (this.rotateNum === 3) {\r\n            w = sourceH0;\r\n            h = sourceW0;\r\n            sx = 0;\r\n            sy = max - h;\r\n        } else {\r\n            w = sourceW0;\r\n            h = sourceH0;\r\n            sx = 0;\r\n            sy = 0;\r\n        }\r\n\r\n        let canvas = getCanvas(w, h),\r\n            context = canvas.getContext('2d');\r\n\r\n        context.drawImage(tempCvs, sx, sy, w, h, 0, 0, w, h);\r\n\r\n        // this.base64Data = canvas.toDataURL(this.mime);\r\n        this.result = canvas;\r\n        this.results.push(canvas);\r\n        return this;\r\n    }\r\n\r\n    // 水印\r\n    mark() {\r\n        let targetImg = this.result;\r\n        let sourceW0 = targetImg.width;\r\n        let sourceH0 = targetImg.height;\r\n\r\n        let canvas = getCanvas(sourceW0, sourceH0);\r\n        let dContext = canvas.getContext('2d');\r\n        dContext.drawImage(targetImg, 0, 0);\r\n        if (this.hasMark) {\r\n\r\n            // dContext.textBaseline = \"top\";\r\n            // dContext.textAlign = this.textAlign;\r\n            // dContext.font = this.markFont;\r\n            // dContext.fillStyle = this.markStyle;\r\n            // dContext.fillText(this.markText, this.markX, this.markY);\r\n\r\n            // let markTxtCvs = {\r\n            //     width: 284,\r\n            //     height: 22,\r\n            //     font0: \"18px / 24px Roboto, Arial, 'Microsoft YaHei', sans-serif\",\r\n            //     font1: this.markFont,\r\n            //     color: this.markStyle,\r\n            //     text: this.markText,\r\n            //     x: this.markX,\r\n            //     y: this.markY,\r\n            //     fontRatio: 1\r\n            // }; \r\n            let markTxtCvs = this.markTxtCvs;\r\n            // TODO 优化只在chrome浏览器下用缩放canvas，其他直接用字体，因为缩放会模糊（解决方案整体放大数倍，待验证）。\r\n            if(markTxtCvs.font1 < 12){\r\n                let txtCvs = getCanvas(markTxtCvs.width, markTxtCvs.height);\r\n                let txtCxt = txtCvs.getContext('2d');\r\n    \r\n                txtCxt.textBaseline = \"top\";\r\n                txtCxt.textAlign = \"start\";\r\n                // \"3px / 4px Roboto, Arial, \"Microsoft YaHei\", sans-serif\"\r\n                txtCxt.font = markTxtCvs.font0;\r\n                txtCxt.fillStyle = markTxtCvs.color;\r\n                txtCxt.fillText(markTxtCvs.text, 0, 0);\r\n                var fontRatio = parseInt(markTxtCvs.font1) / parseInt(markTxtCvs.font0);\r\n                dContext.drawImage(txtCvs, 0, 0, markTxtCvs.width, markTxtCvs.height, markTxtCvs.x, markTxtCvs.y, markTxtCvs.width*fontRatio, markTxtCvs.height*fontRatio);\r\n            }else{\r\n                dContext.textBaseline = \"top\";\r\n                dContext.textAlign = \"start\";\r\n                dContext.font = markTxtCvs.font1;\r\n                dContext.fillStyle = markTxtCvs.color;\r\n                dContext.fillText(markTxtCvs.text, markTxtCvs.x, markTxtCvs.y);                \r\n            }\r\n\r\n            \r\n        }\r\n\r\n        // this.base64Data = canvas.toDataURL(this.mime);\r\n        this.result = canvas;\r\n        this.results.push(canvas);\r\n        return this;\r\n    }\r\n\r\n    // 裁剪\r\n    crop() {\r\n        let targetImg = this.result;\r\n\r\n        let canvas = getCanvas(this.cropW, this.cropH);\r\n        let context = canvas.getContext('2d');\r\n\r\n        // 由于safari对于cropW小数值绘制图片为全黑问题，作以下处理\r\n        this.sx = Math.floor(this.sx);\r\n        this.sy = Math.floor(this.sy);\r\n        this.cropW = Math.floor(this.cropW);\r\n        this.cropH = Math.floor(this.cropH);\r\n\r\n        context.drawImage(targetImg, this.sx, this.sy, this.cropW, this.cropH, 0, 0, this.cropW, this.cropH);\r\n\r\n        // this.base64Data = canvas.toDataURL(this.mime);\r\n        this.result = canvas;\r\n        this.results.push(canvas);\r\n        return this;\r\n    }\r\n    // 缩放\r\n    scale() {\r\n        let targetImg = this.result;\r\n        let sourceW0 = targetImg.width;\r\n        let sourceH0 = targetImg.height;\r\n\r\n        let resultW = this.scaleRatio * sourceW0;\r\n        let resultH = this.scaleRatio * sourceH0;\r\n\r\n        let canvas = getCanvas(resultW, resultH);\r\n        let context = canvas.getContext('2d');\r\n        context.drawImage(targetImg, 0, 0, sourceW0, sourceH0, 0, 0, resultW, resultH);\r\n\r\n        // this.base64Data = canvas.toDataURL(this.mime);\r\n        this.result = canvas;\r\n        this.results.push(canvas);\r\n        return this;\r\n    }\r\n    // 只对'image/jpeg'格式有效\r\n    compress(isSimple) {\r\n        let cvs = this.result;\r\n        let max = this.maxSize * 1024;\r\n        let quality = 1;\r\n        let qualityStep = this.qualityStep;\r\n        // 质量压缩只支持'image/jpeg'，'image/webp'(chrome支持)\r\n        let qualityType = 'image/jpeg';\r\n\r\n        let data = cvs.toDataURL(qualityType, 1.0);\r\n        let size0 = getBase64Size(data);\r\n        // console.log('start compress: ' + Math.ceil(size0 / 1024));\r\n        // 简单粗暴\r\n        if (isSimple) {\r\n            while (size0 > max) {\r\n                quality = Math.floor(max / size0 * 10) / 10;\r\n                data = cvs.toDataURL(qualityType, quality);\r\n                size0 = getBase64Size(data);\r\n            }\r\n\r\n        } else {\r\n            // 降低质量\r\n            while (size0 > max) {\r\n                quality -= qualityStep;\r\n                data = cvs.toDataURL(qualityType, quality);\r\n                size0 = getBase64Size(data);\r\n            }\r\n        }\r\n        // console.log('end compress: ' + Math.ceil(size0 / 1024));\r\n\r\n        let blobData = base64Data2Blob(data, this.mime);;    \r\n        let formdata = blob2FormData(blobData);\r\n        \r\n        return {\r\n            \"base64\": data,\r\n            \"blob\": blobData,\r\n            \"formdata\": formdata\r\n        };\r\n    }\r\n\r\n}\r\n\r\n\r\nexport default ImgHandler\r\n","import $ from 'jquery';\r\n\r\nimport {\r\n    loadImages\r\n} from './util';\r\nimport ImgHandler from './imgHandler';\r\nimport Dialog from './dialog';\r\n\r\nimport '../css/pipeImg.scss';\r\n\r\nclass PipeImg {\r\n\r\n    constructor(options) {\r\n        // 默认配置参数\r\n        let defaults = {\r\n            debug: false,\r\n            // 必填，[{\"id\":\"567701\",\"url\":\"./images/Jellyfish.jpg\"}]\r\n            source: [],\r\n            // 上传图片地址\r\n            uploadUrl: '',\r\n            // 发送文件类型，可以使二进制流'blob'可以是表单数据'formdata'，默认二进制流\r\n            sendDataType: 'formdata',\r\n            // 图片编辑界面类型: '0'单图编辑, '1'批量水印\r\n            type: '0',\r\n            mime: 'image/jpeg',\r\n            // 保存图片最大体积\r\n            maxSize: 500,\r\n            // 直接选择水印文字位置水平垂直距离边框位置\r\n            markXPositionMargin: 15,\r\n            markYPositionMargin: 20,\r\n            // 文案\r\n            markTextList: ['producttest.en.made-in-china.com', 'Focus Service Co - Product SourcingFocus Service Co - Product Sourcing'],\r\n            closeBtnTxt: '关闭',\r\n            saveBtnTxt: '保存',\r\n            resetBtnTxt: '重置',\r\n            confirmBtnTxt: '确定',\r\n            cancelBtnTxt: '取消',\r\n            rotateMenuTxt: '旋转',\r\n            turnLeftTxt: '逆时针旋转',\r\n            turnRightTxt: '顺时针旋转',\r\n            cropMenuTxt: '裁剪',\r\n            scaleMenuTxt: '缩放',\r\n            markMenuTxt: '添加水印',\r\n            colorTxt: '颜色',\r\n            positionTxt: '位置',\r\n            opacityTxt: '透明度',\r\n            showRoomTxt: '展示厅',\r\n            companyNameTxt: '公司名称',\r\n            markAllMenuTxt: '批量添加水印',\r\n            tipTitleTxt: '提示',\r\n            tipContentTxt: '尚未保存，是否确定离开？',\r\n            tipConfirmBtnTxt: '确定',\r\n            constrainTxt: '约束比例',\r\n            // 初始化完成\r\n            onInited: () => {},\r\n            // 上传保存完成\r\n            onComplete: (response) => {},\r\n            onClose: () => {}\r\n        };\r\n\r\n        options = Object.assign({}, defaults, options);\r\n        this.debug = options.debug;\r\n        this.source = options.source;\r\n        if (!this.source) {\r\n            throw new Error('PipeImg: source is not found!');\r\n        }\r\n        if (!(Array.isArray(this.source) || typeof this.source === 'string')) {\r\n            throw new Error('PipeImg: source类型错误，只能为字符串或者数组！');\r\n        }\r\n        this.uploadUrl = options.uploadUrl;\r\n        this.sendDataType = options.sendDataType;\r\n        this.type = options.type;\r\n\r\n        this.mime = options.mime;\r\n        this.maxSize = options.maxSize;\r\n\r\n        this.markXPositionMargin = options.markXPositionMargin;\r\n        this.markYPositionMargin = options.markYPositionMargin;\r\n        this.markTextList = options.markTextList;\r\n        this.closeBtnTxt = options.closeBtnTxt;\r\n        this.saveBtnTxt = options.saveBtnTxt;\r\n        this.resetBtnTxt = options.resetBtnTxt;\r\n        this.confirmBtnTxt = options.confirmBtnTxt;\r\n        this.cancelBtnTxt = options.cancelBtnTxt;\r\n        this.rotateMenuTxt = options.rotateMenuTxt;\r\n        this.turnLeftTxt = options.turnLeftTxt;\r\n        this.turnRightTxt = options.turnRightTxt;\r\n        this.cropMenuTxt = options.cropMenuTxt;\r\n        this.scaleMenuTxt = options.scaleMenuTxt;\r\n        this.markMenuTxt = options.markMenuTxt;\r\n        this.colorTxt = options.colorTxt;\r\n        this.positionTxt = options.positionTxt;\r\n        this.opacityTxt = options.opacityTxt;\r\n        this.showRoomTxt = options.showRoomTxt;\r\n        this.companyNameTxt = options.companyNameTxt;\r\n        this.markAllMenuTxt = options.markAllMenuTxt;\r\n        this.tipTitleTxt = options.tipTitleTxt;\r\n        this.tipContentTxt = options.tipContentTxt;\r\n        this.tipConfirmBtnTxt = options.tipConfirmBtnTxt;\r\n        this.constrainTxt = options.constrainTxt;\r\n\r\n\r\n        this.onInited = options.onInited;\r\n        this.onComplete = options.onComplete;\r\n        this.onClose = options.onClose;\r\n\r\n        this.resultList = [];\r\n        this.sourceImgList = [];\r\n        this.returnJson = [];\r\n        this.methods = [];\r\n\r\n        this.activeIndex = 0;\r\n\r\n        this._init();\r\n\r\n    }\r\n\r\n    _init() {\r\n        this.returnJson = this.source;\r\n        let urlList = this.source.map((element, index) => {\r\n            return element.url;\r\n        })\r\n\r\n        // 解决加载完成及跨域问题\r\n        loadImages(urlList, (images) => {\r\n            this.sourceImgList = images;\r\n\r\n\r\n            this.onInited();\r\n            this._executeMethods();\r\n\r\n        }, () => {\r\n            throw new Error('PipeImg: source load failure!');\r\n        })\r\n\r\n    }\r\n    _show(options) {\r\n        if (options && options.selected) {\r\n            this.activeIndex = options.selected;             \r\n        }\r\n\r\n        this.imgHandler = new ImgHandler({\r\n            sourceImg: this.sourceImgList[this.activeIndex]\r\n        });\r\n        this.resultList.push(this.imgHandler.result);\r\n        \r\n        this.dialog.renderImgList(this.sourceImgList, this.activeIndex);\r\n    }\r\n    _saveRotate(options, cb) {\r\n        this.imgHandler.rotateNum = options.rotateNum;\r\n        this.imgHandler.rotate();\r\n        this.resultList.push(this.imgHandler.result);\r\n        cb(this.imgHandler.result);\r\n    }\r\n    _saveCrop(options, cb) {\r\n        this.imgHandler.cropW = options.cropW;\r\n        this.imgHandler.cropH = options.cropH;\r\n        this.imgHandler.sx = options.sx;\r\n        this.imgHandler.sy = options.sy;\r\n        this.imgHandler.crop();\r\n        this.resultList.push(this.imgHandler.result);\r\n        cb(this.imgHandler.result);\r\n    }\r\n    _saveScale(options, cb) {\r\n        this.imgHandler.scaleRatio = options.scaleRatio;\r\n        this.imgHandler.scale();\r\n        this.resultList.push(this.imgHandler.result);\r\n        cb(this.imgHandler.result);\r\n    }\r\n    _saveMark(options, cb) {\r\n        // this.imgHandler.markX = options.markX;\r\n        // this.imgHandler.markY = options.markY;\r\n        // this.imgHandler.markText = options.markText;\r\n        // this.imgHandler.markFont = options.markFont;\r\n        // this.imgHandler.markStyle = options.markStyle;\r\n        \r\n        this.imgHandler.markTxtCvs = options;\r\n \r\n        this.imgHandler.mark();\r\n        this.resultList.push(this.imgHandler.result);\r\n        cb(this.imgHandler.result);\r\n    }\r\n    _reset(cb) {\r\n        this.rotateNum = 0;\r\n        this.scaleRatio = 1;\r\n\r\n        this.resultList = this.resultList.slice(0, 1);\r\n        this.imgHandler = new ImgHandler({\r\n            sourceImg: this.resultList[0]\r\n        })\r\n        cb(this.resultList[0]);\r\n    }\r\n    _save(cb, index) {\r\n        let compressData = this.imgHandler.compress();\r\n        let sendData = this.sendDataType === 'blob' ? compressData.blob : compressData.formdata;\r\n\r\n        if (this.debug) {\r\n            // 模拟返回\r\n            setTimeout(() => {\r\n                // let response = [{\"picHeight\":600,\"picWidth\":800,\"tempPhotoId\":\"573761\",\"url\":\"image?tid=40&amp;id=gCfpAUFcYRlB&amp;cache=0&amp;lan_code=0\"}];\r\n                let response = [{\r\n                    \"picHeight\": 600,\r\n                    \"picWidth\": 800,\r\n                    \"tempPhotoId\": \"573761\",\r\n                    \"url\": compressData.base64\r\n                }];\r\n                \r\n                this._saveSuccess(response[0], index, cb);\r\n            }, 1000);\r\n        } else {\r\n            $.ajax({\r\n                url: this.uploadUrl,\r\n                type: \"POST\",\r\n                data: sendData,\r\n                processData: false,\r\n                contentType: false,\r\n                success: (response) => {\r\n                    this._saveSuccess(response[0], index, cb);\r\n                },\r\n                error: () => {\r\n                    window.console && console.log('network-error: upload failure!');\r\n                }\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    _saveSuccess(data, index, cb) {\r\n        data.url = data.url.replace(\"&amp;\", \"&\");\r\n        let img = new Image();\r\n        img.src = data.url;\r\n        this.resultList = [img];\r\n        this.sourceImgList[index] = img;\r\n        \r\n        let o = {\r\n            \"id\": data.tempPhotoId,\r\n            \"url\": data.url,\r\n            \"picWidth\": data.picWidth,\r\n            \"picHeight\": data.picHeight\r\n        };\r\n        this.returnJson[index] = o;\r\n        cb && cb(this.returnJson);      \r\n    }\r\n    _changeActive(options, cb) {\r\n        this.activeIndex = options.activeIndex;\r\n        this.imgHandler = new ImgHandler({\r\n            sourceImg: options.activeImg\r\n        })\r\n        this.resultList = [this.imgHandler.result];\r\n        cb && cb(this.imgHandler.result);\r\n    }\r\n\r\n    show(options) {\r\n        this.dialog = new Dialog({\r\n            debug: this.debug,\r\n            activeIndex: this.activeIndex,\r\n            type: this.type,\r\n            mime: this.mime,\r\n\r\n            markXPositionMargin: this.markXPositionMargin,\r\n            markYPositionMargin: this.markYPositionMargin,\r\n            markTextList: this.markTextList,\r\n            closeBtnTxt: this.closeBtnTxt,\r\n            saveBtnTxt: this.saveBtnTxt,\r\n            resetBtnTxt: this.resetBtnTxt,\r\n            confirmBtnTxt: this.confirmBtnTxt,\r\n            cancelBtnTxt: this.cancelBtnTxt,\r\n            rotateMenuTxt: this.rotateMenuTxt,\r\n            turnLeftTxt: this.turnLeftTxt,\r\n            turnRightTxt: this.turnRightTxt,\r\n            cropMenuTxt: this.cropMenuTxt,\r\n            scaleMenuTxt: this.scaleMenuTxt,\r\n            markMenuTxt: this.markMenuTxt,\r\n            colorTxt: this.colorTxt,\r\n            positionTxt: this.positionTxt,\r\n            opacityTxt: this.opacityTxt,\r\n            showRoomTxt: this.showRoomTxt,\r\n            companyNameTxt: this.companyNameTxt,\r\n            markAllMenuTxt: this.markAllMenuTxt,\r\n            tipTitleTxt: this.tipTitleTxt,\r\n            tipContentTxt: this.tipContentTxt,\r\n            tipConfirmBtnTxt: this.tipConfirmBtnTxt,\r\n            constrainTxt: this.constrainTxt,\r\n\r\n            onSaveRotate: (options, cb) => {\r\n                this._saveRotate(options, cb);\r\n            },\r\n            onSaveCrop: (options, cb) => {\r\n                this._saveCrop(options, cb);\r\n            },\r\n            onSaveScale: (options, cb) => {\r\n                this._saveScale(options, cb);\r\n            },\r\n            onSaveMark: (options, cb) => {\r\n                this._saveMark(options, cb);\r\n            },\r\n            onReset: (cb) => {\r\n                this._reset(cb);\r\n            },\r\n            onSave: (cb, index) => {\r\n                this._save(cb, index);\r\n            },\r\n            onChangeActive: (options, cb) => {\r\n                this._changeActive(options, cb);\r\n            },\r\n            onSaveMarkAll: (options, cb) => {\r\n                this._saveMarkAll(options, cb);\r\n            },\r\n            onClose: () => {\r\n                this.onClose();\r\n            },\r\n            onComplete: (result) => {\r\n                this.onComplete(result);\r\n            }\r\n        });\r\n\r\n        this.methods.push({\r\n            \"name\": \"show\",\r\n            \"params\": options\r\n        });\r\n    }\r\n\r\n    _executeMethods() {\r\n        this.methods.forEach(element => {\r\n            this['_' + element.name](element.params);\r\n        });\r\n        this.methods = [];\r\n    }\r\n\r\n\r\n}\r\n\r\nexport {\r\n    PipeImg\r\n}\r\n","import $ from 'jquery';\nimport template from 'template';\n\nimport tpl from './thinSelect.tpl';\n\nclass ThinSelect{\n    constructor(options) {\n        let defaults = {\n            el: '',\n            template: tpl,\n        };\n        options = Object.assign({}, defaults, options);\n        this.el = options.el;\n        this.template = options.template;\n        this.$el = $(this.el);\n\n        this.selectObj = {\n            'txt': '',\n            'optionsObj': []\n        };\n        this._init();\n    }\n    _init() {\n        \n        this.$el.find('option').each((index, element) => {\n            let $option = $(element);\n            let selected = $option.prop('selected');\n            let optionVal = $option.val();\n            let optionTxt = $option.text();\n            let optionObj = {\n                'val': optionVal,\n                'txt': optionTxt,\n                'selected': selected\n            };\n            if (selected) {\n                this.selectObj.txt = optionTxt;\n            }\n            \n            this.selectObj.optionsObj.push(optionObj);\n        });\n\n        let templateHtml = template(this.template, {\n            'txt': this.selectObj.txt,\n            optionList: this.selectObj.optionsObj\n        });\n\n\n        this.$el.hide();\n        $(templateHtml).insertBefore(this.$el);\n        this.$thinSelect = this.$el.prev();\n\n        this._bind();\n    }\n    _bind() {\n        this.$thinSelect.find('.J-select-title').on('click', (e) => {\n            e.stopPropagation();\n            let $list = this.$thinSelect.find('.J-select-list');\n            if($list.is(':visible')){\n                $list.hide();\n                this.$thinSelect.find('.J-arrow').removeClass('active');\n            }else{\n                $list.show();\n                this.$thinSelect.find('.J-arrow').addClass('active');\n            }\n        })\n        this.$thinSelect.find('.J-opt').on('click', (e) => {\n            e.stopPropagation();\n            let txt = $(e.target).addClass('selected').text();\n            this.$thinSelect.find('.J-text').text(txt);\n\n            this.$thinSelect.find('.J-select-list').hide();\n            this.$thinSelect.find('.J-arrow').removeClass('active');\n\n            this.$activeItem = $(e.target).parent();\n            this.$activeItem.siblings().find('.J-opt').removeClass('selected');\n\n            this._updateSource();\n        })\n\n        $(document).on('click.thinSelect', (e) => {\n            this.$thinSelect.find('.J-select-list').hide();     \n            this.$thinSelect.find('.J-arrow').removeClass('active');     \n        })\n    }\n    \n    _updateSource() {\n        let index = this.$activeItem.index();\n        this.$el.find('option').eq(index).prop('selected', true);\n        this.$el.trigger('change');\n    }\n    destroy() {\n        $(document).off('click.thinSelect');\n        this.$thinSelect.remove();\n    }\n    select(index) {\n        let $item = this.$thinSelect.find('.J-opt').parent().eq(index);\n        $item.siblings().find('.J-opt').removeClass('selected');\n        let txt = $item.find('.J-opt').addClass('selected').text();\n        this.$thinSelect.find('.J-text').text(txt);\n    }\n}\n\nThinSelect.use = (el) => {\n    if (!el) {\n        throw new Error('ThinSelect: el is not found!');\n    }\n    let instances = [];\n    $(el).each((index, element) => {\n        let instance = new ThinSelect({'el': element});\n        instances.push(instance);\n    })\n    return instances;\n}\n\nexport default ThinSelect\n","module.exports = \"<div class=\\\"thin-select\\\">\\n\\t<div class=\\\"select-title J-select-title\\\">\\n\\t\\t<div class=\\\"select-selected\\\">\\n\\t\\t\\t<span class=\\\"J-text\\\">{{=txt}}</span>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"select-arrow J-arrow\\\">\\n\\t\\t\\t<i class=\\\"ob-icon icon-down\\\"></i>\\n\\t\\t</div>\\n\\t</div>\\n\\t<div class=\\\"select-list J-select-list\\\">\\n\\t\\t<ul class=\\\"select-list-wrap J-select-tab-cnt\\\">\\n\\t\\t\\t{{ for(var i=0; i < optionList.length; i++) { }} \\n\\t\\t\\t\\t<li>\\n\\t\\t\\t\\t\\t<a href=\\\"javascript:void(0)\\\" class=\\\"select-opt J-opt {{=optionList[i].selected ? 'selected' : ''}}\\\" data-val=\\\"{{=optionList[i].val}}\\\">{{=optionList[i].txt}}</a>\\n\\t\\t\\t\\t</li>\\n\\t\\t\\t{{ } }}\\n\\t\\t</ul>\\n\\t</div>\\n</div>\\n\"","module.exports = \"\\r\\n    {{ for(var i=0;i<imgList.length;i++) { }} \\r\\n    <div class=\\\"img-thumbnail {{=i === activeIndex ? 'active' : ''}} J-img-thumbnail\\\">\\r\\n        <div class=\\\"img-inner\\\">\\r\\n            <a href=\\\"javascript:void(0)\\\">\\r\\n            {{ if(markType === '1') { }}   \\r\\n            <img src=\\\"{{-imgList[i].src}}\\\" title=\\\"{{-imgList[i].width}}px * {{-imgList[i].height}}px\\\">\\r\\n            {{ }else{ }}\\r\\n                <img src=\\\"{{-imgList[i].src}}\\\" title=\\\"{{-imgList[i].src}}\\\">\\r\\n            {{ } }}\\r\\n            <span class=\\\"circle\\\"></span>\\r\\n            </a>\\r\\n        </div>\\r\\n\\r\\n    </div>\\r\\n\\r\\n    {{ } }}\"","//拖拽\nfunction drag(moveElement, dragBar, container, cb) {\n    if (!moveElement) return;\n    dragBar = dragBar || moveElement;\n\n    var draging = false,\n        x0, y0, mLeft0, mTop0, mLeft1, mTop1;\n\n    var mousedownHandler = function (e) {\n        e = e || window.event;\n        x0 = e.clientX;\n        y0 = e.clientY;\n        mLeft0 = moveElement.offsetLeft;\n        mTop0 = moveElement.offsetTop;\n\n        draging = true;\n\n    };\n    var mousemoveHandler = function (e) {\n        e = e || window.event;\n        if (draging) {\n            var x1 = e.clientX,\n                y1 = e.clientY;\n            mLeft1 = x1 - x0 + mLeft0;\n            mTop1 = y1 - y0 + mTop0;\n\n\n            if (container) {\n                // 计算可移动位置的大小， 保证元素不会超过可移动范围\n                // 此处就是父元素的宽度减去子元素宽度\n                var width = container.clientWidth - moveElement.offsetWidth;\n                var height = container.clientHeight - moveElement.offsetHeight;\n                // min方法保证不会超过右边界，max保证不会超过左边界\n                mLeft1 = Math.min(Math.max(0, mLeft1), width);\n                mTop1 = Math.min(Math.max(0, mTop1), height);\n            }\n\n\n            moveElement.style.left = mLeft1 + 'px';\n            moveElement.style.top = mTop1 + 'px';\n\n            typeof cb === 'function' && cb(mLeft1, mTop1);\n        }\n    };\n    var mouseupHandler = function (e) {\n        draging = false;\n    }\n\n    if (window.addEventListener) {\n        dragBar.addEventListener('mousedown', mousedownHandler, false);\n        document.addEventListener('mousemove', mousemoveHandler, false);\n        document.addEventListener('mouseup', mouseupHandler, false);\n    }\n}\n\nfunction getImgPromise(src) {\n    return new Promise((resolve, reject) => {\n        let image = new Image();\n        // 跨域报错处理（Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.）\n        image.setAttribute('crossorigin', 'anonymous');\n        image.src = src;\n        image.onload = () => {\n            resolve(image);\n        };\n        image.onerror = () => {\n            reject('Error: image error!');\n        };\n    });\n}\n// 加载图片\nfunction loadImage(src, success, failure) {\n    var image = new Image();\n    // 跨域报错处理（Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.）\n    image.setAttribute('crossorigin', 'anonymous');\n    image.src = src;\n    image.onload = function () {\n        typeof success === 'function' && success(image);\n    };\n    image.onerror = function () {\n        typeof failure === 'function' && failure();\n    };\n}\n\nfunction loadImages(srcList, success, failure) {\n    if (typeof srcList === 'string') {\n        srcList = [srcList];\n    }\n    var images = [];\n    var index = srcList.length;\n    var _loadImage = () => {\n        if (index === 0) {\n            return false;\n        }\n        var image = new Image();       \n        var src = srcList[--index];\n\n        // IE11对于同域的设置'crossorigin'会导致无法获得image的原始尺寸\n        // \"//image.made-in-china.com/9f7j00CwUvHERGufQt/sun123.jpg\"\n        // \"/image?tid=40&id=ktfKUAkzRwMB&cache=0&lan_code=0\"\n        // 跨域报错处理（Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.）\n        if (/^(?:http|\\/\\/)/.test(src) && src.indexOf(window.location.host) === -1) {\n          image.setAttribute('crossorigin', 'anonymous');\n        }\n        image.src = src;\n\n        image.onload = function () {\n            images.unshift(image);\n            if (images.length === srcList.length) {\n                typeof success === 'function' && success(images);\n                return false;\n            }\n            _loadImage();\n        };\n        image.onerror = function () {\n            typeof failure === 'function' && failure();\n        };\n    };\n    _loadImage();\n\n}\n// 创建cavas\nfunction getCanvas(width, height) {\n    var canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n}\n\n//获取base64图片大小\nfunction getBase64Size(base64Data) {\n    // 'data:image/jpeg;base64,xxxxxx...xxx='\n    var str = base64Data.replace(/^data:image\\/[\\w]*;base64,$/, '');\n    var equalIndex = str.indexOf('=');\n    if (equalIndex > 0) {\n        str = str.substring(0, equalIndex);\n    }\n    var strLength = str.length;\n    return parseInt(strLength - (strLength / 8) * 2);\n}\n// 只对'image/jpeg'格式有效\nfunction compress(img, max, isSimple) {\n    let cvs = img;\n    if (cvs.nodeName.toLowerCase() === 'img') {\n        cvs = img2cvs(cvs);\n    }\n    let quality = 1;\n    let minWH = 800;\n    let scaleRatio = 0.9;\n    let qualityStep = 0.1;\n    // 质量压缩只支持'image/jpeg'，'image/webp'(chrome支持)\n    let qualityType = 'image/jpeg';\n\n    let width = cvs.width;\n    let height = cvs.height;\n    let cvsRatio = width / height;\n    let data = cvs.toDataURL(qualityType, 1.0);\n    let size0 = getBase64Size(data);\n    // console.log('start compress: ' + Math.ceil(size0 / 1024));\n    if (isSimple) {\n        while (size0 > max) {\n            quality = Math.floor(max / size0 * 10) / 10;\n            data = cvs.toDataURL(qualityType, quality);\n            size0 = getBase64Size(data);\n        }\n\n    } else {\n        // 优先缩放\n        while (size0 > max && (width > minWH || height > minWH)) {\n            let newWidth, newHeight;\n            if (cvsRatio > 1) {\n                newWidth = width * scaleRatio > minWH ? width * scaleRatio : minWH;\n                newHeight = newWidth / cvsRatio;\n            } else {\n                newHeight = height * scaleRatio > minWH ? height * scaleRatio : minWH;\n                newWidth = newHeight * cvsRatio;\n            }\n\n            let canvas = getCanvas(newWidth, newHeight),\n                ctx = canvas.getContext(\"2d\");\n            ctx.drawImage(cvs, 0, 0, newWidth, newHeight);\n\n            data = canvas.toDataURL(qualityType, 1.0);\n            size0 = getBase64Size(data);\n            width = newWidth;\n            height = newHeight;\n            cvs = canvas;\n        }\n        // 降低质量\n        while (size0 > max) {\n            quality -= qualityStep;\n            data = cvs.toDataURL(qualityType, quality);\n            size0 = getBase64Size(data);\n        }\n    }\n    // console.log('end compress: ' + Math.ceil(size0 / 1024));\n    return data;\n}\n\n\nfunction base64Data2Blob(base64Data, mime) {\n    var binStr = atob(base64Data.split(',')[1]),\n        len = binStr.length,\n        arr = new Uint8Array(len);\n    if (!mime) {\n        // mime = base64Data.split(',')[0].split(':')[1].split(';')[0];\n        mime = base64Data.substring(base64Data.indexOf('data:') + 5, base64Data.indexOf(';base64'));\n    }\n\n    for (var i = 0; i < len; i++) {\n        arr[i] = binStr.charCodeAt(i);\n    }\n\n    return new Blob([arr], {\n        type: mime\n    });\n\n}\n\nfunction blob2FormData(blob, fileName) {\n    var formData = new FormData();\n    formData.append('file', blob);\n    if (!fileName) {\n        fileName = new Date().getTime();\n    }\n    formData.append(\"fileName\", fileName);\n\n    return formData;\n}\n\n// canvas转成blob对象，type值为image/jpeg或者image/webp时，可使用encoderOptions（0-1）设置图片展示质量。\nfunction canvas2Blob(canvas, callback, type, quality) {\n    // Polyfill\n    if (!HTMLCanvasElement.prototype.toBlob) {\n        Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {\n            value: function (callback, type, quality) {\n\n                var binStr = atob(this.toDataURL('image/jpeg', quality).split(',')[1]),\n                    len = binStr.length,\n                    arr = new Uint8Array(len);\n\n                for (var i = 0; i < len; i++) {\n                    arr[i] = binStr.charCodeAt(i);\n                }\n\n                callback(new Blob([arr], {\n                    type: type || 'image/png'\n                }));\n            }\n        });\n    }\n\n    canvas.toBlob(callback, type, quality);\n}\n\nfunction uploadFile(formData, url) {\n\n    var xmlHttp = new XMLHttpRequest();\n    xmlHttp.open('POST', url); //注意跨域问题\n    xmlHttp.send(formData);\n    xmlHttp.onreadystatechange = function () {\n        if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {\n            console.log(xmlHttp.responseText);\n        } else {\n            console.log(xmlHttp.statusText);\n        }\n    };\n}\n// 选择文件\nfunction chooseFile(btn, cb, validFileCallback) {\n    let $btn = typeof btn === \"string\" ? document.querySelector(btn) : btn;\n    let $file = $btn.querySelector('input[type=file]');\n    if (!$file) {\n        let fileNode = document.createElement('input');\n        fileNode.setAttribute('type', 'file');\n\n        fileNode.style.cssText = 'display: none;';\n        $btn.appendChild(fileNode);\n        $file = $btn.querySelector('input[type=file]');\n    }\n\n    $file.addEventListener('change', function (e) {\n        if (this.files.length > 0) {\n\n            let oFile = this.files[0];\n\n            let validFile = true;\n            if (typeof validFileCallback === 'function' && validFileCallback(oFile) === false) {\n                validFile = false;\n            }\n\n            if (validFile) {\n                let reader = new FileReader();\n                reader.readAsDataURL(oFile);\n\n                reader.onload = function () {\n                    typeof cb === 'function' && cb(this.result);\n                }\n            } else {\n                console.log('onValidateFile function return false')\n            }\n\n        }\n    }, false);\n\n    // 阻止冒泡导致两次触发selectBtn\n    $file.addEventListener('click', (e) => {\n        e.stopPropagation();\n    })\n\n    $file.click();\n\n}\n\nfunction _$(ele) {\n    return typeof ele === 'string' ? document.querySelector(ele) : ele;\n}\n\nfunction img2cvs(img) {\n    var canvas = document.createElement('canvas');\n    var ctx = canvas.getContext('2d');\n    canvas.width = img.naturalWidth;\n    canvas.height = img.naturalHeight;\n    ctx.drawImage(img, 0, 0);\n    return canvas;\n}\nfunction isRealNum(val) {\n    if (typeof val !== 'number') {\n        return false;\n    }\n    if (!isNaN(val)) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\nexport {\n    drag,\n    loadImage,\n    loadImages,\n    getCanvas,\n    getBase64Size,\n    compress,\n    base64Data2Blob,\n    blob2FormData,\n    chooseFile,\n    uploadFile,\n    getImgPromise,\n    _$,\n    img2cvs,\n    isRealNum\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE_jquery__;","module.exports = __WEBPACK_EXTERNAL_MODULE_template__;"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClFA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AAEA;AAIA;AAGA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1CA;AA+CA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxBA;AA2BA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AAKA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAHA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AANA;AACA;AASA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AA1BA;AACA;AAiCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AACA;AAGA;AACA;AAEA;AA1BA;AACA;AA6BA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAIA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAXA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAVA;AACA;AAWA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;;AAEA;AACA;AACA;AAEA;AACA;AACA;;;AAEA;AACA;AACA;;;AACA;AACA;AACA;AADA;AAIA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAIA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;;;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AACA;AAUA;AACA;AAEA;AACA;;;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;;;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAtBA;AACA;AAwBA;AACA;AACA;AACA;AACA;AAJA;AAMA;;;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAMA;;;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AACA;AAEA;AACA;AACA;AAEA;AACA;AADA;AAIA;AACA;AACA;AAEA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AACA;AAEA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;;;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAGA;AAEA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAtBA;AACA;AAwBA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAWA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AAFA;AACA;AAGA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AACA;AAIA;AAEA;AACA;;;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;;;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AACA;AACA;AACA;;;;;;AAIA;;;;;;;;;;;AC1gDA;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AAEA;AACA;AAGA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAgBA;AACA;AAcA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AACA;AAOA;AACA;AAAA;AACA;AACA;AAEA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;;;AAEA;AAEA;AAAA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AAFA;AAIA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAFA;AAIA;;;AACA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9TA;AACA;AAMA;;;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AA9BA;AAmCA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAEA;AAEA;AAEA;AAEA;AACA;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AAGA;AAEA;AACA;AAAA;AAGA;AACA;AACA;AACA;AAGA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAHA;AAKA;;;;;;AAKA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrTA;AAEA;AAGA;AACA;AAEA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3CA;AA8CA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AAEA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAEA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;;;AACA;AACA;AACA;AAEA;AACA;AACA;AADA;AAGA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAaA;AAEA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;;;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5DA;AA+DA;AACA;AACA;AAFA;AAIA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvUA;AACA;AAEA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AACA;AAGA;AACA;AACA;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAMA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AClHA;;;;;;;;;;;ACAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAdA;AAgBA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC/UA;;;;;;;;;;;ACAA;;;;;A","sourceRoot":""}