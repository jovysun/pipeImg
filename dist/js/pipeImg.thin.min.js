!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("jQuery"),require("template"));else if("function"==typeof define&&define.amd)define(["jQuery","template"],i);else{var e="object"==typeof exports?i(require("jQuery"),require("template")):i(t.jQuery,t.template);for(var a in e)("object"==typeof exports?exports:t)[a]=e[a]}}(window,function(t,i){return function(t){var i={};function e(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=i,e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(a,n,function(i){return t[i]}.bind(null,n));return a},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=18)}([function(i,e){i.exports=t},function(t,i,e){"use strict";function a(t,i,e,a){if(t){i=i||t;var n,s,o,r,l,c,h=!1;window.addEventListener&&(i.addEventListener("mousedown",function(i){i=i||window.event,n=i.clientX,s=i.clientY,o=t.offsetLeft,r=t.offsetTop,h=!0},!1),document.addEventListener("mousemove",function(i){if(i=i||window.event,h){var p=i.clientX,u=i.clientY;if(l=p-n+o,c=u-s+r,e){var d=e.clientWidth-t.offsetWidth,m=e.clientHeight-t.offsetHeight;l=Math.min(Math.max(0,l),d),c=Math.min(Math.max(0,c),m)}t.style.left=l+"px",t.style.top=c+"px","function"==typeof a&&a(l,c)}},!1),document.addEventListener("mouseup",function(t){h=!1},!1))}}function n(t,i,e){"string"==typeof t&&(t=[t]);var a=[],n=t.length;!function s(){if(0===n)return!1;var o=new Image;o.setAttribute("crossorigin","anonymous"),o.src=t[--n],o.onload=function(){if(a.unshift(o),a.length===t.length)return"function"==typeof i&&i(a),!1;s()},o.onerror=function(){"function"==typeof e&&e()}}()}function s(t,i){var e=document.createElement("canvas");return e.width=t,e.height=i,e}function o(t){var i=t.replace(/^data:image\/[\w]*;base64,$/,""),e=i.indexOf("=");e>0&&(i=i.substring(0,e));var a=i.length;return parseInt(a-a/8*2)}function r(t,i){var e=atob(t.split(",")[1]),a=e.length,n=new Uint8Array(a);i||(i=t.substring(t.indexOf("data:")+5,t.indexOf(";base64")));for(var s=0;s<a;s++)n[s]=e.charCodeAt(s);return new Blob([n],{type:i})}function l(t,i){var e=new FormData;return e.append("file",t),i||(i=(new Date).getTime()),e.append("fileName",i),e}e.d(i,"c",function(){return a}),e.d(i,"f",function(){return n}),e.d(i,"e",function(){return s}),e.d(i,"d",function(){return o}),e.d(i,"a",function(){return r}),e.d(i,"b",function(){return l})},function(t,i,e){"use strict";var a=e(1);function n(){return(n=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function s(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var o=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=n({},{sourceImg:null,rotateNum:0,maxSize:500,cropW:"",cropH:"",mime:"image/jpeg",minWH:800,hasMark:!0,textAlign:"start",markFont:"16px microsoft yahei",markStyle:"#fff",markText:"UED",markX:0,markY:0},i),this.sourceImg=i.sourceImg,this.rotateNum=i.rotateNum,this.maxSize=i.maxSize,this.cropW=i.cropW,this.cropH=i.cropH,this.mime=i.mime,this.minWH=i.minWH,this.hasMark=i.hasMark,this.textAlign=i.textAlign,this.markFont=i.markFont,this.markStyle=i.markStyle,this.markText=i.markText,this.markX=i.markX,this.markY=i.markY,this.sx=0,this.sy=0,this.scaleRatio=.5,this.quality=.2,this.results=[],this.init()}return function(t,i,e){i&&s(t.prototype,i),e&&s(t,e)}(t,[{key:"init",value:function(){var t=this.sourceImg,i=t.width,e=t.height;if("img"===t.nodeName.toLowerCase()){i=t.naturalWidth,e=t.naturalHeight;var n=Object(a.e)(i,e);n.getContext("2d").drawImage(t,0,0),t=n}this.result=t,this.results.push(this.result)}},{key:"reset",value:function(){this.rotateNum=0,this.scaleRatio=1,this.results=this.results.slice(0,1)}},{key:"rollback",value:function(){this.results.pop()}},{key:"rotate",value:function(){var t=this.result,i=t.width,e=t.height,n=90*this.rotateNum,s=Math.max(i,e),o=Object(a.e)(s,s),r=o.getContext("2d");r.translate(s/2,s/2),r.rotate(n*Math.PI/180),r.translate(-s/2,-s/2),r.drawImage(t,0,0);var l=i,c=e,h=0,p=0;1===this.rotateNum?(c=i,h=s-(l=e),p=0):2===this.rotateNum?(h=s-(l=i),p=s-(c=e)):3===this.rotateNum?(l=e,h=0,p=s-(c=i)):(l=i,c=e,h=0,p=0);var u=Object(a.e)(l,c);return u.getContext("2d").drawImage(o,h,p,l,c,0,0,l,c),this.result=u,this.results.push(u),this}},{key:"mark",value:function(){var t=this.result,i=t.width,e=t.height,n=Object(a.e)(i,e),s=n.getContext("2d");return s.drawImage(t,0,0),this.hasMark&&(s.textBaseline="top",s.textAlign=this.textAlign,s.font=this.markFont,s.fillStyle=this.markStyle,s.fillText(this.markText,this.markX,this.markY)),this.result=n,this.results.push(n),this}},{key:"crop",value:function(){var t=this.result,i=(t.width,t.height,Object(a.e)(this.cropW,this.cropH));return i.getContext("2d").drawImage(t,this.sx,this.sy,this.cropW,this.cropH,0,0,this.cropW,this.cropH),this.result=i,this.results.push(i),this}},{key:"scale",value:function(){var t=this.result,i=t.width,e=t.height,n=this.scaleRatio*i,s=this.scaleRatio*e,o=Object(a.e)(n,s);return o.getContext("2d").drawImage(t,0,0,i,e,0,0,n,s),this.result=o,this.results.push(o),this}},{key:"compress",value:function(t){var i=this.result,e=1024*this.maxSize,n=1,s=this.minWH,o=i.width,r=i.height,l=o/r,c=i.toDataURL("image/jpeg",1),h=Object(a.d)(c);if(t)for(;h>e;)n=Math.floor(e/h*10)/10,c=i.toDataURL("image/jpeg",n),h=Object(a.d)(c);else{for(;h>e&&(o>s||r>s);){var p=void 0,u=void 0;l>1?u=(p=.9*o>s?.9*o:s)/l:p=(u=.9*r>s?.9*r:s)*l;var d=Object(a.e)(p,u);d.getContext("2d").drawImage(i,0,0,p,u),c=d.toDataURL("image/jpeg",1),h=Object(a.d)(c),o=p,r=u,i=d}for(;h>e;)n-=.1,c=i.toDataURL("image/jpeg",n),h=Object(a.d)(c)}var m=Object(a.a)(c,this.mime);return{base64:c,blob:m,formdata:Object(a.b)(m)}}}]),t}();i.a=o},function(t,e){t.exports=i},function(t,i){t.exports='<div class="pipeImg-wrapper J-pipe-wrapper">\r\n    <div class="pipeImg-header">\r\n        <ul class="pipeImg-menu">\r\n            <li class="pipeImg-item J-item active"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-refresh"></i>{{=rotateMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-crop"></i>{{=cropMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-scaling"></i>{{=scaleMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item J-item-mark">\r\n                <a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</a>\r\n                <div class="pipeImg-btn J-menu-txt" style="display:none;"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</div>\r\n                <div class="pipeImg-item item-sub">\r\n                    <a class="pipeImg-btn J-menu-btn-mark-all" href="javascript:void(0)"><i class="ob-icon icon-batch"></i>{{=markAllMenuTxt}}</a>\r\n                    <a class="pipeImg-btn J-menu-btn-mark" href="javascript:void(0)" style="display:none;"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</a>\r\n                </div>\r\n            </li>\r\n        </ul>\r\n        <a class="pipeImg-btn btn-close J-button-close" href="javascript:void(0)"><i class="ob-icon icon-delete"></i>{{=closeBtnTxt}}</a>\r\n    </div>\r\n    <div class="pipeImg-content">\r\n        \x3c!-- 旋转面板 --\x3e\r\n        <div class="pipeImg-panel rotate-panel active J-panel J-rotate-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="size">\r\n                    <span class="J-num-width"></span>*<span class="J-num-height"></span>px\r\n                </div>\r\n                <a class="pipeImg-btn btn-rotate J-btn-rotate-left" href="javascript:void(0)"><i class="ob-icon icon-rotate-l"></i>{{=turnLeftTxt}}</a>\r\n                <a class="pipeImg-btn btn-rotate J-btn-rotate-right" href="javascript:void(0)"><i class="ob-icon icon-rotate-r"></i>{{=turnRightTxt}}</a>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 裁剪面板 --\x3e\r\n        <div class="pipeImg-panel J-panel J-crop-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <input class="num-width J-num-width" type="text">\r\n                <input class="J-fix-ratio" id="fixRatio" type="checkbox" name="fixRatio" hidden>\r\n                <label class="fix" for="fixRatio"><i class="ob-icon icon-lock"></i></label>\r\n                <input class="num-height J-num-height" type="text">\r\n                <span class="txt">px</span>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 缩放面板 --\x3e\r\n        <div class="pipeImg-panel scale-panel J-panel J-scale-panel">\r\n            <div class="img-box J-img-box">\r\n                <div class="scale-img-wrapper J-scale-img-wrapper">\r\n                    <img class="J-source" src="{{-imgList[0].src}}">\r\n                </div>\r\n            </div>\r\n            <div class="content-footer">\r\n                <input class="num-width J-num-width" type="text">\r\n                <span class="txt">X</span>\r\n                <input class="num-height J-num-height" type="text">\r\n                <span class="txt">px</span>\r\n                <input class="scale-range J-scale-range" type="range" name="scaleRatio" min="5" max="100" step="1" defaultValue="100" value="100">\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 添加水印面板 --\x3e\r\n        <div class="pipeImg-panel J-panel J-mark-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=colorTxt}}:</div> \r\n                    <input class="J-color" id="colorWhite" type="radio" name="color" value="0" autocomplete="off" hidden>        \r\n                    <label class="color" for="colorWhite"></label>\r\n                    <input class="J-color" id="colorBlack" type="radio" name="color" value="1" checked autocomplete="off" hidden>\r\n                    <label class="color color-black" for="colorBlack"></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=positionTxt}}:</div>\r\n                    <input class="J-position" id="positionCenter" type="radio" name="position" value="0" autocomplete="off" checked hidden>\r\n                    <label class="position center" for="positionCenter"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftTop" type="radio" name="position" value="1" autocomplete="off" hidden>\r\n                    <label class="position left-top" for="positionLeftTop"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightTop" type="radio" name="position" value="2" autocomplete="off" hidden>\r\n                    <label class="position right-top" for="positionRightTop"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftBottom" type="radio" name="position" value="3" autocomplete="off" hidden>\r\n                    <label class="position left-bottom" for="positionLeftBottom"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightBottom" type="radio" name="position" value="4" autocomplete="off" hidden>\r\n                    <label class="position right-bottom" for="positionRightBottom"><span class="line"></span></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=opacityTxt}}:</div>\r\n                    <input class="opacity-range J-opacity" name="opacity" type="range" min="10" max="100" step="1" defaultValue="80" value="80">\r\n                </div>\r\n\r\n                <select class="J-select-mark" name="markTxt">\r\n                    <option value="0" selected="selected">{{=showRoomTxt}}</option>\r\n                    <option value="1">{{=companyNameTxt}}</option>\r\n                </select>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-confirm J-button-confirm" href="javascript:void(0)">{{=confirmBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-cancel J-button-cancel" href="javascript:void(0)">{{=cancelBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 批量添加水印 --\x3e\r\n        <div class="pipeImg-panel panel-mark-all J-panel J-mark-all-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="imgs-thumbnail">\r\n                {{ for(var i=0;i<imgList.length;i++) { }} \r\n                <div class="img-thumbnail {{=i === 0 ? \'active\' : \'\'}} J-img-thumbnail">\r\n                    <a href="javascript:void(0)">\r\n                        <img src="{{-imgList[i].src}}">\r\n                        <span class="circle"></span>\r\n                    </a>\r\n                </div>\r\n\r\n                {{ } }}\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=colorTxt}}:</div> \r\n                    <input class="J-color" id="colorWhiteAll" type="radio" name="colorAll" value="0" autocomplete="off" hidden>        \r\n                    <label class="color" for="colorWhiteAll"></label>\r\n                    <input class="J-color" id="colorBlackAll" type="radio" name="colorAll" value="1" checked autocomplete="off" hidden>\r\n                    <label class="color color-black" for="colorBlackAll"></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=positionTxt}}:</div>\r\n                    <input class="J-position" id="positionCenterAll" type="radio" name="positionAll" value="0" autocomplete="off" checked hidden>\r\n                    <label class="position center" for="positionCenterAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftTopAll" type="radio" name="positionAll" value="1" autocomplete="off" hidden>\r\n                    <label class="position left-top" for="positionLeftTopAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightTopAll" type="radio" name="positionAll" value="2" autocomplete="off" hidden>\r\n                    <label class="position right-top" for="positionRightTopAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftBottomAll" type="radio" name="positionAll" value="3" autocomplete="off" hidden>\r\n                    <label class="position left-bottom" for="positionLeftBottomAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightBottomAll" type="radio" name="positionAll" value="4" autocomplete="off" hidden>\r\n                    <label class="position right-bottom" for="positionRightBottomAll"><span class="line"></span></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=opacityTxt}}:</div>\r\n                    <input class="opacity-range J-opacity" name="opacityAll" type="range" min="10" max="100" step="1" defaultValue="80" value="80">\r\n                </div>\r\n\r\n                <select class="J-select-mark" name="markTxtAll">\r\n                    <option value="0" selected="selected">{{=showRoomTxt}}</option>\r\n                    <option value="1">{{=companyNameTxt}}</option>\r\n                </select>\r\n                \r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n    <div class="pipeImg-footer J-pipe-footer">\r\n        <div class="imgs-thumbnail">\r\n            {{ for(var i=0;i<imgList.length;i++) { }} \r\n            <div class="img-thumbnail {{=i === 0 ? \'active\' : \'\'}} J-img-thumbnail">\r\n                <div class="img-inner">\r\n                    <a href="javascript:void(0)">\r\n                    <img src="{{-imgList[i].src}}">\r\n                    <span class="circle"></span>\r\n                    </a>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            {{ } }}\r\n        </div>  \r\n\r\n        <div class="pipeImg-buttons">\r\n            <a class="pipeImg-button button-confirm J-button-confirm-all" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n            <a class="pipeImg-button button-cancel J-button-cancel-all" href="javascript:void(0)">{{=cancelBtnTxt}}</a>\r\n        </div>            \r\n    </div>\r\n\r\n</div>\r\n\r\n<div class="pipeImg-tip J-pipeImg-tip">\r\n    <div class="pipeImg-tip-header">{{=tipTitleTxt}}</div>\r\n    <div class="pipeImg-tip-main">\r\n        <div class="pipeImg-tip-content">{{=tipContentTxt}}</div>\r\n        <a class="pipeImg-button button-confirm J-tip-confirm" href="javascript:void(0)">{{=tipConfirmBtnTxt}}</a>\r\n        <a class="pipeImg-button button-cancel J-tip-cancel" href="javascript:void(0)">{{=cancelBtnTxt}}</a>        \r\n    </div>\r\n</div>\r\n\r\n<div class="pipeImg-progress-bar J-pipeImg-progress">\r\n    <div class="pipeImg-progress-val"></div>\r\n</div>'},function(t,i){t.exports='<div class="thin-select">\n\t<div class="select-title J-select-title">\n\t\t<div class="select-selected">\n\t\t\t<span class="J-text">{{=txt}}</span>\n\t\t</div>\n\t\t<div class="select-arrow J-arrow">\n\t\t\t<i class="ob-icon icon-down"></i>\n\t\t</div>\n\t</div>\n\t<div class="select-list J-select-list">\n\t\t<ul class="select-list-wrap J-select-tab-cnt">\n\t\t\t{{ for(var i=0; i < optionList.length; i++) { }} \n\t\t\t\t<li>\n\t\t\t\t\t<a href="javascript:void(0)" class="select-opt J-opt {{=optionList[i].selected ? \'selected\' : \'\'}}" data-val="{{=optionList[i].val}}">{{=optionList[i].txt}}</a>\n\t\t\t\t</li>\n\t\t\t{{ } }}\n\t\t</ul>\n\t</div>\n</div>\n'},function(t,i,e){"use strict";var a=e(0),n=e.n(a),s=e(3),o=e.n(s),r=e(1);function l(){return(l=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function c(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var h=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=l({},{el:"",width:"100%",height:"100%",markText:"producttest.en.made-in-china.com",hasLight:!1,fixRatio:!1,onDragPoint:function(t){},onDragComplete:function(t,i){}},i),this.el=i.el,this.width=i.width,this.height=i.height,this.markText=i.markText,this.hasLight=i.hasLight,this.fixRatio=i.fixRatio,this.onDragPoint=i.onDragPoint,this.onDragComplete=i.onDragComplete,this.init()}return function(t,i,e){i&&c(t.prototype,i),e&&c(t,e)}(t,[{key:"init",value:function(){var t=this;this.$el=n()(this.el);var i=this.$el.attr("src"),e=this.$el.parent(),a='<div class="dragbox-wrapper J-dragbox-wrapper">\n                                <img class="J-source" src="'.concat(i,'">\n                                <div class="drag-box J-drag-box">\n                                    <div class="drag-point up-left J-drag-point"></div>\n                                    <div class="drag-point up J-drag-point"></div>\n                                    <div class="drag-point up-right J-drag-point"></div>\n                                    <div class="drag-point right J-drag-point"></div>\n                                    <div class="drag-point right-down J-drag-point"></div>\n                                    <div class="drag-point down J-drag-point"></div>\n                                    <div class="drag-point left-down J-drag-point"></div>\n                                    <div class="drag-point left J-drag-point"></div>\n                                    <div class="mark-txt J-mark-txt">').concat(this.markText,"</div>\n                                </div>\n                            </div>");this.hasLight&&(a='<div class="dragbox-wrapper J-dragbox-wrapper">\n                                <img class="J-source img-dark" src="'.concat(i,'">\n                                <img class="J-source img-light J-img-light" src="').concat(i,'">\n                                <div class="drag-box J-drag-box">\n                                    <div class="drag-point up-left J-drag-point"></div>\n                                    <div class="drag-point up J-drag-point"></div>\n                                    <div class="drag-point up-right J-drag-point"></div>\n                                    <div class="drag-point right J-drag-point"></div>\n                                    <div class="drag-point right-down J-drag-point"></div>\n                                    <div class="drag-point down J-drag-point"></div>\n                                    <div class="drag-point left-down J-drag-point"></div>\n                                    <div class="drag-point left J-drag-point"></div>\n                                </div>\n                            </div>')),e.html(a),this.$dragBox=e.find(".J-drag-box"),this.hasLight||this.$dragBox.css({width:this.$dragBox.find(".J-mark-txt").width(),height:this.$dragBox.find(".J-mark-txt").height()}),this.$dragPoint=this.$dragBox.find(".J-drag-point"),this.boxEl=this.$dragBox.get(0),this.containerEl=this.boxEl.parentNode,this.imgLight=e.find(".J-img-light:first").get(0),this.boxData={left:this.boxEl.offsetLeft,top:this.boxEl.offsetTop,width:this.boxEl.offsetWidth,height:this.boxEl.offsetHeight,ratio:this.boxEl.offsetWidth/this.boxEl.offsetHeight},this._bind(),Object(r.c)(this.boxEl,this.boxEl,this.boxEl.parentNode,function(i,e){t._light(),t.onDragComplete(i,e)})}},{key:"_bind",value:function(){var t=this,i=!1,e="",a=["up-left","up","up-right","right","right-down","down","left-down","left"],s=this.boxData.width/this.boxData.height;this.$dragPoint.on("mousedown",function(o){o.stopPropagation(),i=!0;var r=n()(o.target).index();e=a[r],s=t.boxData.width/t.boxData.height}),n()(document).on("mouseup",function(e){i=!1,t.boxData={left:t.boxEl.offsetLeft,top:t.boxEl.offsetTop,width:t.boxEl.offsetWidth,height:t.boxEl.offsetHeight,ratio:t.boxEl.offsetWidth/t.boxEl.offsetHeight}}),n()(document).on("mousemove",function(a){1==i&&(t._move(a,e,s),t._light(),t.boxData={left:t.boxEl.offsetLeft,top:t.boxEl.offsetTop,width:t.boxEl.offsetWidth,height:t.boxEl.offsetHeight,ratio:t.boxEl.offsetWidth/t.boxEl.offsetHeight},t.onDragPoint(t.boxData))})}},{key:"_getPosition",value:function(){for(var t=this.boxEl,i=t.offsetLeft,e=t.offsetTop,a=t.offsetParent;null!=a;)i+=a.offsetLeft,e+=a.offsetTop,a=a.offsetParent;return{left:i,top:e}}},{key:"_move",value:function(t,i,e){var a,n,s,o,r,l,c=t.clientX,h=t.clientY,p=this.boxEl.offsetWidth,u=this.boxEl.offsetHeight,d=this._getPosition(),m=d.top,f=d.left;if(-1!=i.indexOf("left")){var v=f-c;if(v>=0&&this.boxEl.offsetLeft<=0)return!1;a=p+v,s=this.boxEl.offsetLeft-v}if(-1!=i.indexOf("right")){var g=c-f-p;if(g>=0&&this.containerEl.clientWidth-(this.boxEl.offsetLeft+p+g)<=0)return!1;a=p+g,s=this.boxEl.offsetLeft}if(-1!=i.indexOf("up")&&(this.fixRatio?r=(n=Math.round(a/e))-u:n=u+(r=m-h),o=this.boxEl.offsetTop-r,r>=0&&this.boxEl.offsetTop<=0))return!1;if(-1!=i.indexOf("down")&&(this.fixRatio?(l=(n=Math.round(a/e))-u,o=this.boxEl.offsetTop):n=u+(l=h-m-u),l>=0&&this.containerEl.clientHeight-(this.boxEl.offsetTop+u+l)<=0))return!1;this.boxEl.style.width=Math.min(a,this.containerEl.offsetWidth)+"px",this.boxEl.style.height=Math.min(n,this.containerEl.offsetHeight)+"px",this.boxEl.style.left=Math.max(s,0)+"px",this.boxEl.style.top=Math.max(o,0)+"px"}},{key:"_light",value:function(){this.hasLight&&this._setChoice()}},{key:"_setChoice",value:function(){var t=this.boxEl.offsetTop,i=this.boxEl.offsetLeft+this.boxEl.offsetWidth,e=this.boxEl.offsetTop+this.boxEl.offsetHeight,a=this.boxEl.offsetLeft;this.imgLight.style.clip="rect("+t+"px,"+i+"px,"+e+"px,"+a+"px)"}},{key:"update",value:function(){this.$dragBox.css({width:this.width,height:this.height})}}]),t}(),p=e(4),u=e.n(p),d=e(5),m=e.n(d);function f(){return(f=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function v(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var g=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=f({},{el:"",template:m.a},i),this.el=i.el,this.template=i.template,this.$el=n()(this.el),this.selectObj={txt:"",optionsObj:[]},this._init()}return function(t,i,e){i&&v(t.prototype,i),e&&v(t,e)}(t,[{key:"_init",value:function(){var t=this;this.$el.find("option").each(function(i,e){var a=n()(e),s=a.prop("selected"),o=a.val(),r=a.text(),l={val:o,txt:r,selected:s};s&&(t.selectObj.txt=r),t.selectObj.optionsObj.push(l)});var i=o()(this.template,{txt:this.selectObj.txt,optionList:this.selectObj.optionsObj});this.$el.hide(),n()(i).insertBefore(this.$el),this.$thinSelect=this.$el.prev(),this._bind()}},{key:"_bind",value:function(){var t=this;this.$thinSelect.find(".J-select-title").on("click",function(i){i.stopPropagation();var e=t.$thinSelect.find(".J-select-list");e.is(":visible")?(e.hide(),t.$thinSelect.find(".J-arrow").removeClass("active")):(e.show(),t.$thinSelect.find(".J-arrow").addClass("active"))}),this.$thinSelect.find(".J-opt").on("click",function(i){i.stopPropagation();var e=n()(i.target).addClass("selected").text();t.$thinSelect.find(".J-text").text(e),t.$thinSelect.find(".J-select-list").hide(),t.$thinSelect.find(".J-arrow").removeClass("active"),t.$activeItem=n()(i.target).parent(),t.$activeItem.siblings().find(".J-opt").removeClass("selected"),t._updateSource()}),n()(document).on("click.thinSelect",function(i){t.$thinSelect.find(".J-select-list").hide(),t.$thinSelect.find(".J-arrow").removeClass("active")})}},{key:"_updateSource",value:function(){var t=this.$activeItem.index();this.$el.find("option").eq(t).prop("selected",!0),this.$el.trigger("change")}},{key:"destroy",value:function(){n()(document).off("click.thinSelect"),this.$thinSelect.remove()}},{key:"select",value:function(t){var i=this.$thinSelect.find(".J-opt").parent().eq(t);i.siblings().find(".J-opt").removeClass("selected");var e=i.find(".J-opt").addClass("selected").text();this.$thinSelect.find(".J-text").text(e)}}]),t}();g.use=function(t){if(!t)throw new Error("ThinSelect: el is not found!");var i=[];return n()(t).each(function(t,e){var a=new g({el:e});i.push(a)}),i};var x=g;function b(){return(b=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function k(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var T=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=b({},{debug:!1,imgList:[],template:u.a,mime:"image/jpeg",markTextList:["producttest.en.made-in-china.com","Focus Service Co - Product Sourcing"],closeBtnTxt:"关闭",saveBtnTxt:"保存",resetBtnTxt:"重置",confirmBtnTxt:"确定",cancelBtnTxt:"取消",rotateMenuTxt:"旋转",turnLeftTxt:"逆时针旋转",turnRightTxt:"顺时针旋转",cropMenuTxt:"裁剪",scaleMenuTxt:"缩放",markMenuTxt:"添加水印",colorTxt:"颜色",positionTxt:"位置",opacityTxt:"透明度",showRoomTxt:"展示厅",companyNameTxt:"公司名称",markAllMenuTxt:"批量添加水印",tipTitleTxt:"提示",tipContentTxt:"尚未保存，是否确定离开？",tipConfirmBtnTxt:"确定",onSaveRotate:function(t,i){},onSaveCrop:function(t,i){},onSaveScale:function(t,i){},onSaveMark:function(t,i){},onReset:function(t){},onSave:function(t){},onChangeActive:function(t,i){},onSaveMarkAll:function(t){}},i),this.debug=i.debug,this.imgList=i.imgList,this.template=i.template,this.mime=i.mime,this.markTextList=i.markTextList,this.closeBtnTxt=i.closeBtnTxt,this.saveBtnTxt=i.saveBtnTxt,this.resetBtnTxt=i.resetBtnTxt,this.confirmBtnTxt=i.confirmBtnTxt,this.cancelBtnTxt=i.cancelBtnTxt,this.rotateMenuTxt=i.rotateMenuTxt,this.turnLeftTxt=i.turnLeftTxt,this.turnRightTxt=i.turnRightTxt,this.cropMenuTxt=i.cropMenuTxt,this.scaleMenuTxt=i.scaleMenuTxt,this.markMenuTxt=i.markMenuTxt,this.colorTxt=i.colorTxt,this.positionTxt=i.positionTxt,this.opacityTxt=i.opacityTxt,this.showRoomTxt=i.showRoomTxt,this.companyNameTxt=i.companyNameTxt,this.markAllMenuTxt=i.markAllMenuTxt,this.tipTitleTxt=i.tipTitleTxt,this.tipContentTxt=i.tipContentTxt,this.tipConfirmBtnTxt=i.tipConfirmBtnTxt,this.onSaveRotate=i.onSaveRotate,this.onSaveCrop=i.onSaveCrop,this.onSaveScale=i.onSaveScale,this.onSaveMark=i.onSaveMark,this.onReset=i.onReset,this.onSave=i.onSave,this.onChangeActive=i.onChangeActive,this.onSaveMarkAll=i.onSaveMarkAll,this._init()}return function(t,i,e){i&&k(t.prototype,i),e&&k(t,e)}(t,[{key:"_init",value:function(){var t=this,i='<div class="pipeImg-dialog J-pipe-dialog" onselectstart="return false" ondragstart="return false"><div class="pipe-mask J-pipe-mask"></div>'+o()(this.template,{imgList:this.imgList,closeBtnTxt:this.closeBtnTxt,saveBtnTxt:this.saveBtnTxt,resetBtnTxt:this.resetBtnTxt,confirmBtnTxt:this.confirmBtnTxt,cancelBtnTxt:this.cancelBtnTxt,rotateMenuTxt:this.rotateMenuTxt,turnLeftTxt:this.turnLeftTxt,turnRightTxt:this.turnRightTxt,cropMenuTxt:this.cropMenuTxt,scaleMenuTxt:this.scaleMenuTxt,markMenuTxt:this.markMenuTxt,colorTxt:this.colorTxt,positionTxt:this.positionTxt,opacityTxt:this.opacityTxt,showRoomTxt:this.showRoomTxt,companyNameTxt:this.companyNameTxt,markAllMenuTxt:this.markAllMenuTxt,tipTitleTxt:this.tipTitleTxt,tipContentTxt:this.tipContentTxt,tipConfirmBtnTxt:this.tipConfirmBtnTxt})+"</div>";n()("body").append(i),this.$el=n()(".J-pipe-dialog"),this.$pipeWrapper=this.$el.find(".J-pipe-wrapper"),this.$btnClose=this.$el.find(".J-button-close"),this.$btnSave=this.$el.find(".J-button-save"),this.$btnReset=this.$el.find(".J-button-reset"),this.$btnConfirm=this.$el.find(".J-button-confirm"),this.$btnCancel=this.$el.find(".J-button-cancel"),this.$btnSaveAll=this.$el.find(".J-button-confirm-all"),this.$btnCancelAll=this.$el.find(".J-button-cancel-all"),this.$btnRotateLeft=this.$el.find(".J-btn-rotate-left"),this.$btnRotateRight=this.$el.find(".J-btn-rotate-right");var e=this.$el.find(".J-crop-panel");this.$inputCropWidth=e.find(".J-num-width"),this.$inputCropHeight=e.find(".J-num-height"),this.$radioCropFix=e.find(".J-fix-ratio"),this.$scalePanel=this.$el.find(".J-scale-panel"),this.$inputScaleWidth=this.$scalePanel.find(".J-num-width"),this.$inputScaleHeight=this.$scalePanel.find(".J-num-height"),this.$rangeScaleRatio=this.$scalePanel.find(".J-scale-range"),this.$markPanel=this.$el.find(".J-mark-panel"),this.$radioMarkColor=this.$markPanel.find(".J-color"),this.$radioMarkPosition=this.$markPanel.find(".J-position"),this.$rangeMarkOpacity=this.$markPanel.find(".J-opacity"),this.$selectMarkTxt=this.$markPanel.find(".J-select-mark"),this.$markAllPanel=this.$el.find(".J-mark-all-panel"),this.$radioMarkAllColor=this.$markAllPanel.find(".J-color"),this.$radioMarkAllPosition=this.$markAllPanel.find(".J-position"),this.$rangeMarkAllOpacity=this.$markAllPanel.find(".J-opacity"),this.$selectMarkAllTxt=this.$markAllPanel.find(".J-select-mark"),this.$buttons=this.$el.find(".J-button-save, .J-button-reset, .J-button-confirm, .J-button-cancel, .J-button-confirm-all, .J-button-cancel-all"),this.isChange=!1,this.rotateNum=0,this.scaleRatio=1,this.imgBoxHeight=this.$el.find(".J-img-box").height(),this.imgBoxWidth=this.$el.find(".J-img-box").width(),this.imgBoxRatio=this.imgBoxWidth/this.imgBoxHeight,this.activeImg=this.imgList[0],this.cropBox=new h({el:e.find(".J-source"),hasLight:!0,onDragPoint:function(i){t._showSize(i.width*t.activeData.ratio,i.height*t.activeData.ratio),t._updateIsChange(!0)}});var a=this.$scalePanel.find(".J-scale-img-wrapper"),s=this.$scalePanel.find(".J-source").get(0);Object(r.c)(s,s,a.get(0)),this.markBox=new h({el:this.$markPanel.find(".J-source"),fixRatio:!0,markText:this.markTextList[0],onDragComplete:function(i,e){t.$markPanel.find(".J-position").prop("checked",!1),t._updateIsChange(!0)},onDragPoint:function(i){t.$markPanel.find(".J-mark-txt").css({"font-size":Math.round(parseInt(t.markBox.$dragBox.css("height"))/t.markLineHeight0*t.markFontSize0)}),t.markBox.$dragBox.find(".J-mark-txt").css({display:"block"})}}),this.markAllBox=new h({el:this.$markAllPanel.find(".J-source"),fixRatio:!0,markText:this.markTextList[0],onDragComplete:function(i,e){t.$markAllPanel.find(".J-position").prop("checked",!1),t._updateIsChange(!0)},onDragPoint:function(i){t.$markAllPanel.find(".J-mark-txt").css({"font-size":Math.round(parseInt(t.markAllBox.$dragBox.css("height"))/t.markLineHeight0*t.markFontSize0)}),t.markAllBox.$dragBox.find(".J-mark-txt").css({display:"block"})}}),this._refresh(),this.markSelects=x.use(this.$el.find(".J-select-mark")),this._setMarkPosition(),this._setMarkPosition("all"),this.markFontSize0=parseInt(this.$el.find(".J-mark-txt").css("font-size")),this.markLineHeight0=parseInt(this.$el.find(".J-mark-txt").css("line-height")),this._bind()}},{key:"_bind",value:function(){var t=this,i=this;this.$el.find(".J-pipe-footer").on("click",".J-img-thumbnail",function(t){var e=this,a=function(){var t=n()(e);t.addClass("active").siblings().removeClass("active");var a=t.find("img");i.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").attr("src",a.attr("src")),i._updateActiveImg(t.index()),i._goHome(),i._initData()};i.isChange?i._confirm(function(){a(),i._updateIsChange(!1)}):a()}),this.$markAllPanel.on("click",".J-img-thumbnail",function(t){var e=n()(this);e.addClass("active").siblings().removeClass("active");var a=e.find("img");i.$markAllPanel.find(".J-source").attr("src",a.attr("src")),i._updateActiveImg(e.index()),i._setMarkPosition("all"),i._initData()}),this.$el.find(".J-menu-btn").on("click",function(t){var e=this,a=function(){var t=n()(e).parent(),a=t.index(),s=t.parent().find(".active:first").index();if(i.showModel("0"),i.showMenu(a),i.isChange)switch(s){case 0:i._saveRotate();break;case 1:i._saveCrop();break;case 2:i._saveScale()}1===a&&i._initCrop(),2===a&&i._initScale(),3===a&&i._initMark()};i.$markAllPanel.hasClass("active")?i._confirm(function(){a(),i._updateIsChange(!1)}):a()}),this.$el.find(".J-item-mark").on("click",".J-menu-btn-mark",function(i){var e=function(){var i=t.$el.find(".J-pipe-footer").find(".J-img-thumbnail.active");t._updateActiveImg(i.index()),t.showModel("0"),t.showMenu(3),t._initMark(),t._updateIsChange(!1)};t.isChange?t._confirm(e):e()}),this.$el.find(".J-item-mark").on("click",".J-menu-btn-mark-all",function(i){var e=function(){var i=t.$markAllPanel.find(".J-img-thumbnail.active");t._updateActiveImg(i.index()),t.showModel("1"),t._initMark("all"),t._initData()};t.isChange?t._confirm(e):e()}),this.$btnRotateLeft.on("click",function(){t._getRotateNum(-1),t._updateRotate()}),this.$btnRotateRight.on("click",function(){t._getRotateNum(1),t._updateRotate()}),this.$inputCropWidth.on("input",function(i){var e=parseInt(n()(i.target).val());t.cropBox.width=e/t.activeData.ratio,t.cropBox.fixRatio&&(t.cropBox.height=t.cropBox.width/t.cropBox.boxData.ratio),t._updateCrop()}),this.$inputCropHeight.on("input",function(i){var e=parseInt(n()(i.target).val());t.cropBox.height=e/t.activeData.ratio,t.cropBox.fixRatio&&(t.cropBox.width=t.cropBox.height*t.cropBox.boxData.ratio),t._updateCrop()}),this.$radioCropFix.on("change",function(i){t.cropBox.fixRatio=!t.cropBox.fixRatio}),this.$inputScaleWidth.on("input",function(i){var e=parseInt(n()(i.target).val());e=e>=0?e:0,t.scaleRatio=e/t.activeData.w0,t._updateScale()}),this.$inputScaleHeight.on("input",function(i){var e=parseInt(n()(i.target).val());e=e>=0?e:0,t.scaleRatio=e/t.activeData.h0,t._updateScale()}),this.$rangeScaleRatio.on("change",function(i){var e=n()(i.target),a=parseInt(e.attr("max")),s=parseInt(e.val());t.scaleRatio=s/a,t._updateScale()}),this.$rangeScaleRatio.on("input",function(i){var e=n()(i.target),a=parseInt(e.attr("max")),s=parseInt(e.val());t.scaleRatio=s/a,t._updateScale()}),this.$radioMarkColor.on("change",function(){t._updateMark()}),this.$rangeMarkOpacity.on("input",function(){t._updateMark()}),this.$rangeMarkOpacity.on("change",function(){t._updateMark()}),this.$selectMarkTxt.on("change",function(){t.markBox.$dragBox.find(".J-mark-txt").css({display:"inline-block","font-size":t.markFontSize0}),t._updateMark()}),this.$radioMarkPosition.on("change",function(){t._updateMark()}),this.$radioMarkAllColor.on("change",function(){t._updateMark("all")}),this.$rangeMarkAllOpacity.on("input",function(){t._updateMark("all")}),this.$rangeMarkAllOpacity.on("change",function(){t._updateMark("all")}),this.$selectMarkAllTxt.on("change",function(){t.markAllBox.$dragBox.find(".J-mark-txt").css({display:"inline-block","font-size":t.markFontSize0}),t._updateMark("all")}),this.$radioMarkAllPosition.on("change",function(){t._updateMark("all")}),this.$btnConfirm.on("click",function(){t._saveMark()}),this.$btnCancel.on("click",function(){t._cancelMark()}),this.$btnSaveAll.on("click",function(){t._showProgress(),t._saveMarkAll()}),this.$btnCancelAll.on("click",function(){t._confirm(function(){t.destory()})}),this.$btnReset.on("click",function(){t.isChange&&t._reset()}),this.$btnSave.on("click",function(i){if(t.isChange){switch(t._showProgress(),n()(i.target).parents(".J-panel").index()){case 0:t._saveRotate();break;case 1:t._saveCrop();break;case 2:t._saveScale()}t._save()}}),this.$btnClose.on("click",function(i){t._confirm(function(){t.destory()})}),this.$el.on("contextmenu",function(i){return t.debug})}},{key:"_goHome",value:function(){this.$el.find(".J-menu-btn").parent(":first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel:first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-item-mark").find(".J-menu-btn").show(),this.$el.find(".J-item-mark").find(".J-menu-txt").hide()}},{key:"_initRotate",value:function(){this.rotateNum=0}},{key:"_updateRotate",value:function(){var t,i;this.$el.find(".J-source").css({transform:"rotate(".concat(90*this.rotateNum,"deg)")}),1===this.rotateNum||3===this.rotateNum?1/this.activeData.imgRatio<this.imgBoxRatio?(t=this.imgBoxHeight,i="auto"):(t="auto",i=this.imgBoxWidth):this.activeData.imgRatio<this.imgBoxRatio?(t="auto",i=this.imgBoxHeight):(t=this.imgBoxWidth,i="auto"),this.$el.find(".J-source").css({width:t,height:i}),this._updateIsChange(!0)}},{key:"_saveRotate",value:function(){var t=this,i={rotateNum:this.rotateNum};this.onSaveRotate(i,function(i){t.rotateNum=0,t.activeImg=i,t._refresh()})}},{key:"_initCrop",value:function(){this.$radioCropFix.prop("checked",!1),this.cropBox.isFixed=this.$radioCropFix.prop("checked"),this.cropBox.width=this.$inputCropWidth.val()/this.activeData.ratio,this.cropBox.height=this.$inputCropHeight.val()/this.activeData.ratio}},{key:"_updateCrop",value:function(){this.cropBox.update(),this._updateIsChange(!0)}},{key:"_saveCrop",value:function(){var t=this,i={sx:Math.max(this.cropBox.boxData.left*this.activeData.ratio,0),sy:Math.max(this.cropBox.boxData.top*this.activeData.ratio,0),cropW:Math.min(this.cropBox.boxData.width*this.activeData.ratio,this.activeData.w0),cropH:Math.min(this.cropBox.boxData.height*this.activeData.ratio,this.activeData.h0)};this.onSaveCrop(i,function(i){t.sx=0,t.sy=0,t.cropW=i.width,t.cropH=i.height,t.activeImg=i,t._refresh()})}},{key:"_initScale",value:function(){var t,i,e=this.$scalePanel.find(".J-img-box"),a=this.$scalePanel.find(".J-scale-range"),n=this.$scalePanel.find(".J-scale-img-wrapper"),s=e.find(".J-source");t=this.activeData.w0<this.imgBoxWidth?this.imgBoxWidth:this.activeData.w0+(this.activeData.w0-this.imgBoxWidth),i=this.activeData.h0<this.imgBoxHeight?this.imgBoxHeight:this.activeData.h0+(this.activeData.h0-this.imgBoxHeight),n.css({width:t,height:i,"margin-left":-t/2,"margin-top":-i/2}),s.css({position:"absolute",left:(t-this.activeData.w0)/2,top:(i-this.activeData.h0)/2,width:this.activeData.w0,height:this.activeData.h0,"max-width":"none","max-height":"none",cursor:"move"}),a.val(a.attr("defaultValue")),this.scaleRatio=1}},{key:"_updateScale",value:function(){var t=this.scaleRatio,i=this.$rangeScaleRatio,e=this.$inputScaleWidth,a=this.$inputScaleHeight,n=parseInt(i.attr("max"));e.val()!=this.activeData.w0*t&&e.val(this.activeData.w0*t),a.val()!=this.activeData.h0*t&&a.val(this.activeData.h0*t),i.val()!=n*t&&i.val(n*t),this.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").css({transform:"scale(".concat(this.scaleRatio,")")}),this._updateIsChange(!0)}},{key:"_saveScale",value:function(){var t=this,i={scaleRatio:this.scaleRatio};this.onSaveScale(i,function(i){t.scaleRatio=1,t.activeImg=i,t._refresh(),t._initScale()})}},{key:"_setMarkPosition",value:function(t){var i="all"===t?this.$markAllPanel:this.$markPanel,e="all"===t?this.markAllBox.$dragBox:this.markBox.$dragBox,a=e.find(".J-mark-txt"),n=parseInt(e.css("left"))*this.activeData.ratio,s=parseInt(e.css("top"))*this.activeData.ratio,o=i.find(".J-position:checked").val(),r=this.activeData.w1,l=this.activeData.h1,c=a.outerWidth(),h=a.outerHeight();switch(["center","upLeft","upRight","downLeft","downRight"][o]){case"center":n=(r-c)/2*this.activeData.ratio,s=(l-h)/2*this.activeData.ratio;break;case"upLeft":n=15*this.activeData.ratio,s=20*this.activeData.ratio;break;case"upRight":n=(r-c-15)*this.activeData.ratio,s=20*this.activeData.ratio;break;case"downLeft":n=15*this.activeData.ratio,s=(l-h-20)*this.activeData.ratio;break;case"downRight":n=(r-c-15)*this.activeData.ratio,s=(l-h-20)*this.activeData.ratio}e.css({left:Math.max(Math.floor(n/this.activeData.ratio),0),top:Math.floor(s/this.activeData.ratio),width:Math.min(Math.ceil(c),Math.floor(this.activeData.w1)),height:Math.ceil(h)})}},{key:"_setMarkStyle",value:function(t){var i="all"===t?this.$markAllPanel:this.$markPanel,e=i.find(".J-mark-txt"),a=i.find(".J-color:checked").val(),n=parseInt(i.find(".J-opacity").val())/parseInt(i.find(".J-opacity").attr("max")),s=i.find(".J-select-mark").val(),o="rgba(255, 255, 255, ".concat(n,")");"1"===a&&(o="rgba(0, 0, 0, ".concat(n,")"));var r=this.markTextList[s];e.text(r).css({color:o})}},{key:"_initMark",value:function(t){var i="all"===t?this.$markAllPanel:this.$markPanel;i.find(".J-color:last").prop("checked",!0),i.find(".J-position:first").prop("checked",!0),i.find(".J-opacity:first").val(i.find(".J-opacity:first").attr("defaultValue")),i.find(".J-select-mark option:first").prop("selected",!0),i.find(".J-mark-txt").css({"font-size":this.markFontSize0+"px"}),"all"===t?(this.markSelects[1].select(0),this.markAllBox.$dragBox.find(".J-mark-txt").css({display:"inline-block"})):(this.markSelects[0].select(0),this.markBox.$dragBox.find(".J-mark-txt").css({display:"inline-block"})),this._setMarkStyle(t),this._setMarkPosition(t)}},{key:"_updateMark",value:function(t){this._setMarkStyle(t),this._setMarkPosition(t),this._updateIsChange(!0)}},{key:"_getMarkParams",value:function(t){var i="all"===t?this.$markAllPanel:this.$markPanel,e="all"===t?this.markAllBox.$dragBox:this.markBox.$dragBox,a=i.find(".J-mark-txt"),n=Math.ceil(parseInt(a.css("font-size"))*this.activeData.ratio)+"px / "+Math.ceil(parseInt(a.css("line-height"))*this.activeData.ratio)+"px "+a.css("font-family"),s=i.find(".J-opacity"),o=parseInt(s.val())/parseInt(s.attr("max")),r=i.find(".J-color:checked").val(),l="rgba(255, 255, 255, ".concat(o,")");"1"===r&&(l="rgba(0, 0, 0, ".concat(o,")"));var c=i.find(".J-select-mark").val(),h=this.markTextList[c];return{markX:Math.floor(parseInt(e.css("left"))*this.activeData.ratio),markY:Math.floor(parseInt(e.css("top"))*this.activeData.ratio),markText:h,markFont:n,markStyle:l}}},{key:"_saveMark",value:function(){var t=this,i=this._getMarkParams();this.onSaveMark(i,function(i){t.activeImg=i,t._refresh(),t._goHome(),t._updateIsChange(!0)})}},{key:"_cancelMark",value:function(){this._goHome()}},{key:"_saveMarkAll",value:function(){var t=this,i=this._getMarkParams("all");this.onSaveMarkAll(i,function(i){t.destory(),t._updateIsChange(!1),t._hideProgress()})}},{key:"_showSize",value:function(t,i){t=Math.round(t),i=Math.round(i);var e=this.$el.find(".J-num-width"),a=this.$el.find(".J-num-height");e.each(function(i,a){"input"===n()(a).get(0).nodeName.toLowerCase()?e.val(t):e.html(t)}),a.each(function(t,e){"input"===n()(e).get(0).nodeName.toLowerCase()?a.val(i):a.html(i)})}},{key:"_refresh",value:function(){this._updateActiveData();var t="";t="img"===this.activeData.img.nodeName.toLowerCase()?this.activeData.img.src:this.activeData.img.toDataURL(this.mime,1),this.$el.find(".J-img-box").find(".J-source").length>0?this.$el.find(".J-img-box").find(".J-source").attr("src",t):this.$el.find(".J-img-box").append('<img class="J-source" src="'.concat(t,'">')),this.$el.find(".J-source").removeAttr("style"),this.cropBox&&this.cropBox.boxEl.removeAttribute("style"),this.$el.find(".J-img-box").find(".J-source").css({width:this.activeData.w1,height:this.activeData.h1}),this._showSize(this.activeData.w0,this.activeData.h0)}},{key:"_updateActiveData",value:function(){var t=this.activeImg,i=t.width,e=t.height;"img"===t.nodeName.toLowerCase()&&(i=t.naturalWidth,e=t.naturalHeight);var a,n,s,o=i/e;o<this.imgBoxRatio?(n=(a=this.imgBoxHeight)*o,s=e/a):(a=(n=this.imgBoxWidth)/o,s=i/n),this.activeData={w0:i,h0:e,w1:n,h1:a,ratio:s,imgRatio:o,img:t}}},{key:"_getRotateNum",value:function(t){this.rotateNum+=t,this.rotateNum>3&&(this.rotateNum=0),this.rotateNum<0&&(this.rotateNum=3)}},{key:"_confirm",value:function(t,i){var e=this,a=this.$el.find(".J-pipeImg-tip"),n=function(){e.$pipeWrapper.css("z-index",2),a.hide(),a.off("click")};a.show(),e.$pipeWrapper.css("z-index",0),a.on("click",".J-tip-confirm",function(i){t(),n()}),a.on("click",".J-tip-cancel",function(t){i&&i(),n()})}},{key:"_updateIsChange",value:function(t){this.isChange=t,t?this.$buttons.addClass("active"):this.$buttons.removeClass("active")}},{key:"_reset",value:function(){var t=this;this.onReset(function(i){t.activeImg=i,t._refresh(),t._goHome(),t._initData(),t._updateIsChange(!1)})}},{key:"_save",value:function(){var t=this;this.onSave(function(i){var e=i.url.replace("&amp;","&"),a=t.$el.find(".J-pipe-footer").find(".J-img-thumbnail.active");a.addClass("new").find("img").attr("src",e);var n=a.index();t.$el.find(".J-mark-all-panel").find(".J-img-thumbnail").eq(n).find("img").attr("src",e),t._updateIsChange(!1),t.imgList[n]=a.find("img").get(0),t._hideProgress(),t._goHome()})}},{key:"_showProgress",value:function(){this.$pipeWrapper.css("z-index",0),this.$el.find(".J-pipeImg-progress").addClass("active")}},{key:"_hideProgress",value:function(){this.$pipeWrapper.css("z-index",2),this.$el.find(".J-pipeImg-progress").removeClass("active")}},{key:"_initData",value:function(){this.rotateNum=0,this.scaleRatio=1}},{key:"_updateActiveImg",value:function(t){this.activeImg=this.imgList[t],this._refresh();var i={activeImg:this.activeImg,activeIndex:t};this.onChangeActive(i,function(t){})}},{key:"showMenu",value:function(t){if(this.$el.find(".J-item").eq(t).addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel").eq(t).addClass("active").siblings().removeClass("active"),3===t){var i=this.$el.find(".J-item-mark");i.find(".J-menu-btn").hide(),i.find(".J-menu-txt").show()}}},{key:"showSource",value:function(t){var i=this.$el.find(".J-pipe-footer").find(".J-img-thumbnail").eq(t);i.addClass("active").siblings().removeClass("active");var e=i.find("img").attr("src");this.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").attr("src",e),this._updateActiveImg(t)}},{key:"showModel",value:function(t){if("1"===t){this.imgBoxHeight=this.$markAllPanel.find(".J-img-box").height(),this.imgBoxWidth=this.$markAllPanel.find(".J-img-box").width(),this.imgBoxRatio=this.imgBoxWidth/this.imgBoxHeight,this._refresh(),this._updateIsChange(!0);var i=this.$el.find(".J-item-mark");i.addClass("active").siblings().removeClass("active"),this.$markAllPanel.addClass("active").siblings().removeClass("active"),i.find(".J-menu-btn").hide(),i.find(".J-menu-txt").show();var e=i.find(".J-menu-btn-mark-all").html();i.find(".J-menu-txt").html(e),i.find(".J-menu-btn-mark-all").hide(),i.find(".J-menu-btn-mark").show(),this.$el.find(".J-pipe-footer").addClass("mark-all")}else{this.imgBoxHeight=this.$markPanel.find(".J-img-box").height(),this.imgBoxWidth=this.$markPanel.find(".J-img-box").width(),this.imgBoxRatio=this.imgBoxWidth/this.imgBoxHeight,this._refresh();var a=this.$el.find(".J-item-mark");this.$el.find(".J-item:first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel:first").addClass("active").siblings().removeClass("active"),a.find(".J-menu-btn").show(),a.find(".J-menu-txt").hide();var n=a.find(".J-menu-btn-mark").html();a.find(".J-menu-txt").html(n),a.find(".J-menu-btn-mark-all").show(),a.find(".J-menu-btn-mark").hide(),this.$el.find(".J-pipe-footer").removeClass("mark-all")}}},{key:"destory",value:function(){this.$el.remove()}},{key:"showDialog",value:function(){this.$pipeWrapper.fadeIn(100)}},{key:"hideDialog",value:function(){this.$pipeWrapper.fadeOut(100)}}]),t}();i.a=T},,,,,,,,,,,,function(t,i,e){"use strict";e.r(i),e.d(i,"PipeImg",function(){return h});var a=e(0),n=e.n(a),s=e(1),o=e(2),r=e(6);function l(){return(l=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function c(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var h=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);if(i=l({},{debug:!1,source:[],uploadUrl:"",sendDataType:"formdata",type:"0",mime:"image/jpeg",maxSize:500,markTextList:["producttest.en.made-in-china.com","Focus Service Co - Product SourcingFocus Service Co - Product Sourcing"],closeBtnTxt:"关闭",saveBtnTxt:"保存",resetBtnTxt:"重置",confirmBtnTxt:"确定",cancelBtnTxt:"取消",rotateMenuTxt:"旋转",turnLeftTxt:"逆时针旋转",turnRightTxt:"顺时针旋转",cropMenuTxt:"裁剪",scaleMenuTxt:"缩放",markMenuTxt:"添加水印",colorTxt:"颜色",positionTxt:"位置",opacityTxt:"透明度",showRoomTxt:"展示厅",companyNameTxt:"公司名称",markAllMenuTxt:"批量添加水印",tipTitleTxt:"提示",tipContentTxt:"尚未保存，是否确定离开？",tipConfirmBtnTxt:"确定",onInited:function(){},onComplete:function(t){},onClose:function(){}},i),this.debug=i.debug,this.source=i.source,!this.source)throw new Error("PipeImg: source is not found!");if(!Array.isArray(this.source)&&"string"!=typeof this.source)throw new Error("PipeImg: source类型错误，只能为字符串或者数组！");this.uploadUrl=i.uploadUrl,this.sendDataType=i.sendDataType,this.type=i.type,this.mime=i.mime,this.maxSize=i.maxSize,this.markTextList=i.markTextList,this.closeBtnTxt=i.closeBtnTxt,this.saveBtnTxt=i.saveBtnTxt,this.resetBtnTxt=i.resetBtnTxt,this.confirmBtnTxt=i.confirmBtnTxt,this.cancelBtnTxt=i.cancelBtnTxt,this.rotateMenuTxt=i.rotateMenuTxt,this.turnLeftTxt=i.turnLeftTxt,this.turnRightTxt=i.turnRightTxt,this.cropMenuTxt=i.cropMenuTxt,this.scaleMenuTxt=i.scaleMenuTxt,this.markMenuTxt=i.markMenuTxt,this.colorTxt=i.colorTxt,this.positionTxt=i.positionTxt,this.opacityTxt=i.opacityTxt,this.showRoomTxt=i.showRoomTxt,this.companyNameTxt=i.companyNameTxt,this.markAllMenuTxt=i.markAllMenuTxt,this.tipTitleTxt=i.tipTitleTxt,this.tipContentTxt=i.tipContentTxt,this.tipConfirmBtnTxt=i.tipConfirmBtnTxt,this.onInited=i.onInited,this.onComplete=i.onComplete,this.onClose=i.onClose,this.resultList=[],this.sourceImgList=[],this.returnJson=[],this.methods=[],this.activeIndex=0,this.isSaveAll=!1,this.finishedNum=0,this._init()}return function(t,i,e){i&&c(t.prototype,i),e&&c(t,e)}(t,[{key:"_init",value:function(){var t=this;this.returnJson=this.source;var i=this.source.map(function(t,i){return t.url});Object(s.f)(i,function(i){t.sourceImgList=i,t.imgHandler=new o.a({sourceImg:i[0]}),t.resultList.push(t.imgHandler.result),t.dialog=new r.a({debug:t.debug,imgList:i,mime:t.mime,markTextList:t.markTextList,closeBtnTxt:t.closeBtnTxt,saveBtnTxt:t.saveBtnTxt,resetBtnTxt:t.resetBtnTxt,confirmBtnTxt:t.confirmBtnTxt,cancelBtnTxt:t.cancelBtnTxt,rotateMenuTxt:t.rotateMenuTxt,turnLeftTxt:t.turnLeftTxt,turnRightTxt:t.turnRightTxt,cropMenuTxt:t.cropMenuTxt,scaleMenuTxt:t.scaleMenuTxt,markMenuTxt:t.markMenuTxt,colorTxt:t.colorTxt,positionTxt:t.positionTxt,opacityTxt:t.opacityTxt,showRoomTxt:t.showRoomTxt,companyNameTxt:t.companyNameTxt,markAllMenuTxt:t.markAllMenuTxt,tipTitleTxt:t.tipTitleTxt,tipContentTxt:t.tipContentTxt,tipConfirmBtnTxt:t.tipConfirmBtnTxt,onSaveRotate:function(i,e){t._saveRotate(i,e)},onSaveCrop:function(i,e){t._saveCrop(i,e)},onSaveScale:function(i,e){t._saveScale(i,e)},onSaveMark:function(i,e){t._saveMark(i,e)},onReset:function(i){t._reset(i)},onSave:function(i){t._save(i)},onChangeActive:function(i,e){t._changeActive(i,e)},onSaveMarkAll:function(i,e){t._saveMarkAll(i,e)},onClose:function(){t.onClose()}}),t.onInited(),t._executeMethods()},function(){throw new Error("PipeImg: source load failure!")})}},{key:"_saveRotate",value:function(t,i){this.imgHandler.rotateNum=t.rotateNum,this.imgHandler.rotate(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveCrop",value:function(t,i){this.imgHandler.cropW=t.cropW,this.imgHandler.cropH=t.cropH,this.imgHandler.sx=t.sx,this.imgHandler.sy=t.sy,this.imgHandler.crop(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveScale",value:function(t,i){this.imgHandler.scaleRatio=t.scaleRatio,this.imgHandler.scale(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveMark",value:function(t,i){this.imgHandler.markX=t.markX,this.imgHandler.markY=t.markY,this.imgHandler.markText=t.markText,this.imgHandler.markFont=t.markFont,this.imgHandler.markStyle=t.markStyle,this.imgHandler.mark(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_reset",value:function(t){this.rotateNum=0,this.scaleRatio=1,this.resultList=this.resultList.slice(0,1),this.imgHandler=new o.a({sourceImg:this.resultList[0]}),t(this.resultList[0])}},{key:"_save",value:function(t,i){var e=this;i=void 0===i?this.activeIndex:i;var a=this.imgHandler.compress(),s="blob"===this.sendDataType?a.blob:a.formdata;this.debug?setTimeout(function(){var n=[{picHeight:600,picWidth:800,tempPhotoId:"573761",url:a.base64}];e._saveSuccess(n[0],i,t)},1e3):n.a.ajax({url:this.uploadUrl,type:"POST",data:s,processData:!1,contentType:!1,success:function(a){e._saveSuccess(a[0],i,t)},error:function(){}})}},{key:"_saveSuccess",value:function(t,i,e){t.url=t.url.replace("&amp;","&");var a=new Image;a.src=t.url,this.resultList=[a],this.sourceImgList[i]=a;var n={id:t.tempPhotoId,url:t.url,picWidth:t.picWidth,picHeight:t.picHeight};this.returnJson[i]=n,this.isSaveAll?(this.finishedNum++,this.finishedNum===this.sourceImgList.length&&(this.onComplete(this.returnJson),e(t))):(this.onComplete(this.returnJson),e(t))}},{key:"_saveMarkAll",value:function(t,i){var e=this;this.isSaveAll=!0;var a=t.markX/this.resultList[this.resultList.length-1].width,s=t.markY/this.resultList[this.resultList.length-1].height;n()(this.sourceImgList).each(function(n,r){e.imgHandler=new o.a({sourceImg:r}),e.imgHandler.markX=r.width*a,e.imgHandler.markY=r.height*s,e.imgHandler.markText=t.markText,e.imgHandler.markFont=t.markFont,e.imgHandler.markStyle=t.markStyle,e.imgHandler.mark(),e.resultList.push(e.imgHandler.result),e._save(i,n)})}},{key:"_changeActive",value:function(t,i){this.activeIndex=t.activeIndex,this.imgHandler=new o.a({sourceImg:t.activeImg}),this.resultList=[this.imgHandler.result],i(this.imgHandler.result)}},{key:"show",value:function(t){this.methods.push({name:"show",params:t})}},{key:"_show",value:function(t){"1"===this.type?this.dialog.showModel(this.type):t&&t.selected&&this.dialog.showSource(t.selected)}},{key:"_executeMethods",value:function(){var t=this;this.methods.forEach(function(i){t["_"+i.name](i.params)}),this.methods=[]}}]),t}()}])});
//# sourceMappingURL=pipeImg.thin.min.js.map