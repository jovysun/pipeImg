!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var e=i();for(var a in e)("object"==typeof exports?exports:t)[a]=e[a]}}(window,function(){return function(t){var i={};function e(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=i,e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(a,n,function(i){return t[i]}.bind(null,n));return a},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=16)}([function(t,i,e){"use strict";function a(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,e=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;if(t){var n,s,o,r,l,c,h=!1;window.addEventListener&&(i.addEventListener("mousedown",function(i){i=i||window.event,n=i.clientX,s=i.clientY,o=t.offsetLeft,r=t.offsetTop,h=!0},!1),document.addEventListener("mousemove",function(i){if(i=i||window.event,h){var d=i.clientX,u=i.clientY;if(l=d-n+o,c=u-s+r,e){var p=e.clientWidth-t.offsetWidth,f=e.clientHeight-t.offsetHeight;l=Math.min(Math.max(0,l),p),c=Math.min(Math.max(0,c),f)}t.style.left=l,t.style.top=c,"function"==typeof a&&a(l,c)}},!1),document.addEventListener("mouseup",function(t){h=!1},!1))}}function n(t,i,e){var a=[],n=t.length;!function s(){if(0===n)return!1;var o=new Image;o.setAttribute("crossorigin","anonymous"),o.src=t[--n],o.onload=function(){if(a.unshift(o),a.length===t.length)return"function"==typeof i&&i(a),!1;s()},o.onerror=function(){"function"==typeof e&&e()}}()}function s(t,i){var e=document.createElement("canvas");return e.width=t,e.height=i,e}function o(t){var i=t.replace(/^data:image\/[\w]*;base64,$/,""),e=i.indexOf("=");e>0&&(i=i.substring(0,e));var a=i.length;return parseInt(a-a/8*2)}function r(t,i,e){var a=t;"img"===a.nodeName.toLowerCase()&&(a=function(t){var i=document.createElement("canvas"),e=i.getContext("2d");return i.width=t.naturalWidth,i.height=t.naturalHeight,e.drawImage(t,0,0),i}(a));var n=1,r=a.width,l=a.height,c=r/l,h=a.toDataURL("image/jpeg",1),d=o(h);if(console.log("start compress: "+Math.ceil(d/1024)),e)for(;d>i;)n=Math.floor(i/d*10)/10,d=o(h=a.toDataURL("image/jpeg",n));else{for(;d>i&&(r>800||l>800);){var u=void 0,p=void 0;c>1?p=(u=.9*r>800?.9*r:800)/c:u=(p=.9*l>800?.9*l:800)*c;var f=s(u,p);f.getContext("2d").drawImage(a,0,0,u,p),d=o(h=f.toDataURL("image/jpeg",1)),r=u,l=p,a=f}for(;d>i;)n-=.1,d=o(h=a.toDataURL("image/jpeg",n))}return console.log("end compress: "+Math.ceil(d/1024)),h}function l(t,i){var e=atob(t.split(",")[1]),a=e.length,n=new Uint8Array(a);i||(i=t.substring(t.indexOf("data:")+5,t.indexOf(";base64")));for(var s=0;s<a;s++)n[s]=e.charCodeAt(s);return new Blob([n],{type:i})}function c(t,i){var e=new FormData;return e.append("file",t),i||(i=(new Date).getTime()),e.append("fileName",i),e}e.d(i,"d",function(){return a}),e.d(i,"f",function(){return n}),e.d(i,"e",function(){return s}),e.d(i,"c",function(){return r}),e.d(i,"a",function(){return l}),e.d(i,"b",function(){return c})},function(t,i,e){"use strict";var a=e(0);function n(){return(n=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function s(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var o=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=n({},{sourceImg:null,rotateNum:0,maxSize:500,cropW:"",cropH:"",mime:"image/jpeg",hasMark:!0,textAlign:"left",markFont:"16px microsoft yahei",markStyle:"#fff",markText:"UED",markX:0,markY:0},i),this.sourceImg=i.sourceImg,this.rotateNum=i.rotateNum,this.maxSize=i.maxSize,this.cropW=i.cropW,this.cropH=i.cropH,this.mime=i.mime,this.hasMark=i.hasMark,this.textAlign=i.textAlign,this.markFont=i.markFont,this.markStyle=i.markStyle,this.markText=i.markText,this.markX=i.markX,this.markY=i.markY,this.sx=0,this.sy=0,this.scaleRatio=.5,this.quality=.2,this.results=[],this.init()}return function(t,i,e){i&&s(t.prototype,i),e&&s(t,e)}(t,[{key:"init",value:function(){var t=this.sourceImg,i=t.width,e=t.height;if("img"===t.nodeName.toLowerCase()){i=t.naturalWidth,e=t.naturalHeight;var n=Object(a.e)(i,e);n.getContext("2d").drawImage(t,0,0),t=n}this.result=t,this.results.push(this.result)}},{key:"reset",value:function(){this.rotateNum=0,this.scaleRatio=1,this.results=this.results.slice(0,1)}},{key:"rollback",value:function(){this.results.pop()}},{key:"rotate",value:function(){var t=this.result,i=t.width,e=t.height,n=90*this.rotateNum,s=Math.max(i,e),o=Object(a.e)(s,s),r=o.getContext("2d");r.translate(s/2,s/2),r.rotate(n*Math.PI/180),r.translate(-s/2,-s/2),r.drawImage(t,0,0);var l=i,c=e,h=0,d=0;1===this.rotateNum?(c=i,h=s-(l=e),d=0):2===this.rotateNum?(h=s-(l=i),d=s-(c=e)):3===this.rotateNum?(l=e,h=0,d=s-(c=i)):(l=i,c=e,h=0,d=0);var u=Object(a.e)(l,c);return u.getContext("2d").drawImage(o,h,d,l,c,0,0,l,c),this.result=u,this.results.push(u),this}},{key:"mark",value:function(){var t=this.result,i=t.width,e=t.height,n=Object(a.e)(i,e),s=n.getContext("2d");return s.drawImage(t,0,0),this.hasMark&&(s.textBaseline="top",s.textAlign=this.textAlign,s.font=this.markFont,s.fillStyle=this.markStyle,s.fillText(this.markText,this.markX,this.markY)),this.result=n,this.results.push(n),this}},{key:"crop",value:function(){var t=this.result,i=(t.width,t.height,Object(a.e)(this.cropW,this.cropH));return i.getContext("2d").drawImage(t,this.sx,this.sy,this.cropW,this.cropH,0,0,this.cropW,this.cropH),this.result=i,this.results.push(i),this}},{key:"scale",value:function(){var t=this.result,i=t.width,e=t.height,n=this.scaleRatio*i,s=this.scaleRatio*e,o=Object(a.e)(n,s);return o.getContext("2d").drawImage(t,0,0,i,e,0,0,n,s),this.result=o,this.results.push(o),this}},{key:"compress",value:function(){var t=this.result,i=t.width,e=t.height,n=Object(a.e)(i,e),s=n.getContext("2d");return this.cropW&&this.cropH?s.drawImage(t,0,0,this.cropW,this.cropH):s.drawImage(t,0,0),this.base64Data=n.toDataURL(this.mime,this.quality),this.base64Data}}]),t}();i.a=o},function(t,i){t.exports='<div class="pipeImg-wrapper J-pipe-wrapper">\r\n    <div class="pipe-header">\r\n        <ul class="menu">\r\n            <li class="item J-item active"><a class="btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-refresh"></i>{{=rotateMenuTxt}}</a></li>\r\n            <li class="item J-item"><a class="btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-crop"></i>{{=cropMenuTxt}}</a></li>\r\n            <li class="item J-item"><a class="btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-scaling"></i>{{=scaleMenuTxt}}</a></li>\r\n            <li class="item J-item J-item-mark">\r\n                <a class="btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</a>\r\n                <div class="btn J-menu-txt" style="display:none;"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</div>\r\n                <div class="item item-sub">\r\n                    <a class="btn J-menu-btn-mark-all" href="javascript:void(0)"><i class="ob-icon icon-batch"></i>{{=markAllMenuTxt}}</a>\r\n                    <a class="btn J-menu-btn-mark" href="javascript:void(0)" style="display:none;"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</a>\r\n                </div>\r\n            </li>\r\n        </ul>\r\n        <a class="btn btn-close J-button-close" href="javascript:void(0)"><i class="ob-icon icon-delete"></i>{{=closeBtnTxt}}</a>\r\n    </div>\r\n    <div class="pipe-content">\r\n        \x3c!-- 旋转面板 --\x3e\r\n        <div class="panel active J-panel J-rotate-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="size">\r\n                    <span class="J-num-width"></span>*<span class="J-num-height"></span>px\r\n                </div>\r\n                <a class="btn btn-rotate J-btn-rotate-left" href="javascript:void(0)"><i class="ob-icon icon-rotate-l"></i>{{=turnLeftTxt}}</a>\r\n                <a class="btn btn-rotate J-btn-rotate-right" href="javascript:void(0)"><i class="ob-icon icon-rotate-r"></i>{{=turnRightTxt}}</a>\r\n\r\n                <div class="buttons">\r\n                    <a class="button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 裁剪面板 --\x3e\r\n        <div class="panel J-panel J-crop-panel">\r\n            <div class="img-box J-img-box J-crop-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <input class="num-width J-num-width J-input-crop-width" type="text">\r\n                <input class="J-fix-ratio J-radio-crop-fix" id="fixRatio" type="checkbox" name="fixRatio" hidden>\r\n                <label class="fix" for="fixRatio"><i class="ob-icon icon-lock"></i></label>\r\n                <input class="num-height J-num-height J-input-crop-height" type="text">\r\n                <span class="txt">px</span>\r\n\r\n                <div class="buttons">\r\n                    <a class="button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 缩放面板 --\x3e\r\n        <div class="panel scale-panel J-panel J-scale-panel">\r\n            <div class="img-box J-img-box">\r\n                <div class="scale-img-wrapper J-scale-img-wrapper">\r\n                    <img class="J-source" src="{{-imgList[0].src}}">\r\n                </div>\r\n            </div>\r\n            <div class="content-footer">\r\n                <input class="num-width J-num-width J-input-scale-width" type="text">\r\n                <span class="txt">X</span>\r\n                <input class="num-height J-num-height J-input-scale-width" type="text">\r\n                <span class="txt">px</span>\r\n                <input class="scale-range J-scale-range J-range-scale-ratio" type="range" name="scaleRatio" min="5" max="100" step="1" defaultValue="100">\r\n\r\n                <div class="buttons">\r\n                    <a class="button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 添加水印面板 --\x3e\r\n        <div class="panel J-panel J-mark-panel">\r\n            <div class="img-box J-img-box J-mark-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="item">\r\n                    <div class="txt-label">{{=colorTxt}}:</div> \r\n                    <input class="J-color J-radio-mark-color" id="colorWhite" type="radio" name="color" value="0" autocomplete="off" hidden>        \r\n                    <label class="color" for="colorWhite"></label>\r\n                    <input class="J-color J-radio-mark-color" id="colorBlack" type="radio" name="color" value="1" checked autocomplete="off" hidden>\r\n                    <label class="color color-black" for="colorBlack"></label>\r\n                </div>\r\n                <div class="item">\r\n                    <div class="txt-label">{{=positionTxt}}:</div>\r\n                    <input class="J-position J-radio-mark-position" id="positionCenter" type="radio" name="position" value="0" autocomplete="off" checked hidden>\r\n                    <label class="position center" for="positionCenter"><span class="line"></span></label>\r\n                    <input class="J-position J-radio-mark-position" id="positionLeftTop" type="radio" name="position" value="1" autocomplete="off" hidden>\r\n                    <label class="position left-top" for="positionLeftTop"><span class="line"></span></label>\r\n                    <input class="J-position J-radio-mark-position" id="positionRightTop" type="radio" name="position" value="2" autocomplete="off" hidden>\r\n                    <label class="position right-top" for="positionRightTop"><span class="line"></span></label>\r\n                    <input class="J-position J-radio-mark-position" id="positionLeftBottom" type="radio" name="position" value="3" autocomplete="off" hidden>\r\n                    <label class="position left-bottom" for="positionLeftBottom"><span class="line"></span></label>\r\n                    <input class="J-position J-radio-mark-position" id="positionRightBottom" type="radio" name="position" value="4" autocomplete="off" hidden>\r\n                    <label class="position right-bottom" for="positionRightBottom"><span class="line"></span></label>\r\n                </div>\r\n                <div class="item">\r\n                    <div class="txt-label">{{=opacityTxt}}:</div>\r\n                    <input class="opacity-range J-opacity J-range-mark-opacity" name="opacity" type="range" min="10" max="100" step="1" defaultValue="80">\r\n                </div>\r\n\r\n                <select class="J-markTxt J-select-mark-txt" name="markTxt">\r\n                    <option value="0" selected="selected">{{=showRoomTxt}}</option>\r\n                    <option value="1">{{=companyNameTxt}}</option>\r\n                </select>\r\n\r\n                <div class="buttons">\r\n                    <a class="button button-confirm J-button-confirm" href="javascript:void(0)">{{=confirmBtnTxt}}</a>\r\n                    <a class="button button-cancel J-button-cancel" href="javascript:void(0)">{{=cancelBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 批量添加水印 --\x3e\r\n        <div class="panel panel-mark-all J-panel J-mark-all-panel">\r\n            <div class="img-box J-img-box J-mark-box-all">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="imgs-thumbnail">\r\n                {{ for(var i=0;i<imgList.length;i++) { }} \r\n                <a class="img-thumbnail {{=i === 0 ? \'active\' : \'\'}} J-img-thumbnail" href="javascript:void(0)">\r\n                    <img src="{{-imgList[i].src}}">\r\n                    <span class="circle"></span>\r\n                </a>\r\n                {{ } }}\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="item">\r\n                    <div class="txt-label">{{=colorTxt}}:</div> \r\n                    <input class="J-color J-radio-mark-color" id="colorWhiteAll" type="radio" name="colorAll" value="0" autocomplete="off" hidden>        \r\n                    <label class="color" for="colorWhiteAll"></label>\r\n                    <input class="J-color J-radio-mark-color" id="colorBlackAll" type="radio" name="colorAll" value="1" checked autocomplete="off" hidden>\r\n                    <label class="color color-black" for="colorBlackAll"></label>\r\n                </div>\r\n                <div class="item">\r\n                    <div class="txt-label">{{=positionTxt}}:</div>\r\n                    <input class="J-position J-radio-mark-position" id="positionCenterAll" type="radio" name="positionAll" value="0" autocomplete="off" checked hidden>\r\n                    <label class="position center" for="positionCenterAll"><span class="line"></span></label>\r\n                    <input class="J-position J-radio-mark-position" id="positionLeftTopAll" type="radio" name="positionAll" value="1" autocomplete="off" hidden>\r\n                    <label class="position left-top" for="positionLeftTopAll"><span class="line"></span></label>\r\n                    <input class="J-position J-radio-mark-position" id="positionRightTopAll" type="radio" name="positionAll" value="2" autocomplete="off" hidden>\r\n                    <label class="position right-top" for="positionRightTopAll"><span class="line"></span></label>\r\n                    <input class="J-position J-radio-mark-position" id="positionLeftBottomAll" type="radio" name="positionAll" value="3" autocomplete="off" hidden>\r\n                    <label class="position left-bottom" for="positionLeftBottomAll"><span class="line"></span></label>\r\n                    <input class="J-position J-radio-mark-position" id="positionRightBottomAll" type="radio" name="positionAll" value="4" autocomplete="off" hidden>\r\n                    <label class="position right-bottom" for="positionRightBottomAll"><span class="line"></span></label>\r\n                </div>\r\n                <div class="item">\r\n                    <div class="txt-label">{{=opacityTxt}}:</div>\r\n                    <input class="opacity-range J-opacity J-range-markAll-opacity" name="opacityAll" type="range" min="10" max="100" step="1" defaultValue="80">\r\n                </div>\r\n\r\n                <select class="J-markTxt J-select-markAll-txt" name="markTxtAll">\r\n                    <option value="0" selected="selected">{{=showRoomTxt}}</option>\r\n                    <option value="1">{{=companyNameTxt}}</option>\r\n                </select>\r\n                \r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n    <div class="pipe-footer J-pipe-footer">\r\n        <div class="imgs-thumbnail">\r\n                {{ for(var i=0;i<imgList.length;i++) { }} <a class="img-thumbnail {{=i === 0 ? \'active\' : \'\'}} J-img-thumbnail"\r\n                href="javascript:void(0)">\r\n                <img src="{{-imgList[i].src}}">\r\n                <span class="circle"></span>\r\n                </a>\r\n                {{ } }}\r\n        </div>  \r\n\r\n        <div class="buttons">\r\n            <a class="button button-confirm J-button-confirm-all" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n            <a class="button button-cancel J-button-cancel" href="javascript:void(0)">{{=cancelBtnTxt}}</a>\r\n        </div>            \r\n    </div>\r\n\r\n</div>'},function(t,i){t.exports='<div class="select">\n\t<div class="select-title J-select-title">\n\t\t<div class="select-selected">\n\t\t\t<span class="J-text">{{=txt}}</span>\n\t\t</div>\n\t\t<div class="select-arrow J-arrow">\n\t\t\t<i class="ob-icon icon-down"></i>\n\t\t</div>\n\t</div>\n\t<div class="select-list J-select-list">\n\t\t<ul class="select-list-wrap J-select-tab-cnt">\n\t\t\t{{ for(var i=0; i < optionList.length; i++) { }} \n\t\t\t\t<li>\n\t\t\t\t\t<a href="javascript:void(0)" class="select-opt J-opt {{=optionList[i].selected ? \'selected\' : \'\'}}" data-val="{{=optionList[i].val}}">{{=optionList[i].txt}}</a>\n\t\t\t\t</li>\n\t\t\t{{ } }}\n\t\t</ul>\n\t</div>\n</div>\n'},function(t,i,e){"use strict";var a=e(0);function n(){return(n=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function s(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var o=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=n({},{ele:"",width:"100%",height:"100%",markText:"producttest.en.made-in-china.com",hasLight:!1,fixRatio:!1,onDragPoint:function(t){},onDragComplete:function(t,i){}},i),this.ele=i.ele,this.width=i.width,this.height=i.height,this.markText=i.markText,this.hasLight=i.hasLight,this.fixRatio=i.fixRatio,this.onDragPoint=i.onDragPoint,this.onDragComplete=i.onDragComplete,this.init()}return function(t,i,e){i&&s(t.prototype,i),e&&s(t,e)}(t,[{key:"init",value:function(){var t=this;this.$ele=$(this.ele);var i=this.$ele.attr("src"),e=this.$ele.parent(),n='<div class="dragbox-wrapper J-dragbox-wrapper">\n                                <img class="J-source" src="'.concat(i,'">\n                                <div class="drag-box J-drag-box">\n                                    <div class="drag-point up-left J-drag-point"></div>\n                                    <div class="drag-point up J-drag-point"></div>\n                                    <div class="drag-point up-right J-drag-point"></div>\n                                    <div class="drag-point right J-drag-point"></div>\n                                    <div class="drag-point right-down J-drag-point"></div>\n                                    <div class="drag-point down J-drag-point"></div>\n                                    <div class="drag-point left-down J-drag-point"></div>\n                                    <div class="drag-point left J-drag-point"></div>\n                                    <div class="mark-txt J-mark-txt">').concat(this.markText,"</div>\n                                </div>\n                            </div>");this.hasLight&&(n='<div class="dragbox-wrapper J-dragbox-wrapper">\n                                <img class="J-source img-dark" src="'.concat(i,'">\n                                <img class="J-source img-light J-img-light" src="').concat(i,'">\n                                <div class="drag-box J-drag-box">\n                                    <div class="drag-point up-left J-drag-point"></div>\n                                    <div class="drag-point up J-drag-point"></div>\n                                    <div class="drag-point up-right J-drag-point"></div>\n                                    <div class="drag-point right J-drag-point"></div>\n                                    <div class="drag-point right-down J-drag-point"></div>\n                                    <div class="drag-point down J-drag-point"></div>\n                                    <div class="drag-point left-down J-drag-point"></div>\n                                    <div class="drag-point left J-drag-point"></div>\n                                </div>\n                            </div>')),e.html(n),this.$dragBox=e.find(".J-drag-box"),this.hasLight||this.$dragBox.css({width:this.$dragBox.find(".J-mark-txt").width(),height:this.$dragBox.find(".J-mark-txt").height()}),this.$dragPoint=this.$dragBox.find(".J-drag-point"),this.boxEl=this.$dragBox.get(0),this.containerEl=this.boxEl.parentNode,this.imgLight=e.find(".J-img-light:first").get(0),this.boxData={left:this.boxEl.offsetLeft,top:this.boxEl.offsetTop,width:this.boxEl.offsetWidth,height:this.boxEl.offsetHeight,ratio:this.boxEl.offsetWidth/this.boxEl.offsetHeight},this._bind(),Object(a.d)(this.boxEl,this.boxEl,this.boxEl.parentNode,function(i,e){t._light(),t.onDragComplete(i,e)})}},{key:"_bind",value:function(){var t=this,i=!1,e="",a=["up-left","up","up-right","right","right-down","down","left-down","left"],n=this.boxData.width/this.boxData.height;this.$dragPoint.on("mousedown",function(s){s.stopPropagation(),i=!0;var o=$(s.target).index();e=a[o],n=t.boxData.width/t.boxData.height}),$(document).on("mouseup",function(e){i=!1,t.boxData={left:t.boxEl.offsetLeft,top:t.boxEl.offsetTop,width:t.boxEl.offsetWidth,height:t.boxEl.offsetHeight,ratio:t.boxEl.offsetWidth/t.boxEl.offsetHeight}}),$(document).on("mousemove",function(a){1==i&&(t._move(a,e,n),t._light(),t.boxData={left:t.boxEl.offsetLeft,top:t.boxEl.offsetTop,width:t.boxEl.offsetWidth,height:t.boxEl.offsetHeight,ratio:t.boxEl.offsetWidth/t.boxEl.offsetHeight},t.onDragPoint(t.boxData))})}},{key:"_getPosition",value:function(){for(var t=this.boxEl,i=t.offsetLeft,e=t.offsetTop,a=t.offsetParent;null!=a;)i+=a.offsetLeft,e+=a.offsetTop,a=a.offsetParent;return{left:i,top:e}}},{key:"_move",value:function(t,i,e){var a,n,s,o,r,l,c=t.clientX,h=t.clientY,d=this.boxEl.offsetWidth,u=this.boxEl.offsetHeight,p=this._getPosition(),f=p.top,m=p.left;if(-1!=i.indexOf("left")){var v=m-c;if(v>=0&&this.boxEl.offsetLeft<=0)return!1;a=d+v,s=this.boxEl.offsetLeft-v}if(-1!=i.indexOf("right")){var g=c-m-d;if(g>=0&&this.containerEl.clientWidth-(this.boxEl.offsetLeft+d+g)<=0)return!1;a=d+g,s=this.boxEl.offsetLeft}if(-1!=i.indexOf("up")&&(this.fixRatio?r=(n=a/e)-u:n=u+(r=f-h),o=this.boxEl.offsetTop-r,r>=0&&this.boxEl.offsetTop<=0))return!1;if(-1!=i.indexOf("down")&&(this.fixRatio?(l=(n=a/e)-u,o=this.boxEl.offsetTop):n=u+(l=h-f-u),l>=0&&this.containerEl.clientHeight-(this.boxEl.offsetTop+u+l)<=0))return!1;this.boxEl.style.width=a+"px",this.boxEl.style.height=n+"px",this.boxEl.style.left=s+"px",this.boxEl.style.top=o+"px"}},{key:"_light",value:function(){this.hasLight&&this._setChoice()}},{key:"_setChoice",value:function(){var t=this.boxEl.offsetTop,i=this.boxEl.offsetLeft+this.boxEl.offsetWidth,e=this.boxEl.offsetTop+this.boxEl.offsetHeight,a=this.boxEl.offsetLeft;this.imgLight.style.clip="rect("+t+"px,"+i+"px,"+e+"px,"+a+"px)"}},{key:"update",value:function(t,i){t&&(this.width=t),i&&(this.height=i),this.$dragBox.css({width:this.width,height:this.height})}}]),t}(),r=e(2),l=e.n(r),c=e(3),h=e.n(c);function d(){return(d=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function u(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var p=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=d({},{el:"",template:h.a},i),this.el=i.el,this.template=i.template,this.$el=$(this.el),this.selectObj={txt:"",optionsObj:[]},this._init()}return function(t,i,e){i&&u(t.prototype,i),e&&u(t,e)}(t,[{key:"_init",value:function(){var t=this;this.$el.find("option").each(function(i,e){var a=$(e),n=a.prop("selected"),s=a.val(),o=a.text(),r={val:s,txt:o,selected:n};n&&(t.selectObj.txt=o),t.selectObj.optionsObj.push(r)});var i=template(this.template,{txt:this.selectObj.txt,optionList:this.selectObj.optionsObj});this.$el.hide(),$(i).insertBefore(this.$el),this.$thinSelect=this.$el.prev(),this._bind()}},{key:"_bind",value:function(){var t=this;this.$thinSelect.find(".J-select-title").on("click",function(i){i.stopPropagation();var e=t.$thinSelect.find(".J-select-list");e.is(":visible")?(e.hide(),t.$thinSelect.find(".J-arrow").removeClass("active")):(e.show(),t.$thinSelect.find(".J-arrow").addClass("active"))}),this.$thinSelect.find(".J-opt").on("click",function(i){i.stopPropagation();var e=$(i.target).addClass("selected").text();t.$thinSelect.find(".J-text").text(e),t.$thinSelect.find(".J-select-list").hide(),t.$thinSelect.find(".J-arrow").removeClass("active"),t.$activeItem=$(i.target).parent(),t.$activeItem.siblings().find(".J-opt").removeClass("selected"),t._updateSource()}),$(document).on("click.thinSelect",function(i){t.$thinSelect.find(".J-select-list").hide(),t.$thinSelect.find(".J-arrow").removeClass("active")})}},{key:"_updateSource",value:function(){var t=this.$activeItem.index();this.$el.find("option").eq(t).prop("selected",!0),this.$el.trigger("change")}},{key:"destroy",value:function(){$(document).off("click.thinSelect"),this.$thinSelect.remove()}}]),t}();p.use=function(t){if(!t)throw new Error("ThinSelect: el is not found!");Array.prototype.slice.call(document.querySelectorAll(t)).forEach(function(t){new p({el:t})})};var f=p;function m(){return(m=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function v(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var g=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=m({},{imgList:[],template:l.a,markTextList:["producttest.en.made-in-china.com","Focus Service Co - Product Sourcing"],closeBtnTxt:"关闭",saveBtnTxt:"保存",resetBtnTxt:"重置",confirmBtnTxt:"确定",cancelBtnTxt:"取消",rotateMenuTxt:"旋转",turnLeftTxt:"逆时针旋转",turnRightTxt:"顺时针旋转",cropMenuTxt:"裁剪",scaleMenuTxt:"缩放",markMenuTxt:"添加水印",colorTxt:"颜色",positionTxt:"位置",opacityTxt:"透明度",showRoomTxt:"展示厅",companyNameTxt:"公司名称",markAllMenuTxt:"批量添加水印",onSaveRotate:function(t,i){},onSaveCrop:function(t,i){},onSaveScale:function(t,i){},onSaveMark:function(t,i){},onReset:function(t){},onSave:function(t){},onChangeActive:function(t,i){},onSaveMarkAll:function(t){}},i),this.imgList=i.imgList,this.template=i.template,this.markTextList=i.markTextList,this.closeBtnTxt=i.closeBtnTxt,this.saveBtnTxt=i.saveBtnTxt,this.resetBtnTxt=i.resetBtnTxt,this.confirmBtnTxt=i.confirmBtnTxt,this.cancelBtnTxt=i.cancelBtnTxt,this.rotateMenuTxt=i.rotateMenuTxt,this.turnLeftTxt=i.turnLeftTxt,this.turnRightTxt=i.turnRightTxt,this.cropMenuTxt=i.cropMenuTxt,this.scaleMenuTxt=i.scaleMenuTxt,this.markMenuTxt=i.markMenuTxt,this.colorTxt=i.colorTxt,this.positionTxt=i.positionTxt,this.opacityTxt=i.opacityTxt,this.showRoomTxt=i.showRoomTxt,this.companyNameTxt=i.companyNameTxt,this.markAllMenuTxt=i.markAllMenuTxt,this.onSaveRotate=i.onSaveRotate,this.onSaveCrop=i.onSaveCrop,this.onSaveScale=i.onSaveScale,this.onSaveMark=i.onSaveMark,this.onReset=i.onReset,this.onSave=i.onSave,this.onChangeActive=i.onChangeActive,this.onSaveMarkAll=i.onSaveMarkAll,this._init()}return function(t,i,e){i&&v(t.prototype,i),e&&v(t,e)}(t,[{key:"_init",value:function(){var t=this,i='<div class="pipe-dialog J-pipe-dialog" onselectstart="return false" ondragstart="return false"><div class="pipe-mask J-pipe-mask"></div>'+template(this.template,{imgList:this.imgList,closeBtnTxt:this.closeBtnTxt,saveBtnTxt:this.saveBtnTxt,resetBtnTxt:this.resetBtnTxt,confirmBtnTxt:this.confirmBtnTxt,cancelBtnTxt:this.cancelBtnTxt,rotateMenuTxt:this.rotateMenuTxt,turnLeftTxt:this.turnLeftTxt,turnRightTxt:this.turnRightTxt,cropMenuTxt:this.cropMenuTxt,scaleMenuTxt:this.scaleMenuTxt,markMenuTxt:this.markMenuTxt,colorTxt:this.colorTxt,positionTxt:this.positionTxt,opacityTxt:this.opacityTxt,showRoomTxt:this.showRoomTxt,companyNameTxt:this.companyNameTxt,markAllMenuTxt:this.markAllMenuTxt})+"</div>";$("body").append(i),this.$el=$(".J-pipe-dialog"),this.$pipeWrapper=this.$el.find(".J-pipe-wrapper"),this.$btnClose=this.$el.find(".J-button-close"),this.$btnSave=this.$el.find(".J-button-save"),this.$btnReset=this.$el.find(".J-button-reset"),this.$btnConfirm=this.$el.find(".J-button-confirm"),this.$btnCancel=this.$el.find(".J-button-cancel"),this.$btnSaveAll=this.$el.find(".J-button-confirm-all"),this.$btnRotateLeft=this.$el.find(".J-btn-rotate-left"),this.$btnRotateRight=this.$el.find(".J-btn-rotate-right"),this.$inputCropWidth=this.$el.find(".J-input-crop-width"),this.$inputCropHeight=this.$el.find(".J-input-crop-height"),this.$radioCropFix=this.$el.find(".J-radio-crop-fix"),this.$inputScaleWidth=this.$el.find(".J-input-scale-width"),this.$inputScaleHeight=this.$el.find(".J-input-scale-height"),this.$rangeScaleRatio=this.$el.find(".J-range-scale-ratio"),this.$radioMarkColor=this.$el.find(".J-radio-mark-color"),this.$radioMarkPosition=this.$el.find(".J-radio-mark-position"),this.$rangeMarkOpacity=this.$el.find(".J-range-mark-opacity"),this.$selectMarkTxt=this.$el.find(".J-select-mark-txt"),this.$radioMarkAllColor=this.$el.find(".J-radio-markAll-color"),this.$radioMarkAllPosition=this.$el.find(".J-radio-markAll-position"),this.$rangeMarkAllOpacity=this.$el.find(".J-range-markAll-opacity"),this.$selectMarkAllTxt=this.$el.find(".J-select-markAll-txt"),this.isChange=!1,this.rotateNum=0,this.scaleRatio=1,this.imgBoxHeight=this.$el.find(".J-img-box").height(),this.imgBoxWidth=this.$el.find(".J-img-box").width(),this.imgBoxRatio=this.imgBoxWidth/this.imgBoxHeight,this.activeImg=this.imgList[0],this.cropBox=new o({ele:".J-crop-box .J-source",hasLight:!0,onDragPoint:function(i){t._showSize(i.width*t.activeData.ratio,i.height*t.activeData.ratio),t._updateIsChange(!0)}});var e=this.$el.find(".J-scale-panel"),n=e.find(".J-scale-img-wrapper"),s=e.find(".J-source").get(0);Object(a.d)(s,s,n.get(0)),this.markBox=new o({ele:".J-mark-box .J-source",fixRatio:!1,markText:"producttest.en.made-in-china.com",onDragComplete:function(i,e){t.markX=i*t.activeData.ratio,t.markY=e*t.activeData.ratio,t.$el.find(".J-mark-panel").find(".J-position").prop("checked",!1),t._updateIsChange(!0)},onDragPoint:function(i){t.$el.find(".J-mark-panel").find(".J-mark-txt").css({"font-size":parseInt(t.markBox.$dragBox.css("height"))/1.5}),t._updateMark()}}),this.markAllBox=new o({ele:".J-mark-box-all .J-source",markText:"producttest.en.made-in-china.com",onDragComplete:function(i,e){t.markXAll=i*t.activeData.ratio,t.markYAll=e*t.activeData.ratio,t.$el.find(".J-mark-all-panel").find(".J-position").prop("checked",!1),t._updateIsChange(!0)},onDragPoint:function(i){t.$el.find(".J-mark-all-panel").find(".J-mark-txt").css({"font-size":parseInt(t.markAllBox.$dragBox.css("height"))/1.5}),t._updateMarkAll()}}),this._refresh(),this._bind(),f.use(".J-markTxt")}},{key:"_bind",value:function(){var t=this;this.$el.find(".J-pipe-footer").on("click",".J-img-thumbnail",function(i){var e=$(i.target).parent();e.addClass("active").siblings().removeClass("active"),t.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").attr("src",e.find("img").attr("src"));var a=t.$el.find(".J-source:first").get(0);t.activeImg=a,t._refresh(),t._initPanel();var n={activeImg:a};t.onChangeActive(n,function(t){})}),this.$el.find(".J-mark-all-panel").on("click",".J-img-thumbnail",function(i){var e=$(i.target).parent();e.addClass("active").siblings().removeClass("active"),t.$el.find(".J-mark-all-panel").find(".J-source").attr("src",e.find("img").attr("src"));var a=t.$el.find(".J-mark-all-panel").find(".J-source:first").get(0);t.activeImg=a,t._refresh(),t._initMarkAll();var n={activeImg:a};t.onChangeActive(n,function(t){})}),this.$el.find(".J-menu-btn").on("click",function(i){var e=$(i.target).parent(),a=e.index(),n=e.parent().find(".active:first").index();if(e.addClass("active").siblings().removeClass("active"),t.$el.find(".J-panel").eq(a).addClass("active").siblings().removeClass("active"),t.isChange)switch(n){case 0:t._saveRotate();break;case 1:t._saveCrop();break;case 2:t._saveScale()}1===a&&t._initCrop(),2===a&&t._initScale(),3===a&&(t._initMark(),t.$el.find(".J-item-mark").find(".J-menu-btn").hide(),t.$el.find(".J-item-mark").find(".J-menu-txt").show()),3!==a&&(t.$el.find(".J-item-mark").find(".J-menu-btn").show(),t.$el.find(".J-item-mark").find(".J-menu-txt").hide()),t.$el.find(".J-pipe-footer").removeClass("mark-all")}),this.$el.find(".J-item-mark").on("click",".J-menu-btn-mark",function(i){if(!t._isGoOn())return!1;var e=t.$el.find(".J-item-mark").find(".J-menu-btn-mark").html();t.$el.find(".J-item-mark").find(".J-menu-txt").html(e),t.$el.find(".J-item-mark").find(".J-menu-btn-mark-all").show(),t.$el.find(".J-item-mark").find(".J-menu-btn-mark").hide(),t.$el.find(".J-item-mark").addClass("active").siblings().removeClass("active"),t.$el.find(".J-mark-panel").addClass("active").siblings().removeClass("active"),t.$el.find(".J-pipe-footer").removeClass("mark-all"),t._initPanel()}),this.$el.find(".J-item-mark").on("click",".J-menu-btn-mark-all",function(i){if(!t._isGoOn())return!1;t.$el.find(".J-item-mark").addClass("active").siblings().removeClass("active");var e=t.$el.find(".J-mark-all-panel"),a=e.find(".J-img-thumbnail.active img");e.addClass("active").siblings().removeClass("active"),t.$el.find(".J-item-mark").find(".J-menu-btn").hide(),t.$el.find(".J-item-mark").find(".J-menu-txt").show(),t.$el.find(".J-pipe-footer").addClass("mark-all");var n=t.$el.find(".J-item-mark").find(".J-menu-btn-mark-all").html();t.$el.find(".J-item-mark").find(".J-menu-txt").html(n),t.$el.find(".J-item-mark").find(".J-menu-btn-mark-all").hide(),t.$el.find(".J-item-mark").find(".J-menu-btn-mark").show(),e.find(".J-source").attr("src",a.attr("src")),t.rotateNum=0,t.scaleRatio=1,t.activeImg=a.get(0),t._refresh(),t._initMarkAll(),t._updateIsChange(!0)}),this.$btnRotateLeft.on("click",function(){t._getRotateNum(-1),t._updateRotate()}),this.$btnRotateRight.on("click",function(){t._getRotateNum(1),t._updateRotate()}),this.$inputCropWidth.on("input",function(i){t.cropBox.width=$(i.target).val()/t.activeData.ratio,t.cropBox.fixRatio&&(t.cropBox.height=t.cropBox.width/t.cropBox.boxData.ratio),t._updateCrop()}),this.$inputCropHeight.on("input",function(i){t.cropBox.height=$(i.target).val()/t.activeData.ratio,t.cropBox.fixRatio&&(t.cropBox.width=t.cropBox.height*t.cropBox.boxData.ratio),t._updateCrop()}),this.$radioCropFix.on("change",function(i){t.cropBox.fixRatio=!t.cropBox.fixRatio}),this.$inputScaleWidth.on("input",function(i){var e=$(i.target);t.scaleRatio=parseInt(e.val())/t.activeData.w0,t._updateScale()}),this.$inputScaleHeight.on("input",function(i){var e=$(i.target);t.scaleRatio=parseInt(e.val())/t.activeData.h0,t._updateScale()}),this.$rangeScaleRatio.on("change",function(i){var e=$(i.target),a=parseInt(e.attr("max"));t.scaleRatio=parseInt(e.val())/a,t._updateScale()}),this.$rangeScaleRatio.on("input",function(i){var e=$(i.target),a=parseInt(e.attr("max"));t.scaleRatio=parseInt(e.val())/a,t._updateScale()}),this.$radioMarkColor.on("input",function(){t._updateMark()}),this.$rangeMarkOpacity.on("input",function(){t._updateMark()}),this.$rangeMarkOpacity.on("change",function(){t._updateMark()}),this.$selectMarkTxt.on("change",function(){t._updateMark()}),this.$radioMarkPosition.on("change",function(){t._updateMark()}),this.$radioMarkAllColor.on("input",function(){t._updateMarkAll()}),this.$rangeMarkAllOpacity.on("input",function(){t._updateMarkAll()}),this.$rangeMarkAllOpacity.on("change",function(){t._updateMarkAll()}),this.$selectMarkAllTxt.on("change",function(){t._updateMarkAll()}),this.$radioMarkAllPosition.on("change",function(){t._updateMarkAll()}),this.$btnConfirm.on("click",function(){t._saveMark()}),this.$btnCancel.on("click",function(){t._cancelMark()}),this.$btnSaveAll.on("click",function(){t._saveMarkAll()}),this.$btnReset.on("click",function(){t._reset()}),this.$btnSave.on("click",function(i){if(t.isChange){switch($(i.target).parents(".J-panel").index()){case 0:t._saveRotate();break;case 1:t._saveCrop();break;case 2:t._saveScale()}t._save()}}),this.$btnClose.on("click",function(i){if(!t._isGoOn())return!1;t.destory()}),this.$el.on("contextmenu",function(t){})}},{key:"_initPanel",value:function(){this._initCrop(),this._initScale(),this._initMark()}},{key:"_goHome",value:function(){this.$el.find(".J-menu-btn").parent(":first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel:first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-item-mark").find(".J-menu-btn").show(),this.$el.find(".J-item-mark").find(".J-menu-txt").hide()}},{key:"_initRotate",value:function(){this.rotateNum=0}},{key:"_updateRotate",value:function(){this.$el.find(".J-source").css({transform:"rotate(".concat(90*this.rotateNum,"deg)")}),1===this.rotateNum||3===this.rotateNum?1/this.activeData.imgRatio<this.imgBoxRatio?this.$el.find(".J-source").css({width:this.imgBoxHeight,height:"auto"}):this.$el.find(".J-source").css({width:"auto",height:this.imgBoxWidth}):this.activeData.imgRatio<this.imgBoxRatio?this.$el.find(".J-source").css({width:"auto",height:this.imgBoxHeight}):this.$el.find(".J-source").css({width:this.imgBoxWidth,height:"auto"}),this._updateIsChange(!0)}},{key:"_saveRotate",value:function(){var t=this,i={rotateNum:this.rotateNum};this.onSaveRotate(i,function(i){t.rotateNum=0,t.activeImg=i,t._refresh(),t._updateIsChange(!1)})}},{key:"_initCrop",value:function(){var t=this.$el.find(".J-crop-panel");this.cropBox.isFixed=t.find(".J-fix-ratio").prop("checked"),this.cropBox.width=t.find(".J-num-width").val()/this.activeData.ratio,this.cropBox.height=t.find(".J-num-height").val()/this.activeData.ratio}},{key:"_updateCrop",value:function(){this.cropBox.update(),this._updateIsChange(!0)}},{key:"_saveCrop",value:function(){var t=this,i={sx:this.cropBox.boxData.left*this.activeData.ratio,sy:this.cropBox.boxData.top*this.activeData.ratio,cropW:this.cropBox.boxData.width*this.activeData.ratio,cropH:this.cropBox.boxData.height*this.activeData.ratio};this.onSaveCrop(i,function(i){t.sx=0,t.sy=0,t.cropW=i.width,t.cropH=i.height,t.activeImg=i,t._refresh(),t._updateIsChange(!1)})}},{key:"_initScale",value:function(){var t=this.$el.find(".J-scale-panel"),i=t.find(".J-img-box"),e=t.find(".J-scale-range"),a=t.find(".J-scale-img-wrapper"),n=i.find(".J-source"),s=this.activeData.w0+(this.activeData.w0-this.imgBoxWidth),o=this.activeData.h0+(this.activeData.h0-this.imgBoxHeight);a.css({width:s,height:o,"margin-left":-s/2,"margin-top":-o/2}),n.css({position:"absolute",left:(s-this.activeData.w0)/2,top:(o-this.activeData.h0)/2,width:this.activeData.w0,height:this.activeData.h0,"max-width":"none","max-height":"none",cursor:"move"}),e.val(e.attr("max")),this.scaleRatio=1}},{key:"_updateScale",value:function(){var t=this.scaleRatio,i=this.$el.find(".J-scale-panel"),e=i.find(".J-scale-range"),a=i.find(".J-num-width"),n=i.find(".J-num-height"),s=parseInt(e.attr("max"));a.val()!=this.activeData.w0*t&&a.val(this.activeData.w0*t),n.val()!=this.activeData.h0*t&&n.val(this.activeData.h0*t),e.val()!=s*t&&e.val(s*t),$(".J-source").css({transform:"scale(".concat(this.scaleRatio,")")}),this._updateIsChange(!0)}},{key:"_saveScale",value:function(){var t=this,i={scaleRatio:this.scaleRatio};this.onSaveScale(i,function(i){t.scaleRatio=1,t.activeImg=i,t._refresh(),t._updateIsChange(!0)})}},{key:"_setMarkPosition",value:function(t){var i,e,a,n;"all"===t?(i=this.$el.find(".J-mark-all-panel"),e=this.markAllBox.$dragBox,a=this.markXAll,n=this.markYAll):(i=this.$el.find(".J-mark-panel"),e=this.markBox.$dragBox,a=this.markX,n=this.markY);var s=i.find(".J-position:checked").val(),o=this.activeData.w1,r=this.activeData.h1,l=e.find(".J-mark-txt").outerWidth(),c=e.find(".J-mark-txt").outerHeight();switch(["center","upLeft","upRight","downLeft","downRight"][s]){case"center":a=(o-l)/2*this.activeData.ratio,n=(r-c)/2*this.activeData.ratio;break;case"upLeft":a=0,n=0;break;case"upRight":a=(o-l)*this.activeData.ratio,n=0;break;case"downLeft":a=0,n=(r-c)*this.activeData.ratio;break;case"downRight":a=(o-l)*this.activeData.ratio,n=(r-c)*this.activeData.ratio}e.css({left:a/this.activeData.ratio,top:n/this.activeData.ratio,width:l,height:c}),"all"===t?(this.markXAll=a,this.markYAll=n):(this.markX=a,this.markY=n)}},{key:"_setMarkStyle",value:function(t){var i,e=(i="all"===t?this.$el.find(".J-mark-all-panel"):this.$el.find(".J-mark-panel")).find(".J-mark-txt"),a=i.find(".J-color:checked").val(),n=i.find(".J-opacity").val()/parseInt(i.find(".J-opacity").attr("max")),s=i.find(".J-markTxt:selected").val(),o="rgba(255, 255, 255, ".concat(n,")");"1"===a&&(o="rgba(0, 0, 0, ".concat(n,")"));var r=this.markTextList[s];e.text(r).css({color:o}),"all"===t?(this.markStyleAll=o,this.markTextAll=r):(this.markStyle=o,this.markText=r)}},{key:"_initMark",value:function(){var t=this.$el.find(".J-mark-panel"),i=t.find(".J-mark-txt"),e=parseInt(i.css("font-size"))+"px microsoft yahei";this.markFont=e,t.find(".J-color:last").prop("checked",!0),t.find(".J-position:first").prop("checked",!0),t.find(".J-opacity").val(t.find(".J-opacity").attr("defaultValue")),t.find(".J-markTxt:first").prop("selected",!0),this._setMarkStyle(),this._setMarkPosition()}},{key:"_updateMark",value:function(){this._setMarkStyle(),this._setMarkPosition(),this._updateIsChange(!0)}},{key:"_saveMark",value:function(){var t=this,i={markX:this.markX,markY:this.markY,markText:this.markText,markFont:this.markFont,markStyle:this.markStyle};this.onSaveMark(i,function(i){t.activeImg=i,t._refresh(),t._goHome(),t._updateIsChange(!0)})}},{key:"_cancelMark",value:function(){this._goHome()}},{key:"_initMarkAll",value:function(){var t=this.$el.find(".J-mark-all-panel"),i=t.find(".J-mark-txt"),e=parseInt(i.css("font-size"))+"px microsoft yahei";this.markFontAll=e,t.find(".J-color:last").prop("checked",!0),t.find(".J-position:first").prop("checked",!0),t.find(".J-opacity").val(t.find(".J-opacity").attr("defaultValue")),t.find(".J-select-markAll-txt:first").prop("selected",!0),this._setMarkStyle("all"),this._setMarkPosition("all")}},{key:"_updateMarkAll",value:function(){this._setMarkStyle("all"),this._setMarkPosition("all"),this._updateIsChange(!0)}},{key:"_showSize",value:function(t,i){t=Math.round(t),i=Math.round(i);var e=this.$el.find(".J-num-width"),a=this.$el.find(".J-num-height");e.each(function(i,a){"input"===$(a).get(0).nodeName.toLowerCase()?e.val(t):e.html(t)}),a.each(function(t,e){"input"===$(e).get(0).nodeName.toLowerCase()?a.val(i):a.html(i)})}},{key:"_refresh",value:function(){this._updateActiveData();var t="";t="img"===this.activeData.img.nodeName.toLowerCase()?this.activeData.img.src:this.activeData.img.toDataURL(this.mime,1),this.$el.find(".J-img-box").find(".J-source").length>0?this.$el.find(".J-img-box").find(".J-source").attr("src",t):this.$el.find(".J-img-box").append('<img class="J-source" src="'.concat(t,'">')),this.$el.find(".J-source").removeAttr("style"),this.cropBox&&this.cropBox.boxEl.removeAttribute("style"),this.$el.find(".J-img-box").find(".J-source").css({width:this.activeData.w1,height:this.activeData.h1}),this._showSize(this.activeData.w0,this.activeData.h0)}},{key:"_updateActiveData",value:function(){var t=this.activeImg,i=t.width,e=t.height;"img"===t.nodeName.toLowerCase()&&(i=t.naturalWidth,e=t.naturalHeight);var a,n,s,o=i/e;o<this.imgBoxRatio?(n=(a=this.imgBoxHeight)*o,s=e/a):(a=(n=this.imgBoxWidth)/o,s=i/n),this.activeData={w0:i,h0:e,w1:n,h1:a,ratio:s,imgRatio:o,img:t}}},{key:"_getRotateNum",value:function(t){this.rotateNum+=t,this.rotateNum>3&&(this.rotateNum=0),this.rotateNum<0&&(this.rotateNum=3)}},{key:"_isGoOn",value:function(){var t=!0;return this.isChange&&(t=confirm("Leave without saving?")),t}},{key:"_updateIsChange",value:function(t){this.isChange=t;var i=this.$el.find(".J-button-save, .J-button-reset");t?i.addClass("active"):i.removeClass("active")}},{key:"_reset",value:function(){var t=this;this.onReset(function(i){t.rotateNum=0,t.scaleRatio=1,t.activeImg=i,t._refresh(),t._updateIsChange(!1)})}},{key:"_save",value:function(){var t=this;this.onSave(function(i){var e=t.$el.find(".J-pipe-footer").find(".J-img-thumbnail.active");e.addClass("new").find("img").attr("src",i.src);var a=e.index();t.$el.find(".J-mark-all-panel").find(".J-img-thumbnail").eq(a).find("img").attr("src",i.src),t._updateIsChange(!1),t.imgList=t.$el.find(".J-pipe-footer").find(".J-img-thumbnail img")})}},{key:"_saveMarkAll",value:function(){var t=this,i={markX:this.markXAll,markY:this.markYAll,markText:this.markTextAll,markFont:this.markFontAll,markStyle:this.markStyleAll};this.onSaveMarkAll(i,function(i){t.destory(),t._updateIsChange(!1)})}},{key:"destory",value:function(){this.$el.remove()}},{key:"showDialog",value:function(){this.$el.show()}},{key:"hideDialog",value:function(){this.$el.hide()}}]),t}();i.a=g},,,,,,,,,,,,function(t,i,e){"use strict";e.r(i),e.d(i,"PipeImg",function(){return l});var a=e(0),n=e(1),s=e(4);function o(){return(o=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function r(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var l=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=o({},{source:["./assets/Jellyfish.jpg"],ajaxUrl:"/pic.do?xcase=uploadWs",debug:!1,mime:"image/jpeg",maxSize:500,onComplete:function(t){}},i),this.source=i.source,this.ajaxUrl=i.ajaxUrl,this.debug=i.debug,this.mime=i.mime,this.maxSize=i.maxSize,this.onComplete=i.onComplete,this.resultList=[],this.sourceImgList=[],this._init()}return function(t,i,e){i&&r(t.prototype,i),e&&r(t,e)}(t,[{key:"_init",value:function(){var t=this;Object(a.f)(this.source,function(i){t.sourceImgList=i,t.imgHandler=new n.a({sourceImg:i[0]}),t.resultList.push(t.imgHandler.result),t.dialog=new s.a({imgList:i,onSaveRotate:function(i,e){t._saveRotate(i,e)},onSaveCrop:function(i,e){t._saveCrop(i,e)},onSaveScale:function(i,e){t._saveScale(i,e)},onSaveMark:function(i,e){t._saveMark(i,e)},onReset:function(i){t._reset(i)},onSave:function(i){t._save(i)},onChangeActive:function(i,e){t._changeActive(i,e)},onSaveMarkAll:function(i,e){t._saveMarkAll(i,e)}})})}},{key:"_saveRotate",value:function(t,i){this.imgHandler.rotateNum=t.rotateNum,this.imgHandler.rotate(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveCrop",value:function(t,i){this.imgHandler.cropW=t.cropW,this.imgHandler.cropH=t.cropH,this.imgHandler.sx=t.sx,this.imgHandler.sy=t.sy,this.imgHandler.crop(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveScale",value:function(t,i){this.imgHandler.scaleRatio=t.scaleRatio,this.imgHandler.scale(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveMark",value:function(t,i){this.imgHandler.markX=t.markX,this.imgHandler.markY=t.markY,this.imgHandler.markText=t.markText,this.imgHandler.markFont=t.markFont,this.imgHandler.markStyle=t.markStyle,this.imgHandler.mark(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_reset",value:function(t){this.rotateNum=0,this.scaleRatio=1,this.resultList=this.resultList.slice(0,1),this.imgHandler=new n.a({sourceImg:this.resultList[0]}),t(this.resultList[0])}},{key:"_save",value:function(t){var i=this,e=1024*this.maxSize,n=Object(a.c)(this.resultList[this.resultList.length-1],e,!1);if(this.debug){var s={src:n},o=new Image;o.src=s.src,this.resultList=[o],t(s),this.onComplete(s)}else{var r=Object(a.a)(n,this.mime),l=Object(a.b)(r);$.ajax({url:this.ajaxUrl,type:"POST",data:l,processData:!1,contentType:!1,success:function(e){var a=new Image;a.src=e.src,i.resultList=[a],t(e),i.onComplete(e)},error:function(){alert("后台错误")}})}}},{key:"_saveMarkAll",value:function(t,i){var e=this,a=t.markX/this.resultList[this.resultList.length-1].width,s=t.markY/this.resultList[this.resultList.length-1].height;$(this.sourceImgList).each(function(o,r){var l=new n.a({sourceImg:r});l.markX=r.width*a,l.markY=r.height*s,l.markText=t.markText,l.markFont=t.markFont,l.markStyle=t.markStyle,l.mark(),e.resultList.push(l.result),e._save(i)})}},{key:"_changeActive",value:function(t,i){this.imgHandler=new n.a({sourceImg:t.activeImg}),this.resultList=[this.imgHandler.result],i(this.imgHandler.result)}}]),t}()}])});
//# sourceMappingURL=pipeImg.thin.min.js.map