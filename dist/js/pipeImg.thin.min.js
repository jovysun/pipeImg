!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var e=i();for(var a in e)("object"==typeof exports?exports:t)[a]=e[a]}}(window,function(){return function(t){var i={};function e(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=i,e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(a,n,function(i){return t[i]}.bind(null,n));return a},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=16)}([function(t,i,e){"use strict";function a(t,i,e,a){if(t){i=i||t;var n,s,o,r,l,c,h=!1;window.addEventListener&&(i.addEventListener("mousedown",function(i){i=i||window.event,n=i.clientX,s=i.clientY,o=t.offsetLeft,r=t.offsetTop,h=!0},!1),document.addEventListener("mousemove",function(i){if(i=i||window.event,h){var u=i.clientX,p=i.clientY;if(l=u-n+o,c=p-s+r,e){var d=e.clientWidth-t.offsetWidth,f=e.clientHeight-t.offsetHeight;l=Math.min(Math.max(0,l),d),c=Math.min(Math.max(0,c),f)}t.style.left=l+"px",t.style.top=c+"px","function"==typeof a&&a(l,c)}},!1),document.addEventListener("mouseup",function(t){h=!1},!1))}}function n(t,i,e){var a=new Image;a.setAttribute("crossorigin","anonymous"),a.src=t,a.onload=function(){"function"==typeof i&&i(a)},a.onerror=function(){"function"==typeof e&&e()}}function s(t,i,e){"string"==typeof t&&(t=[t]);var a=[],n=t.length;!function s(){if(0===n)return!1;var o=new Image;o.setAttribute("crossorigin","anonymous"),o.src=t[--n],o.onload=function(){if(a.unshift(o),a.length===t.length)return"function"==typeof i&&i(a),!1;s()},o.onerror=function(){"function"==typeof e&&e()}}()}function o(t,i){var e=document.createElement("canvas");return e.width=t,e.height=i,e}function r(t){var i=t.replace(/^data:image\/[\w]*;base64,$/,""),e=i.indexOf("=");e>0&&(i=i.substring(0,e));var a=i.length;return parseInt(a-a/8*2)}function l(t,i,e){var a=t;"img"===a.nodeName.toLowerCase()&&(a=function(t){var i=document.createElement("canvas"),e=i.getContext("2d");return i.width=t.naturalWidth,i.height=t.naturalHeight,e.drawImage(t,0,0),i}(a));var n=1,s=a.width,l=a.height,c=s/l,h=a.toDataURL("image/jpeg",1),u=r(h);if(console.log("start compress: "+Math.ceil(u/1024)),e)for(;u>i;)n=Math.floor(i/u*10)/10,u=r(h=a.toDataURL("image/jpeg",n));else{for(;u>i&&(s>800||l>800);){var p=void 0,d=void 0;c>1?d=(p=.9*s>800?.9*s:800)/c:p=(d=.9*l>800?.9*l:800)*c;var f=o(p,d);f.getContext("2d").drawImage(a,0,0,p,d),u=r(h=f.toDataURL("image/jpeg",1)),s=p,l=d,a=f}for(;u>i;)n-=.1,u=r(h=a.toDataURL("image/jpeg",n))}return console.log("end compress: "+Math.ceil(u/1024)),h}function c(t,i){var e=atob(t.split(",")[1]),a=e.length,n=new Uint8Array(a);i||(i=t.substring(t.indexOf("data:")+5,t.indexOf(";base64")));for(var s=0;s<a;s++)n[s]=e.charCodeAt(s);return new Blob([n],{type:i})}function h(t,i){var e=new FormData;return e.append("file",t),i||(i=(new Date).getTime()),e.append("fileName",i),e}e.d(i,"d",function(){return a}),e.d(i,"f",function(){return n}),e.d(i,"g",function(){return s}),e.d(i,"e",function(){return o}),e.d(i,"c",function(){return l}),e.d(i,"a",function(){return c}),e.d(i,"b",function(){return h})},function(t,i,e){"use strict";var a=e(0);function n(){return(n=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function s(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var o=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=n({},{sourceImg:null,rotateNum:0,maxSize:500,cropW:"",cropH:"",mime:"image/jpeg",hasMark:!0,textAlign:"left",markFont:"16px microsoft yahei",markStyle:"#fff",markText:"UED",markX:0,markY:0},i),this.sourceImg=i.sourceImg,this.rotateNum=i.rotateNum,this.maxSize=i.maxSize,this.cropW=i.cropW,this.cropH=i.cropH,this.mime=i.mime,this.hasMark=i.hasMark,this.textAlign=i.textAlign,this.markFont=i.markFont,this.markStyle=i.markStyle,this.markText=i.markText,this.markX=i.markX,this.markY=i.markY,this.sx=0,this.sy=0,this.scaleRatio=.5,this.quality=.2,this.results=[],this.init()}return function(t,i,e){i&&s(t.prototype,i),e&&s(t,e)}(t,[{key:"init",value:function(){var t=this.sourceImg,i=t.width,e=t.height;if("img"===t.nodeName.toLowerCase()){i=t.naturalWidth,e=t.naturalHeight;var n=Object(a.e)(i,e);n.getContext("2d").drawImage(t,0,0),t=n}this.result=t,this.results.push(this.result)}},{key:"reset",value:function(){this.rotateNum=0,this.scaleRatio=1,this.results=this.results.slice(0,1)}},{key:"rollback",value:function(){this.results.pop()}},{key:"rotate",value:function(){var t=this.result,i=t.width,e=t.height,n=90*this.rotateNum,s=Math.max(i,e),o=Object(a.e)(s,s),r=o.getContext("2d");r.translate(s/2,s/2),r.rotate(n*Math.PI/180),r.translate(-s/2,-s/2),r.drawImage(t,0,0);var l=i,c=e,h=0,u=0;1===this.rotateNum?(c=i,h=s-(l=e),u=0):2===this.rotateNum?(h=s-(l=i),u=s-(c=e)):3===this.rotateNum?(l=e,h=0,u=s-(c=i)):(l=i,c=e,h=0,u=0);var p=Object(a.e)(l,c);return p.getContext("2d").drawImage(o,h,u,l,c,0,0,l,c),this.result=p,this.results.push(p),this}},{key:"mark",value:function(){var t=this.result,i=t.width,e=t.height,n=Object(a.e)(i,e),s=n.getContext("2d");return s.drawImage(t,0,0),this.hasMark&&(s.textBaseline="top",s.textAlign=this.textAlign,s.font=this.markFont,s.fillStyle=this.markStyle,s.fillText(this.markText,this.markX,this.markY)),this.result=n,this.results.push(n),this}},{key:"crop",value:function(){var t=this.result,i=(t.width,t.height,Object(a.e)(this.cropW,this.cropH));return i.getContext("2d").drawImage(t,this.sx,this.sy,this.cropW,this.cropH,0,0,this.cropW,this.cropH),this.result=i,this.results.push(i),this}},{key:"scale",value:function(){var t=this.result,i=t.width,e=t.height,n=this.scaleRatio*i,s=this.scaleRatio*e,o=Object(a.e)(n,s);return o.getContext("2d").drawImage(t,0,0,i,e,0,0,n,s),this.result=o,this.results.push(o),this}}]),t}();i.a=o},function(t,i){t.exports='<div class="pipeImg-wrapper J-pipe-wrapper">\r\n    <div class="pipeImg-header">\r\n        <ul class="pipeImg-menu">\r\n            <li class="pipeImg-item J-item active"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-refresh"></i>{{=rotateMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-crop"></i>{{=cropMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-scaling"></i>{{=scaleMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item J-item-mark">\r\n                <a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</a>\r\n                <div class="pipeImg-btn J-menu-txt" style="display:none;"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</div>\r\n                <div class="pipeImg-item item-sub">\r\n                    <a class="pipeImg-btn J-menu-btn-mark-all" href="javascript:void(0)"><i class="ob-icon icon-batch"></i>{{=markAllMenuTxt}}</a>\r\n                    <a class="pipeImg-btn J-menu-btn-mark" href="javascript:void(0)" style="display:none;"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</a>\r\n                </div>\r\n            </li>\r\n        </ul>\r\n        <a class="pipeImg-btn btn-close J-button-close" href="javascript:void(0)"><i class="ob-icon icon-delete"></i>{{=closeBtnTxt}}</a>\r\n    </div>\r\n    <div class="pipeImg-content">\r\n        \x3c!-- 旋转面板 --\x3e\r\n        <div class="pipeImg-panel active J-panel J-rotate-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="size">\r\n                    <span class="J-num-width"></span>*<span class="J-num-height"></span>px\r\n                </div>\r\n                <a class="pipeImg-btn btn-rotate J-btn-rotate-left" href="javascript:void(0)"><i class="ob-icon icon-rotate-l"></i>{{=turnLeftTxt}}</a>\r\n                <a class="pipeImg-btn btn-rotate J-btn-rotate-right" href="javascript:void(0)"><i class="ob-icon icon-rotate-r"></i>{{=turnRightTxt}}</a>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 裁剪面板 --\x3e\r\n        <div class="pipeImg-panel J-panel J-crop-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <input class="num-width J-num-width" type="text">\r\n                <input class="J-fix-ratio" id="fixRatio" type="checkbox" name="fixRatio" hidden>\r\n                <label class="fix" for="fixRatio"><i class="ob-icon icon-lock"></i></label>\r\n                <input class="num-height J-num-height" type="text">\r\n                <span class="txt">px</span>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 缩放面板 --\x3e\r\n        <div class="pipeImg-panel scale-panel J-panel J-scale-panel">\r\n            <div class="img-box J-img-box">\r\n                <div class="scale-img-wrapper J-scale-img-wrapper">\r\n                    <img class="J-source" src="{{-imgList[0].src}}">\r\n                </div>\r\n            </div>\r\n            <div class="content-footer">\r\n                <input class="num-width J-num-width" type="text">\r\n                <span class="txt">X</span>\r\n                <input class="num-height J-num-height" type="text">\r\n                <span class="txt">px</span>\r\n                <input class="scale-range J-scale-range" type="range" name="scaleRatio" min="5" max="100" step="1" defaultValue="100" value="100">\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 添加水印面板 --\x3e\r\n        <div class="pipeImg-panel J-panel J-mark-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=colorTxt}}:</div> \r\n                    <input class="J-color" id="colorWhite" type="radio" name="color" value="0" autocomplete="off" hidden>        \r\n                    <label class="color" for="colorWhite"></label>\r\n                    <input class="J-color" id="colorBlack" type="radio" name="color" value="1" checked autocomplete="off" hidden>\r\n                    <label class="color color-black" for="colorBlack"></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=positionTxt}}:</div>\r\n                    <input class="J-position" id="positionCenter" type="radio" name="position" value="0" autocomplete="off" checked hidden>\r\n                    <label class="position center" for="positionCenter"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftTop" type="radio" name="position" value="1" autocomplete="off" hidden>\r\n                    <label class="position left-top" for="positionLeftTop"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightTop" type="radio" name="position" value="2" autocomplete="off" hidden>\r\n                    <label class="position right-top" for="positionRightTop"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftBottom" type="radio" name="position" value="3" autocomplete="off" hidden>\r\n                    <label class="position left-bottom" for="positionLeftBottom"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightBottom" type="radio" name="position" value="4" autocomplete="off" hidden>\r\n                    <label class="position right-bottom" for="positionRightBottom"><span class="line"></span></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=opacityTxt}}:</div>\r\n                    <input class="opacity-range J-opacity" name="opacity" type="range" min="10" max="100" step="1" defaultValue="80" value="80">\r\n                </div>\r\n\r\n                <select class="J-markTxt" name="markTxt">\r\n                    <option value="0" selected="selected">{{=showRoomTxt}}</option>\r\n                    <option value="1">{{=companyNameTxt}}</option>\r\n                </select>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-confirm J-button-confirm" href="javascript:void(0)">{{=confirmBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-cancel J-button-cancel" href="javascript:void(0)">{{=cancelBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 批量添加水印 --\x3e\r\n        <div class="pipeImg-panel panel-mark-all J-panel J-mark-all-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[0].src}}">\r\n            </div>\r\n            <div class="imgs-thumbnail">\r\n                {{ for(var i=0;i<imgList.length;i++) { }} \r\n                <a class="img-thumbnail {{=i === 0 ? \'active\' : \'\'}} J-img-thumbnail" href="javascript:void(0)">\r\n                    <img src="{{-imgList[i].src}}">\r\n                    <span class="circle"></span>\r\n                </a>\r\n                {{ } }}\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=colorTxt}}:</div> \r\n                    <input class="J-color" id="colorWhiteAll" type="radio" name="colorAll" value="0" autocomplete="off" hidden>        \r\n                    <label class="color" for="colorWhiteAll"></label>\r\n                    <input class="J-color" id="colorBlackAll" type="radio" name="colorAll" value="1" checked autocomplete="off" hidden>\r\n                    <label class="color color-black" for="colorBlackAll"></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=positionTxt}}:</div>\r\n                    <input class="J-position" id="positionCenterAll" type="radio" name="positionAll" value="0" autocomplete="off" checked hidden>\r\n                    <label class="position center" for="positionCenterAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftTopAll" type="radio" name="positionAll" value="1" autocomplete="off" hidden>\r\n                    <label class="position left-top" for="positionLeftTopAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightTopAll" type="radio" name="positionAll" value="2" autocomplete="off" hidden>\r\n                    <label class="position right-top" for="positionRightTopAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftBottomAll" type="radio" name="positionAll" value="3" autocomplete="off" hidden>\r\n                    <label class="position left-bottom" for="positionLeftBottomAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightBottomAll" type="radio" name="positionAll" value="4" autocomplete="off" hidden>\r\n                    <label class="position right-bottom" for="positionRightBottomAll"><span class="line"></span></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=opacityTxt}}:</div>\r\n                    <input class="opacity-range J-opacity" name="opacityAll" type="range" min="10" max="100" step="1" defaultValue="80" value="80">\r\n                </div>\r\n\r\n                <select class="J-markTxt" name="markTxtAll">\r\n                    <option value="0" selected="selected">{{=showRoomTxt}}</option>\r\n                    <option value="1">{{=companyNameTxt}}</option>\r\n                </select>\r\n                \r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n    <div class="pipeImg-footer J-pipe-footer">\r\n        <div class="imgs-thumbnail">\r\n            {{ for(var i=0;i<imgList.length;i++) { }} <a class="img-thumbnail {{=i === 0 ? \'active\' : \'\'}} J-img-thumbnail"\r\n            href="javascript:void(0)">\r\n            <img src="{{-imgList[i].src}}">\r\n            <span class="circle"></span>\r\n            </a>\r\n            {{ } }}\r\n        </div>  \r\n\r\n        <div class="pipeImg-buttons">\r\n            <a class="pipeImg-button button-confirm J-button-confirm-all" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n            <a class="pipeImg-button button-cancel J-button-cancel-all" href="javascript:void(0)">{{=cancelBtnTxt}}</a>\r\n        </div>            \r\n    </div>\r\n\r\n</div>\r\n<div class="pipeImg-tip J-pipeImg-tip">\r\n    <div class="pipeImg-tip-header">{{=tipTitleTxt}}</div>\r\n    <div class="pipeImg-tip-main">\r\n        <div class="pipeImg-tip-content">{{=tipContentTxt}}</div>\r\n        <a class="pipeImg-button button-confirm J-tip-confirm" href="javascript:void(0)">{{=tipConfirmBtnTxt}}</a>\r\n        <a class="pipeImg-button button-cancel J-tip-cancel" href="javascript:void(0)">{{=cancelBtnTxt}}</a>        \r\n    </div>\r\n</div>'},function(t,i){t.exports='<div class="select">\n\t<div class="select-title J-select-title">\n\t\t<div class="select-selected">\n\t\t\t<span class="J-text">{{=txt}}</span>\n\t\t</div>\n\t\t<div class="select-arrow J-arrow">\n\t\t\t<i class="ob-icon icon-down"></i>\n\t\t</div>\n\t</div>\n\t<div class="select-list J-select-list">\n\t\t<ul class="select-list-wrap J-select-tab-cnt">\n\t\t\t{{ for(var i=0; i < optionList.length; i++) { }} \n\t\t\t\t<li>\n\t\t\t\t\t<a href="javascript:void(0)" class="select-opt J-opt {{=optionList[i].selected ? \'selected\' : \'\'}}" data-val="{{=optionList[i].val}}">{{=optionList[i].txt}}</a>\n\t\t\t\t</li>\n\t\t\t{{ } }}\n\t\t</ul>\n\t</div>\n</div>\n'},function(t,i,e){"use strict";var a=e(0);function n(){return(n=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function s(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var o=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=n({},{el:"",width:"100%",height:"100%",markText:"producttest.en.made-in-china.com",hasLight:!1,fixRatio:!1,onDragPoint:function(t){},onDragComplete:function(t,i){}},i),this.el=i.el,this.width=i.width,this.height=i.height,this.markText=i.markText,this.hasLight=i.hasLight,this.fixRatio=i.fixRatio,this.onDragPoint=i.onDragPoint,this.onDragComplete=i.onDragComplete,this.init()}return function(t,i,e){i&&s(t.prototype,i),e&&s(t,e)}(t,[{key:"init",value:function(){var t=this;this.$el=$(this.el);var i=this.$el.attr("src"),e=this.$el.parent(),n='<div class="dragbox-wrapper J-dragbox-wrapper">\n                                <img class="J-source" src="'.concat(i,'">\n                                <div class="drag-box J-drag-box">\n                                    <div class="drag-point up-left J-drag-point"></div>\n                                    <div class="drag-point up J-drag-point"></div>\n                                    <div class="drag-point up-right J-drag-point"></div>\n                                    <div class="drag-point right J-drag-point"></div>\n                                    <div class="drag-point right-down J-drag-point"></div>\n                                    <div class="drag-point down J-drag-point"></div>\n                                    <div class="drag-point left-down J-drag-point"></div>\n                                    <div class="drag-point left J-drag-point"></div>\n                                    <div class="mark-txt J-mark-txt">').concat(this.markText,"</div>\n                                </div>\n                            </div>");this.hasLight&&(n='<div class="dragbox-wrapper J-dragbox-wrapper">\n                                <img class="J-source img-dark" src="'.concat(i,'">\n                                <img class="J-source img-light J-img-light" src="').concat(i,'">\n                                <div class="drag-box J-drag-box">\n                                    <div class="drag-point up-left J-drag-point"></div>\n                                    <div class="drag-point up J-drag-point"></div>\n                                    <div class="drag-point up-right J-drag-point"></div>\n                                    <div class="drag-point right J-drag-point"></div>\n                                    <div class="drag-point right-down J-drag-point"></div>\n                                    <div class="drag-point down J-drag-point"></div>\n                                    <div class="drag-point left-down J-drag-point"></div>\n                                    <div class="drag-point left J-drag-point"></div>\n                                </div>\n                            </div>')),e.html(n),this.$dragBox=e.find(".J-drag-box"),this.hasLight||this.$dragBox.css({width:this.$dragBox.find(".J-mark-txt").width(),height:this.$dragBox.find(".J-mark-txt").height()}),this.$dragPoint=this.$dragBox.find(".J-drag-point"),this.boxEl=this.$dragBox.get(0),this.containerEl=this.boxEl.parentNode,this.imgLight=e.find(".J-img-light:first").get(0),this.boxData={left:this.boxEl.offsetLeft,top:this.boxEl.offsetTop,width:this.boxEl.offsetWidth,height:this.boxEl.offsetHeight,ratio:this.boxEl.offsetWidth/this.boxEl.offsetHeight},this._bind(),Object(a.d)(this.boxEl,this.boxEl,this.boxEl.parentNode,function(i,e){t._light(),t.onDragComplete(i,e)})}},{key:"_bind",value:function(){var t=this,i=!1,e="",a=["up-left","up","up-right","right","right-down","down","left-down","left"],n=this.boxData.width/this.boxData.height;this.$dragPoint.on("mousedown",function(s){s.stopPropagation(),i=!0;var o=$(s.target).index();e=a[o],n=t.boxData.width/t.boxData.height}),$(document).on("mouseup",function(e){i=!1,t.boxData={left:t.boxEl.offsetLeft,top:t.boxEl.offsetTop,width:t.boxEl.offsetWidth,height:t.boxEl.offsetHeight,ratio:t.boxEl.offsetWidth/t.boxEl.offsetHeight}}),$(document).on("mousemove",function(a){1==i&&(t._move(a,e,n),t._light(),t.boxData={left:t.boxEl.offsetLeft,top:t.boxEl.offsetTop,width:t.boxEl.offsetWidth,height:t.boxEl.offsetHeight,ratio:t.boxEl.offsetWidth/t.boxEl.offsetHeight},t.onDragPoint(t.boxData))})}},{key:"_getPosition",value:function(){for(var t=this.boxEl,i=t.offsetLeft,e=t.offsetTop,a=t.offsetParent;null!=a;)i+=a.offsetLeft,e+=a.offsetTop,a=a.offsetParent;return{left:i,top:e}}},{key:"_move",value:function(t,i,e){var a,n,s,o,r,l,c=t.clientX,h=t.clientY,u=this.boxEl.offsetWidth-2,p=this.boxEl.offsetHeight-2,d=this._getPosition(),f=d.top,m=d.left;if(-1!=i.indexOf("left")){var v=m-c;if(v>=0&&this.boxEl.offsetLeft<=0)return!1;a=u+v,s=this.boxEl.offsetLeft-v}if(-1!=i.indexOf("right")){var g=c-m-u;if(g>=0&&this.containerEl.clientWidth-(this.boxEl.offsetLeft+u+g)<=0)return!1;a=u+g,s=this.boxEl.offsetLeft}if(-1!=i.indexOf("up")&&(this.fixRatio?r=(n=Math.round(a/e))-p:n=p+(r=f-h),o=this.boxEl.offsetTop-r,r>=0&&this.boxEl.offsetTop<=0))return!1;if(-1!=i.indexOf("down")&&(this.fixRatio?(l=(n=Math.round(a/e))-p,o=this.boxEl.offsetTop):n=p+(l=h-f-p),l>=0&&this.containerEl.clientHeight-(this.boxEl.offsetTop+p+l)<=0))return!1;this.boxEl.style.width=a+"px",this.boxEl.style.height=n+"px",this.boxEl.style.left=s+"px",this.boxEl.style.top=o+"px"}},{key:"_light",value:function(){this.hasLight&&this._setChoice()}},{key:"_setChoice",value:function(){var t=this.boxEl.offsetTop,i=this.boxEl.offsetLeft+this.boxEl.offsetWidth,e=this.boxEl.offsetTop+this.boxEl.offsetHeight,a=this.boxEl.offsetLeft;this.imgLight.style.clip="rect("+t+"px,"+i+"px,"+e+"px,"+a+"px)"}},{key:"update",value:function(){this.$dragBox.css({width:this.width,height:this.height})}}]),t}(),r=e(2),l=e.n(r),c=e(3),h=e.n(c);function u(){return(u=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function p(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var d=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=u({},{el:"",template:h.a},i),this.el=i.el,this.template=i.template,this.$el=$(this.el),this.selectObj={txt:"",optionsObj:[]},this._init()}return function(t,i,e){i&&p(t.prototype,i),e&&p(t,e)}(t,[{key:"_init",value:function(){var t=this;this.$el.find("option").each(function(i,e){var a=$(e),n=a.prop("selected"),s=a.val(),o=a.text(),r={val:s,txt:o,selected:n};n&&(t.selectObj.txt=o),t.selectObj.optionsObj.push(r)});var i=template(this.template,{txt:this.selectObj.txt,optionList:this.selectObj.optionsObj});this.$el.hide(),$(i).insertBefore(this.$el),this.$thinSelect=this.$el.prev(),this._bind()}},{key:"_bind",value:function(){var t=this;this.$thinSelect.find(".J-select-title").on("click",function(i){i.stopPropagation();var e=t.$thinSelect.find(".J-select-list");e.is(":visible")?(e.hide(),t.$thinSelect.find(".J-arrow").removeClass("active")):(e.show(),t.$thinSelect.find(".J-arrow").addClass("active"))}),this.$thinSelect.find(".J-opt").on("click",function(i){i.stopPropagation();var e=$(i.target).addClass("selected").text();t.$thinSelect.find(".J-text").text(e),t.$thinSelect.find(".J-select-list").hide(),t.$thinSelect.find(".J-arrow").removeClass("active"),t.$activeItem=$(i.target).parent(),t.$activeItem.siblings().find(".J-opt").removeClass("selected"),t._updateSource()}),$(document).on("click.thinSelect",function(i){t.$thinSelect.find(".J-select-list").hide(),t.$thinSelect.find(".J-arrow").removeClass("active")})}},{key:"_updateSource",value:function(){var t=this.$activeItem.index();this.$el.find("option").eq(t).prop("selected",!0),this.$el.trigger("change")}},{key:"destroy",value:function(){$(document).off("click.thinSelect"),this.$thinSelect.remove()}}]),t}();d.use=function(t){if(!t)throw new Error("ThinSelect: el is not found!");Array.prototype.slice.call(document.querySelectorAll(t)).forEach(function(t){new d({el:t})})};var f=d;function m(){return(m=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function v(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var g=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=m({},{imgList:[],template:l.a,mime:"image/jpeg",markTextList:["producttest.en.made-in-china.com","Focus Service Co - Product Sourcing"],closeBtnTxt:"关闭",saveBtnTxt:"保存",resetBtnTxt:"重置",confirmBtnTxt:"确定",cancelBtnTxt:"取消",rotateMenuTxt:"旋转",turnLeftTxt:"逆时针旋转",turnRightTxt:"顺时针旋转",cropMenuTxt:"裁剪",scaleMenuTxt:"缩放",markMenuTxt:"添加水印",colorTxt:"颜色",positionTxt:"位置",opacityTxt:"透明度",showRoomTxt:"展示厅",companyNameTxt:"公司名称",markAllMenuTxt:"批量添加水印",tipTitleTxt:"提示",tipContentTxt:"尚未保存，是否确定离开？",tipConfirmBtnTxt:"确定",onSaveRotate:function(t,i){},onSaveCrop:function(t,i){},onSaveScale:function(t,i){},onSaveMark:function(t,i){},onReset:function(t){},onSave:function(t){},onChangeActive:function(t,i){},onSaveMarkAll:function(t){}},i),this.imgList=i.imgList,this.template=i.template,this.mime=i.mime,this.markTextList=i.markTextList,this.closeBtnTxt=i.closeBtnTxt,this.saveBtnTxt=i.saveBtnTxt,this.resetBtnTxt=i.resetBtnTxt,this.confirmBtnTxt=i.confirmBtnTxt,this.cancelBtnTxt=i.cancelBtnTxt,this.rotateMenuTxt=i.rotateMenuTxt,this.turnLeftTxt=i.turnLeftTxt,this.turnRightTxt=i.turnRightTxt,this.cropMenuTxt=i.cropMenuTxt,this.scaleMenuTxt=i.scaleMenuTxt,this.markMenuTxt=i.markMenuTxt,this.colorTxt=i.colorTxt,this.positionTxt=i.positionTxt,this.opacityTxt=i.opacityTxt,this.showRoomTxt=i.showRoomTxt,this.companyNameTxt=i.companyNameTxt,this.markAllMenuTxt=i.markAllMenuTxt,this.tipTitleTxt=i.tipTitleTxt,this.tipContentTxt=i.tipContentTxt,this.tipConfirmBtnTxt=i.tipConfirmBtnTxt,this.onSaveRotate=i.onSaveRotate,this.onSaveCrop=i.onSaveCrop,this.onSaveScale=i.onSaveScale,this.onSaveMark=i.onSaveMark,this.onReset=i.onReset,this.onSave=i.onSave,this.onChangeActive=i.onChangeActive,this.onSaveMarkAll=i.onSaveMarkAll,this._init()}return function(t,i,e){i&&v(t.prototype,i),e&&v(t,e)}(t,[{key:"_init",value:function(){var t=this,i='<div class="pipeImg-dialog J-pipe-dialog" onselectstart="return false" ondragstart="return false"><div class="pipe-mask J-pipe-mask"></div>'+template(this.template,{imgList:this.imgList,closeBtnTxt:this.closeBtnTxt,saveBtnTxt:this.saveBtnTxt,resetBtnTxt:this.resetBtnTxt,confirmBtnTxt:this.confirmBtnTxt,cancelBtnTxt:this.cancelBtnTxt,rotateMenuTxt:this.rotateMenuTxt,turnLeftTxt:this.turnLeftTxt,turnRightTxt:this.turnRightTxt,cropMenuTxt:this.cropMenuTxt,scaleMenuTxt:this.scaleMenuTxt,markMenuTxt:this.markMenuTxt,colorTxt:this.colorTxt,positionTxt:this.positionTxt,opacityTxt:this.opacityTxt,showRoomTxt:this.showRoomTxt,companyNameTxt:this.companyNameTxt,markAllMenuTxt:this.markAllMenuTxt,tipTitleTxt:this.tipTitleTxt,tipContentTxt:this.tipContentTxt,tipConfirmBtnTxt:this.tipConfirmBtnTxt})+"</div>";$("body").append(i),this.$el=$(".J-pipe-dialog"),this.$pipeWrapper=this.$el.find(".J-pipe-wrapper"),this.$btnClose=this.$el.find(".J-button-close"),this.$btnSave=this.$el.find(".J-button-save"),this.$btnReset=this.$el.find(".J-button-reset"),this.$btnConfirm=this.$el.find(".J-button-confirm"),this.$btnCancel=this.$el.find(".J-button-cancel"),this.$btnSaveAll=this.$el.find(".J-button-confirm-all"),this.$btnCancelAll=this.$el.find(".J-button-cancel-all"),this.$btnRotateLeft=this.$el.find(".J-btn-rotate-left"),this.$btnRotateRight=this.$el.find(".J-btn-rotate-right");var e=this.$el.find(".J-crop-panel");this.$inputCropWidth=e.find(".J-num-width"),this.$inputCropHeight=e.find(".J-num-height"),this.$radioCropFix=e.find(".J-fix-ratio"),this.$scalePanel=this.$el.find(".J-scale-panel"),this.$inputScaleWidth=this.$scalePanel.find(".J-num-width"),this.$inputScaleHeight=this.$scalePanel.find(".J-num-height"),this.$rangeScaleRatio=this.$scalePanel.find(".J-scale-range"),this.$markPanel=this.$el.find(".J-mark-panel"),this.$radioMarkColor=this.$markPanel.find(".J-color"),this.$radioMarkPosition=this.$markPanel.find(".J-position"),this.$rangeMarkOpacity=this.$markPanel.find(".J-opacity"),this.$selectMarkTxt=this.$markPanel.find(".J-markTxt"),this.$markAllPanel=this.$el.find(".J-mark-all-panel"),this.$radioMarkAllColor=this.$markAllPanel.find(".J-color"),this.$radioMarkAllPosition=this.$markAllPanel.find(".J-position"),this.$rangeMarkAllOpacity=this.$markAllPanel.find(".J-opacity"),this.$selectMarkAllTxt=this.$markAllPanel.find(".J-markTxt"),this.isChange=!1,this.rotateNum=0,this.scaleRatio=1,this.imgBoxHeight=this.$el.find(".J-img-box").height(),this.imgBoxWidth=this.$el.find(".J-img-box").width(),this.imgBoxRatio=this.imgBoxWidth/this.imgBoxHeight,this.activeImg=this.imgList[0],this.cropBox=new o({el:e.find(".J-source"),hasLight:!0,onDragPoint:function(i){t._showSize(i.width*t.activeData.ratio,i.height*t.activeData.ratio),t._updateIsChange(!0)}});var n=this.$scalePanel.find(".J-scale-img-wrapper"),s=this.$scalePanel.find(".J-source").get(0);Object(a.d)(s,s,n.get(0)),this.markBox=new o({el:this.$markPanel.find(".J-source"),fixRatio:!1,markText:this.markTextList[0],onDragComplete:function(i,e){t.$el.find(".J-mark-panel").find(".J-position").prop("checked",!1),t._updateIsChange(!0)},onDragPoint:function(i){t.$el.find(".J-mark-panel").find(".J-mark-txt").css({"font-size":parseInt(t.markBox.$dragBox.css("height"))/1.5}),t._updateMark()}}),this.markAllBox=new o({el:this.$markAllPanel.find(".J-source"),markText:this.markTextList[0],onDragComplete:function(i,e){t.$el.find(".J-mark-all-panel").find(".J-position").prop("checked",!1),t._updateIsChange(!0)},onDragPoint:function(i){t.$el.find(".J-mark-all-panel").find(".J-mark-txt").css({"font-size":parseInt(t.markAllBox.$dragBox.css("height"))/1.5}),t._updateMarkAll()}}),this._refresh(),f.use(".J-markTxt"),this._setMarkPosition(),this._setMarkPosition("all"),this._bind()}},{key:"_bind",value:function(){var t=this;this.$el.find(".J-pipe-footer").on("click",".J-img-thumbnail",function(i){var e=$(i.target).parent();e.addClass("active").siblings().removeClass("active");var n=e.index(),s=e.find("img").attr("src");t.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").attr("src",s),Object(a.f)(s,function(i){t._updateActiveImg(i,n),t._goHome(),t._initData()})}),this.$markAllPanel.on("click",".J-img-thumbnail",function(i){var e=$(i.target).parent();e.addClass("active").siblings().removeClass("active");var n=e.index(),s=e.find("img").attr("src");t.$markAllPanel.find(".J-source").attr("src",s),Object(a.f)(s,function(i){t._updateActiveImg(i,n),t._setMarkPosition("all"),t._initData()})}),this.$el.find(".J-menu-btn").on("click",function(i){var e=$(i.target).parent(),a=e.index(),n=e.parent().find(".active:first").index();if(t.showModel("0"),t.showMenu(a),t.isChange)switch(n){case 0:t._saveRotate();break;case 1:t._saveCrop();break;case 2:t._saveScale()}1===a&&t._initCrop(),2===a&&t._initScale()}),this.$el.find(".J-item-mark").on("click",".J-menu-btn-mark",function(i){t._confirm(function(){var i=t.$el.find(".J-pipe-footer").find(".J-img-thumbnail.active"),e=i.index(),n=i.find("img").attr("src");Object(a.f)(n,function(i){t._updateActiveImg(i,e),t.showModel("0"),t.showMenu(3)})})}),this.$el.find(".J-item-mark").on("click",".J-menu-btn-mark-all",function(i){t._confirm(function(){var i=t.$markAllPanel.find(".J-img-thumbnail.active"),e=i.index(),n=i.find("img").attr("src");Object(a.f)(n,function(i){t._updateActiveImg(i,e),t.showModel("1"),t._initData(),t._updateIsChange(!0)})})}),this.$btnRotateLeft.on("click",function(){t._getRotateNum(-1),t._updateRotate()}),this.$btnRotateRight.on("click",function(){t._getRotateNum(1),t._updateRotate()}),this.$inputCropWidth.on("input",function(i){var e=parseInt($(i.target).val());t.cropBox.width=e/t.activeData.ratio,t.cropBox.fixRatio&&(t.cropBox.height=t.cropBox.width/t.cropBox.boxData.ratio),t._updateCrop()}),this.$inputCropHeight.on("input",function(i){var e=parseInt($(i.target).val());t.cropBox.height=e/t.activeData.ratio,t.cropBox.fixRatio&&(t.cropBox.width=t.cropBox.height*t.cropBox.boxData.ratio),t._updateCrop()}),this.$radioCropFix.on("change",function(i){t.cropBox.fixRatio=!t.cropBox.fixRatio}),this.$inputScaleWidth.on("input",function(i){var e=parseInt($(i.target).val());e=e>=0?e:0,t.scaleRatio=e/t.activeData.w0,t._updateScale()}),this.$inputScaleHeight.on("input",function(i){var e=parseInt($(i.target).val());e=e>=0?e:0,console.log(e),t.scaleRatio=e/t.activeData.h0,t._updateScale()}),this.$rangeScaleRatio.on("change",function(i){var e=$(i.target),a=parseInt(e.attr("max")),n=parseInt(e.val());t.scaleRatio=n/a,t._updateScale()}),this.$rangeScaleRatio.on("input",function(i){var e=$(i.target),a=parseInt(e.attr("max")),n=parseInt(e.val());t.scaleRatio=n/a,t._updateScale()}),this.$radioMarkColor.on("change",function(){t._updateMark()}),this.$rangeMarkOpacity.on("input",function(){t._updateMark()}),this.$rangeMarkOpacity.on("change",function(){t._updateMark()}),this.$selectMarkTxt.on("change",function(){t._updateMark()}),this.$radioMarkPosition.on("change",function(){t._updateMark()}),this.$radioMarkAllColor.on("change",function(){t._updateMarkAll()}),this.$rangeMarkAllOpacity.on("input",function(){t._updateMarkAll()}),this.$rangeMarkAllOpacity.on("change",function(){t._updateMarkAll()}),this.$selectMarkAllTxt.on("change",function(){t._updateMarkAll()}),this.$radioMarkAllPosition.on("change",function(){t._updateMarkAll()}),this.$btnConfirm.on("click",function(){t._saveMark()}),this.$btnCancel.on("click",function(){t._cancelMark()}),this.$btnSaveAll.on("click",function(){t._saveMarkAll()}),this.$btnCancelAll.on("click",function(){t.destory()}),this.$btnReset.on("click",function(){t._reset()}),this.$btnSave.on("click",function(i){if(t.isChange){switch($(i.target).parents(".J-panel").index()){case 0:t._saveRotate();break;case 1:t._saveCrop();break;case 2:t._saveScale()}t._save()}}),this.$btnClose.on("click",function(i){t._confirm(function(){t.destory()})}),this.$el.on("contextmenu",function(t){})}},{key:"_goHome",value:function(){this.$el.find(".J-menu-btn").parent(":first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel:first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-item-mark").find(".J-menu-btn").show(),this.$el.find(".J-item-mark").find(".J-menu-txt").hide()}},{key:"_initRotate",value:function(){this.rotateNum=0}},{key:"_updateRotate",value:function(){this.$el.find(".J-source").css({transform:"rotate(".concat(90*this.rotateNum,"deg)")}),1===this.rotateNum||3===this.rotateNum?1/this.activeData.imgRatio<this.imgBoxRatio?this.$el.find(".J-source").css({width:this.imgBoxHeight,height:"auto"}):this.$el.find(".J-source").css({width:"auto",height:this.imgBoxWidth}):this.activeData.imgRatio<this.imgBoxRatio?this.$el.find(".J-source").css({width:"auto",height:this.imgBoxHeight}):this.$el.find(".J-source").css({width:this.imgBoxWidth,height:"auto"}),this._updateIsChange(!0)}},{key:"_saveRotate",value:function(){var t=this,i={rotateNum:this.rotateNum};this.onSaveRotate(i,function(i){t.rotateNum=0,t.activeImg=i,t._refresh(),t._updateIsChange(!1)})}},{key:"_initCrop",value:function(){this.cropBox.isFixed=this.$radioCropFix.prop("checked"),this.cropBox.width=this.$inputCropWidth.val()/this.activeData.ratio,this.cropBox.height=this.$inputCropHeight.val()/this.activeData.ratio}},{key:"_updateCrop",value:function(){this.cropBox.update(),this._updateIsChange(!0)}},{key:"_saveCrop",value:function(){var t=this,i={sx:this.cropBox.boxData.left*this.activeData.ratio,sy:this.cropBox.boxData.top*this.activeData.ratio,cropW:this.cropBox.boxData.width*this.activeData.ratio,cropH:this.cropBox.boxData.height*this.activeData.ratio};this.onSaveCrop(i,function(i){t.sx=0,t.sy=0,t.cropW=i.width,t.cropH=i.height,t.activeImg=i,t._refresh(),t._updateIsChange(!1)})}},{key:"_initScale",value:function(){var t=this.$scalePanel.find(".J-img-box"),i=this.$scalePanel.find(".J-scale-range"),e=this.$scalePanel.find(".J-scale-img-wrapper"),a=t.find(".J-source"),n=this.activeData.w0+(this.activeData.w0-this.imgBoxWidth),s=this.activeData.h0+(this.activeData.h0-this.imgBoxHeight);e.css({width:n,height:s,"margin-left":-n/2,"margin-top":-s/2}),a.css({position:"absolute",left:(n-this.activeData.w0)/2,top:(s-this.activeData.h0)/2,width:this.activeData.w0,height:this.activeData.h0,"max-width":"none","max-height":"none",cursor:"move"}),i.val(i.attr("max")),this.scaleRatio=1}},{key:"_updateScale",value:function(){var t=this.scaleRatio,i=this.$rangeScaleRatio,e=this.$inputScaleWidth,a=this.$inputScaleHeight,n=parseInt(i.attr("max"));e.val()!=this.activeData.w0*t&&e.val(this.activeData.w0*t),a.val()!=this.activeData.h0*t&&a.val(this.activeData.h0*t),i.val()!=n*t&&i.val(n*t),this.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").css({transform:"scale(".concat(this.scaleRatio,")")}),this._updateIsChange(!0)}},{key:"_saveScale",value:function(){var t=this,i={scaleRatio:this.scaleRatio};this.onSaveScale(i,function(i){t.scaleRatio=1,t.activeImg=i,t._refresh(),t._updateIsChange(!0)})}},{key:"_setMarkPosition",value:function(t){var i="all"===t?this.$markAllPanel:this.$markPanel,e="all"===t?this.markAllBox.$dragBox:this.markBox.$dragBox,a=parseInt(e.css("left"))*this.activeData.ratio,n=parseInt(e.css("top"))*this.activeData.ratio,s=i.find(".J-position:checked").val(),o=this.activeData.w1,r=this.activeData.h1,l=e.find(".J-mark-txt").outerWidth(),c=e.find(".J-mark-txt").outerHeight();switch(["center","upLeft","upRight","downLeft","downRight"][s]){case"center":a=(o-l)/2*this.activeData.ratio,n=(r-c)/2*this.activeData.ratio;break;case"upLeft":a=0,n=0;break;case"upRight":a=(o-l)*this.activeData.ratio,n=0;break;case"downLeft":a=0,n=(r-c)*this.activeData.ratio;break;case"downRight":a=(o-l)*this.activeData.ratio,n=(r-c)*this.activeData.ratio}e.css({left:a/this.activeData.ratio,top:n/this.activeData.ratio,width:l,height:c})}},{key:"_setMarkStyle",value:function(t){var i="all"===t?this.$markAllPanel:this.$markPanel,e=i.find(".J-mark-txt"),a=i.find(".J-color:checked").val(),n=parseInt(i.find(".J-opacity").val())/parseInt(i.find(".J-opacity").attr("max")),s=i.find(".J-markTxt").val(),o="rgba(255, 255, 255, ".concat(n,")");"1"===a&&(o="rgba(0, 0, 0, ".concat(n,")"));var r=this.markTextList[s];e.text(r).css({color:o})}},{key:"_updateMark",value:function(){this._setMarkStyle(),this._setMarkPosition(),this._updateIsChange(!0)}},{key:"_updateMarkAll",value:function(){this._setMarkStyle("all"),this._setMarkPosition("all"),this._updateIsChange(!0)}},{key:"_getMarkParams",value:function(t){var i="all"===t?this.$markAllPanel:this.$markPanel,e="all"===t?this.markAllBox.$dragBox:this.markBox.$dragBox,a=i.find(".J-mark-txt"),n=parseInt(a.css("font-size"))+"px microsoft yahei",s=i.find(".J-opacity"),o=parseInt(s.val())/parseInt(s.attr("max")),r=i.find(".J-color:checked").val(),l="rgba(255, 255, 255, ".concat(o,")");"1"===r&&(l="rgba(0, 0, 0, ".concat(o,")"));var c=i.find(".J-markTxt").val(),h=this.markTextList[c];return{markX:parseInt(e.css("left"))*this.activeData.ratio,markY:parseInt(e.css("top"))*this.activeData.ratio,markText:h,markFont:n,markStyle:l}}},{key:"_saveMark",value:function(){var t=this,i=this._getMarkParams();this.onSaveMark(i,function(i){t.activeImg=i,t._refresh(),t._goHome(),t._updateIsChange(!0)})}},{key:"_cancelMark",value:function(){this._goHome()}},{key:"_saveMarkAll",value:function(){var t=this,i=this._getMarkParams("all");this.onSaveMarkAll(i,function(i){t.destory(),t._updateIsChange(!1)})}},{key:"_showSize",value:function(t,i){t=Math.round(t),i=Math.round(i);var e=this.$el.find(".J-num-width"),a=this.$el.find(".J-num-height");e.each(function(i,a){"input"===$(a).get(0).nodeName.toLowerCase()?e.val(t):e.html(t)}),a.each(function(t,e){"input"===$(e).get(0).nodeName.toLowerCase()?a.val(i):a.html(i)})}},{key:"_refresh",value:function(){this._updateActiveData();var t="";t="img"===this.activeData.img.nodeName.toLowerCase()?this.activeData.img.src:this.activeData.img.toDataURL(this.mime,1),this.$el.find(".J-img-box").find(".J-source").length>0?this.$el.find(".J-img-box").find(".J-source").attr("src",t):this.$el.find(".J-img-box").append('<img class="J-source" src="'.concat(t,'">')),this.$el.find(".J-source").removeAttr("style"),this.cropBox&&this.cropBox.boxEl.removeAttribute("style"),this.$el.find(".J-img-box").find(".J-source").css({width:this.activeData.w1,height:this.activeData.h1}),this._showSize(this.activeData.w0,this.activeData.h0)}},{key:"_updateActiveData",value:function(){var t=this.activeImg,i=t.width,e=t.height;"img"===t.nodeName.toLowerCase()&&(i=t.naturalWidth,e=t.naturalHeight);var a,n,s,o=i/e;o<this.imgBoxRatio?(n=(a=this.imgBoxHeight)*o,s=e/a):(a=(n=this.imgBoxWidth)/o,s=i/n),this.activeData={w0:i,h0:e,w1:n,h1:a,ratio:s,imgRatio:o,img:t}}},{key:"_getRotateNum",value:function(t){this.rotateNum+=t,this.rotateNum>3&&(this.rotateNum=0),this.rotateNum<0&&(this.rotateNum=3)}},{key:"_confirm",value:function(t,i){var e=this,a=this.$el.find(".J-pipeImg-tip"),n=function(){e.$pipeWrapper.css("z-index",2),a.hide(),a.off("click")};a.show(),e.$pipeWrapper.css("z-index",0),a.on("click",".J-tip-confirm",function(i){t(),n()}),a.on("click",".J-tip-cancel",function(t){i&&i(),n()})}},{key:"_updateIsChange",value:function(t){this.isChange=t;var i=this.$el.find(".J-button-save, .J-button-reset");t?i.addClass("active"):i.removeClass("active")}},{key:"_reset",value:function(){var t=this;this.onReset(function(i){t.rotateNum=0,t.scaleRatio=1,t.activeImg=i,t._refresh(),t._updateIsChange(!1)})}},{key:"_save",value:function(){var t=this;this.onSave(function(i){var e=i.url.replace("&amp;","&"),a=t.$el.find(".J-pipe-footer").find(".J-img-thumbnail.active");a.addClass("new").find("img").attr("src",e);var n=a.index();t.$el.find(".J-mark-all-panel").find(".J-img-thumbnail").eq(n).find("img").attr("src",e),t._updateIsChange(!1),t.imgList=t.$el.find(".J-pipe-footer").find(".J-img-thumbnail img")})}},{key:"_initData",value:function(){this.rotateNum=0,this.scaleRatio=1}},{key:"_updateActiveImg",value:function(t,i){this.activeImg=t,this._refresh();var e={activeImg:this.activeImg,activeIndex:i};this.onChangeActive(e,function(t){})}},{key:"showMenu",value:function(t){if(this.$el.find(".J-item").eq(t).addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel").eq(t).addClass("active").siblings().removeClass("active"),3===t){var i=this.$el.find(".J-item-mark");i.find(".J-menu-btn").hide(),i.find(".J-menu-txt").show()}}},{key:"showSource",value:function(t){var i=this,e=this.$el.find(".J-pipe-footer").find(".J-img-thumbnail").eq(t);e.addClass("active").siblings().removeClass("active");var n=e.find("img").attr("src");this.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").attr("src",n),Object(a.f)(n,function(e){i._updateActiveImg(e,t)})}},{key:"showModel",value:function(t){if("1"===t){var i=this.$el.find(".J-item-mark");i.addClass("active").siblings().removeClass("active"),this.$markAllPanel.addClass("active").siblings().removeClass("active"),i.find(".J-menu-btn").hide(),i.find(".J-menu-txt").show();var e=i.find(".J-menu-btn-mark-all").html();i.find(".J-menu-txt").html(e),i.find(".J-menu-btn-mark-all").hide(),i.find(".J-menu-btn-mark").show(),this.$el.find(".J-pipe-footer").addClass("mark-all")}else{var a=this.$el.find(".J-item-mark");this.$el.find(".J-item:first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel:first").addClass("active").siblings().removeClass("active"),a.find(".J-menu-btn").show(),a.find(".J-menu-txt").hide();var n=a.find(".J-menu-btn-mark").html();a.find(".J-menu-txt").html(n),a.find(".J-menu-btn-mark-all").show(),a.find(".J-menu-btn-mark").hide(),this.$el.find(".J-pipe-footer").removeClass("mark-all")}}},{key:"destory",value:function(){this.$el.remove()}},{key:"showDialog",value:function(){this.$el.fadeIn(100)}},{key:"hideDialog",value:function(){this.$el.fadeOut(100)}}]),t}();i.a=g},,,,,,,,,,,,function(t,i,e){"use strict";e.r(i),e.d(i,"PipeImg",function(){return l});var a=e(0),n=e(1),s=e(4);function o(){return(o=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function r(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var l=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);if(i=o({},{source:[],uploadUrl:"",sendDataType:"formdata",type:"0",debug:!1,mime:"image/jpeg",maxSize:500,markTextList:["producttest.en.made-in-china.com","Focus Service Co - Product Sourcing"],closeBtnTxt:"关闭",saveBtnTxt:"保存",resetBtnTxt:"重置",confirmBtnTxt:"确定",cancelBtnTxt:"取消",rotateMenuTxt:"旋转",turnLeftTxt:"逆时针旋转",turnRightTxt:"顺时针旋转",cropMenuTxt:"裁剪",scaleMenuTxt:"缩放",markMenuTxt:"添加水印",colorTxt:"颜色",positionTxt:"位置",opacityTxt:"透明度",showRoomTxt:"展示厅",companyNameTxt:"公司名称",markAllMenuTxt:"批量添加水印",tipTitleTxt:"提示",tipContentTxt:"尚未保存，是否确定离开？",tipConfirmBtnTxt:"确定",onInited:function(){},onComplete:function(t){}},i),this.source=i.source,!this.source)throw new Error("PipeImg: source is not found!");if(!Array.isArray(this.source)&&"string"!=typeof this.source)throw new Error("PipeImg: source类型错误，只能为字符串或者数组！");this.uploadUrl=i.uploadUrl,this.sendDataType=i.sendDataType,this.type=i.type,this.debug=i.debug,this.mime=i.mime,this.maxSize=i.maxSize,this.markTextList=i.markTextList,this.closeBtnTxt=i.closeBtnTxt,this.saveBtnTxt=i.saveBtnTxt,this.resetBtnTxt=i.resetBtnTxt,this.confirmBtnTxt=i.confirmBtnTxt,this.cancelBtnTxt=i.cancelBtnTxt,this.rotateMenuTxt=i.rotateMenuTxt,this.turnLeftTxt=i.turnLeftTxt,this.turnRightTxt=i.turnRightTxt,this.cropMenuTxt=i.cropMenuTxt,this.scaleMenuTxt=i.scaleMenuTxt,this.markMenuTxt=i.markMenuTxt,this.colorTxt=i.colorTxt,this.positionTxt=i.positionTxt,this.opacityTxt=i.opacityTxt,this.showRoomTxt=i.showRoomTxt,this.companyNameTxt=i.companyNameTxt,this.markAllMenuTxt=i.markAllMenuTxt,this.tipTitleTxt=i.tipTitleTxt,this.tipContentTxt=i.tipContentTxt,this.tipConfirmBtnTxt=i.tipConfirmBtnTxt,this.onInited=i.onInited,this.onComplete=i.onComplete,this.resultList=[],this.sourceImgList=[],this.returnJson=[],this.methods=[],this.activeIndex=0,this.isSaveAll=!1,this.finishedNum=0,this._init()}return function(t,i,e){i&&r(t.prototype,i),e&&r(t,e)}(t,[{key:"_init",value:function(){var t=this;this.returnJson=this.source;var i=this.source.map(function(t,i){return t.url});Object(a.g)(i,function(i){t.sourceImgList=i,t.imgHandler=new n.a({sourceImg:i[0]}),t.resultList.push(t.imgHandler.result),t.dialog=new s.a({imgList:i,mime:t.mime,markTextList:t.markTextList,closeBtnTxt:t.closeBtnTxt,saveBtnTxt:t.saveBtnTxt,resetBtnTxt:t.resetBtnTxt,confirmBtnTxt:t.confirmBtnTxt,cancelBtnTxt:t.cancelBtnTxt,rotateMenuTxt:t.rotateMenuTxt,turnLeftTxt:t.turnLeftTxt,turnRightTxt:t.turnRightTxt,cropMenuTxt:t.cropMenuTxt,scaleMenuTxt:t.scaleMenuTxt,markMenuTxt:t.markMenuTxt,colorTxt:t.colorTxt,positionTxt:t.positionTxt,opacityTxt:t.opacityTxt,showRoomTxt:t.showRoomTxt,companyNameTxt:t.companyNameTxt,markAllMenuTxt:t.markAllMenuTxt,tipTitleTxt:t.tipTitleTxt,tipContentTxt:t.tipContentTxt,tipConfirmBtnTxt:t.tipConfirmBtnTxt,onSaveRotate:function(i,e){t._saveRotate(i,e)},onSaveCrop:function(i,e){t._saveCrop(i,e)},onSaveScale:function(i,e){t._saveScale(i,e)},onSaveMark:function(i,e){t._saveMark(i,e)},onReset:function(i){t._reset(i)},onSave:function(i){t._save(i)},onChangeActive:function(i,e){t._changeActive(i,e)},onSaveMarkAll:function(i,e){t._saveMarkAll(i,e)}}),t.onInited(),t._executeMethods()},function(){throw new Error("PipeImg: source load failure!")})}},{key:"_saveRotate",value:function(t,i){this.imgHandler.rotateNum=t.rotateNum,this.imgHandler.rotate(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveCrop",value:function(t,i){this.imgHandler.cropW=t.cropW,this.imgHandler.cropH=t.cropH,this.imgHandler.sx=t.sx,this.imgHandler.sy=t.sy,this.imgHandler.crop(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveScale",value:function(t,i){this.imgHandler.scaleRatio=t.scaleRatio,this.imgHandler.scale(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveMark",value:function(t,i){this.imgHandler.markX=t.markX,this.imgHandler.markY=t.markY,this.imgHandler.markText=t.markText,this.imgHandler.markFont=t.markFont,this.imgHandler.markStyle=t.markStyle,this.imgHandler.mark(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_reset",value:function(t){this.rotateNum=0,this.scaleRatio=1,this.resultList=this.resultList.slice(0,1),this.imgHandler=new n.a({sourceImg:this.resultList[0]}),t(this.resultList[0])}},{key:"_save",value:function(t,i){var e=this;i=void 0===i?this.activeIndex:i;var n=1024*this.maxSize,s=Object(a.c)(this.resultList[this.resultList.length-1],n,!1);if(this.debug){var o=[{picHeight:1024,picWidth:768,tempPhotoId:"5675810",url:s}],r=new Image;r.src=o[0].url,this.resultList=[r],t(o[0]),this._saveSuccess(o[0],i)}else{var l=Object(a.a)(s,this.mime);"formdata"===this.sendDataType&&(l=Object(a.b)(l)),$.ajax({url:this.uploadUrl,type:"POST",data:l,processData:!1,contentType:!1,success:function(a){var n=new Image;n.src=a[0].url,e.resultList=[n],t(a[0]),e._saveSuccess(a[0],i)},error:function(){console.log("upload failure!")}})}}},{key:"_saveSuccess",value:function(t,i){var e={id:t.tempPhotoId,url:t.url,picWidth:t.picWidth,picHeight:t.picHeight};this.returnJson[i]=e,this.isSaveAll?(this.finishedNum++,this.finishedNum===this.sourceImgList.length&&this.onComplete(this.returnJson)):this.onComplete(this.returnJson)}},{key:"_saveMarkAll",value:function(t,i){var e=this;this.isSaveAll=!0;var a=t.markX/this.resultList[this.resultList.length-1].width,s=t.markY/this.resultList[this.resultList.length-1].height;console.log(this.sourceImgList),$(this.sourceImgList).each(function(o,r){var l=new n.a({sourceImg:r});l.markX=r.width*a,l.markY=r.height*s,l.markText=t.markText,l.markFont=t.markFont,l.markStyle=t.markStyle,l.mark(),e.resultList.push(l.result),e._save(i,o)})}},{key:"_changeActive",value:function(t,i){this.activeIndex=t.activeIndex,this.imgHandler=new n.a({sourceImg:t.activeImg}),this.resultList=[this.imgHandler.result],i(this.imgHandler.result)}},{key:"show",value:function(t){this.methods.push({name:"show",params:t})}},{key:"_show",value:function(t){"1"===this.type?this.dialog.showModel(this.type):t&&t.selected&&this.dialog.showSource(t.selected)}},{key:"_executeMethods",value:function(){var t=this;this.methods.forEach(function(i){t["_"+i.name](i.params)}),this.methods=[]}}]),t}()}])});
//# sourceMappingURL=pipeImg.thin.min.js.map