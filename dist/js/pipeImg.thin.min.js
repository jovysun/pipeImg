!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i(require("jQuery"),require("template"));else if("function"==typeof define&&define.amd)define(["jQuery","template"],i);else{var e="object"==typeof exports?i(require("jQuery"),require("template")):i(t.jQuery,t.template);for(var a in e)("object"==typeof exports?exports:t)[a]=e[a]}}(window,function(t,i){return function(t){var i={};function e(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}return e.m=t,e.c=i,e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(a,n,function(i){return t[i]}.bind(null,n));return a},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=4)}([function(i,e){i.exports=t},function(t,e){t.exports=i},function(t,i){t.exports='<div class="pipeImg-wrapper J-pipe-wrapper">\r\n    <div class="pipeImg-header">\r\n        <ul class="pipeImg-menu">\r\n            <li class="pipeImg-item J-item active"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-refresh"></i>{{=rotateMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-crop"></i>{{=cropMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item"><a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-scaling"></i>{{=scaleMenuTxt}}</a></li>\r\n            <li class="pipeImg-item J-item J-item-mark">\r\n                <a class="pipeImg-btn J-menu-btn" href="javascript:void(0)"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</a>\r\n                <div class="pipeImg-btn J-menu-txt" style="display:none;"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</div>\r\n                <div class="pipeImg-item item-sub">\r\n                    <a class="pipeImg-btn J-menu-btn-mark-all" href="javascript:void(0)"><i class="ob-icon icon-batch"></i>{{=markAllMenuTxt}}</a>\r\n                    <a class="pipeImg-btn J-menu-btn-mark" href="javascript:void(0)" style="display:none;"><i class="ob-icon icon-add-l"></i>{{=markMenuTxt}}</a>\r\n                </div>\r\n            </li>\r\n        </ul>\r\n        <a class="pipeImg-btn btn-close J-button-close" href="javascript:void(0)"><i class="ob-icon icon-delete"></i>{{=closeBtnTxt}}</a>\r\n    </div>\r\n    <div class="pipeImg-content">\r\n        \x3c!-- 旋转面板 --\x3e\r\n        <div class="pipeImg-panel rotate-panel active J-panel J-rotate-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[activeIndex].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="size">\r\n                    <span class="J-num-width"></span>*<span class="J-num-height"></span>px\r\n                </div>\r\n                <a class="pipeImg-btn btn-rotate J-btn-rotate-left" href="javascript:void(0)"><i class="ob-icon icon-rotate-l"></i>{{=turnLeftTxt}}</a>\r\n                <a class="pipeImg-btn btn-rotate J-btn-rotate-right" href="javascript:void(0)"><i class="ob-icon icon-rotate-r"></i>{{=turnRightTxt}}</a>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        \x3c!-- 裁剪面板 --\x3e\r\n        <div class="pipeImg-panel J-panel J-crop-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[activeIndex].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <input class="num-width J-num-width" type="text">\r\n                <input class="J-fix-ratio" id="fixRatio" type="checkbox" name="fixRatio" hidden>\r\n                <label class="fix" for="fixRatio"><i class="ob-icon icon-lock"></i></label>\r\n                <input class="num-height J-num-height" type="text">\r\n                <span class="txt">px</span>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 缩放面板 --\x3e\r\n        <div class="pipeImg-panel scale-panel J-panel J-scale-panel">\r\n            <div class="img-box J-img-box">\r\n                <div class="scale-img-wrapper J-scale-img-wrapper">\r\n                    <img class="J-source" src="{{-imgList[activeIndex].src}}">\r\n                </div>\r\n            </div>\r\n            <div class="content-footer">\r\n                <input class="num-width J-num-width" type="text">\r\n                <span class="txt">X</span>\r\n                <input class="num-height J-num-height" type="text">\r\n                <span class="txt">px</span>\r\n                <input class="scale-range J-scale-range" type="range" name="scaleRatio" min="5" max="100" step="1" defaultValue="100" value="100">\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-main J-button-save" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-reset J-button-reset" href="javascript:void(0)">{{=resetBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 添加水印面板 --\x3e\r\n        <div class="pipeImg-panel J-panel J-mark-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[activeIndex].src}}">\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=colorTxt}}:</div> \r\n                    <input class="J-color" id="colorWhite" type="radio" name="color" value="0" autocomplete="off" hidden>        \r\n                    <label class="color" for="colorWhite"></label>\r\n                    <input class="J-color" id="colorBlack" type="radio" name="color" value="1" checked autocomplete="off" hidden>\r\n                    <label class="color color-black" for="colorBlack"></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=positionTxt}}:</div>\r\n                    <input class="J-position" id="positionCenter" type="radio" name="position" value="0" autocomplete="off" checked hidden>\r\n                    <label class="position center" for="positionCenter"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftTop" type="radio" name="position" value="1" autocomplete="off" hidden>\r\n                    <label class="position left-top" for="positionLeftTop"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightTop" type="radio" name="position" value="2" autocomplete="off" hidden>\r\n                    <label class="position right-top" for="positionRightTop"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftBottom" type="radio" name="position" value="3" autocomplete="off" hidden>\r\n                    <label class="position left-bottom" for="positionLeftBottom"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightBottom" type="radio" name="position" value="4" autocomplete="off" hidden>\r\n                    <label class="position right-bottom" for="positionRightBottom"><span class="line"></span></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=opacityTxt}}:</div>\r\n                    <input class="opacity-range J-opacity" name="opacity" type="range" min="10" max="100" step="1" defaultValue="80" value="80">\r\n                </div>\r\n\r\n                <select class="J-select-mark" name="markTxt">\r\n                    <option value="0" selected="selected">{{=showRoomTxt}}</option>\r\n                    <option value="1">{{=companyNameTxt}}</option>\r\n                </select>\r\n\r\n                <div class="pipeImg-buttons">\r\n                    <a class="pipeImg-button button-confirm J-button-confirm" href="javascript:void(0)">{{=confirmBtnTxt}}</a>\r\n                    <a class="pipeImg-button button-cancel J-button-cancel" href="javascript:void(0)">{{=cancelBtnTxt}}</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n        \x3c!-- 批量添加水印 --\x3e\r\n        <div class="pipeImg-panel panel-mark-all J-panel J-mark-all-panel">\r\n            <div class="img-box J-img-box">\r\n                <img class="J-source" src="{{-imgList[activeIndex].src}}">\r\n            </div>\r\n            <div class="imgs-thumbnail">\r\n                {{ for(var i=0;i<imgList.length;i++) { }} \r\n                <div class="img-thumbnail {{=i === activeIndex ? \'active\' : \'\'}} J-img-thumbnail">\r\n                    <a href="javascript:void(0)">\r\n                        <img src="{{-imgList[i].src}}">\r\n                        <span class="circle"></span>\r\n                    </a>\r\n                </div>\r\n\r\n                {{ } }}\r\n            </div>\r\n            <div class="content-footer">\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=colorTxt}}:</div> \r\n                    <input class="J-color" id="colorWhiteAll" type="radio" name="colorAll" value="0" autocomplete="off" hidden>        \r\n                    <label class="color" for="colorWhiteAll"></label>\r\n                    <input class="J-color" id="colorBlackAll" type="radio" name="colorAll" value="1" checked autocomplete="off" hidden>\r\n                    <label class="color color-black" for="colorBlackAll"></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=positionTxt}}:</div>\r\n                    <input class="J-position" id="positionCenterAll" type="radio" name="positionAll" value="0" autocomplete="off" checked hidden>\r\n                    <label class="position center" for="positionCenterAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftTopAll" type="radio" name="positionAll" value="1" autocomplete="off" hidden>\r\n                    <label class="position left-top" for="positionLeftTopAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightTopAll" type="radio" name="positionAll" value="2" autocomplete="off" hidden>\r\n                    <label class="position right-top" for="positionRightTopAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionLeftBottomAll" type="radio" name="positionAll" value="3" autocomplete="off" hidden>\r\n                    <label class="position left-bottom" for="positionLeftBottomAll"><span class="line"></span></label>\r\n                    <input class="J-position" id="positionRightBottomAll" type="radio" name="positionAll" value="4" autocomplete="off" hidden>\r\n                    <label class="position right-bottom" for="positionRightBottomAll"><span class="line"></span></label>\r\n                </div>\r\n                <div class="pipeImg-item">\r\n                    <div class="txt-label">{{=opacityTxt}}:</div>\r\n                    <input class="opacity-range J-opacity" name="opacityAll" type="range" min="10" max="100" step="1" defaultValue="80" value="80">\r\n                </div>\r\n\r\n                <select class="J-select-mark" name="markTxtAll">\r\n                    <option value="0" selected="selected">{{=showRoomTxt}}</option>\r\n                    <option value="1">{{=companyNameTxt}}</option>\r\n                </select>\r\n                \r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n    <div class="pipeImg-footer J-pipe-footer">\r\n        <div class="imgs-thumbnail">\r\n            {{ for(var i=0;i<imgList.length;i++) { }} \r\n            <div class="img-thumbnail {{=i === activeIndex ? \'active\' : \'\'}} J-img-thumbnail">\r\n                <div class="img-inner">\r\n                    <a href="javascript:void(0)">\r\n                    <img src="{{-imgList[i].src}}">\r\n                    <span class="circle"></span>\r\n                    </a>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            {{ } }}\r\n        </div>  \r\n\r\n        <div class="pipeImg-buttons">\r\n            <a class="pipeImg-button button-confirm J-button-confirm-all" href="javascript:void(0)">{{=saveBtnTxt}}</a>\r\n            <a class="pipeImg-button button-cancel J-button-cancel-all" href="javascript:void(0)">{{=cancelBtnTxt}}</a>\r\n        </div>            \r\n    </div>\r\n\r\n</div>\r\n\r\n<div class="pipeImg-tip J-pipeImg-tip">\r\n    <div class="pipeImg-tip-header">{{=tipTitleTxt}}</div>\r\n    <div class="pipeImg-tip-main">\r\n        <div class="pipeImg-tip-content">{{=tipContentTxt}}</div>\r\n        <a class="pipeImg-button button-confirm J-tip-confirm" href="javascript:void(0)">{{=tipConfirmBtnTxt}}</a>\r\n        <a class="pipeImg-button button-cancel J-tip-cancel" href="javascript:void(0)">{{=cancelBtnTxt}}</a>        \r\n    </div>\r\n</div>\r\n\r\n<div class="pipeImg-progress-bar J-pipeImg-progress">\r\n    <div class="pipeImg-progress-val"></div>\r\n</div>'},function(t,i){t.exports='<div class="thin-select">\n\t<div class="select-title J-select-title">\n\t\t<div class="select-selected">\n\t\t\t<span class="J-text">{{=txt}}</span>\n\t\t</div>\n\t\t<div class="select-arrow J-arrow">\n\t\t\t<i class="ob-icon icon-down"></i>\n\t\t</div>\n\t</div>\n\t<div class="select-list J-select-list">\n\t\t<ul class="select-list-wrap J-select-tab-cnt">\n\t\t\t{{ for(var i=0; i < optionList.length; i++) { }} \n\t\t\t\t<li>\n\t\t\t\t\t<a href="javascript:void(0)" class="select-opt J-opt {{=optionList[i].selected ? \'selected\' : \'\'}}" data-val="{{=optionList[i].val}}">{{=optionList[i].txt}}</a>\n\t\t\t\t</li>\n\t\t\t{{ } }}\n\t\t</ul>\n\t</div>\n</div>\n'},function(t,i,e){"use strict";e.r(i);var a=e(0),n=e.n(a);function s(t,i,e,a){if(t){i=i||t;var n,s,o,r,l,c,h=!1;window.addEventListener&&(i.addEventListener("mousedown",function(i){i=i||window.event,n=i.clientX,s=i.clientY,o=t.offsetLeft,r=t.offsetTop,h=!0},!1),document.addEventListener("mousemove",function(i){if(i=i||window.event,h){var p=i.clientX,u=i.clientY;if(l=p-n+o,c=u-s+r,e){var d=e.clientWidth-t.offsetWidth,m=e.clientHeight-t.offsetHeight;l=Math.min(Math.max(0,l),d),c=Math.min(Math.max(0,c),m)}t.style.left=l+"px",t.style.top=c+"px","function"==typeof a&&a(l,c)}},!1),document.addEventListener("mouseup",function(t){h=!1},!1))}}function o(t,i){var e=document.createElement("canvas");return e.width=t,e.height=i,e}function r(t){var i=t.replace(/^data:image\/[\w]*;base64,$/,""),e=i.indexOf("=");e>0&&(i=i.substring(0,e));var a=i.length;return parseInt(a-a/8*2)}function l(){return(l=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function c(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var h=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=l({},{sourceImg:null,rotateNum:0,cropW:"",cropH:"",mime:"image/jpeg",hasMark:!0,textAlign:"start",markFont:"16px microsoft yahei",markStyle:"#fff",markText:"UED",markX:0,markY:0,maxSize:500,qualityStep:.1},i),this.sourceImg=i.sourceImg,this.rotateNum=i.rotateNum,this.maxSize=i.maxSize,this.cropW=i.cropW,this.cropH=i.cropH,this.mime=i.mime,this.qualityStep=i.qualityStep,this.hasMark=i.hasMark,this.textAlign=i.textAlign,this.markFont=i.markFont,this.markStyle=i.markStyle,this.markText=i.markText,this.markX=i.markX,this.markY=i.markY,this.sx=0,this.sy=0,this.scaleRatio=1,this.results=[],this.init()}return function(t,i,e){i&&c(t.prototype,i),e&&c(t,e)}(t,[{key:"init",value:function(){var t=this.sourceImg;t.width,t.height;if("img"===t.nodeName.toLowerCase()){var i=o(t.naturalWidth,t.naturalHeight);i.getContext("2d").drawImage(t,0,0),t=i}this.result=t,this.results.push(this.result)}},{key:"reset",value:function(){this.rotateNum=0,this.scaleRatio=1,this.results=this.results.slice(0,1)}},{key:"rollback",value:function(){this.results.pop()}},{key:"rotate",value:function(){var t=this.result,i=t.width,e=t.height,a=90*this.rotateNum,n=Math.max(i,e),s=o(n,n),r=s.getContext("2d");r.translate(n/2,n/2),r.rotate(a*Math.PI/180),r.translate(-n/2,-n/2),r.drawImage(t,0,0);var l=i,c=e,h=0,p=0;1===this.rotateNum?(c=i,h=n-(l=e),p=0):2===this.rotateNum?(h=n-(l=i),p=n-(c=e)):3===this.rotateNum?(l=e,h=0,p=n-(c=i)):(l=i,c=e,h=0,p=0);var u=o(l,c);return u.getContext("2d").drawImage(s,h,p,l,c,0,0,l,c),this.result=u,this.results.push(u),this}},{key:"mark",value:function(){var t=this.result,i=o(t.width,t.height),e=i.getContext("2d");return e.drawImage(t,0,0),this.hasMark&&(e.textBaseline="top",e.textAlign=this.textAlign,e.font=this.markFont,e.fillStyle=this.markStyle,e.fillText(this.markText,this.markX,this.markY)),this.result=i,this.results.push(i),this}},{key:"crop",value:function(){var t=this.result,i=o(this.cropW,this.cropH);return i.getContext("2d").drawImage(t,this.sx,this.sy,this.cropW,this.cropH,0,0,this.cropW,this.cropH),this.result=i,this.results.push(i),this}},{key:"scale",value:function(){var t=this.result,i=t.width,e=t.height,a=this.scaleRatio*i,n=this.scaleRatio*e,s=o(a,n);return s.getContext("2d").drawImage(t,0,0,i,e,0,0,a,n),this.result=s,this.results.push(s),this}},{key:"compress",value:function(t){var i=this.result,e=1024*this.maxSize,a=1,n=this.qualityStep,s=i.toDataURL("image/jpeg",1),o=r(s);if(t)for(;o>e;)a=Math.floor(e/o*10)/10,o=r(s=i.toDataURL("image/jpeg",a));else for(;o>e;)a-=n,o=r(s=i.toDataURL("image/jpeg",a));var l=function(t,i){var e=atob(t.split(",")[1]),a=e.length,n=new Uint8Array(a);i||(i=t.substring(t.indexOf("data:")+5,t.indexOf(";base64")));for(var s=0;s<a;s++)n[s]=e.charCodeAt(s);return new Blob([n],{type:i})}(s,this.mime);return{base64:s,blob:l,formdata:function(t,i){var e=new FormData;return e.append("file",t),i||(i=(new Date).getTime()),e.append("fileName",i),e}(l)}}}]),t}(),p=e(1),u=e.n(p);function d(){return(d=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function m(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var f=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);i=d({},{el:"",width:"100%",height:"100%",markText:"producttest.en.made-in-china.com",isCrop:!1,fixRatio:!1,onDragPoint:function(t){},onDragComplete:function(t,i){}},i),this.el=i.el,this.width=i.width,this.height=i.height,this.markText=i.markText,this.isCrop=i.isCrop,this.fixRatio=i.fixRatio,this.onDragPoint=i.onDragPoint,this.onDragComplete=i.onDragComplete,this.init()}return function(t,i,e){i&&m(t.prototype,i),e&&m(t,e)}(t,[{key:"init",value:function(){var t=this;this.$el=n()(this.el);var i=this.$el.attr("src"),e=this.$el.parent(),a='<div class="dragbox-wrapper J-dragbox-wrapper">\n                                <img class="J-source" src="'.concat(i,'">\n                                <div class="drag-box J-drag-box">\n                                    <div class="drag-point up-left J-drag-point"></div>\n                                    <div class="drag-point up J-drag-point"></div>\n                                    <div class="drag-point up-right J-drag-point"></div>\n                                    <div class="drag-point right J-drag-point"></div>\n                                    <div class="drag-point right-down J-drag-point"></div>\n                                    <div class="drag-point down J-drag-point"></div>\n                                    <div class="drag-point left-down J-drag-point"></div>\n                                    <div class="drag-point left J-drag-point"></div>\n                                    <div class="mark-txt J-mark-txt">').concat(this.markText,"</div>\n                                </div>\n                            </div>");this.isCrop&&(a='<div class="dragbox-wrapper J-dragbox-wrapper">\n                                <img class="J-source img-dark" src="'.concat(i,'">\n                                <img class="J-source img-light J-img-light" src="').concat(i,'">\n                                <div class="drag-box J-drag-box">\n                                    <div class="drag-point up-left J-drag-point"></div>\n                                    <div class="drag-point up J-drag-point"></div>\n                                    <div class="drag-point up-right J-drag-point"></div>\n                                    <div class="drag-point right J-drag-point"></div>\n                                    <div class="drag-point right-down J-drag-point"></div>\n                                    <div class="drag-point down J-drag-point"></div>\n                                    <div class="drag-point left-down J-drag-point"></div>\n                                    <div class="drag-point left J-drag-point"></div>\n                                </div>\n                            </div>')),e.html(a),this.$dragBox=e.find(".J-drag-box"),this.isCrop||this.$dragBox.css({width:this.$dragBox.find(".J-mark-txt").width(),height:this.$dragBox.find(".J-mark-txt").height()}),this.$dragPoint=this.$dragBox.find(".J-drag-point"),this.boxEl=this.$dragBox.get(0),this.containerEl=this.boxEl.parentNode,this.imgLight=e.find(".J-img-light:first").get(0),this.boxData={left:this.boxEl.offsetLeft,top:this.boxEl.offsetTop,width:this.boxEl.offsetWidth,height:this.boxEl.offsetHeight,ratio:this.boxEl.offsetWidth/this.boxEl.offsetHeight},this._bind();var o=this.isCrop?this.boxEl.parentNode:null;s(this.boxEl,this.boxEl,o,function(i,e){t._light(),t.onDragComplete(i,e)})}},{key:"_bind",value:function(){var t=this,i=!1,e="",a=["up-left","up","up-right","right","right-down","down","left-down","left"],s=this.boxData.width/this.boxData.height;this.$dragPoint.on("mousedown",function(o){o.stopPropagation(),i=!0;var r=n()(o.target).index();e=a[r],s=t.boxData.width/t.boxData.height}),n()(document).on("mouseup",function(e){i=!1,t.boxData={left:t.boxEl.offsetLeft,top:t.boxEl.offsetTop,width:t.boxEl.offsetWidth,height:t.boxEl.offsetHeight,ratio:t.boxEl.offsetWidth/t.boxEl.offsetHeight}}),n()(document).on("mousemove",function(a){1==i&&(t._move(a,e,s),t._light(),t.boxData={left:t.boxEl.offsetLeft,top:t.boxEl.offsetTop,width:t.boxEl.offsetWidth,height:t.boxEl.offsetHeight,ratio:t.boxEl.offsetWidth/t.boxEl.offsetHeight},t.onDragPoint(t.boxData))})}},{key:"_getPosition",value:function(){for(var t=this.boxEl,i=t.offsetLeft,e=t.offsetTop,a=t.offsetParent;null!=a;)i+=a.offsetLeft,e+=a.offsetTop,a=a.offsetParent;return{left:i,top:e}}},{key:"_move",value:function(t,i,e){var a,n,s,o,r,l,c=t.clientX,h=t.clientY,p=this.boxEl.offsetWidth,u=this.boxEl.offsetHeight,d=this._getPosition(),m=d.top,f=d.left;if(-1!=i.indexOf("left")){var v=f-c;if(this.isCrop&&v>=0&&this.boxEl.offsetLeft<=0)return!1;a=p+v,s=this.boxEl.offsetLeft-v}if(-1!=i.indexOf("right")){var g=c-f-p;if(this.isCrop&&g>=0&&this.containerEl.clientWidth-(this.boxEl.offsetLeft+p+g)<=0)return!1;a=p+g,s=this.boxEl.offsetLeft}if(-1!=i.indexOf("up")&&(this.fixRatio?r=(n=Math.round(a/e))-u:n=u+(r=m-h),o=this.boxEl.offsetTop-r,this.isCrop&&r>=0&&this.boxEl.offsetTop<=0))return!1;if(-1!=i.indexOf("down")&&(this.fixRatio?(l=(n=Math.round(a/e))-u,o=this.boxEl.offsetTop):n=u+(l=h-m-u),this.isCrop&&l>=0&&this.containerEl.clientHeight-(this.boxEl.offsetTop+u+l)<=0))return!1;this.isCrop&&(a=Math.min(a,this.containerEl.offsetWidth),n=Math.min(n,this.containerEl.offsetHeight),s=Math.max(s,0),o=Math.max(o,0)),this.boxEl.style.width=a+"px",this.boxEl.style.height=n+"px",this.boxEl.style.left=s+"px",this.boxEl.style.top=o+"px"}},{key:"_light",value:function(){this.isCrop&&this._setChoice()}},{key:"_setChoice",value:function(){var t=this.boxEl.offsetTop,i=this.boxEl.offsetLeft+this.boxEl.offsetWidth,e=this.boxEl.offsetTop+this.boxEl.offsetHeight,a=this.boxEl.offsetLeft;this.imgLight.style.clip="rect("+t+"px,"+i+"px,"+e+"px,"+a+"px)"}},{key:"update",value:function(){this.$dragBox.css({width:this.width,height:this.height})}}]),t}(),v=e(2),g=e.n(v),x=e(3),b=e.n(x);function k(){return(k=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function T(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var J=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=k({},{el:"",template:b.a},i),this.el=i.el,this.template=i.template,this.$el=n()(this.el),this.selectObj={txt:"",optionsObj:[]},this._init()}return function(t,i,e){i&&T(t.prototype,i),e&&T(t,e)}(t,[{key:"_init",value:function(){var t=this;this.$el.find("option").each(function(i,e){var a=n()(e),s=a.prop("selected"),o=a.val(),r=a.text(),l={val:o,txt:r,selected:s};s&&(t.selectObj.txt=r),t.selectObj.optionsObj.push(l)});var i=u()(this.template,{txt:this.selectObj.txt,optionList:this.selectObj.optionsObj});this.$el.hide(),n()(i).insertBefore(this.$el),this.$thinSelect=this.$el.prev(),this._bind()}},{key:"_bind",value:function(){var t=this;this.$thinSelect.find(".J-select-title").on("click",function(i){i.stopPropagation();var e=t.$thinSelect.find(".J-select-list");e.is(":visible")?(e.hide(),t.$thinSelect.find(".J-arrow").removeClass("active")):(e.show(),t.$thinSelect.find(".J-arrow").addClass("active"))}),this.$thinSelect.find(".J-opt").on("click",function(i){i.stopPropagation();var e=n()(i.target).addClass("selected").text();t.$thinSelect.find(".J-text").text(e),t.$thinSelect.find(".J-select-list").hide(),t.$thinSelect.find(".J-arrow").removeClass("active"),t.$activeItem=n()(i.target).parent(),t.$activeItem.siblings().find(".J-opt").removeClass("selected"),t._updateSource()}),n()(document).on("click.thinSelect",function(i){t.$thinSelect.find(".J-select-list").hide(),t.$thinSelect.find(".J-arrow").removeClass("active")})}},{key:"_updateSource",value:function(){var t=this.$activeItem.index();this.$el.find("option").eq(t).prop("selected",!0),this.$el.trigger("change")}},{key:"destroy",value:function(){n()(document).off("click.thinSelect"),this.$thinSelect.remove()}},{key:"select",value:function(t){var i=this.$thinSelect.find(".J-opt").parent().eq(t);i.siblings().find(".J-opt").removeClass("selected");var e=i.find(".J-opt").addClass("selected").text();this.$thinSelect.find(".J-text").text(e)}}]),t}();J.use=function(t){if(!t)throw new Error("ThinSelect: el is not found!");var i=[];return n()(t).each(function(t,e){var a=new J({el:e});i.push(a)}),i};var y=J;function $(){return($=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function w(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var M=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),i=$({},{debug:!1,imgList:[],activeIndex:0,type:"0",template:g.a,mime:"image/jpeg",markTextList:["producttest.en.made-in-china.com","Focus Service Co - Product Sourcing"],closeBtnTxt:"关闭",saveBtnTxt:"保存",resetBtnTxt:"重置",confirmBtnTxt:"确定",cancelBtnTxt:"取消",rotateMenuTxt:"旋转",turnLeftTxt:"逆时针旋转",turnRightTxt:"顺时针旋转",cropMenuTxt:"裁剪",scaleMenuTxt:"缩放",markMenuTxt:"添加水印",colorTxt:"颜色",positionTxt:"位置",opacityTxt:"透明度",showRoomTxt:"展示厅",companyNameTxt:"公司名称",markAllMenuTxt:"批量添加水印",tipTitleTxt:"提示",tipContentTxt:"尚未保存，是否确定离开？",tipConfirmBtnTxt:"确定",onSaveRotate:function(t,i){},onSaveCrop:function(t,i){},onSaveScale:function(t,i){},onSaveMark:function(t,i){},onReset:function(t){},onSave:function(t){},onChangeActive:function(t,i){},onSaveMarkAll:function(t){},onComplete:function(t){}},i),this.debug=i.debug,this.imgList=i.imgList,this.activeIndex=i.activeIndex,this.type=i.type,this.template=i.template,this.mime=i.mime,this.markTextList=i.markTextList,this.closeBtnTxt=i.closeBtnTxt,this.saveBtnTxt=i.saveBtnTxt,this.resetBtnTxt=i.resetBtnTxt,this.confirmBtnTxt=i.confirmBtnTxt,this.cancelBtnTxt=i.cancelBtnTxt,this.rotateMenuTxt=i.rotateMenuTxt,this.turnLeftTxt=i.turnLeftTxt,this.turnRightTxt=i.turnRightTxt,this.cropMenuTxt=i.cropMenuTxt,this.scaleMenuTxt=i.scaleMenuTxt,this.markMenuTxt=i.markMenuTxt,this.colorTxt=i.colorTxt,this.positionTxt=i.positionTxt,this.opacityTxt=i.opacityTxt,this.showRoomTxt=i.showRoomTxt,this.companyNameTxt=i.companyNameTxt,this.markAllMenuTxt=i.markAllMenuTxt,this.tipTitleTxt=i.tipTitleTxt,this.tipContentTxt=i.tipContentTxt,this.tipConfirmBtnTxt=i.tipConfirmBtnTxt,this.onSaveRotate=i.onSaveRotate,this.onSaveCrop=i.onSaveCrop,this.onSaveScale=i.onSaveScale,this.onSaveMark=i.onSaveMark,this.onReset=i.onReset,this.onSave=i.onSave,this.onChangeActive=i.onChangeActive,this.onSaveMarkAll=i.onSaveMarkAll,this.onComplete=i.onComplete,this._init()}return function(t,i,e){i&&w(t.prototype,i),e&&w(t,e)}(t,[{key:"_init",value:function(){var t=this,i='<div class="pipeImg-dialog J-pipe-dialog" onselectstart="return false" ondragstart="return false"><div class="pipe-mask J-pipe-mask"></div>'+u()(this.template,{imgList:this.imgList,activeIndex:this.activeIndex,type:this.type,closeBtnTxt:this.closeBtnTxt,saveBtnTxt:this.saveBtnTxt,resetBtnTxt:this.resetBtnTxt,confirmBtnTxt:this.confirmBtnTxt,cancelBtnTxt:this.cancelBtnTxt,rotateMenuTxt:this.rotateMenuTxt,turnLeftTxt:this.turnLeftTxt,turnRightTxt:this.turnRightTxt,cropMenuTxt:this.cropMenuTxt,scaleMenuTxt:this.scaleMenuTxt,markMenuTxt:this.markMenuTxt,colorTxt:this.colorTxt,positionTxt:this.positionTxt,opacityTxt:this.opacityTxt,showRoomTxt:this.showRoomTxt,companyNameTxt:this.companyNameTxt,markAllMenuTxt:this.markAllMenuTxt,tipTitleTxt:this.tipTitleTxt,tipContentTxt:this.tipContentTxt,tipConfirmBtnTxt:this.tipConfirmBtnTxt})+"</div>";n()("body").append(i),this.$el=n()(".J-pipe-dialog"),this.$pipeWrapper=this.$el.find(".J-pipe-wrapper"),this.$btnClose=this.$el.find(".J-button-close"),this.$btnSave=this.$el.find(".J-button-save"),this.$btnReset=this.$el.find(".J-button-reset"),this.$btnConfirm=this.$el.find(".J-button-confirm"),this.$btnCancel=this.$el.find(".J-button-cancel"),this.$btnSaveAll=this.$el.find(".J-button-confirm-all"),this.$btnCancelAll=this.$el.find(".J-button-cancel-all"),this.$rotatePanel=this.$el.find(".J-rotate-panel"),this.$txtRotateWidth=this.$rotatePanel.find(".J-num-width"),this.$txtRotateHeight=this.$rotatePanel.find(".J-num-height"),this.$btnRotateLeft=this.$el.find(".J-btn-rotate-left"),this.$btnRotateRight=this.$el.find(".J-btn-rotate-right");var e=this.$el.find(".J-crop-panel");this.$inputCropWidth=e.find(".J-num-width"),this.$inputCropHeight=e.find(".J-num-height"),this.$radioCropFix=e.find(".J-fix-ratio"),this.$scalePanel=this.$el.find(".J-scale-panel"),this.$inputScaleWidth=this.$scalePanel.find(".J-num-width"),this.$inputScaleHeight=this.$scalePanel.find(".J-num-height"),this.$rangeScaleRatio=this.$scalePanel.find(".J-scale-range"),this.$markPanel=this.$el.find(".J-mark-panel"),this.$radioMarkColor=this.$markPanel.find(".J-color"),this.$radioMarkPosition=this.$markPanel.find(".J-position"),this.$rangeMarkOpacity=this.$markPanel.find(".J-opacity"),this.$selectMarkTxt=this.$markPanel.find(".J-select-mark"),this.$markAllPanel=this.$el.find(".J-mark-all-panel"),this.$radioMarkAllColor=this.$markAllPanel.find(".J-color"),this.$radioMarkAllPosition=this.$markAllPanel.find(".J-position"),this.$rangeMarkAllOpacity=this.$markAllPanel.find(".J-opacity"),this.$selectMarkAllTxt=this.$markAllPanel.find(".J-select-mark"),this.$buttons=this.$el.find(".J-button-save, .J-button-reset, .J-button-confirm, .J-button-cancel, .J-button-confirm-all, .J-button-cancel-all"),this.MARKTYPE={SINGLE:"0",MULTIPLE:"1"},this.isChange=!1,this.rotateNum=0,this.scaleRatio=1,this.imgBoxHeight=this.$el.find(".J-img-box").height(),this.imgBoxWidth=this.$el.find(".J-img-box").width(),this.imgBoxRatio=this.imgBoxWidth/this.imgBoxHeight,this.activeImg=this.imgList[this.activeIndex],this._updateActiveData(),this.cropBox=new f({el:e.find(".J-source"),isCrop:!0,onDragPoint:function(i){t._showSize(i.width*t.activeData.ratio,i.height*t.activeData.ratio),t._updateIsChange(!0)}});var a=this.$scalePanel.find(".J-scale-img-wrapper"),o=this.$scalePanel.find(".J-source").get(0);s(o,o,a.get(0)),this.markBox=new f({el:this.$markPanel.find(".J-source"),fixRatio:!0,markText:this.markTextList[0],onDragComplete:function(i,e){t.$markPanel.find(".J-position").prop("checked",!1),t._updateIsChange(!0)},onDragPoint:function(i){t.$markPanel.find(".J-mark-txt").css({"font-size":Math.round(parseInt(t.markBox.$dragBox.css("height"))/t.markLineHeight0*t.markFontSize0)}),t.markBox.$dragBox.find(".J-mark-txt").css({display:"block"})}}),this.markAllBox=new f({el:this.$markAllPanel.find(".J-source"),fixRatio:!0,markText:this.markTextList[0],onDragComplete:function(i,e){t.$markAllPanel.find(".J-position").prop("checked",!1),t._updateIsChange(!0)},onDragPoint:function(i){t.$markAllPanel.find(".J-mark-txt").css({"font-size":Math.round(parseInt(t.markAllBox.$dragBox.css("height"))/t.markLineHeight0*t.markFontSize0)}),t.markAllBox.$dragBox.find(".J-mark-txt").css({display:"block"})}}),this.type===this.MARKTYPE.MULTIPLE&&this.showModel(this.type),this._refresh(),this.markSelects=y.use(this.$el.find(".J-select-mark")),this._setMarkPosition(),this._setMarkPosition(this.MARKTYPE.MULTIPLE),this.markFontSize0=parseInt(this.$el.find(".J-mark-txt").css("font-size")),this.markLineHeight0=parseInt(this.$el.find(".J-mark-txt").css("line-height")),this._bind()}},{key:"_bind",value:function(){var t=this,i=this;this.$el.find(".J-pipe-footer").on("click",".J-img-thumbnail",function(t){var e=this,a=function(){var t=n()(e);t.addClass("active").siblings().removeClass("active");var a=t.find("img");i.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").attr("src",a.attr("src")),i._updateActiveImg(t.index()),i._goHome(),i._initData()};i.isChange?i._confirm(function(){a(),i._updateIsChange(!1)}):a()}),this.$markAllPanel.on("click",".J-img-thumbnail",function(t){var e=n()(this);e.addClass("active").siblings().removeClass("active");var a=e.find("img");i.$markAllPanel.find(".J-source").attr("src",a.attr("src")),i._updateActiveImg(e.index()),i._setMarkPosition(i.MARKTYPE.MULTIPLE),i._initData()}),this.$el.find(".J-menu-btn").on("click",function(t){var e=this,a=function(){var t=n()(e).parent(),a=t.index(),s=t.parent().find(".active:first").index();if(i.showModel(i.MARKTYPE.SINGLE),i.showMenu(a),i.isChange)switch(s){case 0:i._saveRotate();break;case 1:i._saveCrop();break;case 2:i._saveScale()}1===a&&i._initCrop(),2===a&&i._initScale(),3===a&&i._initMark()};if(i.$markAllPanel.hasClass("active")){var s=i.$el.find(".J-pipe-footer").find(".J-img-thumbnail.active");i._updateActiveImg(s.index())}i.$markAllPanel.hasClass("active")&&i.isChange?i._confirm(function(){a(),i._updateIsChange(!1)}):a()}),this.$el.find(".J-item-mark").on("click",".J-menu-btn-mark",function(i){var e=function(){var i=t.$el.find(".J-pipe-footer").find(".J-img-thumbnail.active");t._updateActiveImg(i.index()),t.showModel(t.MARKTYPE.SINGLE),t.showMenu(3),t._initMark(),t._updateIsChange(!1)};t.isChange?t._confirm(e):e()}),this.$el.find(".J-item-mark").on("click",".J-menu-btn-mark-all",function(i){var e=function(){var i=t.$markAllPanel.find(".J-img-thumbnail.active");t._updateActiveImg(i.index()),t.showModel(t.MARKTYPE.MULTIPLE),t._initMark(t.MARKTYPE.MULTIPLE),t._updateIsChange(!1),t._initData()};t.isChange?t._confirm(e):e()}),this.$btnRotateLeft.on("click",function(){t._getRotateNum(-1),t._updateRotate()}),this.$btnRotateRight.on("click",function(){t._getRotateNum(1),t._updateRotate()}),this.$inputCropWidth.on("input",function(i){var e=parseInt(n()(i.target).val());t.cropBox.width=e/t.activeData.ratio,t.cropBox.fixRatio&&(t.cropBox.height=t.cropBox.width/t.cropBox.boxData.ratio),t._updateCrop()}),this.$inputCropHeight.on("input",function(i){var e=parseInt(n()(i.target).val());t.cropBox.height=e/t.activeData.ratio,t.cropBox.fixRatio&&(t.cropBox.width=t.cropBox.height*t.cropBox.boxData.ratio),t._updateCrop()}),this.$radioCropFix.on("change",function(i){t.cropBox.fixRatio=!t.cropBox.fixRatio}),this.$inputScaleWidth.on("input",function(i){var e=parseInt(n()(i.target).val());e=e>=0?e:0,t.scaleRatio=e/t.activeData.w0,t._updateScale()}),this.$inputScaleHeight.on("input",function(i){var e=parseInt(n()(i.target).val());e=e>=0?e:0,t.scaleRatio=e/t.activeData.h0,t._updateScale()}),this.$rangeScaleRatio.on("change",function(i){var e=n()(i.target),a=parseInt(e.attr("max")),s=parseInt(e.val());t.scaleRatio=s/a,t._updateScale()}),this.$rangeScaleRatio.on("input",function(i){var e=n()(i.target),a=parseInt(e.attr("max")),s=parseInt(e.val());t.scaleRatio=s/a,t._updateScale()}),this.$radioMarkColor.on("change",function(){t._updateMark()}),this.$rangeMarkOpacity.on("input",function(){t._updateMark()}),this.$rangeMarkOpacity.on("change",function(){t._updateMark()}),this.$selectMarkTxt.on("change",function(){t.markBox.$dragBox.find(".J-mark-txt").css({display:"inline-block","font-size":t.markFontSize0}),t._updateMark()}),this.$radioMarkPosition.on("change",function(){t._updateMark()}),this.$radioMarkAllColor.on("change",function(){t._updateMark(t.MARKTYPE.MULTIPLE)}),this.$rangeMarkAllOpacity.on("input",function(){t._updateMark(t.MARKTYPE.MULTIPLE)}),this.$rangeMarkAllOpacity.on("change",function(){t._updateMark(t.MARKTYPE.MULTIPLE)}),this.$selectMarkAllTxt.on("change",function(){t.markAllBox.$dragBox.find(".J-mark-txt").css({display:"inline-block","font-size":t.markFontSize0}),t._updateMark(t.MARKTYPE.MULTIPLE)}),this.$radioMarkAllPosition.on("change",function(){t._updateMark(t.MARKTYPE.MULTIPLE)}),this.$btnConfirm.on("click",function(){t._saveMark()}),this.$btnCancel.on("click",function(){t._cancelMark()}),this.$btnSaveAll.on("click",function(){t._showProgress(),t._saveMarkAll()}),this.$btnCancelAll.on("click",function(){t.isChange?t._confirm(function(){t.destory()}):t.destory()}),this.$btnReset.on("click",function(){t.isChange&&t._reset()}),this.$btnSave.on("click",function(i){if(t.isChange){switch(t._showProgress(),t.$el.find(".J-panel.active").index()){case 0:t._saveRotate();break;case 1:t._saveCrop();break;case 2:t._saveScale()}t._save()}}),this.$btnClose.on("click",function(i){t.isChange?t._confirm(function(){t.destory()}):t.destory()}),this.$el.on("contextmenu",function(i){return t.debug})}},{key:"_goHome",value:function(){this.$el.find(".J-menu-btn").parent(":first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel:first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-item-mark").find(".J-menu-btn").show(),this.$el.find(".J-item-mark").find(".J-menu-txt").hide()}},{key:"_initRotate",value:function(){this.rotateNum=0}},{key:"_updateRotate",value:function(){var t,i;this.$el.find(".J-source").css({transform:"rotate(".concat(90*this.rotateNum,"deg)")}),1===this.rotateNum||3===this.rotateNum?(1/this.activeData.imgRatio<this.imgBoxRatio?(t=Math.min(this.imgBoxHeight,this.activeData.h0),i="auto"):(t="auto",i=Math.min(this.imgBoxWidth,this.activeData.w0)),this.$txtRotateWidth.text(this.activeData.h0),this.$txtRotateHeight.text(this.activeData.w0)):(this.activeData.imgRatio<this.imgBoxRatio?(t="auto",i=Math.min(this.imgBoxHeight,this.activeData.h0)):(t=Math.min(this.imgBoxWidth,this.activeData.w0),i="auto"),this.$txtRotateWidth.text(this.activeData.w0),this.$txtRotateHeight.text(this.activeData.h0)),this.$el.find(".J-source").css({width:t,height:i}),this._updateIsChange(!0)}},{key:"_saveRotate",value:function(){var t=this;if(0===this.rotateNum)return!1;var i={rotateNum:this.rotateNum};this.onSaveRotate(i,function(i){t.rotateNum=0,t.activeImg=i,t._updateActiveData(),t._refresh()})}},{key:"_initCrop",value:function(){this.$radioCropFix.prop("checked",!1),this.cropBox.isFixed=this.$radioCropFix.prop("checked"),this.cropBox.width=this.$inputCropWidth.val()/this.activeData.ratio,this.cropBox.height=this.$inputCropHeight.val()/this.activeData.ratio}},{key:"_updateCrop",value:function(){this.cropBox.update(),this._updateIsChange(!0)}},{key:"_saveCrop",value:function(){var t=this;if(0===this.cropBox.boxData.left&&0===this.cropBox.boxData.top&&this.cropBox.boxData.width===this.activeData.w1&&this.cropBox.boxData.height===this.activeData.h1)return!1;var i={sx:Math.max(this.cropBox.boxData.left*this.activeData.ratio,0),sy:Math.max(this.cropBox.boxData.top*this.activeData.ratio,0),cropW:Math.min(this.cropBox.boxData.width*this.activeData.ratio,this.activeData.w0),cropH:Math.min(this.cropBox.boxData.height*this.activeData.ratio,this.activeData.h0)};this.onSaveCrop(i,function(i){t.activeImg=i,t._updateActiveData(),t._refresh()})}},{key:"_initScale",value:function(){var t,i,e=this.$scalePanel.find(".J-img-box"),a=this.$scalePanel.find(".J-scale-range"),n=this.$scalePanel.find(".J-scale-img-wrapper"),s=e.find(".J-source");t=this.activeData.w0<this.imgBoxWidth?this.imgBoxWidth:this.activeData.w0+(this.activeData.w0-this.imgBoxWidth),i=this.activeData.h0<this.imgBoxHeight?this.imgBoxHeight:this.activeData.h0+(this.activeData.h0-this.imgBoxHeight),n.css({width:t,height:i,"margin-left":-t/2,"margin-top":-i/2}),s.css({position:"absolute",left:(t-this.activeData.w0)/2,top:(i-this.activeData.h0)/2,width:this.activeData.w0,height:this.activeData.h0,"max-width":"none","max-height":"none",cursor:"move"}),a.val(a.attr("defaultValue")),this.scaleRatio=1}},{key:"_updateScale",value:function(){var t=this.scaleRatio,i=this.$rangeScaleRatio,e=this.$inputScaleWidth,a=this.$inputScaleHeight,n=parseInt(i.attr("max"));e.val()!=this.activeData.w0*t&&e.val(this.activeData.w0*t),a.val()!=this.activeData.h0*t&&a.val(this.activeData.h0*t),i.val()!=n*t&&i.val(n*t),this.$el.find(".J-panel").not(".J-mark-all-panel").find(".J-source").css({transform:"scale(".concat(this.scaleRatio,")")}),this._updateIsChange(!0)}},{key:"_saveScale",value:function(){var t=this;if(1===this.scaleRatio)return!1;var i={scaleRatio:this.scaleRatio};this.onSaveScale(i,function(i){t.scaleRatio=1,t.activeImg=i,t._updateActiveData(),t._refresh(),t._initScale()})}},{key:"_setMarkPosition",value:function(t){var i=t===this.MARKTYPE.MULTIPLE?this.$markAllPanel:this.$markPanel,e=t===this.MARKTYPE.MULTIPLE?this.markAllBox.$dragBox:this.markBox.$dragBox,a=e.find(".J-mark-txt"),n=parseInt(e.css("left"))*this.activeData.ratio,s=parseInt(e.css("top"))*this.activeData.ratio,o=i.find(".J-position:checked").val(),r=this.activeData.w1,l=this.activeData.h1,c=a.outerWidth(),h=a.outerHeight();switch(["center","upLeft","upRight","downLeft","downRight"][o]){case"center":n=(r-c)/2*this.activeData.ratio,s=(l-h)/2*this.activeData.ratio;break;case"upLeft":n=15*this.activeData.ratio,s=20*this.activeData.ratio;break;case"upRight":n=(r-c-15)*this.activeData.ratio,s=20*this.activeData.ratio;break;case"downLeft":n=15*this.activeData.ratio,s=(l-h-20)*this.activeData.ratio;break;case"downRight":n=(r-c-15)*this.activeData.ratio,s=(l-h-20)*this.activeData.ratio}e.css({left:Math.floor(n/this.activeData.ratio),top:Math.floor(s/this.activeData.ratio),width:Math.ceil(c),height:Math.ceil(h)})}},{key:"_setMarkStyle",value:function(t){var i=t===this.MARKTYPE.MULTIPLE?this.$markAllPanel:this.$markPanel,e=i.find(".J-mark-txt"),a=i.find(".J-color:checked").val(),n=parseInt(i.find(".J-opacity").val())/parseInt(i.find(".J-opacity").attr("max")),s=i.find(".J-select-mark").val(),o="rgba(255, 255, 255, ".concat(n,")");"1"===a&&(o="rgba(0, 0, 0, ".concat(n,")"));var r=this.markTextList[s];e.text(r).css({color:o})}},{key:"_initMark",value:function(t){var i=t===this.MARKTYPE.MULTIPLE?this.$markAllPanel:this.$markPanel;i.find(".J-color:last").prop("checked",!0),i.find(".J-position:first").prop("checked",!0),i.find(".J-opacity:first").val(i.find(".J-opacity:first").attr("defaultValue")),i.find(".J-select-mark option:first").prop("selected",!0),i.find(".J-mark-txt").css({"font-size":this.markFontSize0+"px"}),t===this.MARKTYPE.MULTIPLE?(this.markSelects[1].select(0),this.markAllBox.$dragBox.find(".J-mark-txt").css({display:"inline-block"})):(this.markSelects[0].select(0),this.markBox.$dragBox.find(".J-mark-txt").css({display:"inline-block"})),this._setMarkStyle(t),this._setMarkPosition(t)}},{key:"_updateMark",value:function(t){this._setMarkStyle(t),this._setMarkPosition(t),this._updateIsChange(!0)}},{key:"_saveMark",value:function(){var t=this,i=this._getMarkParams();this.onSaveMark(i,function(i){t.activeImg=i,t._updateActiveData(),t._refresh(),t._goHome(),t._updateIsChange(!0)})}},{key:"_cancelMark",value:function(){this._goHome()}},{key:"_getMarkParams",value:function(t){var i=t===this.MARKTYPE.MULTIPLE?this.$markAllPanel:this.$markPanel,e=t===this.MARKTYPE.MULTIPLE?this.markAllBox.$dragBox:this.markBox.$dragBox,a=i.find(".J-mark-txt"),n=Math.floor(parseInt(a.css("font-size"))*this.activeData.ratio)+"px / "+Math.floor(parseInt(a.css("line-height"))*this.activeData.ratio)+"px "+a.css("font-family"),s=i.find(".J-opacity"),o=parseInt(s.val())/parseInt(s.attr("max")),r=i.find(".J-color:checked").val(),l="rgba(255, 255, 255, ".concat(o,")");"1"===r&&(l="rgba(0, 0, 0, ".concat(o,")"));var c=i.find(".J-select-mark").val(),h=this.markTextList[c],p=Math.floor(parseInt(e.css("left"))*this.activeData.ratio),u=Math.floor(parseInt(e.css("top"))*this.activeData.ratio),d=i.find(".J-position:checked").val(),m=this.activeData.w1,f=this.activeData.h1,v=a.outerWidth(),g=a.outerHeight();switch(["center","upLeft","upRight","downLeft","downRight"][d]){case"center":p=(m-v)/2*this.activeData.ratio,u=(f-g)/2*this.activeData.ratio;break;case"upLeft":p=15*this.activeData.ratio,u=20*this.activeData.ratio;break;case"upRight":p=(m-v-15)*this.activeData.ratio,u=20*this.activeData.ratio;break;case"downLeft":p=15*this.activeData.ratio,u=(f-g-20)*this.activeData.ratio;break;case"downRight":p=(m-v-15)*this.activeData.ratio,u=(f-g-20)*this.activeData.ratio}return{markX:p,markY:u,markText:h,markFont:n,markStyle:l}}},{key:"_saveMarkAll",value:function(){var t=this,i=0;this.imgList.forEach(function(e,a){t.onChangeActive({activeImg:e,activeIndex:a}),t.activeImg=e,t._updateActiveData();var n=t._getMarkParams(t.MARKTYPE.MULTIPLE);t.onSaveMark(n,function(t){}),t.onSave(function(e){++i===t.imgList.length&&(t._hideProgress(),t.destory(),t._updateIsChange(!1),i=0,t.onComplete(e))},a)})}},{key:"_showSize",value:function(t,i){t=Math.round(t),i=Math.round(i);var e=this.$el.find(".J-num-width"),a=this.$el.find(".J-num-height");e.each(function(i,a){"input"===n()(a).get(0).nodeName.toLowerCase()?e.val(t):e.text(t)}),a.each(function(t,e){"input"===n()(e).get(0).nodeName.toLowerCase()?a.val(i):a.text(i)})}},{key:"_refresh",value:function(){var t="";t="img"===this.activeData.img.nodeName.toLowerCase()?this.activeData.img.src:this.activeData.img.toDataURL(this.mime,1),this.$el.find(".J-img-box").find(".J-source").length>0?this.$el.find(".J-img-box").find(".J-source").attr("src",t):this.$el.find(".J-img-box").append('<img class="J-source" src="'.concat(t,'">')),this.$el.find(".J-source").removeAttr("style"),this.cropBox&&this.cropBox.boxEl.removeAttribute("style"),this.$el.find(".J-img-box").find(".J-source").css({width:this.activeData.w1,height:this.activeData.h1}),this._showSize(this.activeData.w0,this.activeData.h0)}},{key:"_updateActiveData",value:function(){var t=this.activeImg,i=t.width,e=t.height;"img"===t.nodeName.toLowerCase()&&(i=t.naturalWidth,e=t.naturalHeight);var a=i/e,n=e,s=i,o=1;a<this.imgBoxRatio?e>this.imgBoxHeight&&(s=(n=this.imgBoxHeight)*a,o=e/n):i>this.imgBoxWidth&&(n=(s=this.imgBoxWidth)/a,o=i/s),this.activeData={w0:i,h0:e,w1:s,h1:n,ratio:o,imgRatio:a,img:t}}},{key:"_getRotateNum",value:function(t){this.rotateNum+=t,this.rotateNum>3&&(this.rotateNum=0),this.rotateNum<0&&(this.rotateNum=3)}},{key:"_confirm",value:function(t,i){var e=this,a=this.$el.find(".J-pipeImg-tip"),n=function(){e.$pipeWrapper.css("z-index",2),a.hide(),a.off("click")};a.show(),e.$pipeWrapper.css("z-index",0),a.on("click",".J-tip-confirm",function(i){t(),n()}),a.on("click",".J-tip-cancel",function(t){i&&i(),n()})}},{key:"_updateIsChange",value:function(t){this.isChange=t,t?this.$buttons.addClass("active"):this.$buttons.removeClass("active")}},{key:"_reset",value:function(){var t=this;this.onReset(function(i){t.activeImg=i,t._updateActiveData(),t._refresh(),t._goHome(),t._initData(),t._updateIsChange(!1)})}},{key:"_save",value:function(){var t=this,i=this.$el.find(".J-pipe-footer").find(".J-img-thumbnail.active"),e=i.index();this.onSave(function(a){if(!(a&&a[e]&&a[e].url))return window.console&&console.log("save: data error!"),!1;var n=a[e].url.replace("&amp;","&");i.addClass("new").find("img").attr("src",n),t.$markAllPanel.find(".J-img-thumbnail").eq(e).find("img").attr("src",n),t.imgList[e]=i.find("img").get(0),t._hideProgress(),t._goHome(),t.onComplete(a),t._updateIsChange(!1)},e)}},{key:"_showProgress",value:function(){this.$pipeWrapper.css("z-index",0),this.$el.find(".J-pipeImg-progress").addClass("active")}},{key:"_hideProgress",value:function(){this.$pipeWrapper.css("z-index",2),this.$el.find(".J-pipeImg-progress").removeClass("active")}},{key:"_initData",value:function(){this.rotateNum=0,this.scaleRatio=1}},{key:"_updateActiveImg",value:function(t){this.activeImg=this.imgList[t],this._updateActiveData(),this._refresh();var i={activeImg:this.activeImg,activeIndex:t};this.onChangeActive(i,function(t){})}},{key:"showMenu",value:function(t){if(this.$el.find(".J-item").eq(t).addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel").eq(t).addClass("active").siblings().removeClass("active"),3===t){var i=this.$el.find(".J-item-mark");i.find(".J-menu-btn").hide(),i.find(".J-menu-txt").show()}}},{key:"showModel",value:function(t){if(t===this.MARKTYPE.MULTIPLE){this.imgBoxHeight=this.$markAllPanel.find(".J-img-box").height(),this.imgBoxWidth=this.$markAllPanel.find(".J-img-box").width(),this.imgBoxRatio=this.imgBoxWidth/this.imgBoxHeight,this._updateActiveData(),this._refresh();var i=this.$el.find(".J-item-mark");i.addClass("active").siblings().removeClass("active"),this.$markAllPanel.addClass("active").siblings().removeClass("active"),i.find(".J-menu-btn").hide(),i.find(".J-menu-txt").show();var e=i.find(".J-menu-btn-mark-all").html();i.find(".J-menu-txt").html(e),i.find(".J-menu-btn-mark-all").hide(),i.find(".J-menu-btn-mark").show(),this.$el.find(".J-pipe-footer").addClass("mark-all")}else{this.imgBoxHeight=this.$markPanel.find(".J-img-box").height(),this.imgBoxWidth=this.$markPanel.find(".J-img-box").width(),this.imgBoxRatio=this.imgBoxWidth/this.imgBoxHeight,this._updateActiveData(),this._refresh();var a=this.$el.find(".J-item-mark");this.$el.find(".J-item:first").addClass("active").siblings().removeClass("active"),this.$el.find(".J-panel:first").addClass("active").siblings().removeClass("active"),a.find(".J-menu-btn").show(),a.find(".J-menu-txt").hide();var n=a.find(".J-menu-btn-mark").html();a.find(".J-menu-txt").html(n),a.find(".J-menu-btn-mark-all").show(),a.find(".J-menu-btn-mark").hide(),this.$el.find(".J-pipe-footer").removeClass("mark-all")}}},{key:"destory",value:function(){this.$el.remove()}},{key:"showDialog",value:function(){this.$pipeWrapper.fadeIn(100)}},{key:"hideDialog",value:function(){this.$pipeWrapper.fadeOut(100)}}]),t}();function I(){return(I=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t}).apply(this,arguments)}function C(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}e.d(i,"PipeImg",function(){return _});var _=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t);if(i=I({},{debug:!1,source:[],uploadUrl:"",sendDataType:"formdata",type:"0",mime:"image/jpeg",maxSize:500,markTextList:["producttest.en.made-in-china.com","Focus Service Co - Product SourcingFocus Service Co - Product Sourcing"],closeBtnTxt:"关闭",saveBtnTxt:"保存",resetBtnTxt:"重置",confirmBtnTxt:"确定",cancelBtnTxt:"取消",rotateMenuTxt:"旋转",turnLeftTxt:"逆时针旋转",turnRightTxt:"顺时针旋转",cropMenuTxt:"裁剪",scaleMenuTxt:"缩放",markMenuTxt:"添加水印",colorTxt:"颜色",positionTxt:"位置",opacityTxt:"透明度",showRoomTxt:"展示厅",companyNameTxt:"公司名称",markAllMenuTxt:"批量添加水印",tipTitleTxt:"提示",tipContentTxt:"尚未保存，是否确定离开？",tipConfirmBtnTxt:"确定",onInited:function(){},onComplete:function(t){},onClose:function(){}},i),this.debug=i.debug,this.source=i.source,!this.source)throw new Error("PipeImg: source is not found!");if(!Array.isArray(this.source)&&"string"!=typeof this.source)throw new Error("PipeImg: source类型错误，只能为字符串或者数组！");this.uploadUrl=i.uploadUrl,this.sendDataType=i.sendDataType,this.type=i.type,this.mime=i.mime,this.maxSize=i.maxSize,this.markTextList=i.markTextList,this.closeBtnTxt=i.closeBtnTxt,this.saveBtnTxt=i.saveBtnTxt,this.resetBtnTxt=i.resetBtnTxt,this.confirmBtnTxt=i.confirmBtnTxt,this.cancelBtnTxt=i.cancelBtnTxt,this.rotateMenuTxt=i.rotateMenuTxt,this.turnLeftTxt=i.turnLeftTxt,this.turnRightTxt=i.turnRightTxt,this.cropMenuTxt=i.cropMenuTxt,this.scaleMenuTxt=i.scaleMenuTxt,this.markMenuTxt=i.markMenuTxt,this.colorTxt=i.colorTxt,this.positionTxt=i.positionTxt,this.opacityTxt=i.opacityTxt,this.showRoomTxt=i.showRoomTxt,this.companyNameTxt=i.companyNameTxt,this.markAllMenuTxt=i.markAllMenuTxt,this.tipTitleTxt=i.tipTitleTxt,this.tipContentTxt=i.tipContentTxt,this.tipConfirmBtnTxt=i.tipConfirmBtnTxt,this.onInited=i.onInited,this.onComplete=i.onComplete,this.onClose=i.onClose,this.resultList=[],this.sourceImgList=[],this.returnJson=[],this.methods=[],this.activeIndex=0,this._init()}return function(t,i,e){i&&C(t.prototype,i),e&&C(t,e)}(t,[{key:"_init",value:function(){var t=this;this.returnJson=this.source,function(t,i,e){"string"==typeof t&&(t=[t]);var a=[],n=t.length;!function s(){if(0===n)return!1;var o=new Image;o.setAttribute("crossorigin","anonymous"),o.src=t[--n],o.onload=function(){if(a.unshift(o),a.length===t.length)return"function"==typeof i&&i(a),!1;s()},o.onerror=function(){"function"==typeof e&&e()}}()}(this.source.map(function(t,i){return t.url}),function(i){t.sourceImgList=i,t.onInited(),t._executeMethods()},function(){throw new Error("PipeImg: source load failure!")})}},{key:"_show",value:function(t){var i=this;t&&t.selected&&(this.activeIndex=t.selected),this.imgHandler=new h({sourceImg:this.sourceImgList[this.activeIndex]}),this.resultList.push(this.imgHandler.result),this.dialog=new M({debug:this.debug,imgList:this.sourceImgList,activeIndex:this.activeIndex,type:this.type,mime:this.mime,markTextList:this.markTextList,closeBtnTxt:this.closeBtnTxt,saveBtnTxt:this.saveBtnTxt,resetBtnTxt:this.resetBtnTxt,confirmBtnTxt:this.confirmBtnTxt,cancelBtnTxt:this.cancelBtnTxt,rotateMenuTxt:this.rotateMenuTxt,turnLeftTxt:this.turnLeftTxt,turnRightTxt:this.turnRightTxt,cropMenuTxt:this.cropMenuTxt,scaleMenuTxt:this.scaleMenuTxt,markMenuTxt:this.markMenuTxt,colorTxt:this.colorTxt,positionTxt:this.positionTxt,opacityTxt:this.opacityTxt,showRoomTxt:this.showRoomTxt,companyNameTxt:this.companyNameTxt,markAllMenuTxt:this.markAllMenuTxt,tipTitleTxt:this.tipTitleTxt,tipContentTxt:this.tipContentTxt,tipConfirmBtnTxt:this.tipConfirmBtnTxt,onSaveRotate:function(t,e){i._saveRotate(t,e)},onSaveCrop:function(t,e){i._saveCrop(t,e)},onSaveScale:function(t,e){i._saveScale(t,e)},onSaveMark:function(t,e){i._saveMark(t,e)},onReset:function(t){i._reset(t)},onSave:function(t,e){i._save(t,e)},onChangeActive:function(t,e){i._changeActive(t,e)},onSaveMarkAll:function(t,e){i._saveMarkAll(t,e)},onClose:function(){i.onClose()},onComplete:function(t){i.onComplete(t)}})}},{key:"_saveRotate",value:function(t,i){this.imgHandler.rotateNum=t.rotateNum,this.imgHandler.rotate(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveCrop",value:function(t,i){this.imgHandler.cropW=t.cropW,this.imgHandler.cropH=t.cropH,this.imgHandler.sx=t.sx,this.imgHandler.sy=t.sy,this.imgHandler.crop(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveScale",value:function(t,i){this.imgHandler.scaleRatio=t.scaleRatio,this.imgHandler.scale(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_saveMark",value:function(t,i){this.imgHandler.markX=t.markX,this.imgHandler.markY=t.markY,this.imgHandler.markText=t.markText,this.imgHandler.markFont=t.markFont,this.imgHandler.markStyle=t.markStyle,this.imgHandler.mark(),this.resultList.push(this.imgHandler.result),i(this.imgHandler.result)}},{key:"_reset",value:function(t){this.rotateNum=0,this.scaleRatio=1,this.resultList=this.resultList.slice(0,1),this.imgHandler=new h({sourceImg:this.resultList[0]}),t(this.resultList[0])}},{key:"_save",value:function(t,i){var e=this,a=this.imgHandler.compress(),s="blob"===this.sendDataType?a.blob:a.formdata;this.debug?setTimeout(function(){var n=[{picHeight:600,picWidth:800,tempPhotoId:"573761",url:a.base64}];e._saveSuccess(n[0],i,t)},1e3):n.a.ajax({url:this.uploadUrl,type:"POST",data:s,processData:!1,contentType:!1,success:function(a){e._saveSuccess(a[0],i,t)},error:function(){window.console&&console.log("network-error: upload failure!")}})}},{key:"_saveSuccess",value:function(t,i,e){t.url=t.url.replace("&amp;","&");var a=new Image;a.src=t.url,this.resultList=[a],this.sourceImgList[i]=a;var n={id:t.tempPhotoId,url:t.url,picWidth:t.picWidth,picHeight:t.picHeight};this.returnJson[i]=n,e&&e(this.returnJson)}},{key:"_changeActive",value:function(t,i){this.activeIndex=t.activeIndex,this.imgHandler=new h({sourceImg:t.activeImg}),this.resultList=[this.imgHandler.result],i&&i(this.imgHandler.result)}},{key:"show",value:function(t){this.methods.push({name:"show",params:t})}},{key:"_executeMethods",value:function(){var t=this;this.methods.forEach(function(i){t["_"+i.name](i.params)}),this.methods=[]}}]),t}()}])});
//# sourceMappingURL=pipeImg.thin.min.js.map